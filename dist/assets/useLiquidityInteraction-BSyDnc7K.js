import{l as V,g as ce,v as ue,z as S,as as Ue,a8 as ze,F as Qe,d as I,av as Ze,S as Ye,t as we,aO as Ke,ah as Xe,G as Ae,a5 as pe,n as Pe,cT as Ie,br as et,Q as Be,T as se,i as tt,e as _e,aj as $e,Z as le,j as xe,C as ne,B as st,I as ge,u as je,cS as Q,ai as Z,w as Ne,c as Ee,M as at,aq as rt,ae as nt,V as re}from"./index-BpSfzecM.js";import"./cross-DJ28FxNa.js";import{r as _,j as t,V as N,H as j,T as C,m as M,Y as ye,O as it,Q as ct,U as ut,ab as lt,S as ke,C as xt,l as ot}from"./vendor-CBmAETR3.js";import{H as de}from"./HTextLabelBox-D0r99Smv.js";import{a as he}from"./useWrapPoolData-CMGMCXwG.js";import{T as pt}from"./TooltipIcon-DVhxXZmh.js";import We from"./ExamplePieChart-BwD2tvSq.js";import{u as gt}from"./index-C7OfScvw.js";import{u as yt}from"./index-CqgM3rES.js";import{a as dt}from"./addLiquidity-DNM9DGI2.js";import{a as ht,u as wt}from"./useFavoritePool-5MLb1oZG.js";import{u as _t}from"./useCreatePool-CDFSrv9X.js";import{a as jt}from"./usePositionList-heG2hQcx.js";import{u as bt}from"./swapWidget-DsvWJZa9.js";import{u as ft}from"./swapWidgetConfig-UYiO35jy.js";import{u as St}from"./useGetTvlInfo-QgMBT0Ce.js";function vt(){const e=(a,r,s,u)=>{const o=Math.max(a,s),g=Math.min(r,u)-o,y=r-a,v=u-s,T=S(g.toString());console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:27 ~ estPositionAPRWithMultiMethod ~ retroRange.toString():",g.toString());const F=S(y.toString()),f=S(v.toString());return console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:30 ~ estPositionAPRWithMultiMethod ~ histRange.toString():",v.toString()),console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:8 ~ estPositionAPRWithMultiMethod ~ lowerUserPrice:",{lowerUserPrice:a,upperUserPrice:r,lowerHistPrice:s,upperHistPrice:u,retroRange:g,userRange:y,histRange:v}),g<=0?S(0):y<=g?f.div(T):g===v?T.div(F):T.div(f).mul(T.div(F))};return{getPositionApr:(a,r,s,u,o,R)=>{if(console.log("ðŸš€ ~ usePositionApr ~ posRangeInfo?.currentStatus:",r==null?void 0:r.currentStatus),!V(a)||!V(r)||!V(u))return;if(console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:52 ~ usePositionApr ~ posRangeInfo:",r),(r==null?void 0:r.currentStatus)=="Closed"||(r==null?void 0:r.currentStatus)=="Inactive")return{aprPercentageTotal:0,displayAprPercentageTotal:"0%",aprByFee:0,aprByFeeDisplay:"0%",farmingAprDisplay:"0%",posMiningReward:[]};console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:42 ~ getPositionApr ~ posPoolInfo:",a),console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:91 ~ usePositionApr ~ posRangeInfo:",r);const{minPriceRaw:g,maxPriceRaw:y}=r;console.log("ðŸš€ ~ usePositionApr ~  minPriceRaw, maxPriceRaw:",g,y);const{tokenA:v,tokenB:T,miningAprList:F,feeApr:f,feeApr7d:d,feeApr30d:l,isReverse:c,farmsEffectiveTickLower:m,farmsEffectiveTickUpper:b,farmsStatedTvl:x,farmsApr:p}=a,h=v==null?void 0:v.decimals,w=T==null?void 0:T.decimals,L=g=="0"&&y=="âˆž",z=g,D=L?2**50:y,{lower:J,upper:G}=u,K=ce.tickIndexToPrice(J,h,w).toNumber(),X=ce.tickIndexToPrice(G,h,w).toNumber(),E=c?ue(S(1).div(X).toString(),void 0,!0):ue(K,void 0,!0),A=c?ue(S(1).div(K).toString(),void 0,!0):ue(X,void 0,!0),P=e(z,D,E,A);console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:71 ~ getPositionApr ~ ",{positionMultiç³»æ•°:P.toString(),feeApr:f,feeApr7d:d,feeApr30d:l,dateType:s});const U=S(s==="day"?f??"0":s==="month"?l??"0":d??"0").mul(P).toString(),ee=[];let q=S(U);F==null||F.forEach(H=>{const W=S(P).mul(H.apr).toString(),te=he(W,!0);ee.push({...H,posMiningRewardApr:W,posMiningRewardAprDisplay:te}),q=q.add(W)});let O="0";if(o){const H=ce.tickIndexToPrice(m,h,w).toNumber(),W=ce.tickIndexToPrice(b,h,w).toNumber(),te=e(z,D,H,W);console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:123 ~ usePositionApr ~ farmsApr:",p),O=te.gt(0)?S(p).toString():"0"}return{aprPercentageTotal:q.toString(),displayAprPercentageTotal:ze(q.mul(100).toNumber()),aprByFee:U,aprByFeeDisplay:he(U,!0),posMiningReward:ee,farmingAprDisplay:Ue(S(O).mul(100).toString(),"%",2,!0)}}}}var mt=(e=>(e.add="add_liquidity_event",e.remove="remove_liquidity_event",e.swap="swap_event",e))(mt||{});function Yt(e,n){const a=_.useMemo(()=>{if(e&&n&&e!=="--"&&n!=="--"){const s=Qe(I(e).div(n).mul(100).toString(),2);return s==="NaN"?"--":s}return"--"},[e,n]),r=_.useMemo(()=>a&&a!=="--"?I(100).minus(a).toString():"--",[a]);return{tokenARatio:a,tokenBRatio:r}}const Kt=({label:e,value:n,wrapStyle:a={}})=>t.jsx(de,{wrapStyle:{p:"10px",bg:"background",borderRadius:"8px",...a},label:e,labelStyle:{fontSize:"14px",whiteSpace:"nowrap"},value:n,valueStyle:{fontSize:"14px"}}),Xt=({token:e,amount:n,amountUSD:a,loading:r})=>{const{getExplorerUrl:s}=Ze();return e?t.jsxs(N,{w:"100%",p:{base:"16px 8px",lg:"12px"},borderRadius:"8px",bg:"background",gap:"16px",children:[t.jsxs(j,{w:"100%",justify:"space-between",children:[t.jsxs(j,{gap:"12px",children:[t.jsx(Ye,{imageUrl:e==null?void 0:e.logo_url,w:"28px",h:"28px",coinType:e?e==null?void 0:e.coin_type:""}),t.jsxs(N,{align:"flex-start",gap:"4px",children:[t.jsx(C,{color:"text_caption",fontSize:"16px",children:we(e==null?void 0:e.symbol,10)}),t.jsx(C,{fontSize:"12px",children:e==null?void 0:e.name})]})]}),t.jsx(Ke,{address:(e==null?void 0:e.coin_type)||"",fontSize:"14px",color:"text_caption",onClickLink:()=>window.open(s(e==null?void 0:e.coin_type,"coin")),wrapStyle:{gap:"6px"},iconGap:"6px"})]}),t.jsx(de,{label:"Amount",labelStyle:{fontSize:"14px"},value:Xe(Ae(n||"0",e.decimals)),valueStyle:{fontSize:"14px"},isLoading:r,wrapStyle:{h:"14px"},skeletonStyle:{valueW:"120px"}}),t.jsx(de,{label:"Amount (USD)",labelStyle:{fontSize:"14px"},value:a&&a!=="--"?`$${pe(a)}`:"--",valueStyle:{fontSize:"14px"},isLoading:r,wrapStyle:{h:"14px"},skeletonStyle:{valueW:"120px"}})]}):null};function Tt(){const{fetchByApi:e}=Pe();return{fetchBinsTradeData:async({poolId:a,dataType:r,period:s})=>{if(!a)return[];try{const u=await e(Ie,"GET",{dataType:r,period:s,pool:a});return console.log(u,et(BigInt(4294965899)),"res-fetchBinsTradeData"),u&&u.bins&&u.bins.length?u.bins:[]}catch(u){return console.error(u,"res-fetchAnalyticsData"),[]}}}}function Ft(e,n,a,r,s){const[u,o]=_.useState(!1),[R,g]=_.useState({}),{fetchBinsTradeData:y}=Tt(),{getTokenAmountValue:v}=Be(),T=_.useCallback(l=>l==="24H"?1:l==="7D"?7:l==="30D"?30:1,[]);_.useEffect(()=>{s!=null&&s.poolAddress&&(o(!0),y({dataType:"fee",period:a,poolId:s.poolAddress}).then(l=>{const c={};l.forEach(m=>{c[`${m.binId}-${a}`]=m.value}),g({...R,...c})}).finally(()=>{o(!1)}))},[s==null?void 0:s.poolAddress,a]);const F=_.useCallback(l=>{const c=[];let m=S(0),b=S(0);if(!s)return{validBinList:c,total_user_amount_a:m.toString(),total_user_amount_b:b.toString()};for(const x of l){const p=x.bin_id,h=e.find(D=>D.bin_id===p),w=R[`${x.bin_id}-${a}`],L=se(x.amount_a,s.tokenA.decimals),z=se(x.amount_b,s.tokenB.decimals);m=m.add(L),b=b.add(z),h&&w&&c.push({bin_id:p,user_amount_a:se(x.amount_a,s.tokenA.decimals),user_amount_b:se(x.amount_b,s.tokenB.decimals),total_amount_a:se(h.amount_a,s.tokenA.decimals),total_amount_b:se(h.amount_b,s.tokenB.decimals),total_fee_value:w||"0"})}return{validBinList:c,total_user_amount_a:m.toString(),total_user_amount_b:b.toString()}},[e,a,R]),f=_.useCallback(l=>{var z,D,J,G,K,X;const{validBinList:c,total_user_amount_a:m,total_user_amount_b:b}=F(l),x=v((z=s==null?void 0:s.tokenA)==null?void 0:z.coin_type,m),p=v((D=s==null?void 0:s.tokenB)==null?void 0:D.coin_type,b),h=S(x).add(S(p));let w=S(0);for(const E of c){const A=v((J=s==null?void 0:s.tokenA)==null?void 0:J.coin_type,E.total_amount_a),P=v((G=s==null?void 0:s.tokenB)==null?void 0:G.coin_type,E.total_amount_b),U=S(A).add(S(P)),ee=v((K=s==null?void 0:s.tokenA)==null?void 0:K.coin_type,E.user_amount_a),q=v((X=s==null?void 0:s.tokenB)==null?void 0:X.coin_type,E.user_amount_b),O=S(ee).add(S(q)),H=O.gt(0)?S(O).div(U.add(O)):S(0),W=H.mul(E.total_fee_value);w=S(w).add(W),console.log("ðŸš€ ~ file: useDlmmApr.ts:123 ~ estimatedFee ~ info1:",{bin_id:E.bin_id,total_amount_value:U.toString(),user_amount_value:O.toString(),total_fee_value:E.total_fee_value,fee:W.toString(),fee_rate:H.toString()})}return{total_fee:w.toString(),total_user_value:h.toString(),show_fee_apr:c.length>0}},[e,R,a]);return{estimateApr:_.useMemo(()=>{const l=n.find(L=>L.liquidity&&L.bin_id===r);if(!(s!=null&&s.tokenA))return{fee_apr:void 0,miningAprList:[]};if(!l)return{fee_apr:0,miningAprList:[]};const{total_fee:c,total_user_value:m,show_fee_apr:b}=f(n);let x=c;console.log("ðŸš€ ~ file: useDlmmApr.ts:123 ~ estimatedFee ~ info2:",{total_fee:c,total_user_value:m,show_fee_apr:b,user_bins:n,active_bin:l,allBinList:e});let p=T(a);if(s!=null&&s.createTimestamp){const D=(Date.now()/1e3-Number(s.createTimestamp))/(60*60*24);console.log("ðŸš€ ~ file: useDlmmApr.ts:198 ~ poolAgeDays:",D),D<1?(x=S(x).div(D).mul(p).toString(),(a==="7D"||a==="30D")&&(p=1)):D<7?(x=S(x).div(D).mul(p).toString(),a==="30D"&&(p=7)):D<30&&a==="30D"&&(x=S(x).div(D).mul(p).toString())}const h=S(365).div(p),w=S(x).div(m).mul(h).toString();return console.log("ðŸš€ ~ file: useDlmmApr.ts:123 ~ estimatedFee ~ info2:",{total_fee:c,preTotalFee:x,total_user_value:m,show_fee_apr:b,user_bins:n,active_bin:l,allBinList:e,fee_apr:w,period:a,feeDataObj:R,miningAprList:s==null?void 0:s.miningAprList}),{fee_apr:w,miningAprList:s==null?void 0:s.miningAprList}},[a,n,e,R,r,s]),loading:u}}const Ct=(e,n)=>({priceRangeMap:null,setPriceRangeMap:a=>{e(()=>({priceRangeMap:a}))},resetDeposit:()=>{e(()=>({priceRangeMap:null}))}}),Dt=tt(Ct);function Le({estimateApr:e,placement:n="top",miningAprList:a,haveMining:r,loading:s}){const[u,o]=_.useState(new Map),R=isNaN(e),{getTokenListInfo:g}=_e();$e(()=>{const l=a==null?void 0:a.map(c=>c==null?void 0:c.coinType);g(l).then(c=>{c&&(c==null?void 0:c.size)>0&&o(c)})},[a]);const y=R?[]:[{name:"Fees",value:Number(e),displayValue:ze(I(e).mul(100).toString())??"--",color:"#68FFD8"}],v=["#6868FF","#FFCA68","#C8FF00","#FF562B","#0A05FF","#FF65F8","#FF3232","#842CFF","#31D829"];let T=-1;const F=a==null?void 0:a.map(l=>{var h,w,L;const{symbol:c,coinType:m,apr:b,aprDisplay:x}=l||{},p=le(m||"")==le(((w=(h=xe)==null?void 0:h.sui_coin)==null?void 0:w.coin_type)||"");return T=p?T:T+1,{name:`${we(`${c||((L=u==null?void 0:u.get(m))==null?void 0:L.symbol)||""}`,8)} Reward`,value:Number(b),displayValue:x,color:p?"#65C8FF":v[T],coinType:m}}).sort((l,c)=>c.value-l.value),f=y.concat(F??[]),d=R?e:he(I(f==null?void 0:f.reduce((l,c)=>I(l).plus(c==null?void 0:c.value).toNumber(),0)).toString(),!0,!1,!0);return s?t.jsx(M,{w:"50px",h:"14px"}):r?t.jsx(ne,{placement:n,maxW:"350px",tooltip:t.jsx(_.Suspense,{fallback:t.jsxs(N,{w:"320px",h:"279px",align:"flex-start",gap:"16px",children:[t.jsxs(j,{justify:"space-between",w:"100%",children:[t.jsx(M,{w:"30%",h:"20px"}),t.jsx(M,{w:"30%",h:"20px"})]}),t.jsxs(j,{justify:"space-between",gap:"20px",w:"100%",children:[t.jsx(ye,{w:"64px",h:"64px"}),t.jsxs(N,{w:"calc(100% - 84px)",children:[t.jsxs(j,{justify:"space-between",w:"100%",children:[t.jsx(M,{w:"40%",h:"16px"}),t.jsx(M,{w:"30%",h:"16px"})]}),t.jsxs(j,{justify:"space-between",w:"100%",children:[t.jsx(M,{w:"40%",h:"16px"}),t.jsx(M,{w:"30%",h:"16px"})]}),t.jsxs(j,{justify:"space-between",w:"100%",children:[t.jsx(M,{w:"40%",h:"16px"}),t.jsx(M,{w:"30%",h:"16px"})]})]})]})]}),children:t.jsxs(N,{gap:"16px",w:"320px",overflow:"hidden",align:"flex-start",pb:"2px",children:[t.jsxs(j,{w:"100%",justify:"space-between",children:[t.jsx(C,{color:"text_caption",children:"Total APR"}),t.jsx(C,{color:"text_caption",fontSize:"16px",children:d??"--"})]}),t.jsx(_.Suspense,{fallback:t.jsxs(j,{justify:"space-between",gap:"20px",w:"100%",children:[t.jsx(ye,{w:"64px",h:"64px"}),t.jsxs(N,{w:"calc(100% - 84px)",children:[t.jsxs(j,{justify:"space-between",w:"100%",children:[t.jsx(M,{w:"40%",h:"16px"}),t.jsx(M,{w:"30%",h:"16px"})]}),t.jsxs(j,{justify:"space-between",w:"100%",children:[t.jsx(M,{w:"40%",h:"16px"}),t.jsx(M,{w:"30%",h:"16px"})]}),t.jsxs(j,{justify:"space-between",w:"100%",children:[t.jsx(M,{w:"40%",h:"16px"}),t.jsx(M,{w:"30%",h:"16px"})]})]})]}),children:t.jsx(We,{originData:f})})]})}),children:t.jsx(C,{color:"primary",textDecoration:"underline dotted",textDecorationColor:"primary",cursor:"pointer",children:d??"--"})}):t.jsx(C,{color:R?"text_caption":"primary",textDecorationColor:"primary",children:d??"--"})}function At({direct:e,wrapStyle:n={},currentLiquidityBins:a,maxBinRangeData:r,activeId:s}){var c,m;const{priceRangeMap:u}=Dt(),[o,R]=_.useState({type:"30D",key:"month"}),{minPriceForDate:g,maxPriceForDate:y,setMinPriceForDate:v,setMaxPriceForDate:T,dlmmApiPoolInfo:F}=gt();_.useEffect(()=>{let b="",x="";if(V(u)&&V(o)){const p=`${o==null?void 0:o.type}-${F==null?void 0:F.poolId}`,h=u[p];if(h){const w=h[0],L=e?w:I(1).div(w).toString(),z=h[1],D=e?z:I(1).div(z).toString();b=pe(L,6),x=pe(D,6)}else b="-",x="-"}else b="-",x="-";v(b),T(x)},[e,o==null?void 0:o.key,u,F==null?void 0:F.poolId]);const{isApp:f}=je(),{estimateApr:d,loading:l}=Ft((r==null?void 0:r.list)||[],(a==null?void 0:a.list)||[],o==null?void 0:o.type,s,F);return f?t.jsxs(j,{w:"100%",justify:"space-between",flexDirection:{base:"column",lg:"row"},children:[t.jsxs(N,{w:{base:"100%",lg:"50%"},flexDirection:{base:"row",lg:"column"},justify:{base:"space-between",lg:"center"},alignItems:{base:"center",lg:"flex-start"},flex:"1",bg:"card_bg",borderRadius:"8px",children:[t.jsxs(C,{fontSize:"14px",whiteSpace:"nowrap",children:[o==null?void 0:o.type,"Â Price Range"]}),t.jsx(M,{minH:"14px",isLoaded:g!==void 0&&y!==void 0,children:t.jsx(j,{flexDir:"row",alignItems:"center",children:t.jsxs(C,{fontSize:"14px",color:"text_caption",children:[e?g==="-"?g:Q(Z(g)):y==="-"?y:Q(Z(y)),"Â -Â ",e?y==="-"?y:Q(Z(y)):g==="-"?g:Q(Z(g))]})})})]}),t.jsxs(N,{w:{base:"100%",lg:"50%"},flexDirection:{base:"row",lg:"column"},justify:{base:"space-between",lg:"center"},alignItems:{base:"center",lg:"flex-start"},flex:"1",bg:"card_bg",borderRadius:"8px",children:[t.jsxs(j,{w:{base:"unset",lg:"100%"},justify:"space-between",children:[t.jsx(ne,{tooltip:t.jsxs(C,{fontSize:"12px",lineHeight:"20px",children:["APR based on the past ",o==null?void 0:o.type," historical trade fees and emissions. Only positions in range earn yield. Past performance is not indicative of future results. Calculations are an estimate and only for reference."]}),children:t.jsxs(j,{gap:"4px",children:[t.jsx(C,{fontSize:"14px",h:"20px",lineHeight:"20px",children:"Estimated APR"}),t.jsx(ge,{xlinkHref:"#icon-icon_tips",fontSize:"20px"})]})}),t.jsx(j,{pos:"relative",h:"100%",alignItems:"start",children:t.jsx(Oe,{type:o,onTypeChange:b=>{R({type:b.label,key:b.key})},list:oe})})]}),t.jsx(Le,{loading:l,estimateApr:a===void 0?"--":(d==null?void 0:d.fee_apr)??"0",miningAprList:d==null?void 0:d.miningAprList,haveMining:(((c=d==null?void 0:d.miningAprList)==null?void 0:c.length)||0)>0})]})]}):t.jsxs(j,{w:"100%",gap:"16px",justify:"space-between",...n,children:[t.jsxs(ke,{flexDir:{base:"row",lg:"column"},align:{base:"center",lg:"flex-start"},justify:{base:"space-between",lg:"center"},w:{base:"100%",lg:"auto"},gap:"4px",children:[t.jsx(j,{children:t.jsxs(C,{lineHeight:"20px",fontSize:"14px",whiteSpace:"nowrap",children:[o==null?void 0:o.type,"Â Price Range"]})}),t.jsxs(C,{color:"text_caption",fontSize:"14px",lineHeight:"14px",h:"14px",children:[e?g==="-"?g:Q(Z(g)):y==="-"?y:Q(Z(y)),"Â -Â ",e?y==="-"?y:Q(Z(y)):g==="-"?g:Q(Z(g))]})]}),t.jsxs(ke,{flexDir:{base:"row",lg:"column"},align:{base:"center",lg:"flex-start"},justify:{base:"space-between",lg:"center"},w:{base:"100%",lg:"auto"},gap:"4px",children:[t.jsx(j,{children:t.jsx(ne,{tooltip:t.jsxs(C,{fontSize:"12px",lineHeight:"20px",children:["APR based on the past ",o==null?void 0:o.type," historical trade fees and emissions. Only positions in range earn yield. Past performance is not indicative of future results. Calculations are an estimate and only for reference."]}),children:t.jsxs(j,{gap:"4px",children:[t.jsx(C,{children:"Estimated APR"}),t.jsx(ge,{xlinkHref:"#icon-icon_tips"})]})})}),t.jsx(Le,{loading:l,estimateApr:a===void 0?"--":(d==null?void 0:d.fee_apr)??"0",miningAprList:d==null?void 0:d.miningAprList,haveMining:(((m=d==null?void 0:d.miningAprList)==null?void 0:m.length)||0)>0})]}),t.jsx(Ne,{type:"outlineTab",tabList:oe,currentTab:o,handleChangeTab:b=>{R({type:b.label,key:b.key})},isActive:(b,x)=>b.key===x.key,wrapStyle:{h:f?"28px":"32px",p:"3px",border:"1px solid",borderColor:"border",borderRadius:"8px",gap:"4px",w:"auto"},itemStyle:{h:f?"20px":"24px",p:f?"4px 6px":"4px 8px",fontSize:"12px",borderRadius:"4px",flex:1}})]})}function Oe({type:e,onTypeChange:n,list:a}){return t.jsx(it,{isLazy:!0,placement:"bottom-end",children:({isOpen:r,onClose:s})=>t.jsxs(t.Fragment,{children:[t.jsx(ct,{cursor:"pointer",bg:"none",children:t.jsx(st,{p:"5px 8px",borderRadius:"8px",children:t.jsxs(j,{width:"100%",justifyContent:"space-between",gap:"2px",children:[t.jsx(C,{color:"text_caption",fontSize:{base:"12px",lg:"14px"},children:e==null?void 0:e.type}),t.jsx(ge,{transition:"transform 0.5s",transform:r?"rotate(180deg)":"rotate(0deg)",xlinkHref:"#icon-icon_descending_nor",svgFill:"text_caption",svgW:"26px",svgH:"26px"})]})})}),t.jsx(ut,{bg:"bg_secondary",borderRadius:"8px",p:"4px",opacity:"1",overflow:"hidden",minW:"56px",children:t.jsx(N,{w:"58px",gap:"8px",children:a.map(u=>t.jsx(lt,{fontSize:"14px",textAlign:"center",borderRadius:"8px",color:(e==null?void 0:e.key)===u.key?"primary":"#909CA4",onClick:()=>n(u),bg:"menu_item_bg",justifyContent:"center",children:u.label},u.key))})})]})})}const Mt=({totalAprDisplay:e,farmingAprDisplay:n,placement:a="top",poolInfo:r,positionApr:s,showFarmingApr:u=!1,haveUnderline:o=!1,flexDirection:R="column",isActive:g=!0})=>{var b;const{getTokenListInfo:y}=_e(),[v,T]=_.useState(new Map);$e(()=>{var p,h;if(((p=s==null?void 0:s.posMiningReward)==null?void 0:p.length)==0)return;const x=(h=s==null?void 0:s.posMiningReward)==null?void 0:h.map(w=>w==null?void 0:w.coinType);y(x).then(w=>{w&&(w==null?void 0:w.size)>0&&T(w)})},[s==null?void 0:s.posMiningReward]);const{isApp:F}=je(),f=r!=null&&r.feeApr&&S(r==null?void 0:r.feeApr).gt(0)?[{name:"Fees",value:Number(s==null?void 0:s.aprByFee),displayValue:s==null?void 0:s.aprByFeeDisplay,color:"#68FFD8"}]:[],d=["#6868FF","#FFCA68","#C8FF00","#FF562B","#0A05FF","#FF65F8","#FF3232","#842CFF","#31D829"];let l=-1;const c=(b=s==null?void 0:s.posMiningReward)==null?void 0:b.map(x=>{var D,J,G;const{symbol:p,coinType:h,posMiningRewardApr:w,posMiningRewardAprDisplay:L}=x||{},z=le(h||"")==le(((J=(D=xe)==null?void 0:D.sui_coin)==null?void 0:J.coin_type)||"");return l=z?l:l+1,{name:`${we(`${p||((G=v==null?void 0:v.get(h))==null?void 0:G.symbol)||""}`,8)} Reward`,value:Number(w),displayValue:L,color:z?"#65C8FF":d[l]}}).sort((x,p)=>p.value-x.value),m=f.concat(c);return g?t.jsx(j,{justify:"flex-end",onClick:x=>{F&&Ee(x)},children:V(s)&&(s==null?void 0:s.aprPercentageTotal)>0?t.jsx(ne,{maxW:"350px",placement:a,showTooltip:(r==null?void 0:r.haveMining)&&e!=="--",tooltip:t.jsxs(N,{w:"100%",p:"4px",children:[t.jsxs(j,{w:"100%",justify:"space-between",children:[t.jsx(C,{color:"text_caption",children:"Total APR"}),t.jsx(C,{color:"text_caption",fontSize:"16px",children:e})]}),t.jsx(kt,{originData:m})]}),children:t.jsx(xt,{children:t.jsx(Rt,{flexDirection:R,showFarmingApr:u,haveUnderline:o,poolInfo:r,totalAprDisplay:e,farmingAprDisplay:n})})}):t.jsx(C,{color:"text_caption",children:"--"})}):t.jsx(C,{color:"text_caption",children:"0%"})},Rt=({poolInfo:e,totalAprDisplay:n,farmingAprDisplay:a,haveUnderline:r,showFarmingApr:s=!1,flexDirection:u="column"})=>t.jsxs(N,{align:u=="column"?"flex-end":"center",gap:"4px",flexDirection:u,children:[t.jsx(C,{as:"span",color:"primary",cursor:e!=null&&e.haveMining&&n!=="0%"?"help":"text",textDecoration:r&&(e!=null&&e.haveMining)&&n!=="0%"?"underline dotted":"none",textUnderlineOffset:"3px",children:n}),(e==null?void 0:e.haveFarming)&&s&&t.jsx(ne,{tooltip:"Your Farming APR",children:t.jsx(C,{fontWeight:"500",p:"2px 4px",fontSize:"12px",color:"primary_yellow",bg:"primary_yellow_opacity.10",borderRadius:"4px",whiteSpace:"nowrap",children:a=="--"?"--":"+"+a})})]}),kt=({originData:e})=>t.jsx(_.Suspense,{fallback:t.jsxs(j,{justify:"space-between",gap:"20px",w:"100%",children:[t.jsx(ye,{w:"64px",h:"64px"}),t.jsxs(N,{w:"calc(100% - 84px)",children:[t.jsxs(j,{justify:"space-between",w:"100%",children:[t.jsx(M,{w:"40%",h:"16px"}),t.jsx(M,{w:"30%",h:"16px"})]}),t.jsxs(j,{justify:"space-between",w:"100%",children:[t.jsx(M,{w:"40%",h:"16px"}),t.jsx(M,{w:"30%",h:"16px"})]}),t.jsxs(j,{justify:"space-between",w:"100%",children:[t.jsx(M,{w:"40%",h:"16px"}),t.jsx(M,{w:"30%",h:"16px"})]})]})]}),children:t.jsx(We,{originData:e})}),oe=[{label:"24H",key:"day"},{label:"7D",key:"week"},{label:"30D",key:"month"}];function Pt({ranges:e,currentPosPoolsRelatedData:n,posPoolInfo:a,isActive:r,tab:s,setTab:u,wrapStyle:o,showFarmingApr:R=!1,flexDirection:g="column",isFarms:y=!1,currentPosTvl:v,isPosition:T=!1,children:F}){const{isApp:f}=je(),{getPositionApr:d}=vt(),l=_.useMemo(()=>{if(console.log("ðŸš€ðŸš€ðŸš€ ~ EstimatedApr.tsx:54 ~ EstimatedApr ~ currentPosPoolsRelatedData:",{currentPosPoolsRelatedData:n,posPoolInfo:a,ranges:e,tab:s}),V(n)&&V(a)&&V(e)&&(Number(n==null?void 0:n.minPriceRaw)!==0||Number(n==null?void 0:n.maxPriceRaw)!==0)&&V(s))return d(a,n,s==null?void 0:s.key,e[s==null?void 0:s.key],y&&!T,v)},[JSON.stringify(n),JSON.stringify(a),JSON.stringify(s==null?void 0:s.key),JSON.stringify(e),T]);return t.jsxs(j,{w:"100%",justify:"space-between",children:[F,t.jsxs(N,{w:{base:"100%",lg:"unset"},gap:"4px",align:{base:"space-between",lg:"flex-start"},flexDirection:{base:"row",lg:"column"},...o,children:[t.jsxs(j,{w:{base:"calc(100% - 60px)",lg:"unset"},gap:"4px",flexWrap:{base:"wrap",lg:"nowrap"},children:[t.jsx(C,{color:"primary_gray",mr:"-2px",whiteSpace:"nowrap",children:"Estimated APR"}),t.jsx(pt,{tooltipCon:`APR based on the past ${s.type} historical trade fees and emissions. Only positions in range earn yield. Past performance is not indicative of future results.
Calculations are an estimate and only for reference.`}),f&&t.jsx(Oe,{type:s,onTypeChange:c=>{u({type:c.label,key:c.key})},list:oe})]}),t.jsx(j,{w:"60px",align:"center",justify:{base:"flex-end",lg:"flex-start"},children:t.jsx(Mt,{isActive:r,haveUnderline:!0,showFarmingApr:R,poolInfo:a,positionApr:l,flexDirection:g,farmingAprDisplay:l==null?void 0:l.farmingAprDisplay,totalAprDisplay:l==null?void 0:l.displayAprPercentageTotal})})]}),!f&&t.jsx(Ne,{type:"outlineTab",tabList:oe,currentTab:s,handleChangeTab:c=>{u({type:c.label,key:c.key})},isActive:(c,m)=>c.key===m.key,wrapStyle:{h:f?"28px":"32px",p:"3px",border:"1px solid",borderColor:"border",borderRadius:"8px",gap:"4px",w:"auto"},itemStyle:{h:f?"20px":"24px",p:f?"4px 6px":"4px 8px",fontSize:"12px",borderRadius:"4px",flex:1}})]})}function It({children:e,title:n,wrapStyle:a={},divider:r=!1,titleStyle:s={}}){const u=Array.isArray(e);return t.jsxs(N,{gap:"8px",p:r?"0 16px 16px":"10px 16px 16px",borderRadius:"16px",bg:"card_bg",...a,children:[t.jsxs(j,{w:"100%",justify:"space-between",h:r?"52px":"32px",borderBottom:r?"1px solid":"none",borderColor:"border",p:r?"10px 0":"0",...s,children:[typeof n=="string"?t.jsx(C,{fontSize:"16px",fontWeight:"500",color:"text_caption",children:n}):n,u?e==null?void 0:e[0]:e]}),u&&(e==null?void 0:e[1])]})}var He=(e=>(e.deposit="Provide Liquidity",e.positions="My Positions",e.analytics="Analytics",e))(He||{});const Y=[{label:"Provide Liquidity",key:"deposit"},{label:"My Positions",key:"positions"},{label:"Analytics",key:"analytics"}];function es({apiPoolInfo:e}){var fe,Se,ve;const{currentAccount:n}=at(),{tab:a,poolAddress:r}=rt(),s=ot(),[u,o]=_.useState(),[R,g]=_.useState(Y),[y,v]=_.useState(((fe=Y==null?void 0:Y.find(i=>i.key===a))==null?void 0:fe.key)||Y[0].key),[T,F]=_.useState(),[f,d]=_.useState(),{posBaseListGroupByPool:l,posBaseListLoading:c}=jt(),{addFavorites:m,removeFavorites:b}=ht(),{poolFavoriteIds:x}=wt(),{fromToken:p,toToken:h}=dt(),{fetchTokenPrices:w}=Be(),{setFromCoin:L,setToCoin:z}=bt(),{setIsOpen:D}=ft(),{setPoolType:J,setCurrentStep:G}=_t(),{isSwapWidgetDisplay:K}=nt(),X=()=>{var i,B;K?D(!0):s(`/swap/${(i=e==null?void 0:e.displayTokenA)==null?void 0:i.coin_type}/${(B=e==null?void 0:e.displayTokenB)==null?void 0:B.coin_type}`)};_.useEffect(()=>(p&&h&&(L(p),z(h)),()=>{L(xe.clmm_swap.from_coin),z(xe.clmm_swap.to_coin)}),[p,h]);const E=_.useMemo(()=>{if(r&&r!=="undefined"){const i=l[r.toLowerCase()||""];return i&&(i!=null&&i.list)&&(i==null?void 0:i.list.length)>0?i==null?void 0:i.list.length:void 0}},[JSON.stringify(l),r]);_.useEffect(()=>{g(Y==null?void 0:Y.map(i=>({...i,num:i.label==="My Positions"&&(n!=null&&n.address)?E:void 0})))},[E,n==null?void 0:n.address]),_.useLayoutEffect(()=>{a&&a!==y&&v(a)},[a]);const A=_.useMemo(()=>x==null?void 0:x.includes(r||""),[JSON.stringify(x),r]),P=i=>{Ee(i),r&&(A?b(r):m(r))},U=_.useMemo(()=>A?{tooltip:"Remove from Watchlist",xlinkHref:"#icon-icon_star_sel",svgFill:"primary_blue",svgHover:"primary"}:{tooltip:"Add to Watchlist",xlinkHref:"#icon-icon_star",svgFill:"text_paragraph",svgHover:"text_caption"},[A]);_.useEffect(()=>{F(e==null?void 0:e.displayTokenA),d(e==null?void 0:e.displayTokenB)},[(Se=e==null?void 0:e.displayTokenA)==null?void 0:Se.coin_type,(ve=e==null?void 0:e.displayTokenB)==null?void 0:ve.coin_type]);const ee=()=>{var i,B;G(2),J("clmm"),s(`/create-pool/${(i=e==null?void 0:e.displayTokenA)==null?void 0:i.coin_type}/${(B=e==null?void 0:e.displayTokenB)==null?void 0:B.coin_type}/${u==null?void 0:u.feeRate}`)},q=()=>{var B;const i=[];p&&i.push(p.coin_type),h&&i.push(h.coin_type),e!=null&&e.miningRewardList&&((B=e==null?void 0:e.miningRewardList)==null||B.forEach(k=>{i.push(re(k==null?void 0:k.coinType).full_address)})),i.length>0&&w(Array.from(new Set(i.filter(k=>k&&k!=="undefined"))))};_.useEffect(()=>{q()},[p==null?void 0:p.coin_type,h==null?void 0:h.coin_type]);const{fetchTokenInfo:O}=_e(),{setApiPoolInfo:H,apiPoolInfoLoading:W,netError:te}=yt(),{setTotalAmountUSD:be}=St(),Ve=_.useCallback(async(i,B,k,me,ae,Te)=>{var Fe,Ce,De,Me,Re;const ie=Object.keys(He).find(qe=>qe===y),Ge=[me,ae].filter(Boolean),$=await O(Ge);if(k!=null&&k.coin_type||(Fe=$==null?void 0:$.get(ae||""))!=null&&Fe.coin_type)if(re(i==null?void 0:i.coin_type).full_address===re((k==null?void 0:k.coin_type)||((Ce=$==null?void 0:$.get(ae||""))==null?void 0:Ce.coin_type)||"").full_address)F(f),d(T);else{if(re(i==null?void 0:i.coin_type).full_address===re((B==null?void 0:B.coin_type)||((De=$==null?void 0:$.get(me||""))==null?void 0:De.coin_type)||"").full_address)return;s(Te?`/clmm?tab=${ie}&from=${i==null?void 0:i.coin_type}&to=${(k==null?void 0:k.coin_type)||((Me=$==null?void 0:$.get(ae||""))==null?void 0:Me.coin_type)}`:`/clmm?tab=${ie}&from=${(k==null?void 0:k.coin_type)||((Re=$==null?void 0:$.get(ae||""))==null?void 0:Re.coin_type)}&to=${i==null?void 0:i.coin_type}`),H(null),be("")}else s(Te?`/clmm?tab=${ie}&from=${i==null?void 0:i.coin_type}`:`/clmm?tab=${ie}&to=${i==null?void 0:i.coin_type}`),H(null),be("")},[T,f,y]),Je=_.useCallback(async(i,B)=>{const k=await O(i||"");return{value:B||(i?k:void 0),isWhiteSelect:!1,whiteTokenList:void 0,disabled:te,tokenStyle:{p:0,border:"none"},tokenSize:"32px",symbolStyle:{fontSize:"20px",fontWeight:"500"},wrapStyle:{h:"32px",border:"none",p:"0",bg:"background"},loading:!B&&W}},[te,W]);return{currentTab:y,setCurrentTab:v,tabList:R,favoriteStyle:U,onChangeFavorites:P,selectedTokenA:T,selectedTokenB:f,setSelectedTokenA:F,setSelectedTokenB:d,onConfirm:ee,feeTier:u,setFeeTier:o,refreshMarketPrice:q,onJump2Swap:X,handleSelectToken:Ve,getSelectTokenProps:Je}}export{It as D,mt as E,Kt as I,At as P,Xt as T,Pt as a,es as b,He as c,Tt as d,Dt as e,Yt as u};
