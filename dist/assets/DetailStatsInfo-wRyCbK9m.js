import{r as g,j as l,V as f,T as r,H as b,B as ye,m as L,S as O,ad as we,w as Ae,i as xe}from"./vendor-CBmAETR3.js";import{u as Ce}from"./usePosClaimFeeAndReward-DDP49i6N.js";import{u as Te}from"./StatusPosition-DomBkXw9.js";import{n as _e,au as Se,Q as Fe,u as pe,av as ve,e as Me,l as Re,A as Ee,v as ie,t as N,p as te,d as C,aj as ke,w as Le,ai as $,aw as ze}from"./index-Lo8eQgA0.js";import"./cross-J9VCREIf.js";import{a as We}from"./usePositionList-Bupy7RnX.js";import{u as Ge}from"./detail-Bk2dr4YI.js";import{L as Ve}from"./LiquidityValueBlock-BFN5N1z7.js";function Ye(){const{fetchByApi:m}=_e();return{getClmmPositionHistoricalProfit:async j=>{try{const t=await m(Se,"GET",{position_id:j});if(t!=null&&t.FeeA)return t}catch(t){console.log("ðŸš€ðŸš€ðŸš€ ~ useGetClmmPositionHistoricalProfit.ts:15 ~ getClmmPositionHistoricalProfit ~ error:",t)}}}}function Ze({dailyEarnUSDDisplay:m,originResult:n}){var D,q,H,B,Y,I,P;const{tokenAmountAfterA:j,tokenAmountAfterB:t,currentPosDetailTab:K,curPosContractPoolInfo:d,isPosDetailRefresh:T,isAutoClaim:_,currentPosPoolInfo:z}=Ge(),{currentPosBaseInfo:e,posFeeData:u,posRewardsData:y,posLiquidityData:W,currentPosBaseInfoLoading:G,posFeeDataLoading:S,posRewardsDataLoading:F}=We(),o=g.useMemo(()=>W[e==null?void 0:e.posId],[W,e==null?void 0:e.posId]),x=g.useMemo(()=>u[e==null?void 0:e.posId],[u,e==null?void 0:e.posId]),p=g.useMemo(()=>(y[e==null?void 0:e.posId]??[]).filter((i,M)=>{var E,k;return C(((k=(E=d==null?void 0:d.rewarder_infos)==null?void 0:E[M])==null?void 0:k.emissionsEveryDay)||0).gt(0)||C((i==null?void 0:i.display_amount_owed)||0).gt(0)}),[y,e==null?void 0:e.posId,d==null?void 0:d.rewarder_infos]),[v,de]=g.useState("--"),{calculatePendingYield:re}=Ce();g.useEffect(()=>{if(!G&&!S&&!F&&e){const{total:s}=re([e],u,y);de(s)}},[G,S,F,u,y]);const{toClaimPosition:ce,isClaimLoading:U}=Te(),Q=_?j!==""||t!=="":!1,{isApp:h}=pe(),X=[{label:"Unclaimed",value:"Unclaimed"},{label:"Claimed",value:"Claimed"}],[V,ge]=g.useState(X[0]),be=s=>{ge(s)},{getClmmPositionHistoricalProfit:me}=Ye(),[a,J]=g.useState(null),Z=async()=>{var i,M,R;const s=await me(e==null?void 0:e.posId);console.log("ðŸš€ðŸš€ðŸš€ ~ DetailStatsInfo.tsx:93 ~ handleGetClmmPositionHistoricalProfit ~ res:",s),(a===null||((i=s==null?void 0:s.FeeA)==null?void 0:i.Amount)!==void 0&&C($((M=s==null?void 0:s.FeeA)==null?void 0:M.Amount)).gt((R=a==null?void 0:a.FeeA)==null?void 0:R.Amount))&&J(s)};ke(()=>{e!=null&&e.posId&&Z()},[e==null?void 0:e.posId,x,p,z]);const ue=async()=>{var E,k,ee,le,se;await ce(e,d);const s=C(((E=a==null?void 0:a.FeeA)==null?void 0:E.Amount)||0).add((x==null?void 0:x.displayFeeOwedA)||0).toString(),i=C(((k=a==null?void 0:a.FeeB)==null?void 0:k.Amount)||0).add((x==null?void 0:x.displayFeeOwedB)||0).toString(),R=ze([...p==null?void 0:p.map(c=>c==null?void 0:c.coin_address),...(ee=a==null?void 0:a.Mining)==null?void 0:ee.map(c=>c==null?void 0:c.CoinType)]).map(c=>{var ae,ne,oe;const he=((ae=p==null?void 0:p.find(A=>(A==null?void 0:A.coin_address)===c))==null?void 0:ae.display_amount_owed)||"0",fe=((oe=(ne=a==null?void 0:a.Mining)==null?void 0:ne.find(A=>(A==null?void 0:A.CoinType)===c))==null?void 0:oe.Amount)||"0",je=C($(he)).add($(fe)).toString();return{CoinType:c,Amount:je||0}});J({FeeA:{Amount:s,CoinType:(le=a==null?void 0:a.FeeA)==null?void 0:le.CoinType},FeeB:{Amount:i,CoinType:(se=a==null?void 0:a.FeeB)==null?void 0:se.CoinType},Mining:R}),await Z()};return l.jsxs(f,{w:"100%",gap:{base:"12px",lg:"16px"},children:[l.jsxs(f,{bg:"bg_secondary",w:"100%",p:{base:"16px 8px 8px",lg:"20px 20px 0"},borderRadius:"16px",children:[l.jsxs(O,{flexDir:{base:"column",lg:"row"},w:"100%",justify:{base:"center",lg:"space-between"},gap:{base:"16px",lg:"0"},children:[l.jsxs(O,{flexDir:{base:"row",lg:"column"},align:{base:"center",lg:"flex-start"},justify:{base:"space-between",lg:"center"},mt:{base:"-12px",lg:"0"},children:[l.jsx(r,{color:"primary_gray",mb:{base:"0",lg:"-12px"},children:"Liquidity"}),l.jsx(Ve,{positionInfo:e,haveTooltip:!1})]}),l.jsxs(b,{w:{base:"100%",lg:"unset"},gap:"4px",pb:"12px",justifyContent:"center",children:[l.jsx(L,{isLoaded:!!e&&!!o,children:l.jsxs(b,{gap:"4px",children:[l.jsx(r,{color:"text_caption",children:N((D=e==null?void 0:e.displayTokenA)==null?void 0:D.symbol)}),l.jsxs(r,{color:"primary",children:[o==null?void 0:o.displayPercentA,"%"]})]})}),l.jsx(we,{w:{base:"100px",lg:"200px"},h:"4px",value:o==null?void 0:o.displayPercentA,bg:"quote_green",sx:{'div[role="progressbar"]':{bg:"primary"}}}),l.jsx(L,{isLoaded:!!e&&!!o,children:l.jsxs(b,{gap:"4px",children:[l.jsxs(r,{color:"primary_green",children:[o==null?void 0:o.displayPercentB,"%"]}),l.jsx(r,{color:"text_caption",children:N((q=e==null?void 0:e.displayTokenB)==null?void 0:q.symbol)})]})})]})]}),l.jsxs(b,{gap:"0px",p:{base:"8px 0px",lg:"8px 40px 0px"},w:"100%",justify:"space-between",flexDirection:{base:"column",lg:"row"},children:[l.jsx(w,{label:"Base",token:e==null?void 0:e.displayTokenA,amount:o==null?void 0:o.displayCoinAmountA,afterAmount:j,align:h?"flex-end":"flex-start"}),l.jsx(w,{label:"Quote",token:e==null?void 0:e.displayTokenB,amount:o==null?void 0:o.displayCoinAmountB,afterAmount:t,align:"flex-end"})]})]}),l.jsxs(f,{bg:"bg_secondary",w:"100%",p:{base:"16px 8px",lg:"20px 20px 0"},borderRadius:"16px",children:[l.jsxs(b,{w:"100%",justify:"space-between",children:[l.jsx(O,{flexDir:{base:"row",lg:"column"},alignItems:{base:"center",lg:"flex-start"},justify:{base:"space-between",lg:"center"},w:{base:"100%",lg:"auto"},children:l.jsxs(b,{gap:"28px",children:[l.jsxs(f,{align:"flex-start",children:[l.jsx(r,{color:"primary_gray",whiteSpace:"nowrap",children:"Claimable Yield"}),l.jsx(L,{isLoaded:!!v&&!!e&&!!u&&!!y,children:l.jsx(r,{color:"text_caption",fontSize:"16px",children:te(v,2)})})]}),m!==null&&l.jsxs(O,{flexDir:{base:"column",lg:"row"},bg:"card_bg",borderRadius:"8px",p:"8px",children:[l.jsx(r,{fontSize:"12px",children:"Est. Daily Yield"}),l.jsx(L,{isLoaded:!!v&&!!e&&!!u&&!!y,children:l.jsx(r,{fontSize:"12px",color:"primary",children:m?m!=="$0"?`+${m}`:m:"$0"})})]})]})}),l.jsx(Ae,{isLoading:U,isDisabled:Number(v)===0||v==="--"||U||!x,onClick:ue,w:"112px",h:"28px",borderRadius:"8px",fontWeight:"500",fontSize:"14px",children:"Claim"})]}),l.jsxs(f,{p:{base:"20px 0px 0",lg:"20px 40px 0px"},w:"100%",gap:"26px",children:[l.jsx(f,{align:"flex-start",w:"100%",children:l.jsx(Le,{type:"outlineTab",tabList:X,currentTab:V==null?void 0:V.label,handleChangeTab:be,wrapStyle:{w:"158px",h:"28px",p:"4px",borderRadius:"8px"},itemStyle:{flex:{lg:"1",base:"auto"},fontSize:"12px",margin:"0px",borderRadius:"4px"}})}),V.value=="Unclaimed"?l.jsxs(b,{justify:"space-between",w:"100%",gap:"0px",flexWrap:"wrap",flexDirection:{base:"column",lg:"row"},children:[l.jsx(w,{label:"Fees",token:e==null?void 0:e.displayTokenA,amount:x==null?void 0:x.displayFeeOwedA,afterAmount:Q&&_?"0":"",align:h?"flex-end":"flex-start"}),l.jsx(w,{label:h?"":"Fees",token:e==null?void 0:e.displayTokenB,amount:x==null?void 0:x.displayFeeOwedB,afterAmount:Q&&_?"0":"",align:"flex-end"}),p==null?void 0:p.map((s,i)=>l.jsx(xe.Fragment,{children:l.jsx(w,{label:h?i==0?"Mining Rewards":"":"Mining Rewards",token:s==null?void 0:s.token,amount:s==null?void 0:s.display_amount_owed,afterAmount:Q&&_?"0":"",align:h?"flex-end":i%2===0?"flex-start":"flex-end"})},s==null?void 0:s.coin_address))]}):l.jsxs(b,{justify:"space-between",w:"100%",gap:"0px",flexWrap:"wrap",flexDirection:{base:"column",lg:"row"},children:[l.jsx(w,{label:"Fees",token:e==null?void 0:e.displayTokenA,amount:(H=a==null?void 0:a.FeeA)==null?void 0:H.Amount,align:h?"flex-end":"flex-start",afterAmount:""}),l.jsx(w,{label:h?"":"Fees",token:e==null?void 0:e.displayTokenB,amount:(B=a==null?void 0:a.FeeB)==null?void 0:B.Amount,align:"flex-end",afterAmount:""}),(P=(I=(Y=a==null?void 0:a.Mining)==null?void 0:Y.filter)==null?void 0:I.call(Y,s=>{var i;return(s==null?void 0:s.Amount)&&((i=C($(s==null?void 0:s.Amount)))==null?void 0:i.gt(0))}))==null?void 0:P.map((s,i)=>l.jsx(xe.Fragment,{children:l.jsx(w,{label:h?i==0?"Mining Rewards":"":"Mining Rewards",coinType:s==null?void 0:s.CoinType,amount:s==null?void 0:s.Amount,align:h?"flex-end":i%2===0?"flex-start":"flex-end",afterAmount:""})},s==null?void 0:s.CoinType))]})]})]})]})}function w({label:m,token:n,amount:j,afterAmount:t,isLoading:K,align:d="flex-start",coinType:T=""}){const{getTokenAmountValue:_}=Fe(),{isApp:z}=pe(),{getExplorerUrl:e}=ve(),u=_((n==null?void 0:n.coin_type)||T,j,"--"),[y,W]=g.useState(!1);g.useEffect(()=>{setTimeout(()=>{W(!0)},5e3)},[]);const{getTokenInfo:G}=Me(),[S,F]=g.useState(null),o=async x=>{if(x)try{const p=await G(x);console.log("ðŸš€ ~ fetchToken ~ coinInfo:",x,p),p&&F(p)}catch(p){console.error("Error fetching token info:",p)}};return g.useEffect(()=>{n&&Re(n)?F(n):T&&o(T)},[T,n]),l.jsxs(f,{align:d,gap:{base:"4px",lg:"8px"},w:{base:"100%",lg:"calc(50% - 4px)"},mb:{base:"16px",lg:"28px"},children:[l.jsxs(f,{w:"100%",align:{base:"center",lg:d},justify:{base:"space-between"},flexDirection:{base:"row",lg:"column"},children:[l.jsx(r,{color:"primary_gray",children:m}),l.jsxs(b,{h:{base:"unset",lg:"34px"},flexDirection:d=="flex-start"?"row":"row-reverse",children:[l.jsx(ye,{onClick:z?()=>window.open(e(n==null?void 0:n.coin_type,"coin")):()=>{},children:l.jsx(Ee,{haveTooltip:!z,coinType:n?n==null?void 0:n.coin_type:T,haveName:!1,haveSymbol:!1,warningIcon:{iconW:"14px",iconH:"14px"},imgBoxStyle:{w:"28px",h:"28px"}})}),l.jsx(L,{isLoaded:!K&&!!j||y,children:l.jsxs(f,{align:d,gap:"4px",children:[l.jsxs(r,{color:"text_caption",fontSize:{base:"14px",lg:"16px"},children:[ie(j)," ",N(S==null?void 0:S.symbol)]}),l.jsx(r,{color:"primary_gray",fontSize:{base:"12px",lg:"14px"},children:u=="--"?"$--":te(u,2)})]})})]})]}),t!==""&&t&&l.jsx(b,{bg:"primary_opacity.10",borderRadius:"full",p:"4px 20px",align:"center",children:l.jsxs(r,{color:"primary",lineHeight:"20px",textAlign:d==="flex-end"?"right":"left",children:[ie(t)," ",N(n==null?void 0:n.symbol,10)," after"]})})]})}export{Ze as D,w as T};
