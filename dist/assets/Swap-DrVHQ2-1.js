import{r as c,j as r,M as me,o as xe,p as ge,$ as Se,a0 as he,q as we,t as Re,H as B,V as L,C as ye,T as je,B as k,w as _e}from"./vendor-CBmAETR3.js";import{R as be,u as Me}from"./AggregatorModal-BBTaBCXS.js";import{u as ve,a as We}from"./useSwap-C3hmZP9P.js";import{S as qe,u as Fe,P as Ae,a as Ee}from"./SwapConfirmBlock-CDC9OMrv.js";import{c as Oe,e as He}from"./useSwapHelper-RreJ3kMc.js";import{a as Pe,S as Te}from"./useGetRouterConfig-DJQlEuNJ.js";import{Z as F,M as Be,u as Le,a as ke,C as Qe,E as Ve,ad as ze}from"./index-BpSfzecM.js";import{u as Y}from"./index-FuOBGqkF.js";import{u as Z}from"./swap-BzZMpsSt.js";import"./cross-DJ28FxNa.js";import{H as De}from"./HTextLabelBox-D0r99Smv.js";import{I as Ie}from"./IconBg-Bcw9JXPW.js";import{u as Ce}from"./useAccountBalance-DV0qM_Vy.js";import{T as Ue}from"./TradeInputGroup-C0B6uidS.js";import{W as $e}from"./WarningTokenTipModal-BPL2NtCc.js";import{S as Ge}from"./Slippage-8fJCLOYr.js";import{A as Ne}from"./index-CpyY2kgL.js";import{F as Ye}from"./FreshProgressV2-DfCij7Ow.js";import Ze from"./PriceReference-CRSt7W-B.js";import{R as Je,a as Ke}from"./RfqRightWidget-Dhgrm_Tf.js";import"./aggregator-CyPcoC3_.js";import"./TooltipIcon-DVhxXZmh.js";import"./index-CgYRIMgB.js";import"./index-Dq_SzPY7.js";import"./useTransaction-uEos3ZjK.js";import"./useTrack-Cdn9qear.js";import"./v4-C6aID195.js";import"./useSigner-Ct94kXtL.js";import"./useTransactionModal-DL7w_I3R.js";import"./index-gw6wWhzj.js";import"./useTokenBalance-c3RAkCCY.js";import"./useFindBestRouting-CX4IIQLi.js";import"./useChainTime-DNIcZpVU.js";import"./usePriceImpact-DTCbq_0I.js";import"./CurrentPrice-D1qM8kFS.js";import"./PriceImpact-B_OiyXWK.js";import"./MarketSource-Zu8s3YB-.js";import"./SolidPieCountdown-B9kgZHE-.js";import"./TradeConfirmAmountInfo-C8pVFbTE.js";import"./useGetPoolList-4kFQ2tyG.js";import"./utils-CMHkC_9A.js";import"./useWrapPoolData-CMGMCXwG.js";import"./en_US-KAK2ZBDO-C1Pw6Q2s.js";import"./_baseClone-B759QteI.js";import"./_getAllKeysIn-Juzb7Mj8.js";import"./_defineProperty-Bpc363rP.js";import"./HighlightText-Dw_TnRsZ.js";import"./last-CxFZ9vay.js";import"./CheckBox-eomO844M.js";import"./Ratio-JsiL9RvN.js";import"./YAxis-DLEZvSSr.js";import"./generateCategoricalChart-CmRMqbFo.js";import"./debounce-MPJy35Ge.js";import"./LineChart-7c6x8Z7S.js";import"./Line-zvGWD_L_.js";const Xe=({initialCount:s,expired_at:w,onComplete:e,onTick:t})=>{const a=c.useRef(null),p=c.useRef(s);return c.useEffect(()=>(p.current=s,s>0?(a.current=setInterval(()=>{p.current=p.current-1,t==null||t(p.current),p.current<=0&&(a.current&&(clearInterval(a.current),a.current=null),e==null||e())},1e3),t==null||t(p.current)):a.current&&(clearInterval(a.current),a.current=null),()=>{a.current&&(clearInterval(a.current),a.current=null)}),[w]),{count:p.current}};function et(s){const{isOpen:w,onClose:e,data:t,handleRouterSwap:a,rftCountdownFlagRef:p}=s,{fromCoin:i,toCoin:A,routerData:m,userSelectQuoteMode:x}=Z(),{isProMode:y}=Y();return r.jsxs(me,{autoFocus:!1,returnFocusOnClose:!1,trapFocus:!1,isOpen:w,onClose:()=>e(!1),isCentered:!0,children:[r.jsx(xe,{}),r.jsxs(ge,{children:[r.jsx(Se,{children:x==="rfq"?r.jsx(be,{}):r.jsx(he,{fontWeight:"500",fontSize:"16px",children:y?"Trade":"Swap"})}),r.jsx(we,{onClick:()=>e(!0)}),r.jsx(Re,{textAlign:"center",p:"0px",children:r.jsx(qe,{rftCountdownFlagRef:p,handleRouterSwap:a,onClose:e,data:t,lastRouterData:m,fromCoin:i,toCoin:A,isWidget:!1,isSelectedRfq:x==="rfq"})})]})]})}function sr(){var G,N;const s=c.useRef(void 0),w=Z(),{fromCoin:e,toCoin:t,byAmountIn:a,setUserSelectQuoteMode:p,findRouterLoading:i,rfqData:A,routerData:m,userSelectQuoteMode:x}=w,{handleSelectToken:y,handleAmountChange:_,fromAmount:u,toAmount:d,fromAmountValue:J,toAmountValue:K,fromBalanceInfo:R,toBalanceInfo:E,amountLimit:X,getSwapSecondaryData:ee,handleRouterSwap:te,reCalculateRouteData:b,scamsText:Q,refreshMarketPrice:re,isOpenConfirmModel:f,setIsOpenConfirmModel:M,resetInputAmount:oe,onReverseClick:v}=ve(w,!1,s),{showTokenInfo:n,isProMode:g,currentProTab:S,currentProTabUpdateWith:O}=Y();c.useEffect(()=>{console.log("Swap ðŸš€ ~ useEffect ~ currentProTabUpdateWith:",O),!(O==="toggleBtn"||!O)&&(n!=null&&n.coin_type&&(t!=null&&t.coin_type)&&(e!=null&&e.coin_type)?(S=="Buy"&&F(n==null?void 0:n.coin_type)!==F(t==null?void 0:t.coin_type)||S=="Sell"&&F(n==null?void 0:n.coin_type)!==F(e==null?void 0:e.coin_type))&&v(!q):(n!=null&&n.coin_type&&(e!=null&&e.coin_type)&&!(t!=null&&t.coin_type)||n!=null&&n.coin_type&&!(e!=null&&e.coin_type)&&(t!=null&&t.coin_type))&&v(!q))},[S]);const{currentAccount:W,onWalletModal:ae}=Be(),{fetchAccountBalance:V}=Ce(),{isOpenRfqSwitch:se,rfqConfigs:H}=Oe(),{fetchRfqConfigs:ie}=We();c.useEffect(()=>{W!=null&&W.address&&V(),ie()},[]);const{btnText:z,btnDisabled:ne}=Fe(u,d,R==null?void 0:R.balanceFormat,e,t,m),D=c.useRef(null),{allProviders:le}=Pe(m),{isOpenAggregatorMode:I,isAllowInputReceiveSide:q}=Me(!0),C=c.useRef(f),l=He(A,m);Xe({initialCount:((G=l==null?void 0:l.rfqQuote)==null?void 0:G.total_countdown)||0,expired_at:((N=l==null?void 0:l.rfqQuote)==null?void 0:N.expired_at)||"0",onTick:o=>{if(i){s.current=void 0;return}s.current=o,o===0&&(C.current||b())}}),c.useEffect(()=>{C.current=f},[f]);const ce=()=>{var o;(o=D.current)==null||o.reset()},U=(o=!0)=>{s.current=void 0,b(o),V(),re()};c.useEffect(()=>{ce()},[d,u,e==null?void 0:e.coin_type,t==null?void 0:t.coin_type]),c.useEffect(()=>{a||U()},[e==null?void 0:e.coin_type,t==null?void 0:t.coin_type]),c.useEffect(()=>{oe()},[I]);const pe=c.useMemo(()=>{const o=[];return e&&o.push(e),t&&o.push(t),o},[e,t]),[P,$]=c.useState("#icon-a-icon_trade"),ue=()=>{$("#icon-icon_swap1")},de=()=>{$("#icon-a-icon_trade")},{isApp:j}=Le(),{isShowTradeChart:h,setIsShowTradeChart:fe,isShowTradeOrders:tt,setIsShowTradeOrders:rt}=ke();return r.jsxs(B,{position:"relative",children:[r.jsxs(L,{gap:{base:"16px",lg:"8px"},w:{base:"100%",lg:g?"380px":"470px"},children:[r.jsxs(B,{w:"100%",justify:"space-between",children:[r.jsx(Ne,{showRfqSwitch:!0}),r.jsxs(B,{children:[r.jsx(Ge,{}),!g&&r.jsx(Qe,{showTooltip:!j,placement:"bottom-end",tooltip:r.jsx(je,{fontSize:"12px",children:h?"Hide reference price":"View reference price"}),children:r.jsx(ye,{children:r.jsx(Ie,{w:"28px",h:"28px",borderRadius:"8px",variant:"",xlinkHref:"#icon-icon_kline",svgFill:h?"primary":"",svgHover:h?"primary":j?"text_paragraph":"text_caption",onClick:()=>fe(!h)})})}),r.jsx(Ye,{callbackInterval:f?5:10,ref:D,min:0,max:10,onClick:()=>{f&&x==="rfq"||U(!f)}})]})]}),r.jsxs(k,{w:"100%",children:[r.jsx(Ue,{wrapStyle:{gap:{base:"16px",lg:"8px"},mt:{base:"0px",lg:"4px"}},onClick:()=>v(!I,!0),from:{title:"You Pay",balance:(R==null?void 0:R.balanceFormat)||"",value:u,amountValue:!a&&i?"":J,loading:!a&&i,onChange:o=>{_(o,!0)},selectable:!0,placeholder:"0.0",token:e,onFocusChange:o=>{o&&+u&&!a&&_(u,!0)},onTokenChange:o=>{y(o,!0)}},to:{title:"You Receive",balance:(E==null?void 0:E.balanceFormat)||"",value:d,amountValue:a&&i?"":K,loading:a&&i,onFocusChange:o=>{o&&+d&&a&&_(d,!1)},onTokenChange:o=>{y(o,!1)},inputAllowed:q,onChange:o=>{_(o,!1)},selectable:!0,placeholder:"0.0",token:t,half:!1,max:!1},iconParams:{xlinkHref:P,svgFill:"text_caption",transform:P==="#icon-a-icon_trade"?"":"rotate(90deg)",fontSize:P==="#icon-a-icon_trade"?"12px":"16px",onMouseEnter:ue,onMouseLeave:de}}),Q&&r.jsx(k,{mt:"-32px",p:"48px 16px 16px",borderRadius:"20px",bg:"bg_secondary",border:"1px solid",borderColor:"border",children:r.jsx(Te,{scamsText:Q})})]}),(e||t)&&r.jsx($e,{addToken:!0,tokensInfo:pe,waringModalCancel:o=>{o.forEach(T=>{(T.coin_type===(e==null?void 0:e.coin_type)||T.coin_type===(t==null?void 0:t.coin_type))&&y(void 0,T.coin_type===(e==null?void 0:e.coin_type))})}}),r.jsxs(L,{p:+u&&+d?"0 8px 12px":"0 8px",w:"100%",gap:"8px",border:"1px solid",borderColor:"border",borderRadius:"20px",bg:"bg_secondary",children:[r.jsx(_e,{w:"calc(100% + 18px)",h:"52px",margin:"-1px",fontSize:"18px",fontWeight:"500",borderRadius:"12px",variant:g?`solid-${S==null?void 0:S.toLocaleLowerCase()}`:"solid",isDisabled:i||ne,isLoading:i,onClick:()=>{W?(p("router"),M(!0)):ae(!0)},children:[e,t].filter(Boolean).length<2?"Select a token":g&&z=="Swap"?S:z}),!!+u&&!!+d&&r.jsxs(L,{w:"100%",gap:"12px",children:[r.jsx(Ae,{findRouterLoading:i,routerData:m,fromCoin:e,toCoin:t}),r.jsx(De,{isLoading:i,label:a?"Minimum Received":"Maximum Sold",value:`${Ve(X,a?t==null?void 0:t.decimals:e==null?void 0:e.decimals,!1,ze.ROUND_DOWN)} ${a?t==null?void 0:t.symbol:e==null?void 0:e.symbol}`,labelStyle:{fontWeight:500,whiteSpace:"nowrap",fontSize:"14px"},valueStyle:{fontWeight:500,fontSize:"14px"},skeletonStyle:{valueW:"128px"},wrapStyle:{p:"0 8px",minH:"20px"}}),r.jsx(Ee,{allProviders:le,findRouterLoading:i,fromAmount:u,toAmount:d,fromCoin:e,toCoin:t,data:m})]})]}),(j||h||g)&&r.jsx(Je,{rftCountdownFlagRef:s,findRouterLoading:i,isShowRfqWidget:(l==null?void 0:l.rfqQuote)!==void 0&&!i,rfqData:l,fromCoin:e,toCoin:t,onTrade:()=>{p("rfq"),M(!0)}}),(!h||g)&&r.jsx(Ze,{fromCoin:e,toCoin:t}),j&&r.jsx(k,{h:"0px",mt:"-4px"}),f&&r.jsx(et,{rftCountdownFlagRef:s,data:ee(),isOpen:f,handleRouterSwap:o=>{te(o)},onClose:(o=!1)=>{M(!1),console.log("ðŸš€ ~ onClose ~ userSelectQuoteMode:",x,s.current),x==="rfq"&&s.current===0&&b(),x==="router"&&se&&(H!=null&&H.enable)&&s.current===0&&b()}})]}),!h&&!j&&!g&&r.jsx(Ke,{rftCountdownFlagRef:s,findRouterLoading:i,isShowRfqWidget:(l==null?void 0:l.rfqQuote)!==void 0&&!i,rfqData:l,fromCoin:e,toCoin:t,onTrade:()=>{p("rfq"),M(!0)}})]})}export{sr as default};
