import{r as S,j as e,T as E,H as U,V as K,C as Xe,w as We,Z as Vt,a0 as lt,B as we,ar as Ti,m as Wt,ad as Fi,S as Je,M as es,o as ts,p as ss,$ as Cs,q as Os,t as is,X as Ht,l as Gt,v as $s,a6 as bs,a7 as ys,a8 as js,a1 as Bt,aA as ft,aB as kt,ac as Li}from"./vendor-CBmAETR3.js";import{S as qs}from"./Slippage-C7lPdRZI.js";import{E as Xt,d as zi,u as Ri,I as ct,T as Ss,e as Ni,D as Wi,P as _s,c as vs}from"./useLiquidityInteraction-BRuGSXCL.js";import{u as le}from"./index-9vefoQ6F.js";import{f as jt,n as Us,ci as Hi,dU as Ei,aq as $e,Z as De,s as Et,co as Ci,dg as Oi,I as Fe,u as He,S as Jt,ah as Pe,t as ae,av as Vs,aW as Be,d as F,eY as $i,ca as qi,ai as ve,E as Gs,w as gt,i as Ui,eZ as Mt,aE as Tt,e_ as Vi,aO as Gi,C as Ae,aG as Ki,Q as tt,aj as bt,e as ns,e$ as Qi,a5 as ze,aJ as Dt,bo as Ks,a as Qs,h as at,l as qe,M as St,bn as ws,dV as Yi,aT as Zi,B as et,c as Ys,z as Zs,T as Ct,cU as Xi,ae as Ji,j as At,V as Ft}from"./index-ihcskjKt.js";import{u as mt}from"./index-BgZD3vRA.js";import"./cross-CbhIs7DK.js";import{H as Di}from"./H5MapTable-CpOBMbH2.js";import{N as dt}from"./NoData-BFX9XpKb.js";import{T as Ai}from"./Table-CmEnXJpd.js";import{A as mi}from"./AnalyticsCharts-lEU2K0i9.js";import{A as pt}from"./ActionButton-VtFJpQWF.js";import{a as Ii}from"./VolumeChart-BMeNPMyu.js";import{C as Pi,E as en}from"./EmptyTooltip-t2-GI6nt.js";import{a as tn,F as Ot,C as Xs,u as yt,M as It,P as Bs,B as sn,b as Js}from"./useCreatePriceBin-_gjTrK1h.js";import{R as nn,X as rn,Y as cn}from"./YAxis-1VNgHXtM.js";import{B as an}from"./BarChart-BYOCkToA.js";import{T as un,B as pn,o as xn}from"./generateCategoricalChart-DzovH4HE.js";import{u as ye}from"./addDlmmLiquidity-CmH4aIaT.js";import{L as me,a as dn}from"./useDlmmPreCalc-D8nwessI.js";import{u as Ds,i as ln,a as on,b as rs,c as Ie,d as As,S as Lt}from"./StatsInfo-C01_cTX9.js";import{j as hn,a as gn,c as $t,d as fs,b as bn,e as ks,i as yn}from"./dlmm-B3MPeVqN.js";import{i as xt,f as zt}from"./index-78J_CBpj.js";import{d as Ms,b as jn}from"./config-DTm0VBgZ.js";import{u as ms,S as Ts}from"./SelectToken-D-b9Lw5g.js";import{P as Sn}from"./PoolTag-DVhitHGR.js";import{T as cs}from"./TotalAmount-DPW4Igd_.js";import{P as _n}from"./PositionStatus-dlgY0zMV.js";import{T as vn}from"./TradeConfirmAmountInfo-D6pugXWx.js";import{d as Is}from"./usePosRemove-CKs7-Z6Q.js";import{u as wn}from"./useTransaction-BEUdFaaa.js";import{a as Bn}from"./detail-BQ6q8Dje.js";import{u as Ps}from"./useAccountBalance-D7pkS3C9.js";import{u as fn}from"./useTransactionModal-DhEdYJgg.js";import{u as qt}from"./useTokenBalance-EOIPKTy-.js";import{u as kn}from"./useNotifiSubscription-Cfyz7d-D.js";import{v as Fs}from"./v4-C6aID195.js";import{E as Ut}from"./ErrorTips-D8Nv331n.js";import{T as ei}from"./TradeInputGroup-Cg8Otj2e.js";import{u as as,c as Mn,R as Tn}from"./usePositionList-5SlPZsY2.js";import{a as ti}from"./useGetDlmmContractPoolInfo-NnEy3AV5.js";import{u as Fn}from"./usePriceImpact-C25MtScm.js";import{g as Ls}from"./utils-GUDa3Y46.js";import{W as Ln}from"./WithTooltipInfo-DeNHsACa.js";import{u as si}from"./index-1SLshnYc.js";import{I as zn}from"./InputBox-DUnOULwS.js";import{u as Rn}from"./addLiquidity-ByI4XtN_.js";import{D as Nn}from"./DLMMPositionItem-CmHH6WC2.js";import{u as Wn}from"./useRpcListener-Dj_lqr51.js";import{A as Hn}from"./index-C9gsxTUl.js";import{u as En}from"./useInterval-FApnpfRj.js";import{u as Cn}from"./useCreatePool-B1OBCJf0.js";import{a as On,u as $n}from"./useFavoriteDlmmPool-Kbo6eRe5.js";import{u as qn}from"./swapWidget-DRxn0RNu.js";import{u as Un}from"./swapWidgetConfig-BarEvihe.js";import{B as Vn}from"./BackButton-B9dAauAl.js";import{R as Gn}from"./RefreshButton-DtwRJDvy.js";import{C as Kn}from"./CurrentPrice-CQbowz6j.js";import{F as Qn}from"./FeeSelectBlock-DDUVHhzh.js";import{W as Yn}from"./WarningTokenTipModal-BnIEL8rR.js";import"./TooltipIcon-CBgjM1b2.js";import"./HTextLabelBox-Cv1F2u1A.js";import"./useWrapPoolData-CzWcfmSl.js";import"./ExamplePieChart-CtGkcqfJ.js";import"./PieChart-Dq5PRqbH.js";import"./debounce-MPJy35Ge.js";import"./index-GwPPDvta.js";import"./useFavoritePool-D10BRIh4.js";import"./useGetPoolList-BxNmDN4c.js";import"./useGetTvlInfo-DD8PUvH9.js";import"./index-D8UqOC8m.js";import"./TvlChart-DOf4z2jX.js";import"./AreaChart-CPs2tB_i.js";import"./Area-Ch6FbRWU.js";import"./CoinPairInfo-CDiS7h0Q.js";import"./_getAllKeysIn-BPcro3FP.js";import"./_defineProperty-BPanLZZj.js";import"./objectSpread2-B-AaJtUa.js";import"./useCreatePoolHelper-5n00jG70.js";import"./usePosAdd-B-P_wwAw.js";import"./msafe-BzcjPV-e.js";import"./useGetDlmmPoolList-x-FGvX6E.js";import"./maxBy-DupNhJLP.js";import"./VTextLabelBox-YDTOuudM.js";import"./index-DCf0hNUB.js";import"./CheckBox-CkL01dAe.js";import"./Loading-DOvYGudd.js";import"./icon_active_new@2x-Bekkt6Xc.js";import"./useTrack-Cu3it5QI.js";import"./useSigner-C1gsxlX5.js";import"./usePosClaimFeeAndReward-R-HkZji1.js";import"./LiquidityValueBlock-DS5y0rnC.js";import"./useNotifiAlerts-Duz6Uw_i.js";import"./useXCetusHelper-CrXtSO0d.js";import"./useCurrentPos-qZJLM1cy.js";import"./detail-BpvHUFYz.js";import"./_baseClone-CJALfsQC.js";import"./last-CTTiHFcU.js";import"./useSwapHelper-CDwInMwe.js";import"./en_US-KAK2ZBDO-7b1QhAeP.js";import"./index-CPyR2bLz.js";import"./isBrowser-DgCPUZ4c.js";import"./index-Dq_SzPY7.js";import"./PositionItemContent-Cx-1mfww.js";import"./HiddenDotted-9cZ5UVdD.js";import"./StatusPosition-CmUwds3p.js";import"./useGetClmmPositionDailyEarning-BB_IEQSI.js";import"./PositionPriceRangeBar-B3Gr2ilx.js";import"./TableSortTh-CJhvMpou.js";import"./usePreviousValue-Da-o2xpb.js";import"./useDocumentSize-BZINkChT.js";import"./index-B6CEp9_u.js";import"./CetusMenu-C9-MiO-y.js";function Zn(){const i=jt("dlmm"),{fetchByApi:r}=Us();return{getTransactionsHistory:async o=>{try{const d=await r(Ei,"GET",o);if(console.log(d,"getTransactionsHistory"),d)return d;throw new Error("no data")}catch(d){console.error(d,"getTransactionsHistory ~ error")}},getTransactionsHistoryBySDK:async(o,d)=>{var u;try{const s=await((u=i==null?void 0:i.Pool)==null?void 0:u.getPoolTransactionList({pool_id:o,pagination_args:d,full_rpc_url:Hi==="testnet"?"https://rpc-testnet.suiscan.xyz:443":"https://rpc-mainnet.suiscan.xyz:443"}));if(console.log(s,"getTransactionsHistoryBySDK"),s)return s;throw new Error("no data")}catch(s){console.error(s,"getTransactionsHistoryBySDK ~ error")}}}}function Xn(){const{getTransactionsHistoryBySDK:r}=Zn(),[n,t]=S.useState(!0),[o,d]=S.useState([]),[u,s]=S.useState(1),[b,p]=S.useState(),[x,l]=S.useState(!0),{dlmmApiPoolInfo:a,manualRefresh:y,setManualRefresh:c}=le(),{poolId:j}=$e();S.useEffect(()=>{d([]),s(1),p(void 0),l(!0)},[j]),S.useEffect(()=>{y&&(d([]),s(1),p(void 0),l(!1),h({cursor:void 0,limit:10}))},[j,y]);const h=async v=>{var B;try{if(!x)return;if(j){t(!0);const k=await r(j,{...v});if(k){const L=(B=k==null?void 0:k.data)==null?void 0:B.map(_=>{var N,R,q,m,Q,V;const f=_==null?void 0:_.parsed_json,W=f!=null&&f.from?De((N=f==null?void 0:f.from)==null?void 0:N.name,!1)===((R=a==null?void 0:a.tokenA)==null?void 0:R.coinType)?a==null?void 0:a.tokenA:a==null?void 0:a.tokenB:a==null?void 0:a.tokenA,w=f!=null&&f.target?De((q=f==null?void 0:f.target)==null?void 0:q.name,!1)===((m=a==null?void 0:a.tokenB)==null?void 0:m.coinType)?a==null?void 0:a.tokenB:a==null?void 0:a.tokenA:a==null?void 0:a.tokenB;return{..._,type:["Add","Open"].some(J=>{var X;return(X=_.type)==null?void 0:X.includes(J)})?Xt.add:(Q=_.type)!=null&&Q.includes("Remove")||(V=_.type)!=null&&V.includes("Close")?Xt.remove:Xt.swap,items:[{amount:Et(f!=null&&f.total_amount_a?f==null?void 0:f.total_amount_a:f==null?void 0:f.amount_in,W==null?void 0:W.decimals).toString(),address:W==null?void 0:W.coin_type,url:W==null?void 0:W.logo_url,symbol:W==null?void 0:W.symbol},{amount:Et(f!=null&&f.total_amount_b?f==null?void 0:f.total_amount_b:f==null?void 0:f.amount_out,w==null?void 0:w.decimals).toString(),address:w==null?void 0:w.coin_type,url:w==null?void 0:w.logo_url,symbol:w==null?void 0:w.symbol}]}});v!=null&&v.cursor?d(_=>[..._,...L||[]]):d(L||[]),p(k==null?void 0:k.next_cursor),l(k==null?void 0:k.has_next_page),t(!1)}}}catch(k){console.log(k,"getTransactionsHistoryBySDK-error"),t(!1)}finally{t(!1)}};return mt(()=>{h({cursor:b,limit:10})},[u,j],{wait:500,leading:!0,trailing:!1}),{isLoading:n,list:o,dlmmApiPoolInfo:a,currentPage:u,onCurrentPageChange:()=>{s(v=>v+1)},hasNextPage:x}}var ht=(i=>(i.add="add_liquidity_event",i.remove="remove_liquidity_event",i.swap="swap_event",i))(ht||{});const Rt={[ht.add]:{icon:"#icon-a-icon_add1",color:"primary_green",title:"Add Liquidity"},[ht.remove]:{icon:"#icon-tx_remove",color:"light_coral",title:"Remove Liquidity"},[ht.swap]:{icon:"#icon-icon_swap",color:"primary",title:"Swap"}},Jn=({type:i})=>{var r,n,t,o;return e.jsxs(U,{children:[e.jsx(Fe,{xlinkHref:(r=Rt[i])==null?void 0:r.icon,svgFill:(n=Rt[i])==null?void 0:n.color,svgHover:(t=Rt[i])==null?void 0:t.color}),e.jsx(E,{color:"text_caption",children:(o=Rt[i])==null?void 0:o.title})]})},Dn=({items:i,type:r,isReverse:n})=>{var o,d;const{isApp:t}=He();return i?r===ht.swap?t?e.jsxs(K,{align:"flex-end",gap:"8px",children:[e.jsx(ut,{item:i==null?void 0:i[0]}),e.jsxs(U,{justify:"flex-end",children:[e.jsx(Fe,{xlinkHref:"#icon-icon_right",svgFill:"text_caption",svgHover:"text_caption"}),e.jsx(ut,{item:i==null?void 0:i[1]})]})]}):e.jsxs(U,{justify:"flex-end",gap:"8px",children:[e.jsx(ut,{item:i==null?void 0:i[0]}),e.jsx(Fe,{xlinkHref:"#icon-icon_right",svgFill:"text_caption",svgHover:"text_caption"}),e.jsx(ut,{item:i==null?void 0:i[1]})]}):t?e.jsx(K,{align:"flex-end",gap:"8px 16px",flexDir:n?"column-reverse":"column",children:(o=i==null?void 0:i.filter(u=>!!+u.amount))==null?void 0:o.map(u=>e.jsx(ut,{item:u},u==null?void 0:u.address))}):e.jsx(U,{justify:n?"flex-start":"flex-end",gap:"8px 16px",flexDir:n?"row-reverse":"row",children:(d=i==null?void 0:i.filter(u=>!!+u.amount))==null?void 0:d.map(u=>e.jsx(ut,{item:u},u==null?void 0:u.address))}):null},ut=({item:i})=>e.jsxs(U,{gap:"4px",children:[e.jsx(Jt,{imageUrl:i==null?void 0:i.url,w:"20px",h:"20px"}),e.jsx(E,{color:"text_caption",children:Pe(i==null?void 0:i.amount)}),e.jsx(E,{children:ae(i==null?void 0:i.symbol,10)})]}),zs=(i,r=!1)=>[{title:e.jsx(E,{children:"Event"}),key:"type",render:({type:n})=>e.jsx(Jn,{type:n}),thConfig:{h:"52px",p:"0 !important"},tdConfig:{p:"0 !important"}},{title:e.jsx(E,{textAlign:"right",children:"Amounts"}),key:"amounts",render:({items:n,type:t})=>e.jsx(Dn,{items:n,type:t,isReverse:r}),thConfig:{h:"52px",p:"0 !important"},tdConfig:{p:"0 !important"}},{title:e.jsx(E,{textAlign:"right",children:"Transactions"}),key:"tx",render:({tx:n})=>e.jsx(Ci,{address:n,color:"primary",fontSize:"14px",onClickLink:()=>{window.open(i(n,"tx"),"_blank")}}),thConfig:{h:"52px",p:"0 !important"},tdConfig:{p:"0 !important"}},{title:e.jsx(E,{textAlign:"right",children:"Time"}),key:"block_time",render:({block_time:n})=>e.jsx(E,{color:"text_caption",children:Oi(n)}),thConfig:{h:"52px",p:"0 !important"},tdConfig:{p:"0 !important"}}];function An(){const{getExplorerUrl:i}=Vs(),{isLoading:r,list:n,dlmmApiPoolInfo:t,currentPage:o,onCurrentPageChange:d,hasNextPage:u}=Xn(),{isApp:s}=He();return e.jsxs(K,{w:"100%",position:"relative",mt:{base:"12px",lg:"24px"},gap:"0px",children:[e.jsx(U,{w:"100%",justify:"space-between",children:e.jsx(E,{fontSize:"24px",color:"text_caption",fontWeight:"500",children:"Transactions"})}),!r&&(n==null?void 0:n.length)==0?e.jsx(dt,{type:"nodata",mt:"16px",text:"No Recent Transactions",borderRadius:"16px"}):s?e.jsx(Di,{columns:zs(i,t==null?void 0:t.isReverse),dataSource:n,loading:r&&o===1,itemSkeletonLength:5,itemHeight:"30px",wrapStyle:{gap:0},rowStyle:(b,p)=>({w:"100%",p:"0px",mt:"20px"}),onRowClick:b=>{window.open(i(b==null?void 0:b.tx,"tx"),"_blank")}}):e.jsx(Ai,{columns:zs(i,t==null?void 0:t.isReverse),dataSource:n,skeletonLength:10,loading:r&&o===1,onRowClick:b=>{window.open(i(b==null?void 0:b.tx,"tx"),"_blank")},rowStyle:{h:"52px",cursor:"pointer"}}),u&&e.jsx(Xe,{mt:{base:"40px",lg:"20px"},children:e.jsx(We,{w:"120px",h:"32px",fontSize:"12px",borderRadius:"8px",bg:"button_ghost_bg",color:"primary",borderColor:"border",variant:"outline",onClick:d,children:r?e.jsx(Vt,{size:"sm",color:"text_caption"}):"Load More"})})]})}var ii=(i=>(i.d="D",i.w="W",i.m="M",i))(ii||{}),Pt=(i=>(i.d="24H",i.w="7D",i.m="30D",i))(Pt||{});function mn(i){const[r,n]=S.useState("D"),[t,o]=S.useState([]),{dlmmApiPoolInfo:d,dlmmContractPoolInfo:u}=le(),[s,b]=S.useState(!0),[p,x]=S.useState(null),{poolId:l}=$e(),{getHoverTime:a,time:y}=Ii(),{fetchBinsTradeData:c}=zi();S.useLayoutEffect(()=>{o([]),n("D"),x(null)},[l]);const j=async()=>{if(!(!l||(u==null?void 0:u.binStep)===void 0))try{(t==null?void 0:t.length)===0&&b(!0);const v=await c({dataType:"vol",period:Pt[r.toLowerCase()],poolId:l});if(v&&v.length){const B=v==null?void 0:v.map(k=>{var f,W,w;const L=(w=Be)==null?void 0:w.getPriceFromBinId(k==null?void 0:k.binId,u.binStep,(f=d==null?void 0:d.tokenA)==null?void 0:f.decimals,(W=d==null?void 0:d.tokenB)==null?void 0:W.decimals),_=i===(d==null?void 0:d.isReverse)?F(1).div(L).toString():L;return{price:$i(_),originPrice:_,binId:k==null?void 0:k.binId,value:Number(k==null?void 0:k.value)}}).sort((k,L)=>Number(k.originPrice)-Number(L.originPrice));o(B)}}catch(v){throw console.error(v,"res-fetchAnalyticsData"),v}finally{b(!1)}};S.useEffect(()=>{j()},[l,r,u==null?void 0:u.id,d==null?void 0:d.id,i]),S.useEffect(()=>{p!=null&&p.date&&a(p==null?void 0:p.date,r)},[p==null?void 0:p.date,r]);const h=v=>{n(v.label),v.label!==r&&o([])},g=Object.values(ii).map(v=>({label:v}));return{handleDateTabChange:h,dateTypes:g,chartLoading:s,binsTradeData:t,hoverData:p,setHoverData:x,currentDateType:r,currentDateTypeLabel:Pt[r.toLowerCase()],time:y}}function In({data:i,onChangeValue:r,noXAxis:n,maxBinsLength:t=251}){const[o,d]=S.useState(""),[u,s]=S.useState(""),[b,p]=S.useState(),{dlmmContractPoolInfo:x,dlmmApiPoolInfo:l}=le(),a=h=>{if(h&&h.activePayload&&h.activePayload.length){const{value:g,price:v,binId:B}=h.activePayload[0].payload;r(h.activePayload[0].payload),d(Gs(g,2)),s(v),B===(x==null?void 0:x.activeId)?p(B):p(void 0)}},y=()=>{r(null)},c=S.useMemo(()=>{if((i==null?void 0:i.length)<=19)return i;{const h=i.findIndex(_=>_.binId===(x==null?void 0:x.activeId)),g=Math.floor(t/2);let v=Math.max(h-g,0),B=Math.min(h+g+1,i.length);const k=h-v,L=B-h;return k<L&&(B=B+L-k),L<k&&(v=Math.max(0,v-k+L)),i.slice(v,B)}},[i,x==null?void 0:x.activeId,t]);S.useMemo(()=>(c==null?void 0:c.length)>0?Math.floor(Math.min(...c.map(h=>h.value))):0,[c]);const j=S.useMemo(()=>Math.ceil(Math.max(...c.map(h=>h.value))),[c]);return e.jsx(nn,{width:"100%",height:"100%",children:e.jsxs(an,{barCategoryGap:"25%",data:c,onMouseMove:a,onMouseLeave:y,maxBarSize:24,children:[!n&&e.jsx(rn,{type:"category",dataKey:"price",minTickGap:18,tickLine:!1,axisLine:!1,tick:e.jsx(Pi,{})}),j&&e.jsx(cn,{domain:[0,j*1.05],hide:!0,axisLine:!1,tickLine:!1}),e.jsx(un,{content:e.jsx(en,{value:e.jsxs(K,{align:"flex-start",gap:"4px",children:[b!==void 0&&e.jsx(E,{fontSize:"12px",lineHeight:"16px",children:"Current Price Bin"}),e.jsxs(U,{children:[e.jsx(E,{fontSize:"12px",lineHeight:"16px",children:"Bin Price"}),e.jsx(E,{fontSize:"12px",color:"text_caption",lineHeight:"16px",children:u})]}),e.jsxs(U,{children:[e.jsx(E,{fontSize:"12px",lineHeight:"16px",children:"Volume"}),e.jsxs(E,{fontSize:"12px",color:"text_caption",lineHeight:"16px",children:["$",qi(ve(o),2)]})]})]})}),cursor:e.jsx(Pn,{})}),e.jsx(pn,{dataKey:"value",isAnimationActive:!1,shape:e.jsx(tn,{}),children:c==null?void 0:c.map((h,g)=>e.jsx(xn,{fill:(h==null?void 0:h.binId)===(x==null?void 0:x.activeId)?"#76C8FF":"rgba(117,200,255,0.5)"},h==null?void 0:h.binId))})]})})}function Pn(i){var s,b;const{x:r,y:n,width:t,height:o,payload:d}=i;if(!d||!(d!=null&&d[0])||!((b=(s=d==null?void 0:d[0])==null?void 0:s.payload)!=null&&b.num))return;const u=t>192?t/1.2:t>96?t/1.5:t>48?t/2:t>24?t/4:t/8;return e.jsx("g",{children:e.jsx("rect",{width:t-u,height:o,x:r+u/2,fill:"rgba(118,200,255,0.5)",y:n+1})})}function er({priceDirect:i}){const{handleDateTabChange:r,dateTypes:n,chartLoading:t,binsTradeData:o,setHoverData:d,currentDateType:u,currentDateTypeLabel:s}=mn(i),{isApp:b}=He(),[p,x]=S.useState(251);S.useEffect(()=>{x(b?61:251)},[b]);const l=()=>{if(p<=19)return;const y=Math.max(Math.min(o==null?void 0:o.length,p)-8,19);x(y)},a=()=>{if(p>=(o==null?void 0:o.length))return;const y=Math.min(p+8,o==null?void 0:o.length);x(y)};return e.jsxs(K,{w:"100%",gap:{base:"20px",lg:"40px"},p:{base:"8px",lg:"20px"},borderRadius:"16px",border:"1px solid",borderColor:"border",bg:"bg_secondary",children:[e.jsxs(U,{w:"100%",justify:"space-between",children:[e.jsxs(lt,{fontSize:"16px",fontWeight:"400",children:["Bins Trading Volume(",s,")"]}),e.jsxs(U,{flex:"1",justify:"flex-end",children:[o&&e.jsxs(U,{children:[e.jsx(pt,{type:"Sub",onClick:a,disabled:p>=(o==null?void 0:o.length),wrapStyle:{minW:"24px",w:"24px",h:"24px"}}),e.jsx(pt,{type:"Add",onClick:l,disabled:p<=19,wrapStyle:{minW:"24px",w:"24px",h:"24px"}})]}),e.jsx(gt,{type:"outlineTab",tabList:n,currentTab:u,handleChangeTab:r,wrapStyle:{h:"24px",p:"1px",borderRadius:"8px",flex:"0 0 101px"},itemStyle:{fontSize:"12px",flex:1,borderRadius:"6px"}})]})]}),t&&(o==null?void 0:o.length)===0&&e.jsx(Xe,{h:"140px",children:e.jsx(Vt,{})}),!t&&o&&(o==null?void 0:o.length)===0&&e.jsx(dt,{type:"nodata",border:"none",p:"20px"}),!t&&(o==null?void 0:o.length)>0&&e.jsx(we,{w:"100%",h:"140px",children:e.jsx(In,{data:o,onChangeValue:y=>d(y),maxBinsLength:p})})]})}const tr=(i,r)=>({tokenAPrice:void 0,setTokenAPrice:n=>{i(()=>({tokenAPrice:n}))},tokenBPrice:void 0,setTokenBPrice:n=>{i(()=>({tokenBPrice:n}))},tokenAAmount:"",setTokenAAmount:n=>{i(()=>({tokenAAmount:F(n).lt(0)?"0":n}))},tokenBAmount:"",setTokenBAmount:n=>{i(()=>({tokenBAmount:F(n).lt(0)?"0":n}))},tokenAAmountUSD:"",setTokenAAmountUSD:n=>{i(()=>({tokenAAmountUSD:n}))},tokenBAmountUSD:"",setTokenBAmountUSD:n=>{i(()=>({tokenBAmountUSD:n}))},totalAmountUSD:"",setTotalAmountUSD:n=>{i(()=>({totalAmountUSD:n}))},tvlLoading:!0,setTvlLoading:n=>{i(()=>({tvlLoading:n}))},resetTvlInfo:()=>{i(()=>({tokenAPrice:void 0,tokenBPrice:void 0,tokenAAmount:"",tokenBAmount:"",tokenAAmountUSD:"",tokenBAmountUSD:"",totalAmountUSD:""}))}}),ni=Ui(tr),Nt=i=>i==="--"?"--":`${i}%`;function sr(){const{dlmmApiPoolInfo:i,dlmmContractPoolInfo:r}=le(),{fromToken:n,toToken:t}=ye(),{getExplorerUrl:o}=Vs(),{poolId:d}=$e(),{tokenAAmount:u,tokenBAmount:s,tokenAAmountUSD:b,tokenBAmountUSD:p,totalAmountUSD:x,tvlLoading:l}=ni(),{tokenARatio:a,tokenBRatio:y}=Ri(b,x),c=`${F(Mt).div(Tt).mul(100)}%`,j=S.useMemo(()=>{if(!(r!=null&&r.variable_parameters))return;const g=Vi.getVariableFee(r==null?void 0:r.variable_parameters);return F(g).gt(Mt)?F(Mt).div(Tt).toString():F(g).div(Tt).toString()},[r==null?void 0:r.variable_parameters]),h=S.useMemo(()=>{var B;if(!j)return;const g=F((i==null?void 0:i.fee)??F((B=i==null?void 0:i.feeDisplay)==null?void 0:B.replace("%","")).div(100).toNumber()).plus(F(j)).toString(),v=F(Mt).div(Tt).toString();return F(g).gt(v)?v:g},[i==null?void 0:i.fee,j]);return S.useMemo(()=>!j||!(i!=null&&i.protocolFeeRate)?"--":F(i.protocolFeeRate).mul(100).toString()+"%",[h,i==null?void 0:i.protocolFeeRate]),e.jsxs(K,{w:{base:"100%",lg:"482px"},gap:"20px",p:{base:"20px 8px 8px",lg:"20px 16px"},borderRadius:"16px",border:"1px solid",borderColor:"border",bg:"bg_secondary",minW:{base:"100%",lg:"482px"},maxW:{base:"100%",lg:"482px"},children:[e.jsxs(K,{gap:"20px",w:"100%",children:[e.jsx(U,{w:"100%",justify:"space-between",children:e.jsx(lt,{fontSize:"16px",fontWeight:"400",children:"Pool Info"})}),e.jsxs(Ti,{templateColumns:{base:"repeat(1, 1fr)",lg:"repeat(2, 1fr)"},w:"100%",gap:{base:"12px",lg:"12px"},children:[e.jsx(ct,{label:"Address",value:e.jsx(Gi,{address:d||"",fontSize:"14px",color:"text_caption",onClickLink:()=>window.open(o(d,"poolAddress")),wrapStyle:{gap:"6px"},iconGap:"6px"}),wrapStyle:{gridColumn:{base:"1",lg:"span 2"}}}),e.jsx(ct,{label:"Pool ID",value:(r==null?void 0:r.index)!==void 0?`#${(r==null?void 0:r.index)+1}`:"--"}),e.jsx(ct,{label:"Bin Step",value:(r==null?void 0:r.binStep)||"--"}),e.jsx(ct,{label:"Base Fee",value:i!=null&&i.feeDisplay?i==null?void 0:i.feeDisplay:"--"}),e.jsx(ct,{label:e.jsx(Ae,{tooltip:e.jsx(E,{fontSize:"12px",children:"The hard cap of the total dynamic fee of this pool"}),children:e.jsxs(U,{gap:"2px",_hover:{svg:{fill:"text_caption"}},children:[e.jsx(E,{children:"Max Fee"}),e.jsx(Fe,{xlinkHref:"#icon-icon_tips",fontSize:"18px"})]})}),value:c}),e.jsx(ct,{label:e.jsx(Ae,{tooltip:e.jsx(E,{fontSize:"12px",children:"Base fee + real-time variable fee"}),children:e.jsxs(U,{gap:"2px",_hover:{svg:{fill:"text_caption"}},children:[e.jsx(E,{children:"Total Dynamic Fee"}),e.jsx(Fe,{xlinkHref:"#icon-icon_tips",fontSize:"18px"})]})}),value:h?Gs(F(h).mul(100).toString(),7)+"%":"--",wrapStyle:{gridColumn:{base:"1",lg:"span 2"}}})]})]}),e.jsxs(K,{gap:"20px",w:"100%",children:[e.jsx(U,{justify:"flex-start",w:"100%",children:e.jsx(lt,{fontSize:"16px",fontWeight:"400",children:"Pool Composition"})}),e.jsxs(K,{gap:"16px",w:"100%",children:[e.jsxs(U,{w:"100%",justify:"space-between",children:[e.jsxs(U,{gap:"12px",children:[e.jsx(Jt,{imageUrl:n==null?void 0:n.logo_url,w:"28px",h:"28px",coinType:n?n==null?void 0:n.coin_type:""}),e.jsxs(K,{align:"flex-start",gap:"4px",children:[e.jsx(E,{fontSize:"16px",fontWeight:"500",color:"text_caption",children:ae(n==null?void 0:n.symbol,10)}),l?e.jsx(Wt,{h:"12px",w:"46px"}):e.jsx(E,{fontSize:"12px",fontWeight:"500",children:i!=null&&i.isReverse?Nt(y):Nt(a)})]})]}),e.jsx(we,{w:"200px",children:e.jsx(Fi,{value:Number(i!=null&&i.isReverse?y:a),size:"xs",h:"4px",borderRadius:"4px",bg:[a,y].includes("--")?"border":"quote_green",sx:{'div[role="progressbar"]':{bg:[a,y].includes("--")?"background":"primary"}}})}),e.jsxs(U,{gap:"12px",children:[e.jsxs(K,{align:"flex-end",gap:"4px",children:[e.jsx(E,{fontSize:"16px",fontWeight:"500",color:"text_caption",children:ae(t==null?void 0:t.symbol,10)}),l?e.jsx(Wt,{h:"12px",w:"46px"}):e.jsx(E,{fontSize:"12px",fontWeight:"500",children:i!=null&&i.isReverse?Nt(a):Nt(y)})]}),e.jsx(Jt,{imageUrl:t==null?void 0:t.logo_url,w:"28px",h:"28px",coinType:t?t==null?void 0:t.coin_type:""})]})]}),e.jsxs(K,{w:"100%",flexDir:i!=null&&i.isReverse?"column-reverse":"column",gap:"16px",children:[e.jsx(Ss,{loading:l,token:i==null?void 0:i.tokenA,amount:u,amountUSD:b}),e.jsx(Ss,{loading:l,token:i==null?void 0:i.tokenB,amount:s,amountUSD:p})]})]})]})]})}function ir(i,r){var k,L;jt("dlmm");const{dlmmApiPoolInfo:n,currentBinStep:t,currentPrice:o,dlmmContractPoolInfo:d}=le(),{isInitialized:u}=Ki(),[s,b]=S.useState(),{getBinsInfoByPool:p}=Ds(),[x,l]=S.useState({}),{poolId:a}=$e(),[y,c]=S.useState(!0),{getTokenPrice:j}=tt(),h=j((k=n==null?void 0:n.tokenA)==null?void 0:k.coin_type),g=j((L=n==null?void 0:n.tokenB)==null?void 0:L.coin_type);S.useEffect(()=>{var _,f,W;u&&((_=d==null?void 0:d.bin_manager)!=null&&_.bin_manager_handle)&&(n==null?void 0:n.id)===(d==null?void 0:d.id)&&(c(!0),p({pool_id:d.id,coin_type_a:d.coin_type_a,coin_type_b:d.coin_type_b},(f=n==null?void 0:n.tokenA)==null?void 0:f.decimals,(W=n==null?void 0:n.tokenB)==null?void 0:W.decimals).then(w=>{l(w.allBinObj)}).finally(()=>{c(!1)}))},[n==null?void 0:n.id,u,d==null?void 0:d.id]),bt(()=>{if((d==null?void 0:d.activeId)!==void 0&&(d!=null&&d.id)&&(n==null?void 0:n.poolId)===(d==null?void 0:d.poolAddress)&&!ln(x)){const _=hn({activeBin:d==null?void 0:d.activeId,allBins:x,binStep:d==null?void 0:d.binStep,baseToken:n==null?void 0:n.tokenA,quoteToken:n==null?void 0:n.tokenB,maxBinsLength:i,direct:(n==null?void 0:n.isReverse)!==r});console.log("0829###ðŸš€ ~ useDlmmPoolLiquidityDistribution ~ list:",_),b(_)}},[d==null?void 0:d.activeId,n,x,i,r]);const v=S.useMemo(()=>d==null?void 0:d.activeId,[d==null?void 0:d.activeId]),B=S.useMemo(()=>Object.keys(x).length,[x]);return{activeBin:v,maxBinRangeData:s,allBinsLength:B,isLoading:y,tokenAPrice:h==null?void 0:h.price,tokenBPrice:g==null?void 0:g.price}}function ri(){var c,j;const{setCurrentPrice:i,dlmmApiPoolInfo:r}=le(),{quoteWhiteTokenList:n}=ms(),{getList:t,relatedPoolList:o}=on(),{poolId:d}=$e(),{getTokenInfo:u}=ns(),{fetchByApi:s}=Us(),{setPriceRangeMap:b}=Ni(),p=async(h,g,v,B)=>{var k,L,_,f,W;try{const w=await s(Qi,"POST",{pools:[h]});if(w&&(w!=null&&w.data)&&((k=w==null?void 0:w.data)!=null&&k.list)&&((L=w==null?void 0:w.data)==null?void 0:L.list.length)>0){const N=Object.fromEntries((W=(f=(_=w==null?void 0:w.data)==null?void 0:_.list[0])==null?void 0:f.ranges)==null?void 0:W.map(R=>{var Q,V;const q=(Q=Be)==null?void 0:Q.getPriceFromBinId((R==null?void 0:R.min)??0,g,v==null?void 0:v.decimals,B==null?void 0:B.decimals),m=(V=Be)==null?void 0:V.getPriceFromBinId((R==null?void 0:R.max)??0,g,v==null?void 0:v.decimals,B==null?void 0:B.decimals);return[`${R==null?void 0:R.type}-${h}`,[q,m]]}));return b(N),{rangesWithDateTypeMap:N}}return{rangesWithDateTypeMap:{}}}catch(w){return console.error("Error in fetchPriceRange:",w),b({}),{rangesWithDateTypeMap:{}}}},x=async h=>{var g,v,B;if((h==null?void 0:h.activeId)!==void 0){let k,L;if(h!=null&&h.tokenA)k=(g=h==null?void 0:h.tokenA)==null?void 0:g.decimals;else{const f=await u(h==null?void 0:h.coinTypeA);k=f==null?void 0:f.decimals}if(h!=null&&h.tokenB)L=(v=h==null?void 0:h.tokenB)==null?void 0:v.decimals;else{const f=await u(h==null?void 0:h.coinTypeB);L=f==null?void 0:f.decimals}const _=(B=Be)==null?void 0:B.getPriceFromBinId(h==null?void 0:h.activeId,h==null?void 0:h.binStep,k,L);i(_)}},l=S.useCallback(h=>{var g,v,B,k;return h?`${ae((g=r==null?void 0:r.displayTokenB)==null?void 0:g.symbol,8)} per ${ae((v=r==null?void 0:r.displayTokenA)==null?void 0:v.symbol,8)}`:`${ae((B=r==null?void 0:r.displayTokenA)==null?void 0:B.symbol,8)} per ${ae((k=r==null?void 0:r.displayTokenB)==null?void 0:k.symbol,8)}`},[r]),a=S.useMemo(()=>{var g,v;const h=gn(o);if(console.log(h,o,"baseFeeList"),h)return r!=null&&r.tokenA&&(r!=null&&r.tokenB)?(g=Ms)==null?void 0:g.map(B=>{var L,_;const k=((L=h.find(f=>f.feeRate+""===B.fee))==null?void 0:L.title)||B.title;return{...B,title:k,poolAddress:(_=h.find(f=>f.feeRate+""===B.fee))==null?void 0:_.poolAddress,disabled:k==="Not Created"&&!xt(r==null?void 0:r.tokenA,n)&&!xt(r==null?void 0:r.tokenB,n)}}):(v=Ms)==null?void 0:v.map(B=>{var L,_;const k=((L=h.find(f=>f.feeRate+""===B.fee))==null?void 0:L.title)||B.title;return{...B,title:k,poolAddress:(_=h.find(f=>f.feeRate+""===B.fee))==null?void 0:_.poolAddress,disabled:!xt(r==null?void 0:r.displayTokenA,n)&&!xt(r==null?void 0:r.displayTokenB,n)}})},[JSON.stringify(o),JSON.stringify(n),(c=r==null?void 0:r.displayTokenA)==null?void 0:c.coin_type,(j=r==null?void 0:r.displayTokenB)==null?void 0:j.coin_type]),y=S.useMemo(()=>{const h=a==null?void 0:a.find(g=>g.poolAddress===d);return h||r},[JSON.stringify(a),d,JSON.stringify(r)]);return{getPerText:l,getCurrentPrice:x,getList:t,relatedPoolList:o,baseFeeList:a,currentBaseFee:y,fetchPriceRange:p}}function nr({priceDirect:i}){var k,L,_,f;const{currentPrice:r,reverseCurrentPrice:n,dlmmApiPoolInfo:t}=le(),{getPerText:o}=ri(),[d,u]=S.useState(251),{activeBin:s,maxBinRangeData:b,isLoading:p,tokenAPrice:x,tokenBPrice:l,allBinsLength:a}=ir(d,i),{windowWidth:y,isApp:c}=He();S.useEffect(()=>{u(c?61:251)},[c]);const j=S.useMemo(()=>y<810?y-60:1118,[y]),h=()=>{if(d<=19)return;const W=Math.max(Math.min(d,a)-8,19);u(W)},g=()=>{if(d>=a)return;const W=Math.min(d+8,a);u(W),u(w=>w+8)},v=(t==null?void 0:t.isReverse)||!1,B=S.useMemo(()=>{const w=ve((t!=null&&t.isReverse?n:r).toString());return i&&w?ze(F(w).div(1).toString()):!i&&w?ze(F(1).div(w).toString()):""},[i,t==null?void 0:t.id,r]);return e.jsx(K,{w:"100%",gap:{base:"20px",lg:"40px"},p:{base:"8px",lg:"20px"},borderRadius:"16px",border:"1px solid",borderColor:"border",bg:"bg_secondary",children:e.jsxs(K,{gap:"20px",w:"100%",children:[c?e.jsxs(e.Fragment,{children:[e.jsxs(U,{w:"100%",justify:"space-between",children:[e.jsx(lt,{fontSize:"16px",fontWeight:"400",children:"Pool Liquidity Distribution"}),e.jsxs(U,{children:[e.jsx(pt,{type:"Sub",onClick:g,disabled:d>=a,wrapStyle:{minW:"24px",w:"24px",h:"24px"}}),e.jsx(pt,{type:"Add",onClick:h,disabled:d<=19,wrapStyle:{minW:"24px",w:"24px",h:"24px"}})]})]}),e.jsxs(U,{gap:"16px",children:[e.jsx(me,{symbol:ae(((k=t==null?void 0:t.displayTokenA)==null?void 0:k.symbol)||"",8),color:"dlmm_blue"}),e.jsx(me,{symbol:ae(((L=t==null?void 0:t.displayTokenB)==null?void 0:L.symbol)||"",8),color:"dlmm_green"})]}),e.jsx(Ot,{price:B,perText:o(i)})]}):e.jsxs(U,{w:"100%",justify:"space-between",children:[e.jsx(lt,{fontSize:"16px",fontWeight:"400",children:"Pool Liquidity Distribution"}),e.jsxs(U,{gap:"40px",children:[e.jsxs(U,{gap:"16px",children:[e.jsx(Ot,{price:B,perText:o(i)}),e.jsx(me,{symbol:ae(((_=t==null?void 0:t.displayTokenA)==null?void 0:_.symbol)||"",8),color:"dlmm_blue"}),e.jsx(me,{symbol:ae(((f=t==null?void 0:t.displayTokenB)==null?void 0:f.symbol)||"",8),color:"dlmm_green"})]}),e.jsxs(U,{children:[e.jsx(pt,{type:"Sub",onClick:g,disabled:d>=a}),e.jsx(pt,{type:"Add",onClick:h,disabled:d<=19})]})]})]}),s!==void 0&&(p&&b===void 0?e.jsx(Xe,{h:"160px",children:e.jsx(Vt,{})}):e.jsx(Xs,{type:"simulation",data:b,activeBin:Number(s),width:j,height:160,noDataText:"No Liquidity Data",isReverse:v||!1,tokenAPrice:x,tokenBPrice:l}))]})})}function rr({priceDirect:i}){return e.jsxs(K,{w:"100%",gap:"16px",minW:{base:"100%",lg:"1024px"},children:[e.jsxs(Je,{flexDir:{base:"column",lg:"row"},w:"100%",gap:"16px",children:[e.jsx(mi,{}),e.jsx(sr,{})]}),e.jsx(nr,{priceDirect:i}),e.jsx(er,{priceDirect:i}),e.jsx(An,{})]})}function cr(i){var R,q,m,Q,V,J,X,I;const{onClose:r,onSubmit:n,data:{baseFeeDisplay:t},isReverse:o=!1,isDirect:d}=i,{fromToken:u,toToken:s,fromAmount:b,toAmount:p,byAmountIn:x,totalAmount:l,fromTokenLock:a,toTokenLock:y,minPriceData:c,maxPriceData:j,positionCount:h}=ye(),{dlmmApiPoolInfo:g,currentPrice:v,dlmmContractPoolInfo:B}=le(),{setIsChecked:k}=Dt(),[L,_]=S.useState(d),f=S.useMemo(()=>{var ne,_e,ue,T;return L?`${ae((ne=g==null?void 0:g.displayTokenB)==null?void 0:ne.symbol,10)} per ${ae((_e=g==null?void 0:g.displayTokenA)==null?void 0:_e.symbol,10)}`:`${ae((ue=g==null?void 0:g.displayTokenA)==null?void 0:ue.symbol,10)} per ${ae((T=g==null?void 0:g.displayTokenB)==null?void 0:T.symbol)}`},[L,(R=g==null?void 0:g.displayTokenA)==null?void 0:R.symbol,(q=g==null?void 0:g.displayTokenB)==null?void 0:q.symbol]),W=Is(()=>{n(),r()},1e3,{leading:!0,trailing:!1}),{notifiStatus:w}=Dt(),N=S.useMemo(()=>(c==null?void 0:c.binId)!==void 0&&(j==null?void 0:j.binId)!==void 0&&(B==null?void 0:B.active_id)!==void 0&&(c==null?void 0:c.binId)<=(B==null?void 0:B.active_id)&&(j==null?void 0:j.binId)>=(B==null?void 0:B.active_id),[c==null?void 0:c.binId,j==null?void 0:j.binId,B==null?void 0:B.active_id]);return e.jsxs(es,{isOpen:!0,onClose:()=>{r(),k(!1)},isCentered:!0,children:[e.jsx(ts,{}),e.jsxs(ss,{children:[e.jsx(Cs,{children:e.jsx(lt,{fontWeight:"500",fontSize:"16px",children:"Add Liquidity"})}),e.jsx(Os,{}),e.jsx(is,{textAlign:"center",p:"0px",children:e.jsxs(K,{w:"100%",gap:"20px",p:"8px 16px",pb:"0px",children:[e.jsxs(U,{w:"100%",justifyContent:"space-between",h:"40px",children:[e.jsxs(U,{children:[e.jsx(Ks,{coinACoinType:(m=g==null?void 0:g.displayTokenA)==null?void 0:m.coin_type,coinBCoinType:(Q=g==null?void 0:g.displayTokenB)==null?void 0:Q.coin_type,coinAIconUrl:(V=g==null?void 0:g.displayTokenA)==null?void 0:V.logo_url,coinBIconUrl:(J=g==null?void 0:g.displayTokenB)==null?void 0:J.logo_url,imageStyle:{w:"40px",h:"40px"},imgBoxStyle:{w:"40px",h:"40px"}}),e.jsx(E,{fontSize:"16px",color:"text_caption",textAlign:"left",children:`${ae((X=g==null?void 0:g.displayTokenA)==null?void 0:X.symbol,10)} - ${ae((I=g==null?void 0:g.displayTokenB)==null?void 0:I.symbol,10)}`})]}),e.jsx(Sn,{poolType:"dlmm",displayFee:t,binStep:B==null?void 0:B.binStep})]}),e.jsx(vn,{coinA:{amount:b,...u},coinB:{amount:p,...s}}),e.jsxs(we,{w:"100%",children:[e.jsxs(U,{w:"100%",justify:"space-between",h:"32px",children:[e.jsx(E,{fontSize:"16px",fontWeight:"500",color:"text_caption",children:"Selected Range"}),e.jsx(_n,{isActive:N,isRow:!0,imgStyle:{imgW:"29px",imgH:"16px"},w:"105px",h:"32px"})]}),e.jsxs(K,{gap:"0",border:"1px solid",bg:"bg_secondary",borderColor:"border",borderRadius:"12px",mt:"8px",children:[e.jsxs(U,{justify:"center",h:"48px",w:"100%",gap:"4px",children:[e.jsx(E,{children:"Current Price"}),e.jsx(E,{as:"span",color:"text_caption",children:ze(L===o?F(1).div(v).toString():v)}),e.jsx(E,{children:f}),e.jsx(We,{variant:"unstyled",onClick:()=>_(!L),children:e.jsx(Fe,{xlinkHref:"#icon-icon_swap1"})})]}),e.jsx(we,{h:"1px",w:"calc(100% - 32px)",p:"0 12px",bg:"border"}),e.jsxs(U,{w:"100%",h:"100px",children:[e.jsx(Rs,{title:"Min Price",price:ze(L===o?j==null?void 0:j.reversePrice:c==null?void 0:c.price),perText:f}),e.jsx(Ht,{orientation:"vertical",h:"40px"}),e.jsx(Rs,{title:"Max Price",price:ze(L===o?c==null?void 0:c.reversePrice:j==null?void 0:j.price),perText:f})]})]})]}),e.jsx(cs,{loading:!1,totalAmount:l}),e.jsx(We,{w:"calc(100% + 32px)",bottom:"0px",mt:"4px",h:"52px",borderRadius:"12px",fontSize:"16px",fontWeight:"500",onClick:W,children:"Add Liquidity"})]})})]})]})}const Rs=({title:i,price:r,perText:n})=>e.jsxs(K,{flex:"1",children:[e.jsx(E,{children:i}),e.jsx(E,{color:"text_caption",children:r}),e.jsx(E,{children:n})]}),Ve=1e3;function ci(){var l,a;const{getDefaultBinPriceAndId:i}=yt(),{currentBinStep:r,currentPrice:n,dlmmApiPoolInfo:t,dlmmContractPoolInfo:o}=le(),{setMaxPriceData:d,setMinPriceData:u,maxPriceData:s,minPriceData:b}=ye(),p=S.useCallback((y,c,j,h,g,v=!1)=>{if(!h||!g||!j||y===void 0||c===void 0)return;const B=Be.getPriceFromBinId(y,j,h==null?void 0:h.decimals,g==null?void 0:g.decimals),k=Be.getPriceFromBinId(c,j,h==null?void 0:h.decimals,g==null?void 0:g.decimals),[L,_,f]=$t(k);d({tokenA:h,tokenB:g,binId:c,price:k,displayPrice:L,reversePrice:_,displayReversePrice:f,type:"upper",triggerFrom:"init",actionSource:v?"user":"system"});const[W,w,N]=$t(B);u({tokenA:h,tokenB:g,binId:y,price:B,displayPrice:W,reversePrice:w,displayReversePrice:N,type:"lower",triggerFrom:"init",actionSource:v?"user":"system"})},[]);return{handleInitPriceRange:S.useCallback((y,c,j=!1)=>{var f,W,w,N;if(b!==null&&s!==null&&!j)return;const h=(y==null?void 0:y.binStep)??r,g=c??n,v=((f=y==null?void 0:y.tokenA)==null?void 0:f.decimals)??((W=t==null?void 0:t.tokenA)==null?void 0:W.decimals),B=((w=y==null?void 0:y.tokenB)==null?void 0:w.decimals)??((N=t==null?void 0:t.tokenB)==null?void 0:N.decimals),k=(y==null?void 0:y.activeId)??(o==null?void 0:o.activeId),L=(y==null?void 0:y.tokenA)||(t==null?void 0:t.tokenA),_=(y==null?void 0:y.tokenB)||(t==null?void 0:t.tokenB);if(h&&F(g).gt(0)&&L&&_&&k!==void 0){const{lower_bin_id:R,upper_bin_id:q,lower_price:m,upper_price:Q}=i(h,k,v,B);p(R,q,h,L,_,!0)}},[r,(l=t==null?void 0:t.tokenA)==null?void 0:l.coinType,(a=t==null?void 0:t.tokenB)==null?void 0:a.coinType,n,o==null?void 0:o.activeId]),initPriceRange:p}}function ar(i,r){var ds,ls;const[n,t]=S.useState(!1),[o,d]=S.useState(!1),{getDefaultBinPriceAndId:u}=yt(),{dlmmApiPoolInfo:s,currentBinStep:b,isAutoFill:p,setIsAutoFill:x,setCurrentBinStep:l,strategy:a,currentPrice:y,dlmmContractPoolInfo:c}=le(),{batchSignAndExecuteTransaction:j,getTransactionStatus:h,transactionSuccess:g}=wn(),{dlmmMevProtect:v,maxCapForGas:B,transactionMode:k,customGasPrice:L,liquiditySlippage:_}=Qs(),{transactionConfirmation:f}=fn(),{setBinInfos:W}=Bn(),w=S.useRef(""),{fromAmount:N,setFromAmount:R,fromAmountValue:q,setFromAmountValue:m,toAmount:Q,setToAmount:V,toAmountValue:J,setToAmountValue:X,byAmountIn:I,setByAmountIn:ne,isTokenA:_e,setIsTokenA:ue,fromToken:T,setFromToken:G,toToken:C,setToToken:D,totalAmount:oe,setTotalAmount:re,fromTokenLock:P,setFromTokenLock:H,toTokenLock:Y,setToTokenLock:$,setTokenMaxA:M,setTokenMaxB:O,tokenMaxA:se,tokenMaxB:z,liquidityAmount:A,setLiquidityAmount:Z,confirmModalOpen:de,setConfirmModalOpen:ge,nftOpen:ie,setNftOpen:he,relatedPosId:be,setRelatedPosId:xe,minPriceData:ee,maxPriceData:ce,setMaxPriceData:_t,setMinPriceData:Kt,addLiquidityInfo:st,setAddLiquidityInfo:Ue,setPreCalcError:it,positionCount:di,setPositionCount:us,setNumBins:ps,numBins:nt,setBinIdRange:li,resetAddLiquidity:kr}=ye(),rt=jt("dlmm");tt();const{getNumBins:oi}=yt(),{handleInitPriceRange:Qt,initPriceRange:hi}=ci();S.useEffect(()=>{Qt(void 0,void 0,!1)},[Qt]),S.useEffect(()=>{if(s!=null&&s.binStep){const{minBinId:te,maxBinId:pe}=Be.findMinMaxBinId(Number(s.binStep));li({minBinId:te,maxBinId:pe})}},[s==null?void 0:s.binStep]),S.useEffect(()=>{p&&Qt(void 0,void 0,!0)},[p]),bt(()=>{var te,pe;s&&ue(((te=s==null?void 0:s.displayTokenA)==null?void 0:te.coin_type)===((pe=s==null?void 0:s.tokenA)==null?void 0:pe.coin_type))},[s]);const Yt=S.useMemo(()=>{var te,pe;if(b&&(c==null?void 0:c.activeId)!==void 0&&(s!=null&&s.tokenA)&&(s!=null&&s.tokenB))return u(b,c==null?void 0:c.activeId,(te=s==null?void 0:s.tokenA)==null?void 0:te.decimals,(pe=s==null?void 0:s.tokenB)==null?void 0:pe.decimals)},[c==null?void 0:c.activeId,(ds=s==null?void 0:s.tokenA)==null?void 0:ds.decimals,(ls=s==null?void 0:s.tokenB)==null?void 0:ls.decimals,b]);kn();const{isChecked:gi}=Dt(),bi=S.useCallback(async(te,pe,fe)=>{ne(pe),!te&&p?pe?(R(te),V("")):(V(te),R("")):pe?R(te):V(te),ue(fe!==void 0?fe:!1)},[p]),{handleAutoFillPreAdd:yi,handleNotAutoFillPreAdd:ji}=dn(),xs=S.useCallback(async()=>{var te,pe;try{if(!p||P&&!Y||!P&&Y){d(!0);const fe=((T==null?void 0:T.coin_type)===((te=s==null?void 0:s.tokenA)==null?void 0:te.coin_type)?at(N,T==null?void 0:T.decimals).toString():at(Q,C==null?void 0:C.decimals).toString())||"0",Ge=((T==null?void 0:T.coin_type)===((pe=s==null?void 0:s.tokenA)==null?void 0:pe.coin_type)?at(Q,C==null?void 0:C.decimals).toString():at(N,T==null?void 0:T.decimals).toString())||"0",Ke=F(fe).gt(0),Qe=F(Ge).gt(0);let Ee=ee.binId,je=ce.binId;const ke=c==null?void 0:c.activeId,Re=(ce==null?void 0:ce.actionSource)==="system"&&ee.actionSource==="system";if(Ke&&!Qe?Re&&ee.binId<ke&&(Ee=ke,je=ke+fs-2):!Ke&&Qe?Re&&ce.binId>ke&&(je=ke,Ee=je-fs+2):Re&&(Ee=Yt.lower_bin_id,je=Yt.upper_bin_id),Ee!==ee.binId||je!==ce.binId){hi(Ee,je,c==null?void 0:c.binStep,s==null?void 0:s.tokenA,s==null?void 0:s.tokenB,!1);return}if(Number(nt)>Ve||Number(nt)<1){Ue([]);return}const Le=Fs();w.current=Le;const Me=await ji({coinAmountA:fe,coinAmountB:Ge,currentBinStep:c==null?void 0:c.binStep,tokenA:s==null?void 0:s.tokenA,tokenB:s==null?void 0:s.tokenB,lowerBinId:Ee,upperBinId:je,strategyType:a,activeId:ke,isReverse:s==null?void 0:s.isReverse,pool:c,uuid:Le});if((Me==null?void 0:Me.uuid)===w.current){const{totalAmount:Ce,binInfos:Se,coinAmountA:Te,coinAmountB:Ne}=Me;console.log(Me,"onDlmmNotAutoFillPreCalc 2"),Se&&(Ue(Se),it(void 0)),re(Ce)}}}catch(fe){console.log("onDlmmNotAutoFillPreCalc ~ error",fe),String(fe).includes("is less than 1")&&(it("amountTooSmall"),Ue(null))}finally{d(!1)}},[N,Q,I,s,p,a,ee==null?void 0:ee.binId,ce==null?void 0:ce.binId,T,C,c,P,Y]);mt(()=>{Yt&&(F(N).gt(0)||F(Q).gt(0))&&c&&s?xs():(Ue(null),it(void 0),d(!1),p||(ee&&Kt({...ee,actionSource:"system"}),ce&&_t({...ce,actionSource:"system"})))},[xs],{wait:300});const Zt=S.useCallback(async te=>{var pe,fe,Ge,Ke,Qe,Ee;if(p&&!P&&!Y&&c&&s){d(!0),console.log("onDlmmAutoFillPreCalc ~ numBins",nt,te);const je=I&&(T==null?void 0:T.coin_type)===((pe=s==null?void 0:s.tokenA)==null?void 0:pe.coin_type)?!0:!I&&(C==null?void 0:C.coin_type)===((fe=s==null?void 0:s.tokenA)==null?void 0:fe.coin_type);if(F(te).gt(0))try{if(Number(nt)>Ve||Number(nt)<1){Ue([]);return}const ke=Fs();w.current=ke;const Re=await yi({amount:je?at(te,(Ge=s==null?void 0:s.tokenA)==null?void 0:Ge.decimals).toString():at(te,(Ke=s==null?void 0:s.tokenB)==null?void 0:Ke.decimals).toString(),tokenA:s==null?void 0:s.tokenA,tokenB:s==null?void 0:s.tokenB,strategy:a,isReverse:s==null?void 0:s.isReverse,fixAmountA:je,lowerBinId:ee.binId,upperBinId:ce.binId,activeId:c==null?void 0:c.activeId,currentBinStep:c==null?void 0:c.binStep,pool:c,uuid:ke});if(console.log("onDlmmAutoFillPreCalc ~ res",Re),Re&&(Re==null?void 0:Re.uuid)===w.current){const{displayCoinAmountA:Le,displayCoinAmountB:Me,totalAmount:Ce,binInfos:Se,coinAmountA:Te,coinAmountB:Ne}=Re;Se&&(Ue(Se),it(void 0)),I?(C==null?void 0:C.coin_type)===((Qe=s==null?void 0:s.tokenB)==null?void 0:Qe.coin_type)?V(Ne):V(Te):(T==null?void 0:T.coin_type)===((Ee=s==null?void 0:s.tokenA)==null?void 0:Ee.coin_type)?R(Te):R(Ne),re(Ce)}}catch(ke){console.log("onDlmmAutoFillPreCalc ~ error",ke),String(ke).includes("is less than 1")&&(it("amountTooSmall"),Ue(null),I?V(""):R(""),re("")),d(!1)}else d(!1),it(void 0),I?V(""):R(""),re("")}},[p,T,C,ee,ce,a,I,N,Q,s,P,Y,nt,c==null?void 0:c.activeId]);S.useEffect(()=>{F(N||"0").eq("0")&&F(Q||"0").eq("0")&&(Ue(null),d(!1))},[N,Q]),mt(()=>{I&&Zt(N),I||Zt(Q)},[Zt],{wait:250}),S.useEffect(()=>{if(qe(ee)&&qe(ce)&&b!==void 0)if(Number.isFinite(ee==null?void 0:ee.binId)&&Number.isFinite(ce==null?void 0:ce.binId)&&F(ce.binId).gte(ee.binId)){const te=Be.getPositionCount(ee.binId,ce.binId);us(te);const pe=oi(ee.binId,ce.binId);ps(pe)}else us(0),ps(0)},[ee==null?void 0:ee.binId,ce==null?void 0:ce.binId,b]);const{balanceInfo:Si}=qt(T),{balanceInfo:_i}=qt(C),vt=S.useMemo(()=>s==null?void 0:s.isReverse,[s==null?void 0:s.isReverse]);bt(()=>{var te,pe;ue(I?(T==null?void 0:T.coin_type)===((te=s==null?void 0:s.tokenA)==null?void 0:te.coin_type):(C==null?void 0:C.coin_type)===((pe=s==null?void 0:s.tokenA)==null?void 0:pe.coin_type))},[s==null?void 0:s.poolAddress,I,T,C]);const{currentAccount:vi,onWalletModal:wi}=St(),Bi=Is(()=>{vi?ge(!0):wi(!0)},300,{leading:!0,trailing:!1}),fi=()=>{R(""),V(""),m(""),X(""),re(""),Ue(null)};S.useEffect(()=>{(!N||!+N)&&(!Q||!+Q)&&W({})},[N,Q]);const{fetchAccountBalance:ki}=Ps(),Mi=async()=>{var pe,fe,Ge,Ke,Qe,Ee;let te=[];try{let je;t(!0);const ke=ee.binId,Re=ce.binId,Le=[],Me=st==null?void 0:st.bins;if(Me&&(Me==null?void 0:Me.length)>1e3){const Te=Math.ceil((Me==null?void 0:Me.length)/1e3);for(let Ne=0;Ne<Te;Ne++){const Oe=bn(Me,Ne,1e3),ot={pool_id:s==null?void 0:s.poolId,bin_infos:Oe,coin_type_a:(pe=s==null?void 0:s.tokenA)==null?void 0:pe.coinType,coin_type_b:(fe=s==null?void 0:s.tokenB)==null?void 0:fe.coinType,lower_bin_id:ke,upper_bin_id:Re,active_id:c==null?void 0:c.activeId,strategy_type:a,max_price_slippage:_,bin_step:c==null?void 0:c.binStep,use_bin_infos:!1},Ye=rt==null?void 0:rt.Position.addLiquidityPayload(ot);Le.push(Ye);const{bin_infos:os,...wt}=ot;te.push(wt)}}else{const Se={pool_id:s==null?void 0:s.poolId,bin_infos:st,coin_type_a:(Ge=s==null?void 0:s.tokenA)==null?void 0:Ge.coinType,coin_type_b:(Ke=s==null?void 0:s.tokenB)==null?void 0:Ke.coinType,lower_bin_id:ke,upper_bin_id:Re,active_id:c==null?void 0:c.activeId,strategy_type:a,max_price_slippage:_,bin_step:c==null?void 0:c.binStep,use_bin_infos:!1},Te=rt==null?void 0:rt.Position.addLiquidityPayload(Se);Le.push(Te);const{bin_infos:Ne,...Oe}=Se;te.push(Oe)}je={actionType:"dlmmAddLiquidityBatch",getShowInfo:(Se,Te,Ne,Oe)=>{const ot="Add "+[zt(N,T==null?void 0:T.symbol),zt(Q,C==null?void 0:C.symbol)].filter(Boolean).join(" and "),Ye={modalDescriptionText:ot,toastTitleText:ot},os=(Oe==null?void 0:Oe.failedResults)&&Oe.failedResults.length>0&&Oe.successResults.length>0;if(Se==="rejected"&&os&&Oe.failedResults.length>0&&(Ye.toastDescriptionContent=`Failed transactions ${Oe.failedResults.length} /${Le.length} `),Se==="success"){let wt=N,hs=Q;Te&&(wt=ws(Te,T)||N,hs=ws(Te,C)||Q);const gs="Add "+[zt(wt,T==null?void 0:T.symbol),zt(hs,C==null?void 0:C.symbol)].filter(Boolean).join(" and ");Le.length>1?Ye.toastDescriptionContent=`Completed transactions ${Le.length} /${Le.length} `:Ye.toastDescriptionContent=gs,Ye.modalDescriptionText=gs,Ye.toastTitleText="Supplied Successful"}return Ye}},Le.length===1&&f(je);let Ce=await j(Le,je,{useDevInspect:!0,useMev:v,showSuccessModal:!1,maxCapForGas:B,customGasPrice:L,trackData:{params:te,actionType:"dlmm",action:"dlmmAddLiquidity"}});if(console.log("0923### dlmm add ðŸš€ ~ handleSubmit ~ res:",Ce),console.log("0923### dlmm add ðŸš€ ~ handleSubmit ~ TrackDataParams:",te),console.log(Ce,"signAndExecuteTransaction"),Ce&&((Qe=Ce==null?void 0:Ce.successResults)==null?void 0:Qe.length)>0){if(Le.length===1){let Se=Ce.successResults[0].response;((Ee=Se==null?void 0:Se.events)==null?void 0:Ee.length)===0&&(Se=await h(Se.digest));const{posId:Te,farmsPosId:Ne}=Yi(Se);console.log(Ce,Te,Ne,"signAndExecuteTransaction"),Te?(he(!0),xe(Ne||Te)):Le.length===1&&g(je)}ki(),fi(),i(),t(!1)}}catch(je){throw console.error(je,"handleSubmit ~ error"),String(je).toLocaleLowerCase(),t(!1),je}finally{t(!1)}};return S.useEffect(()=>{if(qe(c)&&qe(ee)&&qe(ce)){const te=ee.binId,pe=ce.binId,fe=c==null?void 0:c.activeId;F(te).gt(pe)?(H(!0),$(!0)):F(te).gt(fe)?vt?(H(!!r),$(!r)):(H(!r),$(!!r)):F(pe).lt(fe)?vt?(H(!r),$(!!r)):(H(!!r),$(!r)):(H(!1),$(!1))}},[ee==null?void 0:ee.binId,ce==null?void 0:ce.binId,y,c==null?void 0:c.activeId,r,vt]),{handleAmountChange:bi,fromToken:T,setFromToken:G,toToken:C,setToToken:D,byAmountIn:I,setByAmountIn:ne,fromAmount:N,fromAmountValue:q,setFromAmount:R,toAmount:Q,toAmountValue:J,setToAmount:V,liquidityAmount:A,fromBalanceInfo:Si,toBalanceInfo:_i,totalAmount:oe,fromTokenLock:P,toTokenLock:Y,handleAdd:Bi,confirmModalOpen:de,setConfirmModalOpen:ge,nftOpen:ie,setNftOpen:he,relatedPosId:be,handleSubmit:Mi,submitLoading:n,positionCount:di,isReverse:vt,preCalcLoading:o}}function ur(){const{fromAmount:i,toAmount:r,fromToken:n,toToken:t,fromTokenLock:o,toTokenLock:d,liquidityAmount:u,numBins:s,addLiquidityInfo:b,preCalcError:p}=ye(),{currentAccount:x}=St(),{isAutoFill:l}=le(),{balanceInfo:a}=qt(n),{balanceInfo:y}=qt(t),c=S.useMemo(()=>{const j={text:"Add Liquidity",disabled:!1};return x!=null&&x.address?!s||+s>Ve?(j.disabled=!0,j):!(b!=null&&b.bins)||b.bins.length===0?(j.disabled=!0,j.text="Enter an amount",j):p==="amountTooSmall"?(j.disabled=!0,j):i&&+i&&F(i).gt((a==null?void 0:a.balanceFormat)||0)?(j.disabled=!0,j.text=`Insufficient ${ae(n==null?void 0:n.symbol,10)} Balance`,j):(r&&+r&&F(r).gt((y==null?void 0:y.balanceFormat)||0)&&(j.disabled=!0,j.text=`Insufficient ${ae(t==null?void 0:t.symbol,10)} Balance`),j):(j.text="Connect Wallet",j.disabled=!1,j)},[x==null?void 0:x.address,i,r,a==null?void 0:a.balanceFormat,y==null?void 0:y.balanceFormat,n,t,o,d,u,l,s,b,p]);return{btnText:c.text,btnDisabled:c.disabled}}function pr({rangeTabList:i}){var f,W;const{dlmmApiPoolInfo:r,isAutoFill:n}=le(),{fromToken:t,toToken:o,setFromToken:d,setToToken:u,byAmountIn:s,setByAmountIn:b,fromTokenLock:p,toTokenLock:x,fromAmount:l,toAmount:a,setFromAmount:y,setToAmount:c,setFromLoading:j,setToLoading:h}=ye(),[g,v]=S.useState(((f=r==null?void 0:r.displayTokenA)==null?void 0:f.coinType)||"");S.useEffect(()=>{var w,N;if((w=r==null?void 0:r.displayTokenA)!=null&&w.coinType){const R=(N=r==null?void 0:r.displayTokenA)==null?void 0:N.coinType;console.log("0925##ðŸš€ trigger setCurrentRangeTab111:",R),v(R)}},[r==null?void 0:r.poolId]);const B=S.useMemo(()=>{var w;return g===((w=r==null?void 0:r.displayTokenA)==null?void 0:w.coinType)},[g,(W=r==null?void 0:r.displayTokenA)==null?void 0:W.coinType]),k=S.useMemo(()=>{var w,N,R,q;return r?`${ae(B?(w=r.displayTokenB)==null?void 0:w.symbol:(N=r.displayTokenA)==null?void 0:N.symbol,8)} per ${ae(B?(R=r.displayTokenA)==null?void 0:R.symbol:(q=r.displayTokenB)==null?void 0:q.symbol,8)}`:""},[B,r]),_=Zi(w=>{const N=(w==null?void 0:w.coinType)||(w==null?void 0:w.key);De(N)!==De(g)&&(w&&(w!=null&&w.coinType||w!=null&&w.key)&&v((w==null?void 0:w.coinType)||(w==null?void 0:w.key)),d(o),u(t),b(!s),n?s?(c(l),y("")):(y(a),c("")):(y(a),c(l)))},500);return S.useEffect(()=>{s&&p&&!x&&(y(""),c("")),!s&&!p&&x&&(y(""),c("")),s&&!p&&x&&c(""),!s&&p&&!x&&y(""),p&&x&&(y(""),c(""))},[p,x]),{direct:B,perText:k,debouncedOnReverseClick:_,currentRangeTab:g}}function xr({onClose:i,poolId:r,posId:n,tokenA:t,tokenB:o,fee:d,isReverse:u,poolType:s="dlmm",binStep:b,positionCount:p,direct:x}){const l=Gt(),[a,y]=S.useState(x),{minPriceData:c,maxPriceData:j}=ye(),h=()=>{Zs(p).eq(1)?l(`/dlmm-position-detail/${n}`):l(`/dlmm?tab=positions&poolId=${r}`),i()};return e.jsxs(es,{isOpen:!0,autoFocus:!1,returnFocusOnClose:!1,onClose:i,isCentered:!0,children:[e.jsx(ts,{}),e.jsxs(ss,{w:"400px",children:[e.jsx(Cs,{children:e.jsxs(U,{justify:"space-between",w:"100%",children:[e.jsx(E,{fontSize:"16px",fontWeight:"500",color:"text_caption",children:"Open position successful"}),e.jsx(We,{onClick:i,variant:"unstyled",p:"0",minW:"unset",minH:"unset",w:"20px",h:"20px",children:e.jsx(Fe,{xlinkHref:"#icon-icon_close"})})]})}),e.jsx(is,{children:e.jsxs(K,{gap:"36px",children:[e.jsxs(K,{gap:"16px",bg:"center / contain no-repeat url('/images/active-sui.gif') ",w:"240px",h:"240px",justify:"center",border:"1px solid",borderColor:"border",borderRadius:"16px",children:[e.jsx(Ks,{coinAIconUrl:t==null?void 0:t.logo_url,coinBIconUrl:o==null?void 0:o.logo_url,coinACoinType:t==null?void 0:t.coin_type,coinBCoinType:o==null?void 0:o.coin_type,w:"48px",h:"48px"}),e.jsxs(E,{fontSize:"20px",fontWeight:"500",color:"text_caption",lineHeight:"28px",children:[ae(t==null?void 0:t.symbol,10)," - ",ae(o==null?void 0:o.symbol,10)]}),e.jsx(et,{w:"unset",p:"4px 8px",borderRadius:"12px",children:e.jsxs(U,{children:[e.jsx(E,{fontSize:"12px",color:"primary",lineHeight:"1",fontWeight:"500",children:d}),e.jsx(Ht,{orientation:"vertical",h:"10px"}),e.jsxs(E,{fontSize:"12px",color:"primary",children:[b," bps"]})]})})]}),e.jsxs(K,{w:"100%",justify:"center",borderRadius:"8px",border:"1px solid",borderColor:"border",bg:"input_bg",p:"16px 8px",children:[e.jsxs(E,{color:"text_caption",wordBreak:"break-all",children:[a!==u?ze(c==null?void 0:c.price):ze(j==null?void 0:j.reversePrice)," -Â ",a!==u?ze(j==null?void 0:j.price):ze(c==null?void 0:c.reversePrice)]}),e.jsxs(U,{children:[e.jsxs(U,{gap:"0",children:[e.jsx(E,{color:"primary_gray",children:ae(a?o==null?void 0:o.symbol:t==null?void 0:t.symbol,10)}),e.jsx(E,{color:"primary_gray",children:"Â perÂ "}),e.jsx(E,{color:"primary_gray",children:ae(a?t==null?void 0:t.symbol:o==null?void 0:o.symbol,10)})]}),e.jsx(Fe,{xlinkHref:"#icon-icon_swap1",w:"16px",h:"16px",onClick:g=>{Ys(g),y(!a)}})]})]})]})}),e.jsx($s,{p:"20px 0 0",children:e.jsx(We,{flex:"1",onClick:h,h:"52px",borderRadius:"12px",fontSize:"16px",fontWeight:"500",children:"View Detail"})})]})]})}function ai({disabled:i=!1}){const{isAutoFill:r,setIsAutoFill:n}=le(),{fromAmount:t,toAmount:o,setByAmountIn:d}=ye(),{isApp:u}=He(),s=()=>{t!==""&&o===""&&d(!0),t===""&&o!==""&&d(!1),n(!r)};return e.jsx(we,{cursor:"pointer",children:u?e.jsxs(bs,{display:"flex",alignItems:"center",children:[e.jsx(ys,{htmlFor:"auto-fill",mb:"0",fontSize:{base:"12px",lg:"14px"},fontWeight:"500",color:i?"text_paragraph":r?"text_highlight":"text_caption",children:e.jsx(Ae,{maxW:"320px",tooltip:e.jsxs(E,{fontSize:"12px",lineHeight:"20px",children:[e.jsx(E,{fontSize:"12px",as:"span",color:"text_caption",children:"ON:"})," ","Enter one token amount, the other is calculated automatically.",e.jsx("br",{}),e.jsx(E,{fontSize:"12px",as:"span",color:"text_caption",children:"OFF:"})," ","Enter custom amounts for both tokens manually.",e.jsx(we,{h:"8px"}),e.jsxs(we,{as:"div",lineHeight:"20px",cursor:"pointer",_hover:{svg:{fill:"text_caption"}},onClick:()=>window.open("https://cetus-1.gitbook.io/cetus-docs/dlmm/dynamic-fee/fee-structure#composition-fee"),children:["A composition fee may be applied during DLMM liquidity provision if the deposited token ratio into a bin differs from the binâ€™s current ratio. ",e.jsx(Fe,{xlinkHref:"#icon-icon_link1",display:"inline-block",fontSize:"16px",verticalAlign:"middle"})]})]}),children:"Auto Fill"})}),e.jsx(js,{id:"auto-fill",isDisabled:i,isChecked:r,onChange:s})]}):e.jsx(Ae,{maxW:"400px",tooltip:e.jsxs(E,{fontSize:"12px",lineHeight:"20px",children:[e.jsx(E,{fontSize:"12px",as:"span",color:"text_caption",children:"ON:"})," ","Enter one token amount, the other is calculated automatically.",e.jsx("br",{}),e.jsx(E,{fontSize:"12px",as:"span",color:"text_caption",children:"OFF:"})," ","Enter custom amounts for both tokens manually.",e.jsx(we,{h:"8px"}),e.jsxs(we,{as:"div",lineHeight:"20px",cursor:"pointer",_hover:{svg:{fill:"text_caption"}},onClick:()=>window.open("https://cetus-1.gitbook.io/cetus-docs/dlmm/dynamic-fee/fee-structure#composition-fee"),children:["A composition fee may be applied during DLMM liquidity provision if the deposited token ratio into a bin differs from the binâ€™s current ratio. ",e.jsx(Fe,{xlinkHref:"#icon-icon_link1",display:"inline-block",fontSize:"16px",verticalAlign:"middle"})]})]}),children:e.jsxs(bs,{display:"flex",alignItems:"center",children:[e.jsx(ys,{htmlFor:"auto-fill",mb:"0",fontSize:{base:"12px",lg:"14px"},fontWeight:"500",color:i?"text_paragraph":r?"text_highlight":"text_caption",children:"Auto Fill"}),e.jsx(js,{id:"auto-fill",isDisabled:i,isChecked:r,onChange:s})]})})})}const dr=({activeBin:i,allBins:r,binStep:n,baseToken:t,quoteToken:o,direct:d=!0,maxBin:u,minBin:s})=>{const b=s==u?s-1:s,p=s==u?u+1:u;if(Number(p)-Number(b)>=It)return;const x=c=>{const j=r==null?void 0:r[String(c)],h=ve(yn(c,n,t==null?void 0:t.decimals,o==null?void 0:o.decimals)),g=j!=null&&j.liquidity&&F(j==null?void 0:j.liquidity).gt("0")?F(j==null?void 0:j.liquidity).div(Math.pow(10,10)).toNumber():0;return{amount_a:(j==null?void 0:j.amount_a)||"0",amount_b:(j==null?void 0:j.amount_b)||"0",bin_id:c,liquidity:g,price:d?h:F(1).div(h).toString(),price_per_lamport:(j==null?void 0:j.price_per_lamport)||"",baseSymbol:t==null?void 0:t.symbol,quoteSymbol:o==null?void 0:o.symbol,baseLogo:t==null?void 0:t.logo_url,quoteLogo:o==null?void 0:o.logo_url,baseAmount:Et(j==null?void 0:j.amount_a,t==null?void 0:t.decimals),quoteAmount:Et(j==null?void 0:j.amount_b,o==null?void 0:o.decimals)}};let l=0;const a=[];for(let c=Number(b);c<=Number(p);c++){const j=x(c);a.push(j),l=j!=null&&j.liquidity?Math.max(l,Number(j.liquidity)):l}return{list:a.sort((c,j)=>Number(c.price)-Number(j.price)),max:l}};function lr(i){var _e,ue;const{getBinInfosByAutoFill:r,getBinInfosByBothAmount:n}=yt(),{addLiquidityInfo:t,setMinPriceData:o,setMaxPriceData:d,minPriceData:u,maxPriceData:s,chartRefreshTrigger:b,preCalcParams:p}=ye(),{dlmmContractPoolInfo:x,dlmmApiPoolInfo:l,isAutoFill:a}=le(),y=S.useRef({}),[c,j]=S.useState(),[h,g]=S.useState(!0),[v,B]=S.useState(),{getBinsInfoByPool:k}=Ds(),{dlmmPosBaseListGroupByPool:L,dlmmPosLiquidityData:_}=as(),[f,W]=S.useState(),{getTokenPrice:w}=tt(),N=w((_e=l==null?void 0:l.tokenA)==null?void 0:_e.coin_type),R=w((ue=l==null?void 0:l.tokenB)==null?void 0:ue.coin_type),[q,m]=S.useState({}),Q=S.useMemo(()=>(u==null?void 0:u.binId)!==void 0&&(s==null?void 0:s.binId)!==void 0?F(u==null?void 0:u.binId).minus(s==null?void 0:s.binId).abs().gte(It):!1,[u==null?void 0:u.binId,s==null?void 0:s.binId]);bt(()=>{var T;if(l!=null&&l.poolId&&L&&_){const G=L[l.poolId],C={};(T=G==null?void 0:G.list)==null||T.forEach(D=>{const oe=_[D.id];oe&&oe.binInfos.bins.forEach(re=>{const P=C[re.bin_id.toString()],H=Ct(re.amount_a,l.tokenA.decimals),Y=Ct(re.amount_b,l.tokenB.decimals);P?(P.amount_a=F(P.amount_a).add(H).toString(),P.amount_b=F(P.amount_b).add(Y).toString()):C[re.bin_id.toString()]={amount_a:H.toString(),amount_b:Y.toString(),bin_id:re.bin_id,price_per_lamport:re.price_per_lamport,liquidity:re.liquidity}})}),m({...C})}},[L,l==null?void 0:l.pool_id,_]),bt(()=>{var T,G,C;if(Q||(T=t==null?void 0:t.bins)!=null&&T.length&&((G=t==null?void 0:t.bins)==null?void 0:G.length)>It){B({...v,toLarge:!0});return}if(t&&((C=t==null?void 0:t.bins)==null?void 0:C.length)>0&&(l!=null&&l.tokenA)&&(l!=null&&l.tokenB)){const D=ks(t.bins,l==null?void 0:l.tokenA,l==null?void 0:l.tokenB,i,x==null?void 0:x.activeId,x==null?void 0:x.bin_step);B(D)}else B(void 0)},[t,l==null?void 0:l.poolId,i,x==null?void 0:x.activeId,Q]);const V=(T,G)=>{var C;(C=T==null?void 0:T.bin_manager)!=null&&C.bin_manager_handle&&(T!=null&&T.id)&&(T==null?void 0:T.id)===(G==null?void 0:G.poolId)&&(g(!0),k({pool_id:T.id,coin_type_a:T.coin_type_a,coin_type_b:T.coin_type_b},G.tokenA.decimals,G.tokenB.decimals).then(D=>{y.current=D.allBinObj,console.log("ðŸš€ ~ getPoolAllBinObj poolAllBinObj",y.current)}).finally(()=>{g(!1)}).catch(D=>{console.log("ðŸš€ ~ getPoolAllBinObj ~ error:",D)}))},J=S.useCallback(()=>{var T;l&&((T=x==null?void 0:x.bin_manager)!=null&&T.bin_manager_handle)&&(x!=null&&x.id)&&(x==null?void 0:x.id)===(l==null?void 0:l.poolId)&&V(x,l)},[x==null?void 0:x.id,l==null?void 0:l.poolId]);S.useEffect(()=>{var T;(T=x==null?void 0:x.bin_manager)!=null&&T.bin_manager_handle&&(x!=null&&x.id)&&(x==null?void 0:x.id)===(l==null?void 0:l.poolId)&&J()},[x==null?void 0:x.activeId,l==null?void 0:l.poolId]),S.useEffect(()=>{var T,G;(s==null?void 0:s.binId)!==void 0&&(u==null?void 0:u.binId)!==void 0&&(((s==null?void 0:s.triggerFrom)==="init"||(u==null?void 0:u.triggerFrom)==="init")&&X(u==null?void 0:u.binId,s==null?void 0:s.binId),((s==null?void 0:s.triggerFrom)==="input"||(u==null?void 0:u.triggerFrom)==="input")&&((T=c==null?void 0:c.list)==null||T.findIndex(C=>C.bin_id===(u==null?void 0:u.binId)),(G=c==null?void 0:c.list)==null||G.findIndex(C=>C.bin_id===(s==null?void 0:s.binId)),(u==null?void 0:u.binId)==(s==null?void 0:s.binId)?X((u==null?void 0:u.binId)-1,(s==null?void 0:s.binId)+1):(s==null?void 0:s.binId)-(u==null?void 0:u.binId)==1?X((u==null?void 0:u.binId)-1,s==null?void 0:s.binId):X(u==null?void 0:u.binId,s==null?void 0:s.binId)))},[s==null?void 0:s.binId,u==null?void 0:u.binId,y.current]),S.useEffect(()=>{var T;b>0&&l&&((T=x==null?void 0:x.bin_manager)!=null&&T.bin_manager_handle)&&(x!=null&&x.id)&&(x==null?void 0:x.id)===(l==null?void 0:l.poolId)&&V(x,l)},[b]);const X=S.useCallback((T,G)=>{if(l!=null&&l.tokenA&&(l!=null&&l.tokenB)&&(x==null?void 0:x.active_id)!==void 0&&(x!=null&&x.id)&&(x==null?void 0:x.id)===(l==null?void 0:l.id)){const C=dr({activeBin:x==null?void 0:x.active_id,allBins:y.current,binStep:x==null?void 0:x.bin_step,baseToken:l==null?void 0:l.tokenA,quoteToken:l==null?void 0:l.tokenB,direct:i,maxBin:G,minBin:T});j(C)}},[x==null?void 0:x.id,l==null?void 0:l.id,x==null?void 0:x.active_id,y.current,i]);S.useEffect(()=>{var T,G,C,D,oe,re,P,H,Y,$,M,O;if((s==null?void 0:s.binId)!==void 0&&(u==null?void 0:u.binId)!==void 0){const se=(T=c==null?void 0:c.list)==null?void 0:T.findIndex(A=>A.bin_id===(u==null?void 0:u.binId)),z=(G=c==null?void 0:c.list)==null?void 0:G.findIndex(A=>A.bin_id===(s==null?void 0:s.binId));if(se!==void 0&&se<0||z!==void 0&&z<0)X(u==null?void 0:u.binId,s==null?void 0:s.binId);else{const A=Math.min((D=(C=c==null?void 0:c.list)==null?void 0:C[0])==null?void 0:D.bin_id,(P=(re=c==null?void 0:c.list)==null?void 0:re[((oe=c==null?void 0:c.list)==null?void 0:oe.length)-1])==null?void 0:P.bin_id),Z=Math.max((Y=(H=c==null?void 0:c.list)==null?void 0:H[0])==null?void 0:Y.bin_id,(O=(M=c==null?void 0:c.list)==null?void 0:M[(($=c==null?void 0:c.list)==null?void 0:$.length)-1])==null?void 0:O.bin_id);X(A,Z)}}},[X]);const I=(T,G,C)=>{var P,H,Y,$,M,O,se,z;W(C?"currentLiquidityChart":"rangeChart");const D=x==null?void 0:x.bin_step,oe=(P=l==null?void 0:l.tokenA)==null?void 0:P.decimals,re=(H=l==null?void 0:l.tokenB)==null?void 0:H.decimals;if(D!==void 0&&oe!==void 0&&re!==void 0&&T!==void 0&&G!==void 0&&(l!=null&&l.tokenA)&&(l!=null&&l.tokenB)){const A=Be.getPriceFromBinId(T,D,oe,re),[Z,de,ge]=$t(A),ie=Be.getPriceFromBinId(G,D,oe,re),[he,be,xe]=$t(ie),ee={binId:T,price:A,displayPrice:Z,reversePrice:de,displayReversePrice:ge,tokenA:l.tokenA,tokenB:l.tokenB,type:"lower",triggerFrom:C?"currentLiquidityChart":"rangeChart",actionSource:"user"},ce={binId:G,price:ie,displayPrice:he,reversePrice:be,displayReversePrice:xe,tokenA:l.tokenA,tokenB:l.tokenB,type:"upper",triggerFrom:C?"currentLiquidityChart":"rangeChart",actionSource:"user"};if(o(ee),d(ce),C)if(c!=null&&c.list&&((Y=c==null?void 0:c.list)==null?void 0:Y.length)>0){const _t=(($=c==null?void 0:c.list)==null?void 0:$.length)||0,Kt=i?(M=c==null?void 0:c.list[0])==null?void 0:M.bin_id:(O=c==null?void 0:c.list[_t-1])==null?void 0:O.bin_id,st=i?(se=c==null?void 0:c.list[_t-1])==null?void 0:se.bin_id:(z=c==null?void 0:c.list[0])==null?void 0:z.bin_id;(T<Kt||G>st)&&X(T,G)}else X(T,G)}},ne=S.useCallback(async(T,G)=>{var C;try{let D=null;if(p&&(p.autoFill&&a&&(D=await r({...p.autoFill,lower_bin_id:T,upper_bin_id:G})),p.notAutoFill&&!a&&(D=await n({...p.notAutoFill,lower_bin_id:T,upper_bin_id:G}))),(C=D==null?void 0:D.bins)!=null&&C.length)return ks(D.bins,l==null?void 0:l.tokenA,l==null?void 0:l.tokenB,i,x==null?void 0:x.activeId,x==null?void 0:x.bin_step)}catch(D){return console.log("ðŸš€ ~ useDlmmAddLiquidityChart ~ error:",D),null}},[p]);return{currentLiquidityBins:v,activeId:x==null?void 0:x.activeId,maxBinRangeData:c,handleRangeChange:I,minPriceData:u,maxPriceData:s,otherPosBinObj:q,maxBinLoading:h,tokenAPrice:N==null?void 0:N.price,tokenBPrice:R==null?void 0:R.price,calcChartBinsData:ne}}function or(i){const{handleActionBinPrice:r}=yt(),{currentBinStep:n,dlmmApiPoolInfo:t,dlmmContractPoolInfo:o,currentPrice:d}=le(),{minPriceData:u,maxPriceData:s,setMinPriceData:b,setMaxPriceData:p,fromToken:x,toToken:l,binIdRange:a}=ye(),{buildPriceData:y}=rs(t==null?void 0:t.tokenA,t==null?void 0:t.tokenB,n),c=(v,B)=>{var f,W;const{bin_id:k,price:L}=r(B,n,(f=t==null?void 0:t.tokenA)==null?void 0:f.decimals,(W=t==null?void 0:t.tokenB)==null?void 0:W.decimals,v),_=Math.min(Math.max(k,a==null?void 0:a.minBinId),a==null?void 0:a.maxBinId);if((B==null?void 0:B.type)==="lower"){const w=Ie(a==null?void 0:a.minBinId,a==null?void 0:a.maxBinId,_,!0,s==null?void 0:s.binId),N=y(_,!0);if(N&&b(N),w&&w!==(s==null?void 0:s.binId)){const R=y(w,!1);R&&p(R)}}else{const w=y(_,!1);w&&p(w);const N=Ie(a==null?void 0:a.minBinId,a==null?void 0:a.maxBinId,_,!1,u==null?void 0:u.binId);if(N&&N!==(u==null?void 0:u.binId)){const R=y(N,!0);R&&b(R)}}},j=v=>{c("Add",v)},h=v=>{c("Sub",v)};return S.useRef(""),S.useRef(""),{handleAddPrice:j,handleSubPrice:h,onPriceChange:(v,B)=>{var W,w,N;const k=v.tokenA,L=v.tokenB;if(!k||!L||!(o!=null&&o.binStep))return;let _;if(F(B).lte("0")||B==="Infinity"){const R=i?d:(W=F(1).div(d))==null?void 0:W.toString();if(F(B).lte("0")){const q=i?F(R).mul(1e-4).toString():F(R).mul(1.9999).toString(),m=ze(i?q:F(1).div(q).toString());_=(w=Be)==null?void 0:w.getBinIdFromPrice(ve(m),o==null?void 0:o.binStep,!0,k==null?void 0:k.decimals,L==null?void 0:L.decimals),console.log(m,_,R,q,d,"lower_price_format")}else{const q=i?F(R).mul(1.9999).toString():F(R).mul(1e-4).toString(),m=ze(i?q:F(1).div(q).toString());_=(N=Be)==null?void 0:N.getBinIdFromPrice(ve(m),o==null?void 0:o.binStep,!0,k==null?void 0:k.decimals,L==null?void 0:L.decimals),console.log(m,_,R,q,d,"lower_price_format")}}else _=Be.getBinIdFromPrice(B,n,(v==null?void 0:v.type)==="lower",k==null?void 0:k.decimals,L==null?void 0:L.decimals);_=Math.min(Math.max(_,a==null?void 0:a.minBinId),a==null?void 0:a.maxBinId);const f=y(_,(v==null?void 0:v.type)==="lower");if((v==null?void 0:v.type)==="lower"){const R=Ie(a==null?void 0:a.minBinId,a==null?void 0:a.maxBinId,_,!0,s==null?void 0:s.binId);if(f&&b(f),R&&R!==(s==null?void 0:s.binId)){const q=y(R,!1);q&&p(q)}}else{f&&p(f);const R=Ie(a==null?void 0:a.minBinId,a==null?void 0:a.maxBinId,_,!1,u==null?void 0:u.binId);if(R&&R!==(u==null?void 0:u.binId)){const q=y(R,!0);q&&b(q)}}return f}}}function Ns({perText:i,direct:r,lowerPrice:n,upperPrice:t,wrapStyle:o={},children:d}){const{handleAddPrice:u,handleSubPrice:s,onPriceChange:b}=or(r),{numBins:p}=ye();return e.jsxs(Je,{className:"controlPriceRange",flexDir:{base:"column",lg:"row"},w:"100%",gap:{base:"8px",lg:"16px"},...o,children:[e.jsx(Bs,{title:"Min Price",perText:i,data:n,onPriceChange:b,direct:r,loading:!n,handleAddPrice:u,handleSubPrice:s,subDisabled:F(p).gte(Ve),addDisabled:!1}),d,e.jsx(Bs,{title:"Max Price",perText:i,data:t,onPriceChange:b,direct:r,loading:!t,handleAddPrice:u,handleSubPrice:s,subDisabled:!1,addDisabled:F(p).gte(Ve)})]})}function Ws({numBins:i,positionCount:r,onNumBinsBlur:n,onNumBinsChange:t,isLoading:o}){const{isApp:d}=He(),u=si(document==null?void 0:document.querySelector(".controlPriceRange")),s=u!=null&&u.height?`${d?60:u.height}px`:"100%";return e.jsx(zn,{flex:{base:"1",lg:"0 0 160px"},minH:s,h:s,borderRadius:"12px",p:"8px 12px 12px",children:e.jsx(K,{w:"100%",h:"100%",justify:"center",children:e.jsx(Ln,{label:"Num Bins",tooltip:"The number of bins in your position. A wider price range usually requires more bins. A position with more bins may consume higher gas during liquidity-related txns.",wrapStyle:{width:"auto",flexDir:"column",align:"center",sx:{"div > p:first-of-type":{fontSize:"12px"}},gap:"4px"},w:"320px",p:"8px",children:o?e.jsx(Wt,{w:"100px",h:"14px"}):e.jsx(Xi,{value:i.toString(),onChange:t,decimals:0,onBlur:n,style:{width:"calc(100% - 8px)",background:"none",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",opacity:1,outline:"none",color:"var(--chakra-colors-text_caption)",fontSize:"14px",height:"14px",lineHeight:"14px",textAlign:"center",fontWeight:"500"}})})})})}function hr({direct:i=!1}){var $;const{dlmmContractPoolInfo:r,dlmmApiPoolInfo:n,currentPrice:t,isAutoFill:o}=le(),{setMaxPriceData:d,setMinPriceData:u,minPriceData:s,maxPriceData:b,fromToken:p,fromAmount:x,toAmount:l,binIdRange:a}=ye(),[y,c]=S.useState(!1),[j,h]=S.useState(!1),{formatMinMaxBinId:g}=As(o,p,n==null?void 0:n.tokenA,x,l),{formatMinMaxPriceData:v,buildPriceData:B}=rs(n==null?void 0:n.tokenA,n==null?void 0:n.tokenB,r==null?void 0:r.binStep),k=S.useCallback(M=>{if((r==null?void 0:r.activeId)===void 0)return;const O=g(Number(M),r==null?void 0:r.activeId);if(O){const{minBinId:se,maxBinId:z}=O,A=v(se,z);if(A){const{minPriceData:Z,maxPriceData:de}=A;u(Z),d(de)}}},[r==null?void 0:r.binStep,r==null?void 0:r.activeId,p==null?void 0:p.address,($=n==null?void 0:n.tokenA)==null?void 0:$.decimals,x,l,o]),[L,_]=S.useState("49"),f=M=>{_(M.label),k(Number(M.label))},[W,w]=S.useState(void 0),[N,R]=S.useState(""),[q,m]=S.useState(""),[Q,V]=S.useState(""),[J,X]=S.useState("");S.useEffect(()=>{if((r==null?void 0:r.activeId)!==void 0&&(s==null?void 0:s.binId)!==void 0&&(b==null?void 0:b.binId)!==void 0){const M=(r==null?void 0:r.activeId)-(s==null?void 0:s.binId),O=(b==null?void 0:b.binId)-(r==null?void 0:r.activeId),se=["19","49","79"],z=M+O+1+"";(M===O||M===0||O===0)&&se.includes(z)?_(z):_(void 0)}},[s==null?void 0:s.binId,b==null?void 0:b.binId,r==null?void 0:r.activeId]),S.useEffect(()=>{if((s==null?void 0:s.price)!==void 0&&(b==null?void 0:b.price)!==void 0&&t)if(i){const M=F(ve(s==null?void 0:s.price)).sub(t).div(t).mul(100).toNumber().toFixed(2),O=F(ve(b==null?void 0:b.price)).sub(t).div(t).mul(100).toNumber().toFixed(2);R(M),m(M),V(O),X(O)}else{const M=F(F(1).div(ve(s==null?void 0:s.price))).sub(F(1).div(t)).div(F(1).div(t)).mul(100).toNumber().toFixed(2),O=F(F(1).div(ve(b==null?void 0:b.price))).sub(F(1).div(t)).div(F(1).div(t)).mul(100).toNumber().toFixed(2);R(O),m(O),V(M),X(M)}},[t,s==null?void 0:s.price,b==null?void 0:b.price,i]);const I=(M,O)=>{var se,z,A,Z;if(console.log(M,J,q,"handleRangeChange, handleRangeChange"),(n==null?void 0:n.isReverse)!==void 0&&(r==null?void 0:r.binStep)!==void 0&&(n!=null&&n.tokenA)&&(n!=null&&n.tokenB)&&q!==void 0&&J!==void 0){const de=n==null?void 0:n.tokenA,ge=n==null?void 0:n.tokenB;if(i)if(O==="min"){let ie;M!=null&&M.startsWith("-")?ie=F(t).sub(F(t).mul(M.replace("-","")).div(100)).toString():ie=F(t).add(F(t).mul(M).div(100)).toString();let he=(se=Be)==null?void 0:se.getBinIdFromPrice(ie,r==null?void 0:r.binStep,!1,de==null?void 0:de.decimals,ge==null?void 0:ge.decimals);he=Math.min(Math.max(he,a==null?void 0:a.minBinId),a==null?void 0:a.maxBinId);const be=Ie(a==null?void 0:a.minBinId,a==null?void 0:a.maxBinId,he,!0,b==null?void 0:b.binId),xe=B(he,!0);if(xe&&u(xe),be&&be!==(b==null?void 0:b.binId)){const ee=B(be,!1);ee&&d(ee)}}else{let ie;M!=null&&M.startsWith("-")?ie=F(t).sub(F(t).mul(M.replace("-","")).div(100)).toString():ie=F(t).add(F(t).mul(M).div(100)).toString();let he=(z=Be)==null?void 0:z.getBinIdFromPrice(ie,r==null?void 0:r.binStep,!0,de==null?void 0:de.decimals,ge==null?void 0:ge.decimals);he=Math.min(Math.max(he,a==null?void 0:a.minBinId),a==null?void 0:a.maxBinId);const be=B(he,!1);be&&d(be);const xe=Ie(a==null?void 0:a.minBinId,a==null?void 0:a.maxBinId,he,!1,s==null?void 0:s.binId);if(xe&&xe!==(s==null?void 0:s.binId)){const ee=B(xe,!0);ee&&u(ee)}}else if(O==="min"){let ie=0;if(M===J&&s&&(ie=s.binId),!ie){let xe;M!=null&&M.startsWith("-")?xe=F(1).div(F(F(1).div(t)).sub(F(1).div(t).mul(M.replace("-","")).div(100))).toString():xe=F(1).div(F(F(1).div(t)).add(F(1).div(t).mul(M).div(100))).toString(),ie=(A=Be)==null?void 0:A.getBinIdFromPrice(xe,r==null?void 0:r.binStep,!1,de==null?void 0:de.decimals,ge==null?void 0:ge.decimals)}ie=Math.min(Math.max(ie,a==null?void 0:a.minBinId),a==null?void 0:a.maxBinId);const he=B(ie,!1);he&&d(he);const be=Ie(a==null?void 0:a.minBinId,a==null?void 0:a.maxBinId,ie,!1,s==null?void 0:s.binId);if(be&&be!==(s==null?void 0:s.binId)){const xe=B(be,!0);xe&&u(xe)}}else{let ie=0;if(M===q&&b&&(ie=b.binId),!ie){let xe;M!=null&&M.startsWith("-")?xe=F(1).div(F(F(1).div(t)).sub(F(1).div(t).mul(M.replace("-","")).div(100))).toString():xe=F(1).div(F(F(1).div(t)).add(F(1).div(t).mul(M).div(100))).toString(),ie=(Z=Be)==null?void 0:Z.getBinIdFromPrice(xe,r==null?void 0:r.binStep,!0,de==null?void 0:de.decimals,ge==null?void 0:ge.decimals)}ie=Math.min(Math.max(ie,a==null?void 0:a.minBinId),a==null?void 0:a.maxBinId);const he=Ie(a==null?void 0:a.minBinId,a==null?void 0:a.maxBinId,ie,!0,b==null?void 0:b.binId),be=B(ie,!0);if(be&&u(be),he&&he!==(b==null?void 0:b.binId)){const xe=B(he,!1);xe&&d(xe)}}}},ne=S.useMemo(()=>W==="min",[W]),_e=S.useMemo(()=>W==="max",[W]),ue=S.useRef(null),T=S.useRef(0),G=S.useRef(null),C=S.useRef(0),D=M=>{T.current=M.target.selectionStart},oe=M=>{C.current=M.target.selectionStart};S.useEffect(()=>{var M;if(ue.current){const O=Math.min(T.current,N.length);(M=ue.current)==null||M.setSelectionRange(O,O)}},[N]),S.useEffect(()=>{var M;if(G.current){const O=Math.min(C.current,Q.length);(M=G.current)==null||M.setSelectionRange(O,O)}},[Q]);const re=M=>{const O=M.replace(/[% ]/g,"");if(w(void 0),console.log(q,"test",O,O==="-","onMinInputChange"),O==="-"){R(q);return}O&&O!==q?(m(O),I(O,"min")):R(q)};S.useEffect(()=>{console.log(N,"minValue")},[N]);const P=(M,O)=>{console.log(M,O,M.startsWith("-")&&F(M.replace("-","")).gt(99.99),"onMinInputChange"),M?M.split("").every(se=>se==="-")&&M.length>0?(console.log(M,"onMinInputChange"),R("-")):M==="-9007199254740991"?R(q):M.startsWith("-")&&F(M.replace("-","")).gt(99.99)?(R("-99.99"),h(!0)):(h(!1),R(M)):R("")};return S.useEffect(()=>{y&&setTimeout(()=>{c(!1)},3e3)},[y]),S.useEffect(()=>{j&&setTimeout(()=>{h(!1)},3e3)},[j]),{isMinInput:ne,minValue:N,minInputRef:ue,onMinInputBlur:re,onMinInputChange:P,handleMinInput:D,isMaxInput:_e,maxValue:Q,maxInputRef:G,onMaxInputChange:(M,O)=>{M?M.split("").every(se=>se==="-")&&M.length>0?V("-"):M==="-9007199254740991"?V(J):M.startsWith("-")&&F(M.replace("-","")).gt(99.99)?(V("-99.99"),c(!0)):(c(!1),V(M)):V("")},onMaxInputBlur:M=>{w(void 0);const O=M.replace(/[% ]/g,"");if(O==="-"){V(q);return}console.log(O,J,"onMaxInputBlur"),O&&O!==J?(X(O),I(O,"max")):V(J)},handleMaxInput:oe,currentNumBins:L,handleChangeTab:f,setActiveInput:w,showMaxWarning:y,showMinWarning:j}}const gr=[{label:"19",value:"19"},{label:"49",value:"49"},{label:"79",value:"79"}];function Hs({direct:i=!1,children:r}){const{isMinInput:n,minValue:t,minInputRef:o,onMinInputBlur:d,onMinInputChange:u,handleMinInput:s,isMaxInput:b,maxValue:p,maxInputRef:x,onMaxInputChange:l,onMaxInputBlur:a,currentNumBins:y,handleChangeTab:c,setActiveInput:j,showMaxWarning:h,showMinWarning:g,handleMaxInput:v}=hr({direct:i}),{isApp:B}=He(),k=si(document==null?void 0:document.querySelector(".controlPriceRange")),L=S.useMemo(()=>Zs(k==null?void 0:k.height).sub(8).div(2).toNumber(),[k==null?void 0:k.height]);return e.jsxs(Je,{flexDir:{base:"column",lg:"row"},w:"100%",gap:"8px",h:{base:"auto",lg:"32px"},justify:"space-between",children:[B?e.jsxs(e.Fragment,{children:[e.jsxs(U,{children:[r==null?void 0:r[0],e.jsxs(K,{flex:"0 0 100px",children:[e.jsx(et,{flex:{base:`0 0 ${L}px`,lg:"0 0 212px"},h:"100%",border:"1px solid",borderColor:n?"token_active_border":"border",boxShadow:n?"0px 0px 8px 0px #0067AD":"",display:"flex",p:"6px",borderRadius:"12px",justifyContent:"center",alignItems:"center",children:e.jsx(Bt,{label:e.jsx(E,{fontSize:"12px",lineHeight:"20px",children:"Percentage Min: -99.99%"}),isOpen:g,placement:"top",children:e.jsx(ft,{value:t,precision:2,inputMode:"numeric",clampValueOnBlur:!0,variant:"unstyled",format:_=>_?Pe(_)+" %":"",onFocus:()=>{j("min")},onBlur:_=>d(ve(_.target.value)),onChange:(_,f)=>u(ve(_),f),color:n?"text_caption":"text_paragraph",w:"100%",children:e.jsx(kt,{fontSize:"14px",color:"text_caption",paddingInlineStart:"4px",paddingInlineEnd:"4px",textAlign:"center",ref:o,onInput:s,onKeyDown:s,onMouseUp:s})})})}),e.jsx(et,{flex:{base:`0 0 ${L}px`,lg:"0 0 212px"},h:"100%",border:"1px solid",borderColor:b?"token_active_border":"border",boxShadow:b?"0px 0px 6px 0px #0067AD":"",display:"flex",p:"6px",borderRadius:"12px",justifyContent:"center",alignItems:"center",children:e.jsx(Bt,{label:e.jsx(E,{fontSize:"12px",lineHeight:"20px",children:"Percentage Min: -99.99%"}),isOpen:h,placement:"top",children:e.jsx(ft,{value:p,precision:2,variant:"unstyled",format:_=>_?Pe(_)+" %":"",clampValueOnBlur:!0,onFocus:()=>{j("max")},onChange:(_,f)=>l(ve(_),f),onBlur:_=>a(ve(_.target.value)),color:b?"text_caption":"text_paragraph",w:"100%",children:e.jsx(kt,{fontSize:"14px",color:"text_caption",paddingInlineStart:"4px",paddingInlineEnd:"4px",textAlign:"center",ref:x,onInput:v,onKeyDown:v,onMouseUp:v})})})})]})]}),r==null?void 0:r[1]]}):e.jsxs(e.Fragment,{children:[e.jsx(et,{flex:{base:"0 0 32px",lg:"1"},h:"100%",border:"1px solid",borderColor:n?"token_active_border":"border",boxShadow:n?"0px 0px 8px 0px #0067AD":"",display:"flex",p:"6px",borderRadius:"12px",justifyContent:"center",alignItems:"center",children:e.jsx(Bt,{label:e.jsx(E,{fontSize:"12px",lineHeight:"20px",children:"Percentage Min: -99.99%"}),isOpen:g,placement:"top",children:e.jsx(ft,{value:t,precision:2,inputMode:"numeric",clampValueOnBlur:!0,variant:"unstyled",format:_=>_?Pe(_)+" %":"",onFocus:()=>{j("min")},onBlur:_=>d(ve(_.target.value)),onChange:(_,f)=>u(ve(_),f),color:n?"text_caption":"text_paragraph",w:"100%",children:e.jsx(kt,{fontSize:"14px",color:"text_caption",paddingInlineStart:"4px",paddingInlineEnd:"4px",textAlign:"center",ref:o,onInput:s,onKeyDown:s,onMouseUp:s})})})}),e.jsx(et,{flex:{base:"0 0 32px",lg:"1"},h:"100%",border:"1px solid",borderColor:b?"token_active_border":"border",boxShadow:b?"0px 0px 6px 0px #0067AD":"",display:"flex",p:"6px",borderRadius:"12px",justifyContent:"center",alignItems:"center",children:e.jsx(Bt,{label:e.jsx(E,{fontSize:"12px",lineHeight:"20px",children:"Percentage Min: -99.99%"}),isOpen:h,placement:"top",children:e.jsx(ft,{value:p,precision:2,variant:"unstyled",format:_=>_?Pe(_)+" %":"",clampValueOnBlur:!0,onFocus:()=>{j("max")},onChange:(_,f)=>l(ve(_),f),onBlur:_=>a(ve(_.target.value)),color:b?"text_caption":"text_paragraph",w:"100%",children:e.jsx(kt,{fontSize:"14px",color:"text_caption",paddingInlineStart:"4px",paddingInlineEnd:"4px",textAlign:"center",ref:x,onInput:v,onKeyDown:v,onMouseUp:v})})})})]}),e.jsx(gt,{tabList:gr,currentTab:y,handleChangeTab:c,type:"outlineTab",wrapStyle:{flex:{base:"0 0 32px",lg:"0 0 160px"},h:"32px",gap:0,p:"3px",borderRadius:"12px"},itemStyle:{flex:1,borderRadius:"8px"}})]})}function Es({direct:i,currentLiquidityBins:r,currentLiquidityBinsLoading:n,activeId:t,maxBinRangeData:o,handleRangeChange:d,isReverse:u,otherPosBinObj:s,maxBinLoading:b=!1,tokenAPrice:p,tokenBPrice:x,strategy:l,chartBinsData:a}){var g;const{minPriceData:y,maxPriceData:c}=ye(),{windowWidth:j}=He(),h=S.useMemo(()=>j<810?j-60:652,[j]);return e.jsxs(K,{position:"relative",w:"100%",h:"288px",gap:"8px",children:[e.jsx(Xs,{data:r,activeBin:Number(t),width:h,height:162,direct:i,isReverse:u,type:"simulation",onChangeRange:d,isShowSlider:!b||((g=o==null?void 0:o.list)==null?void 0:g.length)>0,tokenAPrice:p,tokenBPrice:x,strategy:l,chartBinsData:a,dataLoading:n}),e.jsx(sn,{activeBin:Number(t),data:o,width:h,height:76,type:"liquidity",onChangeRange:d,minBinId:y==null?void 0:y.binId,maxBinId:c==null?void 0:c.binId,currentLiquidityBins:r,otherPosBinObj:s,isReverse:u,maxBinLoading:b})]})}function ui({perText:i,direct:r,minPriceData:n,maxPriceData:t,rangeTabList:o,currentRangeTab:d,onReverseClick:u,preCalcLoading:s}){var re,P,H,Y;const{currentPrice:b,dlmmApiPoolInfo:p,dlmmContractPoolInfo:x,isAutoFill:l,strategy:a,reverseCurrentPrice:y}=le(),{numBins:c,positionCount:j,fromToken:h,binIdRange:g,setNumBins:v,setMaxPriceData:B,setMinPriceData:k,fromAmount:L,toAmount:_}=ye(),{getDlmmContractPoolInfo:f}=ti(),{handleInitPriceRange:W}=ci(),{currentLiquidityBins:w,activeId:N,maxBinRangeData:R,handleRangeChange:q,otherPosBinObj:m,maxBinLoading:Q,tokenAPrice:V,tokenBPrice:J,calcChartBinsData:X}=lr(r),{poolId:I}=$e(),{formatMinMaxBinId:ne}=As(l,h,p==null?void 0:p.tokenA,L,_),{formatMinMaxPriceData:_e}=rs(p==null?void 0:p.tokenA,p==null?void 0:p.tokenB,x==null?void 0:x.binStep),ue=async()=>{var M,O,se;const $=await f(I);if($&&qe($)&&p&&(p!=null&&p.tokenA)&&(p!=null&&p.tokenB)){const z=(se=Be)==null?void 0:se.getPriceFromBinId($==null?void 0:$.active_id,$==null?void 0:$.bin_step,(M=p==null?void 0:p.tokenA)==null?void 0:M.decimals,(O=p==null?void 0:p.tokenB)==null?void 0:O.decimals);W($,z,!0)}},T=()=>{if(p!=null&&p.tokenA&&(p!=null&&p.tokenB)&&N!==void 0){const $=g.maxBinId-g.minBinId+1;if(c===""&&(t!=null&&t.binId)&&(n!=null&&n.binId)){v(Math.abs((t==null?void 0:t.binId)-(n==null?void 0:n.binId))+1);return}let M=Number(c);M>$&&(M=$);const O=ne(Number(M),N);if(O){const{minBinId:se,maxBinId:z}=O;let A=Math.min(Math.max(se,g==null?void 0:g.minBinId),g==null?void 0:g.maxBinId),Z=Math.min(Math.max(z,g==null?void 0:g.minBinId),g==null?void 0:g.maxBinId);Z===(g==null?void 0:g.maxBinId)&&A<N&&Z-A<M&&(A=Z-M+1),A===(g==null?void 0:g.minBinId)&&Z>N&&Z-A<M&&(Z=A+M-1);const de=_e(A,Z);if(de){const{minPriceData:ge,maxPriceData:ie}=de;k(ge),B(ie)}}}},G=$=>{if(console.log($,/^[1-9][0-9]*$/.test($),$==="","handleNumBinsChange"),$==="--"){v($);return}if(/^[1-9][0-9]*$/.test($)||$===""){v($);return}},{priceImpactBasedOnMarket:C}=Fn(r?p==null?void 0:p.tokenA:p==null?void 0:p.tokenB,r?p==null?void 0:p.tokenB:p==null?void 0:p.tokenA,"1",r?b:b?F(1).div(b).toString():void 0,!0),D=S.useMemo(()=>{if(C&&F(C).abs().gte(30))return F(C).gte(30)?`+${F(C).toFixed(0)}%`:`${F(C).toFixed(0)}%`},[C]),{isApp:oe}=He();return e.jsxs(Wi,{title:oe?e.jsx(E,{lineHeight:"20px",fontSize:"16px",fontWeight:"500",color:"text_caption",children:"Set Price Range"}):e.jsxs(U,{h:"20px",gap:"16px",children:[e.jsx(E,{lineHeight:"20px",fontSize:"16px",fontWeight:"500",color:"text_caption",children:"Set Price Range"}),e.jsxs(U,{as:"button",gap:"2px",_hover:{p:{color:"text_caption"},svg:{fill:"text_caption"}},cursor:"pointer",onClick:ue,children:[e.jsx(Fe,{xlinkHref:"#icon-reset",fontSize:"14px"}),e.jsx(E,{fontSize:"12px",children:"Reset"})]})]}),wrapStyle:{w:"100%",gap:"20px",className:"dlmm-tutorial-step-5",p:{base:"0px",lg:"10px 16px 16px"}},children:[oe?e.jsxs(U,{as:"button",gap:"2px",_hover:{p:{color:"text_caption"},svg:{fill:"text_caption"}},cursor:"pointer",onClick:ue,children:[e.jsx(Fe,{xlinkHref:"#icon-reset",fontSize:"14px"}),e.jsx(E,{fontSize:"12px",children:"Reset"})]}):e.jsx(U,{children:!o||!o.length?e.jsx(Wt,{h:"32px",borderRadius:"8px",w:"180px"}):e.jsxs(U,{gap:"20px",children:[e.jsxs(U,{gap:"12px",children:[e.jsx(me,{symbol:ae(((re=p==null?void 0:p.displayTokenA)==null?void 0:re.symbol)||"",8),color:"dlmm_blue"}),e.jsx(me,{symbol:ae(((P=p==null?void 0:p.displayTokenB)==null?void 0:P.symbol)||"",8),color:"dlmm_green"})]}),e.jsx(gt,{type:"outlineTab",tabList:o,currentTab:d,handleChangeTab:$=>u($),wrapStyle:{h:"32px",p:"3px",border:"1px solid",borderColor:"border",borderRadius:"8px",gap:"4px",zIndex:"99"},itemStyle:{h:"24px",p:"4px 12px",borderRadius:"4px",gap:"4px"}})]})}),oe?e.jsxs(K,{w:"100%",gap:"16px",children:[e.jsx(gt,{type:"outlineTab",tabList:o,currentTab:d,handleChangeTab:$=>u($),wrapStyle:{w:"100%",h:"32px",p:"3px",border:"1px solid",borderColor:"border",borderRadius:"8px",gap:"4px",zIndex:"99"},itemStyle:{flex:1,h:"24px",p:"4px 12px",borderRadius:"4px",gap:"4px"}}),e.jsxs(K,{w:"100%",align:"flex-start",children:[e.jsxs(U,{gap:"12px",children:[e.jsx(me,{symbol:ae(((H=p==null?void 0:p.displayTokenA)==null?void 0:H.symbol)||"",8),color:"dlmm_blue"}),e.jsx(me,{symbol:ae(((Y=p==null?void 0:p.displayTokenB)==null?void 0:Y.symbol)||"",8),color:"dlmm_green"})]}),e.jsx(Ot,{price:b?ze(r?b:Ls(b)):void 0,perText:i,showIcon:!1}),e.jsx(Es,{direct:r,currentLiquidityBins:w,currentLiquidityBinsLoading:s,activeId:N,maxBinRangeData:R,otherPosBinObj:m,handleRangeChange:q,isReverse:(p==null?void 0:p.isReverse)||!1,maxBinLoading:Q,tokenAPrice:V,tokenBPrice:J,strategy:a,chartBinsData:X})]}),e.jsx(K,{w:"100%",gap:"8px",children:e.jsxs(Hs,{direct:r,children:[e.jsx(Ns,{perText:i,direct:r,lowerPrice:r?n:t,upperPrice:r?t:n,wrapStyle:{gap:"8px"}}),e.jsx(Ws,{isLoading:!1,numBins:c,positionCount:j,onNumBinsBlur:T,onNumBinsChange:G})]})}),e.jsx(Ht,{orientation:"horizontal"}),e.jsx(_s,{activeId:N,direct:r,currentLiquidityBins:w,maxBinRangeData:R}),e.jsxs(K,{w:"100%",gap:"16px",children:[n&&t&&F(n==null?void 0:n.binId).gt(t==null?void 0:t.binId)&&e.jsx(Xe,{p:"8px",w:"100%",bg:"primary_red_opacity.10",borderRadius:"8px",mb:"16px",children:e.jsx(E,{color:"primary_red",fontSize:"12px",h:"16px",fontWeight:"400",children:"The Max price should be higher than or equal to the Min price"})}),F(c).gt(Ve)&&e.jsx(Xe,{p:"8px",w:"100%",bg:"primary_yellow_opacity.10",borderRadius:"8px",mb:"16px",children:e.jsxs(E,{color:"primary_yellow",fontSize:"12px",lineHeight:"16px",fontWeight:"400",children:["You have reached the maximum limit of ",Pe(Ve)," bins. Please adjust your price range to reduce the number of bins."]})}),e.jsxs(K,{w:"100%",mb:"16px",children:[e.jsx(E,{color:"primary_gray",fontSize:"12px",lineHeight:"20px",children:"The current price of a pool doesn't always reflect the fair market price. Please be cautious to set your price range and allocate liquidity properly."}),D&&e.jsx(Ut,{tips:`The current pool price deviates largely from the real-time market price (${D}). Please be careful with your price range setting to avoid large impermanent loss.`,borderRadius:"12px",p:"8px",w:"100%",tipsFontSize:"12px"})]})]})]}):e.jsxs(K,{w:"100%",gap:"0px",children:[e.jsxs(K,{w:"100%",gap:"12px",children:[e.jsx(U,{w:"100%",justify:"center",children:e.jsx(Ot,{price:b?ze(r?b:Ls(b)):void 0,perText:i,showIcon:!1})}),e.jsx(Es,{direct:r,currentLiquidityBins:w,currentLiquidityBinsLoading:s,activeId:N,maxBinRangeData:R,otherPosBinObj:m,handleRangeChange:q,isReverse:(p==null?void 0:p.isReverse)||!1,maxBinLoading:Q,tokenAPrice:V,tokenBPrice:J,strategy:a,chartBinsData:X})]}),e.jsxs(K,{w:"100%",gap:"16px",children:[e.jsxs(K,{w:"100%",gap:"4px",children:[e.jsxs(U,{w:"100%",h:"fit-content",children:[e.jsx(Ns,{perText:i,direct:r,lowerPrice:r?n:t,upperPrice:r?t:n,wrapStyle:{gap:"8px"}}),e.jsx(Ws,{isLoading:!1,numBins:c,positionCount:j,onNumBinsBlur:T,onNumBinsChange:G})]}),e.jsx(Hs,{direct:r})]}),n&&t&&F(n==null?void 0:n.binId).gt(t==null?void 0:t.binId)&&e.jsx(Xe,{p:"8px",w:"100%",bg:"primary_red_opacity.10",borderRadius:"8px",children:e.jsx(E,{color:"primary_red",fontSize:"12px",h:"16px",fontWeight:"400",children:"The Max price should be higher than or equal to the Min price"})}),F(c).gt(Ve)&&e.jsx(Xe,{p:"8px",w:"100%",bg:"primary_yellow_opacity.10",borderRadius:"8px",children:e.jsxs(E,{color:"primary_yellow",fontSize:"12px",lineHeight:"16px",fontWeight:"400",children:["You have reached the maximum limit of ",Pe(Ve)," bins. Please adjust your price range to reduce the number of bins."]})}),e.jsxs(K,{w:"100%",children:[e.jsx(E,{color:"primary_gray",fontSize:"12px",lineHeight:"20px",children:"The current price of a pool doesn't always reflect the fair market price. Please be cautious to set your price range and allocate liquidity properly."}),D&&e.jsx(Ut,{tips:`The current pool price deviates largely from the real-time market price (${D}). Please be careful with your price range setting to avoid large impermanent loss.`,borderRadius:"12px",p:"8px",w:"100%",tipsFontSize:"12px"})]}),e.jsx(Ht,{w:"100%",orientation:"horizontal"}),e.jsx(_s,{activeId:N,direct:r,currentLiquidityBins:w,maxBinRangeData:R})]})]})]})}function br({btnText:i,btnDisabled:r,onReverseClick:n,direct:t,perText:o,rangeTabList:d,currentRangeTab:u,handleAmountChange:s,fromAmountValue:b,toAmountValue:p,fromBalanceInfo:x,toBalanceInfo:l,handleAdd:a,submitLoading:y,isReverse:c}){const{dlmmApiPoolInfo:j}=le(),{fromToken:h,toToken:g,fromAmount:v,toAmount:B,byAmountIn:k,totalAmount:L,fromTokenLock:_,toTokenLock:f,minPriceData:W,maxPriceData:w,positionCount:N,numBins:R,fromLoading:q,toLoading:m,preCalcError:Q}=ye(),{getTokenAmountValue:V}=tt();return e.jsxs(K,{w:"100%",children:[e.jsxs(K,{w:"100%",borderRadius:"12px",border:"1px solid",borderColor:"border",bg:"card_bg",p:"12px",gap:"16px",children:[e.jsxs(U,{w:"100%",h:"32px",justify:"space-between",children:[e.jsx(E,{lineHeight:"20px",fontSize:"16px",fontWeight:"500",color:"text_caption",children:"Deposit Amounts"}),e.jsxs(U,{children:[e.jsx(et,{p:"4px 4px 4px 8px",borderRadius:"8px",children:e.jsx(ai,{disabled:_||f})}),e.jsx(qs,{slippageType:"liquidity",poolType:"dlmm"})]})]}),e.jsx(we,{w:"100%",position:"relative",children:e.jsx(ei,{onClick:n,from:{wrapStyle:{h:"108px"},balance:(x==null?void 0:x.balanceFormat)||"",value:v,amountValue:V(h==null?void 0:h.coin_type,v),loading:!1,onChange:J=>{s(J,!0,(h==null?void 0:h.coin_type)===(j==null?void 0:j.coin_type_a))},selectable:!1,placeholder:"0.0",token:h,remainBalanceAmount:.5,onFocusChange:J=>{J&&+(v+"")&&!k&&s(v+"",!0,(h==null?void 0:h.coin_type)===(j==null?void 0:j.coin_type_b))},lock:{isLock:_&&!f,text:"The current price is outside your specified price range. Single-asset deposit only."},balancePosition:"bottom",rightJustify:"space-around"},to:{wrapStyle:{h:"108px"},balance:(l==null?void 0:l.balanceFormat)||"",value:B,amountValue:V(g==null?void 0:g.coin_type,B),loading:!1,remainBalanceAmount:.5,onFocusChange:J=>{J&&+(B+"")&&k&&s(B+"",!1,(g==null?void 0:g.coin_type)===(j==null?void 0:j.coin_type_a))},onChange:J=>{s(J,!1,(g==null?void 0:g.coin_type)===(j==null?void 0:j.coin_type_b))},selectable:!1,placeholder:"0.0",token:g,lock:{isLock:!_&&f,text:"The current price is outside your specified price range. Single-asset deposit only."},balancePosition:"bottom",rightJustify:"space-around"},iconParams:{xlinkHref:"#icon-icon_add",svgFill:"text_caption"},lock:{isLock:_&&f,style:{h:"224px"}}})}),e.jsx(cs,{totalAmount:L,loading:!1,valueStyle:{h:"20px",lineHeight:"20px"}})]}),e.jsxs(K,{w:"100%",borderRadius:"12px",border:"1px solid",borderColor:"border",bg:"card_bg",p:"16px 12px 12px",gap:"16px",align:"flex-start",children:[e.jsx(E,{lineHeight:"20px",fontSize:"16px",fontWeight:"500",color:"text_caption",children:"Select Strategy"}),e.jsx(Js,{})]}),e.jsxs(K,{w:"100%",borderRadius:"12px",border:"1px solid",borderColor:"border",bg:"card_bg",p:"12px",gap:"0px",children:[e.jsx(ui,{perText:o,direct:t!==c,minPriceData:W,maxPriceData:w,rangeTabList:d,currentRangeTab:u,onReverseClick:n}),e.jsx(K,{w:"100%",gap:"8px",className:"dlmm-tutorial-step-6",children:!!(j!=null&&j.id)&&!(_&&f)&&e.jsxs(K,{gap:"12px",w:"100%",borderRadius:"16px",children:[Q&&e.jsx(Ut,{tipsFontSize:"12px",tipsLineHeight:"12px",tips:"Amount too small to allocate across bins. Please increase the amount.",type:"warning"}),e.jsx(We,{w:"100%",h:"52px",margin:"-1px -1px 5px",fontSize:"18px",fontWeight:"500",borderRadius:"12px",isDisabled:r,isLoading:y,onClick:a,children:i})]})})]})]})}function yr({btnText:i,btnDisabled:r,onReverseClick:n,direct:t,perText:o,rangeTabList:d,currentRangeTab:u,handleAmountChange:s,fromAmountValue:b,toAmountValue:p,fromBalanceInfo:x,toBalanceInfo:l,handleAdd:a,submitLoading:y,isReverse:c,preCalcLoading:j}){const{dlmmApiPoolInfo:h}=le(),{fromToken:g,toToken:v,fromAmount:B,toAmount:k,byAmountIn:L,totalAmount:_,fromTokenLock:f,toTokenLock:W,minPriceData:w,maxPriceData:N,positionCount:R,numBins:q,fromLoading:m,toLoading:Q,preCalcError:V}=ye(),{getTokenAmountValue:J}=tt();return e.jsx(e.Fragment,{children:e.jsxs(U,{gap:"16px",align:"flex-start",children:[e.jsx(K,{flex:"1",minW:"588px",children:e.jsx(ui,{perText:o,direct:t!==c,minPriceData:w,maxPriceData:N,rangeTabList:d,currentRangeTab:u,onReverseClick:n,preCalcLoading:j})}),e.jsxs(K,{gap:"8px",minW:"420px",maxW:"460px",w:"460px",p:"18px 8px 16px",bg:"card_bg",borderRadius:"16px",align:"flex-start",children:[e.jsxs(K,{className:"dlmm-tutorial-step-4",align:"flex-start",gap:"16px",p:"0 8px",w:"100%",children:[e.jsx(E,{lineHeight:"20px",fontSize:"16px",fontWeight:"500",color:"text_caption",children:"Select Strategy"}),e.jsx(Js,{})]}),e.jsxs(K,{w:"100%",children:[e.jsxs(K,{gap:"12px",w:"100%",className:"dlmm-tutorial-step-3",p:"0 8px 2px",children:[e.jsxs(U,{w:"100%",h:"32px",justify:"space-between",children:[e.jsx(E,{lineHeight:"20px",fontSize:"16px",fontWeight:"500",color:"text_caption",children:"Deposit Amounts"}),e.jsx(U,{children:e.jsx(ai,{disabled:f||W})})]}),e.jsx(we,{w:"100%",position:"relative",children:e.jsx(ei,{onClick:()=>{n(d.find(X=>X.key!==u))},from:{wrapStyle:{h:"108px"},balance:(x==null?void 0:x.balanceFormat)||"",value:B,amountValue:J(g==null?void 0:g.coin_type,B),loading:!1,onChange:X=>{s(X,!0,(g==null?void 0:g.coin_type)===(h==null?void 0:h.coin_type_a))},selectable:!1,placeholder:"0.0",token:g,remainBalanceAmount:.5,onFocusChange:X=>{X&&+(B+"")&&!L&&s(B+"",!0,(g==null?void 0:g.coin_type)===(h==null?void 0:h.coin_type_b))},lock:{isLock:f&&!W,text:"The current price is outside your specified price range. Single-asset deposit only."},balancePosition:"bottom",rightJustify:"space-around"},to:{wrapStyle:{h:"108px"},balance:(l==null?void 0:l.balanceFormat)||"",value:k,amountValue:J(v==null?void 0:v.coin_type,k),loading:!1,remainBalanceAmount:.5,onFocusChange:X=>{X&&+(k+"")&&L&&s(k+"",!1,(v==null?void 0:v.coin_type)===(h==null?void 0:h.coin_type_a))},onChange:X=>{s(X,!1,(v==null?void 0:v.coin_type)===(h==null?void 0:h.coin_type_b))},selectable:!1,placeholder:"0.0",token:v,lock:{isLock:!f&&W,text:"The current price is outside your specified price range. Single-asset deposit only."},balancePosition:"bottom",rightJustify:"space-around"},iconParams:{xlinkHref:"#icon-icon_add",svgFill:"text_caption"},lock:{isLock:f&&W,style:{h:"224px"}}})})]}),e.jsx(K,{w:"100%",gap:"8px",className:"dlmm-tutorial-step-6",p:"2px 8px 0px",children:!!(h!=null&&h.id)&&!(f&&W)&&e.jsxs(K,{gap:"12px",w:"100%",borderRadius:"16px",children:[V&&e.jsx(Ut,{tipsFontSize:"12px",tipsLineHeight:"12px",tips:"Amount too small to allocate across bins. Please increase the amount.",type:"warning"}),e.jsx(We,{w:"100%",h:"52px",margin:"-1px -1px 5px",fontSize:"18px",fontWeight:"500",borderRadius:"12px",isDisabled:r,isLoading:y||j,onClick:a,children:i}),g&&v&&e.jsx(e.Fragment,{children:e.jsx(cs,{totalAmount:_,loading:j,valueStyle:{h:"20px",lineHeight:"20px"}})})]})})]}),e.jsx(e.Fragment,{})]})]})})}function jr({rangeTabList:i,binStep:r,baseFeeDisplay:n,getList:t,getPrice:o}){const{dlmmApiPoolInfo:d,dlmmContractPoolInfo:u}=le(),{fromToken:s,toToken:b,setFromToken:p,setToToken:x,fromLoading:l,toLoading:a,preCalcError:y}=ye(),{zapAmount:c,currentZapToken:j}=Rn(),{direct:h,perText:g,debouncedOnReverseClick:v,currentRangeTab:B}=pr({rangeTabList:i}),{handleAmountChange:k,fromAmountValue:L,toAmountValue:_,fromBalanceInfo:f,toBalanceInfo:W,handleAdd:w,confirmModalOpen:N,setConfirmModalOpen:R,nftOpen:q,setNftOpen:m,relatedPosId:Q,handleSubmit:V,submitLoading:J,positionCount:X,isReverse:I,preCalcLoading:ne}=ar(t,h),{btnText:_e,btnDisabled:ue}=ur(),{isApp:T}=He(),G={btnText:_e,btnDisabled:ue,onReverseClick:v,direct:h,perText:g,rangeTabList:i,currentRangeTab:B,fromBalanceInfo:f,toBalanceInfo:W,fromAmountValue:L,toAmountValue:_,handleAmountChange:k,handleAdd:w,handleSubmit:V,submitLoading:J,preCalcLoading:ne,isReverse:I};return e.jsxs(e.Fragment,{children:[T?e.jsx(br,{...G}):e.jsx(yr,{...G}),N&&e.jsx(cr,{onClose:()=>R(!1),data:{baseFeeDisplay:n},onSubmit:V,isReverse:I,isDirect:h}),q&&Q&&(d==null?void 0:d.poolId)&&e.jsx(xr,{onClose:()=>m(!1),tokenA:d.displayTokenA,tokenB:d.displayTokenB,poolId:d==null?void 0:d.poolId,posId:Q,fee:d==null?void 0:d.feeDisplay,binStep:u==null?void 0:u.binStep,isReverse:I,direct:h,positionCount:X})]})}function pi(){const{dlmmPosBaseListLoading:i,dlmmPosBaseListGroupByPool:r}=as(),{manualRefresh:n}=le(),{currentAccount:t,onWalletModal:o}=St(),{getPositionBaseList:d}=Mn(),[u,s]=S.useState(""),{poolId:b}=$e(),p=async(l,a)=>{try{const y=await d(l,{clmmPool:a,fetchType:"dlmm"});typeof y=="string"&&s(y)}catch(y){y instanceof Tn&&s(y.message)}};return S.useEffect(()=>{t!=null&&t.address&&b&&p(t==null?void 0:t.address,b)},[t==null?void 0:t.address,b]),S.useEffect(()=>{n&&(t!=null&&t.address)&&b&&p(t==null?void 0:t.address,b)},[n]),Wn({onRpcChange:()=>{t!=null&&t.address&&p(t==null?void 0:t.address,b)}}),{data:S.useMemo(()=>{if(b){const l=r[b.toLowerCase()||""];return l?l==null?void 0:l.list:[]}return[]},[b,JSON.stringify(r)]),rpcNodeErrorStr:u,dlmmPosBaseListLoading:i,currentAccount:t,onWalletModal:o}}function Sr({priceDirect:i}){const r=Gt(),{dlmmApiPoolInfo:n}=le(),{currentAccount:t,data:o,rpcNodeErrorStr:d,onWalletModal:u}=pi();return He(),e.jsx(K,{minW:{base:"100%",lg:"1024px"},children:t!=null&&t.address?o&&(o==null?void 0:o.length)>0?e.jsx(et,{p:{base:"12px",lg:"16px"},borderRadius:"16px",children:e.jsx(Nn,{poolInfo:{list:o},priceDirect:i})}):d?e.jsx(dt,{type:"nodata",text:d}):e.jsx(dt,{type:"nodata",text:"You don't have positions for this pool",children:e.jsx(We,{borderRadius:"8px",mt:"8px",fontWeight:"500",w:"120px",h:"28px",fontSize:"12px",onClick:()=>r(`/dlmm?tab=deposit&poolId=${n==null?void 0:n.poolId}`),children:"Create Position"})}):e.jsx(dt,{type:"nowallet",onboard:()=>u(!0)})})}function _r({apiPoolInfo:i,apiPoolInfoLoading:r,tvlLoading:n,totalTvl:t}){const o=S.useMemo(()=>i!=null&&i.haveFarming||i!=null&&i.miningAprList&&(i==null?void 0:i.miningAprList.length)>0?"help":"text",[i]),{isApp:d}=He();return e.jsxs(Je,{flexDir:{base:"column",lg:"row"},gap:{base:"20px",lg:"28px"},children:[e.jsx(Lt,{label:"Pool APR",value:e.jsx(Hn,{poolInfo:i,placement:d?"bottom-end":"bottom",children:e.jsxs(U,{justify:"flex-end",align:"flex-end",gap:"4px",lineHeight:"14px",h:"14px",children:[e.jsxs(E,{as:"span",fontSize:"14px",color:o=="help"?"primary":"text_caption",fontWeight:"500",cursor:o,pos:"relative",children:[(i==null?void 0:i.feeAndMiningAprDisplay)!==""?i==null?void 0:i.feeAndMiningAprDisplay:"--",o=="help"&&e.jsx(we,{w:"100%",borderBottom:"1px dotted",borderColor:"primary",pos:"absolute",bottom:"-1px"})]}),(i==null?void 0:i.haveFarming)&&e.jsxs(E,{fontSize:"12px",lineHeight:"12px",h:"12px",color:"primary",fontWeight:"500",children:["+",i==null?void 0:i.farmingAprDisplay]})]})})}),e.jsx(Lt,{label:"TVL",value:i!=null&&i.tvl&&(i==null?void 0:i.tvl)!=="--"?`$${ze(i==null?void 0:i.tvl,2)}`:"--",loading:!i||!(i!=null&&i.tvl)}),e.jsx(Lt,{label:"Volume (24H)",value:(i==null?void 0:i.volume24Display)||"--",loading:!i||!(i!=null&&i.volume24Display)}),e.jsx(Lt,{label:"Fees (24H)",value:(i==null?void 0:i.fees24Display)||"--",loading:!i||!(i!=null&&i.fees24Display)})]})}function vr({title:i,subTitle:r,btnText:n,isOpen:t,onClose:o,onConfirm:d}){return e.jsxs(es,{autoFocus:!1,returnFocusOnClose:!1,isOpen:t,onClose:o,isCentered:!0,children:[e.jsx(ts,{}),e.jsxs(ss,{children:[e.jsx(Os,{}),e.jsx(is,{p:"20px 16px",children:e.jsxs(K,{children:[e.jsx(we,{w:"140px",h:"140px",bg:"center / contain no-repeat url('/images/img_pool@2x.png')"}),e.jsx(E,{h:"20px",lineHeight:"20px",fontSize:"14px",color:"text_caption",fontWeight:"500",children:i}),r&&e.jsx(E,{fontSize:"14px",children:r})]})}),e.jsx($s,{p:"0 16px 16px",children:e.jsx(We,{w:"100%",h:"40px",borderRadius:"12px",colorScheme:"blue",fontSize:"16px",fontWeight:"500",onClick:()=>{o(),d()},children:n})})]})]})}var xi=(i=>(i.deposit="Provide Liquidity",i.positions="My Positions",i.analytics="Analytics",i))(xi||{});const Ze=[{label:"Provide Liquidity",key:"deposit"},{label:"My Positions",key:"positions"},{label:"Analytics",key:"analytics"}];function wr(){var oe,re,P;const{tab:i,poolId:r}=$e(),n=Gt(),{dlmmApiPoolInfo:t,setDlmmApiPoolInfo:o,dlmmApiPoolInfoLoading:d,netError:u}=le(),[s,b]=S.useState(),[p,x]=S.useState(Ze),[l,a]=S.useState(((oe=Ze==null?void 0:Ze.find(H=>H.key===i))==null?void 0:oe.key)||Ze[0].key),[y,c]=S.useState(),[j,h]=S.useState(),{dlmmPosBaseListGroupByPool:g}=as(),{addFavorites:v,removeFavorites:B}=On(),{dlmmPoolFavoriteIds:k}=$n(),{fromToken:L,toToken:_}=ye(),{fetchTokenPrices:f}=tt(),{currentAccount:W}=St(),{setFromCoin:w,setToCoin:N}=qn(),{setIsOpen:R}=Un(),{setPoolType:q,setCurrentStep:m}=Cn(),{isSwapWidgetDisplay:Q}=Ji(),V=()=>{Q?R(!0):n(`/swap/${t==null?void 0:t.coin_type_a}/${t==null?void 0:t.coin_type_b}`)},J=()=>{n(`/incentive?poolAddress=${t==null?void 0:t.poolAddress}`)};S.useEffect(()=>(L&&_&&(w(L),N(_)),()=>{w(At.clmm_swap.from_coin),N(At.clmm_swap.to_coin)}),[L,_]);const X=S.useMemo(()=>{if(r&&r!=="undefined"){const H=g[r.toLowerCase()||""];return H&&(H!=null&&H.list)&&(H==null?void 0:H.list.length)>0?H==null?void 0:H.list.length:void 0}},[JSON.stringify(g),r]);S.useEffect(()=>{x(Ze==null?void 0:Ze.map(H=>({...H,num:H.label==="My Positions"&&(W!=null&&W.address)?X:void 0})))},[X,W==null?void 0:W.address]),S.useLayoutEffect(()=>{i&&i!==l&&a(i)},[i]);const I=S.useMemo(()=>k==null?void 0:k.includes(r||""),[JSON.stringify(k),r]),ne=H=>{Ys(H),r&&(I?B(r):v(r))},_e=S.useMemo(()=>I?{tooltip:"Remove from Watchlist",xlinkHref:"#icon-icon_star_sel",svgFill:"primary_blue",svgHover:"primary"}:{tooltip:"Add to Watchlist",xlinkHref:"#icon-icon_star",svgFill:"text_paragraph",svgHover:"text_caption"},[I]);S.useEffect(()=>{var H,Y,$,M,O,se;t!=null&&t.displayTokenA&&(t!=null&&t.displayTokenB)&&(console.log("dlmmApiPoolInfo?.displayTokenA: ",t),((H=t==null?void 0:t.displayTokenA)==null?void 0:H.coin_type)!=="undefined"&&c(t==null?void 0:t.displayTokenA),((Y=t==null?void 0:t.displayTokenB)==null?void 0:Y.coin_type)!=="undefined"&&h(t==null?void 0:t.displayTokenB)),($=t==null?void 0:t.displayTokenA)!=null&&$.coin_type&&((M=t==null?void 0:t.displayTokenB)!=null&&M.coin_type)&&G([(O=t==null?void 0:t.displayTokenA)==null?void 0:O.coin_type,(se=t==null?void 0:t.displayTokenB)==null?void 0:se.coin_type]).then(z=>{var A,Z;console.log("dlmmApiPoolInfo?.displayTokenA res: ",z),z&&(z==null?void 0:z.size)>0&&(c(z==null?void 0:z.get((A=t==null?void 0:t.displayTokenA)==null?void 0:A.coin_type)),h(z==null?void 0:z.get((Z=t==null?void 0:t.displayTokenB)==null?void 0:Z.coin_type)))})},[(re=t==null?void 0:t.displayTokenA)==null?void 0:re.coin_type,(P=t==null?void 0:t.displayTokenB)==null?void 0:P.coin_type]);const ue=()=>{var H,Y;m(2),q("dlmm"),n(`/create-pool/${(H=t==null?void 0:t.displayTokenA)==null?void 0:H.coin_type}/${(Y=t==null?void 0:t.displayTokenB)==null?void 0:Y.coin_type}/${s==null?void 0:s.binStep}?baseFactor=${s==null?void 0:s.baseFactor}`)},T=()=>{const H=[];L&&H.push(L.coin_type),_&&H.push(_.coin_type),H.length>0&&f(Array.from(new Set(H.filter(Y=>Y&&Y!=="undefined"))))};S.useEffect(()=>{T()},[L==null?void 0:L.coin_type,_==null?void 0:_.coin_type]);const{fetchTokenInfo:G}=ns(),C=S.useCallback(async(H,Y,$,M,O,se)=>{var de,ge,ie,he,be;const z=Object.keys(xi).find(xe=>xe===l),A=[M,O].filter(Boolean),Z=await G(A);if($!=null&&$.coin_type||(de=Z==null?void 0:Z.get(O||""))!=null&&de.coin_type)if(Ft(H==null?void 0:H.coin_type).full_address===Ft(($==null?void 0:$.coin_type)||((ge=Z==null?void 0:Z.get(O||""))==null?void 0:ge.coin_type)||"").full_address)c(j),h(y);else{if(Ft(H==null?void 0:H.coin_type).full_address===Ft((Y==null?void 0:Y.coin_type)||((ie=Z==null?void 0:Z.get(M||""))==null?void 0:ie.coin_type)||"").full_address)return;n(se?`/dlmm?tab=${z}&from=${H==null?void 0:H.coin_type}&to=${($==null?void 0:$.coin_type)||((he=Z==null?void 0:Z.get(O||""))==null?void 0:he.coin_type)}`:`/dlmm?tab=${z}&from=${($==null?void 0:$.coin_type)||((be=Z==null?void 0:Z.get(O||""))==null?void 0:be.coin_type)}&to=${H==null?void 0:H.coin_type}`),o(null)}else n(se?`/dlmm?tab=${z}&from=${H==null?void 0:H.coin_type}`:`/dlmm?tab=${z}&to=${H==null?void 0:H.coin_type}`),o(null)},[y,j,l]),D=S.useCallback(async(H,Y)=>{const $=await G(H||"");return{value:Y||(H?$:void 0),isWhiteSelect:!1,whiteTokenList:void 0,disabled:u,tokenStyle:{p:0,border:"none"},tokenSize:"32px",symbolStyle:{fontSize:"20px",fontWeight:"500"},wrapStyle:{h:"32px",border:"none",p:"0",bg:"background"},loading:!Y&&d}},[u,d]);return{currentTab:l,setCurrentTab:a,tabList:p,favoriteStyle:_e,onChangeFavorites:ne,selectedTokenA:y,selectedTokenB:j,setSelectedTokenA:c,setSelectedTokenB:h,onConfirm:ue,refreshMarketPrice:T,onJump2Swap:V,onJumpAddIncentive:J,handleSelectToken:C,getSelectTokenProps:D,baseFee:s,setBaseFee:b}}function Br(){const{currentAccount:i}=St(),{fetchAccountBalance:r}=Ps(),{dlmmApiPoolInfo:n,dlmmContractPoolInfo:t,setActiveBin:o,currentBinStep:d,setCurrentBinStep:u,manualRefresh:s,setCurrentPrice:b,setManualRefresh:p,resetLiquidity:x}=le(),{fromToken:l,toToken:a,setFromToken:y,setToToken:c,resetAddLiquidity:j,setChartRefreshTrigger:h}=ye(),{currentTab:g,setCurrentTab:v,tabList:B,favoriteStyle:k,onChangeFavorites:L,selectedTokenA:_,selectedTokenB:f,setSelectedTokenA:W,setSelectedTokenB:w,onConfirm:N,refreshMarketPrice:R,onJump2Swap:q,onJumpAddIncentive:m,handleSelectToken:Q,getSelectTokenProps:V,baseFee:J,setBaseFee:X}=wr(),I=jt("dlmm"),{poolId:ne}=$e(),{quoteWhiteTokenList:_e}=ms();ns();const{getCurrentPrice:ue,getList:T,baseFeeList:G,currentBaseFee:C,fetchPriceRange:D}=ri(),{getDlmmContractPoolInfo:oe}=ti();S.useEffect(()=>{qe(n)&&qe(t)&&(y(n==null?void 0:n.displayTokenA),c(n==null?void 0:n.displayTokenB),D(n==null?void 0:n.poolId,t.binStep,n.tokenA,n.tokenB))},[n==null?void 0:n.poolId,t==null?void 0:t.binStep]),S.useEffect(()=>{u(t==null?void 0:t.binStep)},[t==null?void 0:t.binStep]);const re=z=>{u(z==null?void 0:z.binStep)},P=async()=>{if(ne&&n&&ne===(n==null?void 0:n.poolAddress)){const z=await oe(ne);z&&ue({...z,dlmmApiPoolInfo:n})}},{startTimer:H,stopTimer:Y}=En({interval:5*1e3,callback:()=>{P()}});S.useEffect(()=>(ne&&ne!=="undefined"&&(n!=null&&n.poolAddress)?H():Y(),()=>Y()),[ne,n==null?void 0:n.poolAddress,H,Y]);const $=()=>{R==null||R(),P==null||P()},M=async z=>{console.log("ðŸš€ ~ handleRefresh ~ handleRefresh000:",z,s),z&&(p(!0),$()),ne&&ne!=="undefined"&&await T({poolId:ne}),i!=null&&i.address&&await r(),h(),O(),setTimeout(()=>{p(!1)},1e3)};S.useEffect(()=>{t&&O()},[t==null?void 0:t.activeId,t==null?void 0:t.id]);const O=async()=>{if(t){const{bin_manager:z}=t,{activeId:A,binStep:Z}=t;I==null||I.Pool.getBinInfo(z.bin_manager_handle,A,Z).then(de=>{o(de)})}},se=S.useMemo(()=>qe(n==null?void 0:n.displayTokenA)&&qe(n==null?void 0:n.displayTokenB)?[n==null?void 0:n.displayTokenA,n==null?void 0:n.displayTokenB].filter(Boolean).map(z=>({label:ae(z==null?void 0:z.symbol,8),key:z==null?void 0:z.coinType,isToken:!0,imgInfo:{src:z==null?void 0:z.logo_url,w:"16px",h:"16px",coinType:z?z==null?void 0:z.coinType:"",showTagWidth:"8px",showTagHeight:"8px"}})):[],[n]);return S.useEffect(()=>(i!=null&&i.address&&r(),()=>{x(),j()}),[]),S.useEffect(()=>{ne&&(n==null?void 0:n.poolId)!==ne&&(j(),x()),ne&&ne===(n==null?void 0:n.poolId)&&P()},[ne,n==null?void 0:n.poolId]),{rangeTabList:se,dlmmApiPoolInfo:n,selectedTokenA:_,selectedTokenB:f,setCurrentBinStep:u,currentBinStep:d,currentTab:g,setCurrentTab:v,tabList:B,favoriteStyle:k,onChangeFavorites:L,setSelectedTokenA:W,setSelectedTokenB:w,onConfirm:N,refreshMarketPrice:R,onJump2Swap:q,onJumpAddIncentive:m,handleSelectToken:Q,getSelectTokenProps:V,quoteWhiteTokenList:_e,onBinStepChange:re,baseFeeList:G,currentBaseFee:C,baseFee:J,setBaseFee:X,handleRefresh:M,handleGetPrice:P}}function fr(){var k,L;const{tokenAAmount:i,setTokenAAmount:r,tokenBAmount:n,setTokenBAmount:t,tokenAAmountUSD:o,setTokenAAmountUSD:d,tokenBAmountUSD:u,setTokenBAmountUSD:s,totalAmountUSD:b,setTotalAmountUSD:p,resetTvlInfo:x,tvlLoading:l,setTvlLoading:a}=ni(),{dlmmApiPoolInfo:y,dlmmContractPoolInfo:c}=le(),{getTokenAmountValue:j,fetchTokenPrices:h,priceLoading:g}=tt(),{poolId:v}=$e(),B=async()=>{var _,f,W,w;a(!0);try{const N=[];(_=y==null?void 0:y.tokenA)!=null&&_.coin_type&&N.push((f=y==null?void 0:y.tokenA)==null?void 0:f.coin_type),(W=y==null?void 0:y.tokenB)!=null&&W.coin_type&&N.push((w=y==null?void 0:y.tokenB)==null?void 0:w.coin_type),N.length>0&&h(N)}catch(N){console.log("ðŸš€ ~ PoolInfo ~ handleRefresh:",N)}finally{a(!1)}};return S.useEffect(()=>{x()},[v]),S.useEffect(()=>()=>{x()},[]),S.useEffect(()=>{B()},[y==null?void 0:y.tvl,(k=y==null?void 0:y.tokenA)==null?void 0:k.coin_type,(L=y==null?void 0:y.tokenB)==null?void 0:L.coin_type]),S.useEffect(()=>{c!=null&&c.balanceA&&r(F(c==null?void 0:c.balanceA).sub((c==null?void 0:c.protocolFeeA)||"0").toString())},[c==null?void 0:c.balanceA,c==null?void 0:c.protocolFeeA,v]),S.useEffect(()=>{c!=null&&c.balanceB&&t(F(c==null?void 0:c.balanceB).sub((c==null?void 0:c.protocolFeeB)||"0").toString())},[c==null?void 0:c.balanceB,c==null?void 0:c.protocolFeeB,v]),S.useEffect(()=>{var _;i&&((_=y==null?void 0:y.tokenA)!=null&&_.decimals)&&!Number.isNaN(Number(y==null?void 0:y.tokenA.decimals))&&d(j(y==null?void 0:y.tokenA.coin_type,Ct(i,y==null?void 0:y.tokenA.decimals)))},[i,g]),S.useEffect(()=>{var _;n&&((_=y==null?void 0:y.tokenB)!=null&&_.decimals)&&!Number.isNaN(Number(y==null?void 0:y.tokenB.decimals))&&s(j(y==null?void 0:y.tokenB.coin_type,Ct(n,y==null?void 0:y.tokenB.decimals)))},[n,g]),S.useEffect(()=>{p((o||u)&&o!=="--"&&u!=="--"?F(o||0).plus(u||0).toString():"--")},[o,u]),{tokenAAmount:i,tokenBAmount:n,tokenAAmountUSD:o,tokenBAmountUSD:u,totalAmountUSD:b,setTotalAmountUSD:p,tvlLoading:l}}function Ra(){const i=Gt(),{poolId:r,from:n,to:t}=$e(),{dlmmApiPoolInfoLoading:o,currentPrice:d,reverseCurrentPrice:u,dlmmContractPoolInfo:s}=le(),{dlmmApiPoolInfo:b,selectedTokenA:p,selectedTokenB:x,currentTab:l,setCurrentTab:a,tabList:y,favoriteStyle:c,onChangeFavorites:j,onConfirm:h,onJump2Swap:g,onJumpAddIncentive:v,handleSelectToken:B,getSelectTokenProps:k,rangeTabList:L,quoteWhiteTokenList:_,baseFeeList:f,currentBaseFee:W,setBaseFee:w,handleRefresh:N,handleGetPrice:R}=Br();pi();const{isApp:q}=He(),m=jt("dlmm"),{isOpen:Q,onOpen:V,onClose:J}=Li(),{setFromAmount:X,setToAmount:I}=ye(),{totalAmountUSD:ne,tvlLoading:_e}=fr(),ue=r&&(b==null?void 0:b.tokenA)&&(b==null?void 0:b.tokenB),{tooltip:T,xlinkHref:G,svgFill:C,svgHover:D}=c,[oe,re]=S.useState({}),[P,H]=S.useState({}),[Y,$]=S.useState(!0),M=S.useCallback(async()=>{try{const z=await k(n,p),A=await k(t,x);re(z),H(A)}catch(z){console.log(z,"fetchSelectTokenProps")}},[n,t,p,x,k]);S.useEffect(()=>{M()},[M]),S.useEffect(()=>{X(""),I("")},[l]);const O=S.useCallback(async z=>{var A;if(z!=null&&z.poolAddress)i(`/dlmm?poolId=${z==null?void 0:z.poolAddress}`);else if(p!=null&&p.coin_type&&(x!=null&&x.coin_type))try{const Z=await((A=m==null?void 0:m.Pool)==null?void 0:A.getPoolAddress(De(p==null?void 0:p.coin_type,!0),De(x==null?void 0:x.coin_type,!0),z==null?void 0:z.binStep,z==null?void 0:z.baseFactor));console.log(Z,De(p==null?void 0:p.coin_type,!0),De(x==null?void 0:x.coin_type,!0),p,x,"onFeeChange"),Z?i(`/dlmm?poolId=${Z}`):(w(z),V())}catch{w(z),V()}else w(z),V()},[p,x]),{backUrl:se}=Qs();return e.jsxs(e.Fragment,{children:[e.jsxs(we,{w:"100%",mt:"20px",children:[e.jsxs(U,{w:"100%",minW:{base:"100%",lg:"1024px"},justify:"space-between",children:[e.jsx(Vn,{text:"Pools",onClick:()=>i(se||"/pools?tab=dlmm_pools")}),ue&&e.jsxs(U,{gap:"8px",children:[e.jsx(Ae,{placement:"top",tooltip:T,fontSize:"12px",children:e.jsx(We,{variant:"outline",w:"32px",h:"32px",lineHeight:"32px",onClick:j,p:"0 6px",borderRadius:"8px",color:"text_paragraph",bg:"background",display:"flex",justifyContent:"center",gap:"4px",sx:{_hover:{color:"text_caption",svg:{fill:D}}},children:e.jsx(Fe,{xlinkHref:G,svgFill:C,svgHover:D,fontSize:"18px"})})}),e.jsx(Ae,{placement:"top",tooltip:"Trade",fontSize:"12px",children:e.jsx(We,{variant:"outline",bg:"background",h:"32px",w:"32px",onClick:g,borderRadius:"8px",p:"0 6px",color:"text_paragraph",display:"flex",justifyContent:"center",gap:"4px",sx:{_hover:{color:"text_caption",svg:{fill:"text_caption"}}},children:e.jsx(Fe,{xlinkHref:"#icon-icon_swap1",fontSize:"16px"})})}),At.show_incentive_page&&e.jsx(Ae,{placement:"top",tooltip:"Add Incentive",fontSize:"12px",children:e.jsx(We,{variant:"outline",bg:"background",h:"32px",w:"32px",onClick:v,borderRadius:"8px",p:"0 6px",color:"text_paragraph",display:"flex",justifyContent:"center",gap:"4px",sx:{_hover:{color:"text_caption",svg:{fill:"text_caption"}}},children:e.jsx(Fe,{xlinkHref:"#icon-icon_rewards",fontSize:"16px"})})}),e.jsx(Ae,{placement:"top",tooltip:"Refresh",fontSize:"12px",children:e.jsx(we,{children:e.jsx(Gn,{handleRefresh:N,isAutoRefresh:!0,refreshInterval:30,innerStyle:{bg:"background"},w:"32px",h:"32px",borderRadius:"8px",bg:"background"},r)})})]})]}),e.jsxs(Je,{flexDir:{base:"column",lg:"row"},w:"100%",minW:{base:"100%",lg:"1024px"},justify:"space-between",mt:"20px",gap:{base:"20px",lg:"8px"},children:[e.jsxs(Je,{flexDir:{base:"column",lg:"row"},gap:{base:"20px",lg:"12px"},align:{base:"flex-start",lg:"center"},children:[e.jsxs(U,{gap:"12px",children:[e.jsx(Ts,{onChange:z=>{B(z,p,x,n,t,!0)},...oe}),e.jsx(Ts,{onChange:z=>{B(z,x,p,t,n,!1)},...P})]}),e.jsx(Qn,{poolType:"dlmm",value:W?{...W,binStep:(s==null?void 0:s.binStep)||jn[W.fee||""]}:void 0,loading:!W,onChange:z=>O(z),options:f})]}),ue&&e.jsx(_r,{apiPoolInfo:b,totalTvl:ne,apiPoolInfoLoading:o,tvlLoading:_e})]}),ue?e.jsxs(e.Fragment,{children:[e.jsxs(Je,{w:"100%",flexDir:{base:"column",lg:"row"},justify:{base:"center",lg:"space-between"},align:{base:"flex-start",lg:"center"},minW:{base:"100%",lg:"1024px"},children:[e.jsx(gt,{type:"borderTab",tabList:y,currentTab:l,handleChangeTab:z=>{const A=Object.keys(vs).find(Z=>vs[Z]===z.label);r&&i(`/dlmm?tab=${A}&poolId=${r}`),a(A)},wrapStyle:{w:{base:"100%",lg:"auto"},justify:{base:"space-between",lg:"flex-start"},p:{base:"0 12px",lg:"0"},bg:{base:"bg_secondary",lg:"transparent"},h:q?"60px":"58px",gap:{base:"8px",lg:"45px"},border:{base:"1px solid",lg:"none"},borderColor:{base:"border",lg:"transparent"},borderRadius:{base:"16px",lg:"unset"},mt:{base:"20px",lg:"12px"}},itemStyle:{fontSize:q?"14px":"16px",fontWeight:"500"}}),e.jsxs(U,{children:[l!=="deposit"&&b&&e.jsxs(Je,{w:q?"100%":"auto",mt:{base:"4px",lg:"12px"},gap:"12px",flexDir:{base:"column",lg:"row"},justify:{base:"center",lg:"space-between"},align:{base:"flex-start",lg:"center"},children:[e.jsx(E,{children:"Current Price"}),e.jsx(Kn,{noCenter:!!q,fromToken:b==null?void 0:b.displayTokenA,toToken:b==null?void 0:b.displayTokenB,fromValue:"1",toValue:ve(b!=null&&b.isReverse?u:d).toString(),color:"text_caption",wrapStyle:q?{w:"100%"}:{},pageDirect:Y,handlePageToggleDirect:()=>$(!Y)})]}),l==="deposit"&&!q&&e.jsx(we,{mt:{base:"4px",lg:"12px"},children:e.jsx(qs,{slippageType:"liquidity",poolType:"dlmm"})})]})]}),e.jsx(we,{h:{base:"12px",lg:"8px"}}),l==="deposit"&&e.jsx(jr,{rangeTabList:L,getList:()=>N(!0),getPrice:R,binStep:s==null?void 0:s.binStep,baseFeeDisplay:b==null?void 0:b.feeDisplay}),l==="positions"&&e.jsx(Sr,{priceDirect:Y}),l==="analytics"&&e.jsx(rr,{priceDirect:Y})]}):e.jsx(we,{mt:"20px",children:!b&&o?e.jsx(Xe,{w:"100%",h:"480px",background:"bg_secondary",borderRadius:"12px",border:"1px solid",borderColor:"border",children:e.jsx(Vt,{})}):e.jsx(dt,{type:"custom",imgUrl:"/images/img_pool@2x.png",h:"480px",children:e.jsx(K,{children:p&&x?xt(p,_)||xt(x,_)?e.jsxs(e.Fragment,{children:[e.jsx(E,{h:"20px",lineHeight:"20px",fontSize:"14px",color:"text_caption",fontWeight:"500",children:"This Pool has not been initialized"}),e.jsx(E,{fontSize:"14px",children:"Do you want to initialize it?"}),e.jsx(We,{mt:"12px",w:"120px",h:"32px",borderRadius:"8px",colorScheme:"blue",fontSize:"14px",fontWeight:"500",onClick:()=>{J(),h()},children:"Initialized Pool"})]}):e.jsx(E,{h:"20px",lineHeight:"20px",fontSize:"14px",color:"text_caption",children:"No Liquidity Data"}):e.jsx(E,{h:"20px",lineHeight:"20px",fontSize:"14px",color:"text_caption",children:"Select the token you want to provide liquidity for."})})})})]}),p&&x&&e.jsx(Yn,{tokensInfo:[p,x],waringModalCancel:z=>{i("/pools?tab=dlmm_pools")}}),e.jsx(vr,{title:"This Pool has not been initialized",subTitle:"Do you want to initialize it?",btnText:"Initialized Pool",isOpen:Q,onClose:J,onConfirm:h})]})}export{Ra as default};
//# sourceMappingURL=Dlmm-Do0v7VT5.js.map
