{"version":3,"file":"useStatistics-Ct37Q2eO.js","sources":["../../src/components/stats/VolChartPageBlock.tsx","../../src/store/stats/index.ts","../../src/hooks/stats/useStatistics.ts"],"sourcesContent":["import { useChartTime } from '@/hooks/common/useChartTime'\nimport useGetHistogramData, { GetHistogramDataParams } from '@/hooks/stats/useGetHistogramData'\nimport { StatisticsSummary } from '@/types/clmm'\nimport { SelectTab } from '@cetus/design'\nimport { symbolDataDisplayProcessing } from '@cetus/utils'\nimport { d } from '@cetusprotocol/common-sdk'\nimport { Box, HStack, Skeleton, Spinner, Text, VStack } from '@chakra-ui/react'\nimport { maxBy } from 'lodash-es'\nimport { useEffect, useState } from 'react'\nimport VolumeChart from '../chart/VolumeChart'\n\nexport default function VolChartPageBlock({\n  statisticsData,\n  pageFrom = 'stats',\n  isRefresh\n}: {\n  statisticsData?: StatisticsSummary\n  pageFrom?: 'stats' | 'pools'\n  isRefresh: boolean\n}) {\n  const chartTypeList = [\n    {\n      label: 'D'\n    },\n    {\n      label: 'W'\n    },\n    {\n      label: 'M'\n    }\n  ]\n  const [titleDate, setTitleDate] = useState('(24H)')\n  const [isLoading, setIsLoading] = useState(true)\n  const [volType, setVolType] = useState<'D' | 'W' | 'M'>('D')\n  // ÂõæË°®Êï∞ÊçÆ\n  const { time, getHoverTime, getCurrentTime } = useChartTime()\n  const { getHistogramData, getDlmmHistogramData } = useGetHistogramData()\n  const [volChartData, setVolChartData] = useState<any[]>([])\n  const [volCurrentData, setVolCurrentData] = useState(statisticsData?.summary?.vol24H)\n  const [currentTime, setCurrentTime] = useState(time)\n\n  const handleGetHistogramVolData = async () => {\n    setIsLoading(true)\n    const params: GetHistogramDataParams = {\n      type: 'vol',\n      date_type: volType == 'D' ? 'day' : volType == 'W' ? 'wek' : 'mon'\n    }\n    // ÈÄâÊã©D ÈªòËÆ§‰∏∫ËøëÊúü‰∏Ä‰∏™Êúà ÈÄâÊã©wÔºåÈªòËÆ§‰∏∫ËøëÊúü1Âπ¥ ÈÄâÊã©M ÂèØÂ±ïÁ§∫Ëøë5Âπ¥ÔºåÊó†Êï∞ÊçÆÂàô‰∏çÂ±ïÁ§∫ÔºåÂΩìÂâçÊó∂ÂàªÂç≥Â±ïÁ§∫ÂéÜÂè≤ÂÖ®ÈÉ®Êï∞ÊçÆ\n    // if (pageFrom !== 'stats') {\n    params['limit'] = volType == 'D' ? 31 : volType == 'W' ? 52 : 60\n    // }\n    const clmm_vol_res = await getHistogramData(params)\n    const dlmm_vol_res = await getDlmmHistogramData(params)\n    const clmmArray = clmm_vol_res.map(item => {\n      return {\n        ...item,\n        clmm: item?.num\n      }\n    })\n    const dlmmArray = dlmm_vol_res.map(item => {\n      return {\n        ...item,\n        dlmm: item?.num\n      }\n    })\n    const maxLongArray = maxBy([clmmArray, dlmmArray], arr => arr.length)\n    const minLongArray = maxLongArray?.some(item => item?.clmm !== undefined) ? dlmmArray : clmmArray\n    const newArray = maxLongArray?.map(item => {\n      const minItem = minLongArray?.find(minItem => minItem.date === item.date) ?? {}\n      return {\n        date: item?.date,\n        xAxis: item?.xAxis,\n        clmm: minItem?.num,\n        dlmm: item?.num,\n        num: d(item?.num || 0)\n          .plus(minItem?.num || 0)\n          .toNumber()\n      }\n    })\n    setVolChartData(newArray)\n    setIsLoading(false)\n  }\n  const handleChangeVol = (data: any) => {\n    if (data) {\n      getHoverTime(data.date, volType)\n      setVolCurrentData(symbolDataDisplayProcessing(data.num, '$'))\n      setTitleDate(volType == 'D' ? '(24H)' : volType == 'W' ? '(7D)' : '(30D)')\n    } else {\n      setTitleDate('(24H)')\n      getCurrentTime()\n      setVolCurrentData(statisticsData?.summary?.vol24H)\n    }\n  }\n  useEffect(() => {\n    if (isRefresh) {\n      handleGetHistogramVolData()\n    }\n  }, [isRefresh])\n  useEffect(() => {\n    getCurrentTime()\n  }, [])\n\n  useEffect(() => {\n    handleGetHistogramVolData()\n  }, [volType])\n\n  useEffect(() => {\n    if (statisticsData) {\n      setVolCurrentData(statisticsData?.summary?.vol24H)\n    }\n  }, [statisticsData])\n\n  useEffect(() => {\n    if (time) {\n      setCurrentTime(time)\n    }\n  }, [time])\n\n  return (\n    <Box\n      w={pageFrom == 'pools' ? '100%' : { base: '100%', lg: '50%' }}\n      mt={{\n        base: '12px',\n        lg: '0'\n      }}\n    >\n      <HStack w=\"100%\" justify=\"space-between\">\n        <VStack align=\"flex-start\" gap=\"8px\">\n          <Text fontWeight=\"500\">Trading Volume {titleDate}</Text>\n          <Skeleton isLoaded={!!volCurrentData} h=\"20px\">\n            <Text fontWeight={pageFrom == 'pools' ? '600' : '500'} fontSize=\"20px\" color=\"text_caption\">\n              {volCurrentData}\n            </Text>\n          </Skeleton>\n          {pageFrom == 'stats' && <Text fontWeight=\"500\">{currentTime}</Text>}\n        </VStack>\n        <SelectTab\n          type=\"outlineTab\"\n          tabList={chartTypeList}\n          currentTab={volType}\n          handleChangeTab={tab => setVolType(tab.label)}\n          wrapStyle={{\n            w: '128px',\n            h: '32px',\n            p: '3px',\n            borderRadius: '8px'\n          }}\n          itemStyle={{\n            flex: '1',\n            fontSize: '14px',\n            margin: '0px'\n          }}\n        />\n      </HStack>\n\n      <Box w=\"100%\" h={pageFrom == 'pools' ? '270px' : '260px'} position=\"relative\" pt={pageFrom == 'pools' ? '12px' : '20px'}>\n        {isLoading && (\n          <Box position=\"absolute\" top=\"38%\" left=\"50%\" transform=\"translate(-50%,-50%)\">\n            <Spinner />\n          </Box>\n        )}\n        <VolumeChart data={volChartData} onChangeValue={handleChangeVol} pageFrom={pageFrom} />\n      </Box>\n    </Box>\n  )\n}\n","import { StatisticsSummary } from '@/types/clmm'\nimport { create, StateCreator } from 'zustand'\n\ninterface statsState {\n  statisticsData?: StatisticsSummary\n  setStatisticsData: (data: StatisticsSummary) => void\n}\n\nconst store: StateCreator<statsState> = (set, get) => ({\n  statisticsData: undefined,\n  setStatisticsData: (data: StatisticsSummary) => {\n    set(() => ({\n      statisticsData: data\n    }))\n  }\n})\n\nconst useStatsStore = create(store)\nexport default useStatsStore\n","import { StatisticsV2Path } from '@/apis/path'\nimport useStatsStore from '@/store/stats'\nimport { useFetch } from '@cetus/hooks'\nimport { addComma, d, symbolDataDisplayProcessing } from '@cetus/utils'\n\nexport default function useStatistics() {\n  const { fetchByApi } = useFetch()\n  const { setStatisticsData } = useStatsStore()\n\n  const getStatistics = async () => {\n    const res = await fetchByApi(StatisticsV2Path, 'GET')\n    console.log('üöÄ ~ file: useStatistics.ts:8 ~ getStatistics ~ res:', res)\n\n    if (res) {\n      const { cLmm: clmmData, dlmm: dlmmData } = res\n      const summary = {\n        totalTvl: symbolDataDisplayProcessing(d(clmmData.totalTvl).plus(dlmmData.totalTvl).toString(), '$'),\n        vol24H: symbolDataDisplayProcessing(d(clmmData.vol24H).plus(dlmmData.vol24H).toString(), '$'),\n        cumulativeVol: symbolDataDisplayProcessing(d(clmmData.cumulativeVol).plus(dlmmData.cumulativeVol).toString(), '$'),\n        cumulativeTx: addComma(\n          d(clmmData.cumulativeTx)\n            .plus(dlmmData.cumulativeTx ?? 0)\n            .toString()\n        ),\n        cumulativeUserAccount: addComma(\n          d(clmmData.cumulativeUserAccount)\n            .plus(dlmmData.cumulativeUserAccount ?? 0)\n            .toString()\n        )\n      }\n\n      const result = {\n        clmm: clmmData,\n        dlmm: dlmmData,\n        summary\n      }\n      console.log('üöÄ ~ file: useStatistics.ts:42 ~ getStatistics ~ result:', result)\n      setStatisticsData(result)\n      return result\n    }\n\n    return undefined\n  }\n\n  return {\n    getStatistics\n  }\n}\n"],"names":["VolChartPageBlock","statisticsData","pageFrom","isRefresh","chartTypeList","titleDate","setTitleDate","useState","isLoading","setIsLoading","volType","setVolType","time","getHoverTime","getCurrentTime","useChartTime","getHistogramData","getDlmmHistogramData","useGetHistogramData","volChartData","setVolChartData","volCurrentData","setVolCurrentData","_a","currentTime","setCurrentTime","handleGetHistogramVolData","params","clmm_vol_res","dlmm_vol_res","clmmArray","item","dlmmArray","maxLongArray","maxBy","arr","minLongArray","newArray","minItem","d","handleChangeVol","data","symbolDataDisplayProcessing","useEffect","jsxs","Box","HStack","VStack","Text","jsx","Skeleton","SelectTab","tab","Spinner","VolumeChart","store","set","get","useStatsStore","create","useStatistics","fetchByApi","useFetch","setStatisticsData","res","StatisticsV2Path","clmmData","dlmmData","summary","addComma","result"],"mappings":"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"}