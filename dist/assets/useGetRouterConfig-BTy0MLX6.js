import{b as uo}from"./_baseClone-BEKueZbq.js";import{r as Q,j as r,V as Xt,H as ct,T as at,B as vt,m as po,P as eo,x as ro,W as no,y as so,A as io,C as xo,M as mo,o as yo,p as wo,$ as $o,q as jo,t as To}from"./vendor-CBmAETR3.js";import{e as lo,aj as So,D as Qt,d as bt,aV as Bt,bR as Gt,I as Co,u as Vt,S as Mt,t as At,bS as bo,av as co,C as Fo,aO as ao,bo as Eo,ah as qt,s as Jt,Z as to,n as vo,ae as Mo,bT as Po}from"./index-Lo8eQgA0.js";import"./cross-J9VCREIf.js";import{H as Io}from"./HighlightText-Dw_TnRsZ.js";import{f as Yo,A as Ut,a as Lo}from"./aggregator-CK22pvE4.js";import{g as Oo}from"./index-D39Sw25C.js";import{u as ko}from"./swap-ClL3XCB_.js";var Ao=1,Ho=4;function ge(o){return uo(o,Ao|Ho)}const oo=878,Ct=176,zt=72,It=22,Wo=8,Et=16,_o=24,Xo=12,No=16,Ro=8,zo=22,it=50,nt=55,Ot=13,$t=5;function Do(o,s,d){const[y,L]=Q.useState({}),[W,U]=Q.useState([]),[O,e]=Q.useState([]),[k,M]=Q.useState(0),{fromCoin:f,toCoin:w}=ko(),[$,K]=Q.useState([]),[P,E]=Q.useState([]);function B(i,g,p,x=3){console.log("🔍 getNodeColumeOptimized 开始"),console.log("🔍 fromCoinType:",g),console.log("🔍 targetCoinType:",p),console.log("🔍 maxDepth:",x);const G=new Set;i.forEach(u=>{G.add(u.from),G.add(u.target)}),console.log("🔍 所有节点:",Array.from(G));const S=[],R=[],b=new Set;i.forEach(u=>{var a;if(u.from===g&&u.target!==p){const c=u.target,F=i.some(m=>m.target===c&&m.from!==g);let T=!1;if(F){const m=new Set((a=i.filter(C=>C.from===c))==null?void 0:a.map(C=>C==null?void 0:C.target));Array.from(m).every(C=>C===p)&&(T=!0)}T||b.add(c)}}),b.forEach(u=>{const a={};i.forEach(c=>{c.from===g&&c.target===u&&(a[g]||(a[g]=[]),a[g].push(c))}),Object.keys(a).forEach(c=>{const F=new Map;a[c].forEach(T=>{const m=T.provider,A=T.feeRate,Y=`${m}_${A}`;if(F.has(Y)){const C=F.get(Y);C.amountIn=bt(C.amountIn).plus(T.amountIn||"0").toString(),C.amountOut=bt(C.amountOut).plus(T.amountOut||"0").toString()}else F.set(Y,{...T,amountIn:T.amountIn||"0",amountOut:T.amountOut||"0"})}),a[c]=Array.from(F.values())}),R.push({target:`0-${u}`,originalTarget:u,list:a})}),R.length>0&&(S.push(R),console.log("🔍 添加第0列，数据数量:",R.length));const H=[],X=new Set;i.forEach(u=>{u.from!==g&&u.from!==p&&X.add(u.from),u.target!==g&&u.target!==p&&X.add(u.target)}),X.forEach(u=>{const a={};i.forEach(c=>{c.target===u&&(c.from===g?b.has(u)||(a[c.from]||(a[c.from]=[]),a[c.from].push(c)):(a[c.from]||(a[c.from]=[]),a[c.from].push(c)))}),Object.keys(a).length>0&&(Object.keys(a).forEach(c=>{const F=new Map;a[c].forEach(T=>{const m=T.provider,A=T.feeRate,Y=`${m}_${A}`;if(F.has(Y)){const C=F.get(Y);C.amountIn=bt(C.amountIn).plus(T.amountIn||"0").toString(),C.amountOut=bt(C.amountOut).plus(T.amountOut||"0").toString()}else F.set(Y,{...T,amountIn:T.amountIn||"0",amountOut:T.amountOut||"0"})}),a[c]=Array.from(F.values())}),H.push({target:`1-${u}`,originalTarget:u,list:a}))}),H.length>0&&(S.push(H),console.log("🔍 添加第1列，数据数量:",H.length));const tt=[],I={};return i.forEach(u=>{u.target===p&&(I[u.from]||(I[u.from]=[]),I[u.from].push(u))}),Object.keys(I).length>0&&(Object.keys(I).forEach(u=>{const a=new Map;I[u].forEach(c=>{const F=c.provider,T=c.feeRate,m=`${F}_${T}`;if(a.has(m)){const A=a.get(m);A.amountIn=bt(A.amountIn).plus(c.amountIn||"0").toString(),A.amountOut=bt(A.amountOut).plus(c.amountOut||"0").toString()}else a.set(m,{...c,amountIn:c.amountIn||"0",amountOut:c.amountOut||"0"})}),I[u]=Array.from(a.values())}),tt.push({target:`2-${p}`,originalTarget:p,list:I})),tt.length>0&&(S.push(tt),console.log("🔍 添加第2列，数据数量:",tt.length)),S}function z(i,g,p){var X,tt,I;const x=i.length,G=x*Ct+(x-1)*zt,S=(oo-G)/2,R=new Map,b=[],H=new Map;if(i.forEach((u,a)=>{u.forEach(c=>{const F=`${a}-${c.target}`,T=ot(c.list);console.log(`node高度, nodeKey=${F}, height=${T}`),H.set(F,T)})}),x===1){console.log("🔍 情况1: 只有1列");const u=i[0];let a=it;u.forEach(c=>{const F=`0-${c.target}`,T=H.get(F)||0;R.set(F,{...c,id:F,top:a,left:S,height:T,width:Ct,columnIndex:0}),console.log(`🔍 放置单列节点 ${c.target}: top=${a}`),a+=T+Et}),b.push(u)}else if(x===2){console.log("🔍 情况2: 只有2列");const u=i[0],a=i[1],c=a.some(A=>A.list&&A.list[g]),F=u.map(A=>{var C;const Y=((C=A.list[g])==null?void 0:C.reduce((n,Ft)=>n+parseFloat(Ft.amountIn||"0"),0))||0;return{block:A,totalAmountIn:Y}}).sort((A,Y)=>Y.totalAmountIn-A.totalAmountIn).map(({block:A})=>A);let T=c?it+It:it;F.forEach(A=>{const Y=`0-${A.target}`,C=H.get(Y)||0;R.set(Y,{...A,id:Y,top:T,left:S,height:C,width:Ct,columnIndex:0}),console.log(`🔍 放置第一列节点 ${A.target}: top=${T}`),T+=C+Et});let m=it;a.forEach(A=>{const Y=`1-${A.target}`,C=H.get(Y)||0;R.set(Y,{...A,id:Y,top:m,left:S+Ct+zt,height:C,width:Ct,columnIndex:1}),console.log(`🔍 放置第二列节点 ${A.target}: top=${m}`),m+=C+Et}),b.push(F,a)}else{console.log("🔍 情况3: 有三列");const u=i[0],a=i[1],c=i[2],F=((X=c[0])==null?void 0:X.originalTarget)||((tt=c[0])==null?void 0:tt.target),T=u.map(h=>{var Wt,_t;const V=h.originalTarget||h.target,Z=`0-${h.target}`,st=H.get(Z)||0,Pt=a.some(mt=>mt.originalTarget==h.originalTarget),Tt=((_t=(Wt=c==null?void 0:c[0])==null?void 0:Wt.list)==null?void 0:_t[h==null?void 0:h.originalTarget])&&!Pt,jt=a.some(mt=>{const yt=mt.originalTarget||mt.target;return p.some(wt=>wt.from===V&&wt.target===yt)}),dt=[];a.forEach(mt=>{const yt=mt.originalTarget||mt.target;p.some(wt=>wt.from===V&&wt.target===yt)&&dt.push(yt)});let St=6;if(Tt&&!jt)St=1;else if(Tt&&jt)St=2;else if(!Tt&&jt)if(dt.length===1){const mt=dt[0],yt=a.find(Yt=>(Yt.originalTarget||Yt.target)===mt);(yt?Object.keys(yt.list||{}).length:0)===1?St=3:St=5}else dt.every(yt=>{const wt=a.find(Lt=>(Lt.originalTarget||Lt.target)===yt);return(wt?Object.keys(wt.list||{}).length:0)===1})?St=4:St=6;return{block:h,target:V,height:st,hasDirectToTarget:Tt,hasConnectionToSecond:jt,secondColTargets:dt,priority:St}});T.sort((h,V)=>{var Pt,Tt;if(h.priority!==V.priority)return h.priority-V.priority;const Z=((Pt=h.block.list[g])==null?void 0:Pt.reduce((jt,dt)=>jt+parseFloat(dt.amountIn||"0"),0))||0;return(((Tt=V.block.list[g])==null?void 0:Tt.reduce((jt,dt)=>jt+parseFloat(dt.amountIn||"0"),0))||0)-Z});const m=c.some(h=>(h.originalTarget||h.target)===F&&h.list&&h.list[g]),A=a.some(h=>h.list&&h.list[g]);let Y=m?it+It:it;if(A){const h=a.find(V=>V.list&&V.list[g]);if(h)if(Object.keys(h.list||{}).length===1){const Z=`1-${h.target}`,st=H.get(Z)||0;Y+=st+Et}else Y+=It}A&&T.length>0&&(T[0].hasDirectToTarget&&Y<=it+It?(console.log("🔍 检测到特殊情况：fromCoinType直接到第二列，且第一列第一个节点直接到第三列"),Y+=50,console.log(`🔍 第一列起始位置调整为: ${Y}`)):Y+=Et);let C=Y;T.forEach((h,V)=>{const Z=`0-${h.block.target}`,st=H.get(Z)||0;R.set(Z,{...h.block,id:Z,top:C,left:S,height:st,width:Ct,columnIndex:0}),console.log(`🔍 放置第一列节点 ${h.target}: top=${C}`),V<T.length-1&&(C+=st+Et)});const n=[],Ft=a.find(h=>h.list&&h.list[g]);Ft&&n.push(Ft),T.forEach(h=>{h.secondColTargets.forEach(V=>{const Z=a.find(st=>(st.originalTarget||st.target)===V);Z&&!n.some(st=>st.target===Z.target)&&n.push(Z)})}),a.forEach(h=>{const V=h.originalTarget||h.target;n.some(Z=>(Z.originalTarget||Z.target)===V)||n.push(h)});let xt=m?it+It:it;T.some(h=>h.hasDirectToTarget&&h.hasConnectionToSecond)&&(xt+=It);const t=(I=T.filter(h=>h.hasDirectToTarget&&!h.hasConnectionToSecond))==null?void 0:I.length;let ut=xt;n.forEach((h,V)=>{const Z=`1-${h.target}`,st=H.get(Z)||0;V===0&&t>0&&(A?ut+=It:ut+=t*120+t*Et),R.set(Z,{...h,id:Z,top:ut,left:S+Ct+zt,height:st,width:Ct,columnIndex:1}),console.log(`🔍 放置第二列节点 ${h.originalTarget||h.target}: top=${ut}  blockHeight=${st}`),ut+=st+Et});let pt=it;c.forEach(h=>{const V=`2-${h.target}`,Z=H.get(V)||0;R.set(V,{...h,id:V,top:pt,left:S+2*Ct+2*zt,height:Z,width:Ct,columnIndex:2}),console.log(`🔍 放置第三列节点 ${h.target}: top=${pt}`),pt+=Z+Et}),b.push(T.map(h=>h.block),n,c)}return{nodesMap:R,orderedNodeColume:b}}function l(i,g,p){console.log("🚀 ~ generateNodePercentages ~ nodeColume:",i);const x={},G=[];if(i.forEach((S,R)=>{S.forEach(b=>{const H=b.originalTarget||b.target;if(b.list&&b.list[p]){const X=b.list[p].reduce((tt,I)=>tt+parseFloat(I.amountIn||"0"),0);G.push({target:H,amountIn:X,colIndex:R})}})}),console.log("🔍 fromCoinType的目标:",G),G.length>0){const S=G.reduce((H,X)=>H+X.amountIn,0),R=[];G.forEach(({amountIn:H})=>{const X=S>0?Bt(bt(H).div(S).mul(100).toString(),0):0;R.push(Number(X)||1)});const b=Gt(R);G.forEach(({target:H},X)=>{var I;const tt=((I=b[X])==null?void 0:I.toString())||"0";x[p]||(x[p]={}),x[p][H]={fromPercent:tt},console.log(`🔍 设置fromCoinType百分比: ${p} -> ${H}: ${tt}%`)})}if(i.length>0){const S=i[0];console.log("🔍 处理第一列节点的百分比"),S.forEach(R=>{const b=R.originalTarget||R.target,H=`0-${b}`;console.log(`🔍 处理第一列节点: ${b}`);const X=[];let tt=!1;if(i.length>1&&(tt=i[1].some(u=>(u.originalTarget||u.target)===b)),tt)i[1].forEach(u=>{const a=u.originalTarget||u.target;if(u.list&&u.list[b]){const c=u.list[b].reduce((F,T)=>F+parseFloat(T.amountIn||"0"),0);X.push({target:a,amountIn:c})}});else for(let I=1;I<i.length;I++)i[I].forEach(a=>{const c=a.originalTarget||a.target;if(a.list&&a.list[b]){const F=a.list[b].reduce((T,m)=>T+parseFloat(m.amountIn||"0"),0);X.push({target:c,amountIn:F})}});if(console.log(`🔍 ${b} 的所有目标:`,X),X.length>0){const I=X.reduce((c,F)=>c+F.amountIn,0),u=[];X.forEach(({amountIn:c})=>{const F=I>0?Bt(bt(c).div(I).mul(100).toString(),0):0;u.push(Number(F)||1)});const a=Gt(u);X.forEach(({target:c},F)=>{const T=a[F];x[H]||(x[H]={}),x[H][c]={fromPercent:T.toString()},console.log(`🔍 设置第一列节点百分比: ${b} -> ${c}: ${T}%`)})}})}if(i.length>2){const S=i[1];console.log("🔍 处理第二列节点的百分比"),S.forEach(R=>{const b=R.originalTarget||R.target,H=`1-${b}`;console.log(`🔍 处理第二列节点: ${b}`);const X=[];if(i[2].forEach(I=>{const u=I.originalTarget||I.target;if(I.list&&I.list[b]){const a=I.list[b].reduce((c,F)=>c+parseFloat(F.amountIn||"0"),0);X.push({target:u,amountIn:a})}}),console.log(`🔍 ${b} 在第三列的目标:`,X),X.length>0){const I=X.reduce((c,F)=>c+F.amountIn,0),u=[];X.forEach(({amountIn:c})=>{const F=I>0?Bt(bt(c).div(I).mul(100).toString(),0):0;u.push(Number(F)||1)});const a=Gt(u);X.forEach(({target:c},F)=>{const T=a[F];x[H]||(x[H]={}),x[H][c]={fromPercent:T.toString()},console.log(`🔍 设置第二列节点百分比: ${b} -> ${c}: ${T}%`)})}})}return x}function D(i,g,p){for(const[x,G]of p.entries())if(x.startsWith(`${i}-`)&&(G.originalTarget===g||G.target===g))return G;return null}function q(i,g,p,x,G){var I,u,a,c,F,T;const S=[];console.log("🔍 开始生成连接线"),console.log("🔍 处理fromCoinType出发的线");const R=((u=(I=x[x.length-1])==null?void 0:I[0])==null?void 0:u.originalTarget)||((c=(a=x[x.length-1])==null?void 0:a[0])==null?void 0:c.target);if(R){const m=D(x.length-1,R,g);if(m){const A=((T=(F=i[p])==null?void 0:F[R])==null?void 0:T.fromPercent)||"0";x.length>0&&x[x.length-1].some(C=>(C.originalTarget||C.target)===R&&C.list&&C.list[p])?x.length===1&&x[0].length===1?(S.push({from:p,to:m.id,fromX:Ot,fromY:m.top+m.height/2,toX:m.left-$t,toY:m.top+m.height/2,fromPercent:A,isStart:!0}),console.log(`🔍 添加fromCoinType到targetCoinType的线（单列）: ${A}%`)):(S.push({from:p,to:m.id,fromX:Ot,fromY:it+10,toX:m.left-$t,toY:it+10,fromPercent:A,isStart:!0}),console.log(`🔍 添加fromCoinType到targetCoinType的线（跨列）: ${A}%`)):console.log("🔍 跳过fromCoinType到targetCoinType的线，因为fromPercent为0")}}for(let m=0;m<x.length;m++)x[m].forEach(Y=>{var Ht,t;const C=Y.originalTarget||Y.target,n=D(m,C,g);if(!n||!(Y.list&&Y.list[p])||C===R)return;const xt=((t=(Ht=i[p])==null?void 0:Ht[C])==null?void 0:t.fromPercent)||"0";x.length>2&&m===1?Object.keys(Y.list||{}).length===1?S.push({from:p,to:n.id,fromX:Ot,fromY:n.top+n.height/2,toX:n.left-$t,toY:n.top+n.height/2,fromPercent:xt,isStart:!0}):S.push({from:p,to:n.id,fromX:Ot,fromY:n.top+10,toX:n.left-$t,toY:n.top+10,fromPercent:xt,isStart:!0}):S.push({from:p,to:n.id,fromX:Ot,fromY:n.top+n.height/2,toX:n.left-$t,toY:n.top+n.height/2,fromPercent:xt,isStart:!0}),console.log(`🔍 添加fromCoinType到${C}的线: ${xt}%`)});console.log("🔍 处理节点到节点的线");const b=new Map,H=new Map;for(let m=0;m<x.length;m++)x[m].forEach(Y=>{const C=Y.originalTarget||Y.target;if(!D(m,C,g))return;const Ft=Y.list||{};Object.entries(Ft).forEach(([xt,Ht])=>{if(xt===p)return;let t=null;for(let h=m-1;h>=0&&(t=D(h,xt,g),!t);h--);if(!t)return;const ut=t.id,pt=b.get(ut)||0;b.set(ut,pt+1)})});for(let m=0;m<x.length;m++)x[m].forEach(Y=>{const C=Y.originalTarget||Y.target,n=D(m,C,g);if(!n)return;const Ft=Y.list||{};Object.entries(Ft).forEach(([xt,Ht])=>{var Z,st,Pt,Tt,jt,dt,St,Wt,_t,mt,yt,wt,Yt,Lt;if(xt===p)return;let t=null;for(let rt=m-1;rt>=0&&(t=D(rt,xt,g),!t);rt--);if(!t)return;const ut=t.id,pt=t.top+t.height/2;let h=!1;const V=H.get(ut)||0;if(H.set(ut,V+1),x.length===3&&t.columnIndex===0&&n.columnIndex===2){const rt=(Z=x[0])==null?void 0:Z[0];if(rt&&(t.originalTarget||t.target)===(rt.originalTarget||rt.target))if(x.length>1&&x[1].some(gt=>gt.list&&gt.list[p]))console.log("特殊处理：第一列第一个节点到第三列节点，强制使用特殊路径"),h=!0;else{console.log("第一列第一个节点到第三列节点，使用普通水平连接"),h=!1;const gt=((Pt=(st=i[`${t.columnIndex}-${t.originalTarget||t.target}`])==null?void 0:st[C])==null?void 0:Pt.fromPercent)||"0";S.push({from:t.id,to:n.id,fromX:t.left+t.width,fromY:t.top+10,toX:n.left,toY:t.top+10,fromPercent:gt})}else if(pt>=n.top&&pt<=n.top+n.height){const ft=((jt=(Tt=i[`${t.columnIndex}-${t.originalTarget||t.target}`])==null?void 0:Tt[C])==null?void 0:jt.fromPercent)||"0";S.push({from:t.id,to:n.id,fromX:t.left+t.width,fromY:pt,toX:n.left-$t,toY:pt,fromPercent:ft})}else{let ft=!1;for(let gt=t.top;gt<=t.top+t.height;gt+=5)if(gt>=n.top&&gt<=n.top+n.height){const Nt=((St=(dt=i[`${t.columnIndex}-${t.originalTarget||t.target}`])==null?void 0:dt[C])==null?void 0:St.fromPercent)||"0";S.push({from:t.id,to:n.id,fromX:t.left+t.width,fromY:gt,toX:n.left-$t,toY:gt,fromPercent:Nt}),ft=!0;break}ft||(h=!0)}}else if(pt>=n.top&&pt<=n.top+n.height){const rt=((_t=(Wt=i[`${t.columnIndex}-${t.originalTarget||t.target}`])==null?void 0:Wt[C])==null?void 0:_t.fromPercent)||"0";S.push({from:t.id,to:n.id,fromX:t.left+t.width,fromY:pt,toX:n.left,toY:pt,fromPercent:rt})}else{let rt=!1;for(let ft=t.top;ft<=t.top+t.height;ft+=5)if(ft>n.top+10&&ft<n.top+n.height-10){const gt=((yt=(mt=i[`${t.columnIndex}-${t.originalTarget||t.target}`])==null?void 0:mt[C])==null?void 0:yt.fromPercent)||"0";S.push({from:t.id,to:n.id,fromX:t.left+t.width,fromY:ft,toX:n.left,toY:ft,fromPercent:gt}),rt=!0;break}rt||(h=!0)}if(h){const rt=((Yt=(wt=i[`${t.columnIndex}-${t.originalTarget||t.target}`])==null?void 0:wt[C])==null?void 0:Yt.fromPercent)||"0",ft=b.get(ut)||1,gt=H.get(ut)||0,Nt=50,fo=t.top+10,go=t.height-20,ho=ft>3?Math.min(Nt,go/Math.max(1,ft-1)):Nt,J=fo+gt*ho;if(x.length===3&&t.columnIndex===0&&n.columnIndex===2){const Kt=(Lt=x[0])==null?void 0:Lt[0];if(Kt&&(t.originalTarget||t.target)===(Kt.originalTarget||Kt.target)){console.log("特殊处理：第一列第一个节点到第三列节点");const Rt=t.left+t.width/2,Zt=t.top;S.push({from:t.id,to:n.id,fromX:Rt,fromY:Zt,toX:n.left,toY:it+10,fromPercent:rt,segments:[{x1:Rt,y1:Zt,x2:Rt,y2:it+10},{x1:Rt,y1:it+10,x2:n.left-$t,y2:it+10}]})}else n.top>t.top+t.height?(console.log("生成Z型连线，segments数量: 3"),S.push({from:t.id,to:n.id,fromX:t.left+t.width,fromY:J,toX:t.left+t.width+nt,toY:J,fromPercent:rt,segments:[{x1:t.left+t.width,y1:J,x2:t.left+t.width+nt,y2:J},{x1:t.left+t.width+nt,y1:J,x2:t.left+t.width+nt,y2:n.top+20},{x1:t.left+t.width+nt,y1:n.top+20,x2:n.left,y2:n.top+20}]}),console.log("Z型连线生成完成，edge:",S[S.length-1])):S.push({from:t.id,to:n.id,fromX:t.left+t.width,fromY:J,toX:t.left+t.width+nt,toY:J,fromPercent:rt,segments:[{x1:t.left+t.width,y1:J,x2:t.left+t.width+nt,y2:J},{x1:t.left+t.width+nt,y1:J,x2:t.left+t.width+nt,y2:n.top+n.height-20},{x1:t.left+t.width+nt,y1:n.top+n.height-20,x2:n.left-$t,y2:n.top+n.height-20}]})}else x.length===3&&t.columnIndex===1&&n.columnIndex===2&&n.top<t.top?(console.log("三列情况：第二列到第三列，目标节点在上方"),console.log("三列情况：第二列到第三列，目标节点在上方from: ",t.id),console.log("三列情况：第二列到第三列，目标节点在上方to: ",n.id),S.push({from:t.id,to:n.id,fromX:t.left+t.width,fromY:J,toX:n.left+n.width/2,toY:J,fromPercent:rt,segments:[{x1:t.left+t.width,y1:J,x2:n.left+n.width/2,y2:J},{x1:n.left+n.width/2,y1:J,x2:n.left+n.width/2,y2:n.top+n.height+$t}]})):n.top>t.top+t.height?(console.log("生成Z型连线，segments数量: 3"),S.push({from:t.id,to:n.id,fromX:t.left+t.width,fromY:J,toX:t.left+t.width+nt,toY:J,fromPercent:rt,segments:[{x1:t.left+t.width,y1:J,x2:t.left+t.width+nt,y2:J},{x1:t.left+t.width+nt,y1:J,x2:t.left+t.width+nt,y2:n.top+20},{x1:t.left+t.width+nt,y1:n.top+20,x2:n.left-$t,y2:n.top+20}]})):(console.log("目标节点在上面11 fromNode: ",t),console.log("目标节点在上面11 currentNode: ",n),S.push({from:t.id,to:n.id,fromX:t.left+t.width,fromY:J,toX:t.left+t.width+nt,toY:J,fromPercent:rt,segments:[{x1:t.left+t.width,y1:J,x2:t.left+t.width+nt,y2:J},{x1:t.left+t.width+nt,y1:J,x2:t.left+t.width+nt,y2:n.top+n.height-20},{x1:t.left+t.width+nt,y1:n.top+n.height-20,x2:n.left-$t,y2:n.top+n.height-20}]}))}})});console.log("🔍 添加最后一列出发的线");const X=Math.max(...Array.from(g.values()).map(m=>m.columnIndex)),tt=Array.from(g.values()).filter(m=>m.columnIndex===X);if(tt.length>0){const m=tt[0],A=m.top+m.height/2;S.push({from:m.id,to:"final",fromX:m.left+m.width,fromY:A,toX:oo-Ot,toY:A,fromPercent:"100",isFinal:!0}),console.log("🔍 添加最终边")}return{edges:S}}function v(i){if(i.length===0)return 0;let g=1/0,p=-1/0;return i.forEach(x=>{g=Math.min(g,x.top),p=Math.max(p,x.top+x.height)}),p-g}const N=async()=>{var I;const i=(I=o==null?void 0:o.routerData)==null?void 0:I.paths;if(!i||(i==null?void 0:i.length)===0)return;const g=Qt((f==null?void 0:f.coin_type)||s||"");console.log("4444🚀 ~ toFormatSwapRouter ~ fromCoinType:",g);const p=Qt((w==null?void 0:w.coin_type)||d||"");console.log("4444🚀 ~ toFormatSwapRouter ~ targetCoinType:",p);const x=B(i,g,p,3);console.log("🚀 ~ toFormatSwapRouter11 ~ nodeColume (优化版):",x);const{nodesMap:G,orderedNodeColume:S}=z(x,g,i);E(S);const R=l(S,i,g);console.log("🚀 ~ toFormatSwapRouter ~ nodePercentages:",R);const{edges:b}=q(R,G,g,S),H=[...G.values()];console.log("🚀 ~ toFormatSwapRouter ~ adjustedNodes:",H),console.log("🚀 ~ toFormatSwapRouter11 ~ edges:",b);const X=v([...G.values()])+it+32;M(X),U(H),e(b);const tt=Array.from(new Set([...G.values()].map(u=>u.originalTarget||u.target)));et([...tt,g])},{getTokenListInfo:ht}=lo(),[lt,_]=Q.useState(new Map),et=async i=>{const g=await ht(i);g&&(g==null?void 0:g.size)>0&&_(g)};So(()=>{var i;N(),j(((i=o==null?void 0:o.routerData)==null?void 0:i.paths)||[])},[o]);function j(i){if(!Array.isArray(i))return[];const g=new Set;i.forEach(p=>{p.provider&&g.add(p.provider)}),K(Array.from(g))}function ot(i){console.log("🚀 ~ getBlockHeight ~ list:",i);let g=Wo*2+_o;const p=Object.entries(i);return p.forEach(([x,G],S)=>{g+=Xo*2,g+=No,g+=10,G.forEach(R=>{g+=zo})}),g+((p==null?void 0:p.length)-1)*Ro+10}return{newFormatSwapRouter:y,nodes:W,edges:O,tokenMap:lt,panelHeight:k,getAllProviders:j,allProviders:$,resultColumes:P}}function he({scamsText:o}){return r.jsxs(Xt,{borderRadius:"8px",border:"1px solid",borderColor:"border",pt:"12px",maxW:"480px",children:[r.jsxs(ct,{children:[r.jsx(Co,{xlinkHref:"#icon-icon_priceupdated",svgFill:"primary_yellow",svgHover:"primary_yellow",svgW:"20px",svgH:"20px"}),r.jsx(at,{color:"primary_yellow",children:"Alert"})]}),r.jsx(vt,{bg:"card_bg",borderRadius:"8px",p:"11px",children:r.jsx(Io,{text:`${o}  detected to have Deny List feature. It's an optional feature on Sui designed for regulated coins (learn more). However, it could be misused by HoneyPot scams, which may restrict users from selling the tokens after buying. Please be cautious.`,keywords:["learn more"],onKeywordClick:()=>{window.open("https://docs.sui.io/guides/developer/coin/regulated","_blank")}})})]})}const Bo=({allProviders:o,children:s,loading:d,isSwapWidget:y})=>{const{isApp:L}=Vt(),[W,U]=Q.useState([]);return Q.useEffect(()=>{const O=new Set,e=[];o==null||o.forEach(k=>{const M=Yo(k);M?O.has(M.groupName)||(O.add(M.groupName),e.push(k)):e.push(k)}),U(e)},[o]),o&&r.jsx(po,{isLoaded:!d,minW:"128px",minH:"20px",children:r.jsxs(ct,{w:"100%",gap:"4px",justify:"flex-end",wrap:"wrap",minH:"20px",alignItems:"center",children:[W==null?void 0:W.map(O=>{var e,k;return L&&s?r.jsx(Mt,{w:"16px",h:"16px",imageUrl:(e=Ut[O])==null?void 0:e.logo}):r.jsxs(eo,{isLazy:!0,trigger:L?"click":"hover",children:[r.jsx(ro,{children:r.jsx(vt,{children:r.jsx(Mt,{w:"16px",h:"16px",imageUrl:(k=Ut[O])==null?void 0:k.logo})})}),r.jsx(no,{children:r.jsx(so,{w:"unset",children:r.jsx(io,{fontSize:"12px",children:Lo(O)})})})]},O)}),s]})})},kt=2;function Go({data:o,config:s={},originFromCoinType:d,originToCoinType:y,isWidget:L}){const{nodes:W,edges:U,tokenMap:O,panelHeight:e,resultColumes:k}=Do(o,d,y),M=Q.useRef(null),f={nodeWidth:176,searchStep:5,nodePadding:10,maxSearchDistance:50,arrowOffset:5,...s},w=Q.useMemo(()=>W==null?void 0:W.map($=>{var B;const K=$.originalTarget||$.target,P=O==null?void 0:O.get(K),E=Object.keys($==null?void 0:$.list);return{...$,targetSymbol:P==null?void 0:P.symbol,targetImg:P==null?void 0:P.logo_url,fromGroups:(B=Object.values($==null?void 0:$.list))==null?void 0:B.map((z,l)=>{const D=O==null?void 0:O.get(E[l]),q=`${At((D==null?void 0:D.symbol)||"",8)} > ${At((P==null?void 0:P.symbol)||"",8)}`,v=z.reduce((_,et)=>_+parseFloat(et.amountOut||"0"),0),N=[];z.forEach(_=>{const et=parseFloat(_.amountOut||"0"),j=v>0?Bt(bt(et).div(v).mul(100).toString(),0):"0";N.push(Number(j)||1)});const ht=Gt(N);return{list:z.map((_,et)=>{var i;const j=((i=ht[et])==null?void 0:i.toString())||"0",ot=O==null?void 0:O.get(_==null?void 0:_.from);return{..._,percent:j,fromLogo:ot==null?void 0:ot.logo_url,targetLogo:P==null?void 0:P.logo_url,fromSymbol:ot==null?void 0:ot.symbol,targetSymbol:P==null?void 0:P.symbol,displayFee:Oo(bo(_==null?void 0:_.feeRate,4))}}).sort((_,et)=>Number(et==null?void 0:et.percent)-Number(_==null?void 0:_.percent)),title:q}})}}),[W,O,k]);return r.jsxs(vt,{position:"relative",w:"878px",h:e?`${e}px`:"531px",ref:M,children:[r.jsx(qo,{edges:U,nodes:W,config:f}),r.jsx(Vo,{data:w,isWidget:L})]})}function Uo(o,s,d,y,L,W,U,O){const e=L+U,k=W+O,M=Math.min(o,d),f=Math.max(o,d),w=Math.min(s,y),$=Math.max(s,y);if(f<L||M>e||$<W||w>k)return!1;if(M>=L&&f<=e&&w>=W&&$<=k)return!0;if(Math.abs(s-y)<.001)return s>=W&&s<=k&&f>=L&&M<=e;if(Math.abs(o-d)<.001)return o>=L&&o<=e&&$>=W&&w<=k;const K=[{x1:L,y1:W,x2:e,y2:W},{x1:L,y1:k,x2:e,y2:k},{x1:L,y1:W,x2:L,y2:k},{x1:e,y1:W,x2:e,y2:k}];for(const P of K)if(Ko(o,s,d,y,P.x1,P.y1,P.x2,P.y2))return!0;return!1}function Ko(o,s,d,y,L,W,U,O){const e=(o-d)*(W-O)-(s-y)*(L-U);if(Math.abs(e)<.001)return!1;const k=((o-L)*(W-O)-(s-W)*(L-U))/e,M=-((o-d)*(s-W)-(s-y)*(o-L))/e;return k>=0&&k<=1&&M>=0&&M<=1}function Dt(o,s,d,y,L,W=176,U,O,e=[],k=[],M={}){const f=M.searchStep||5,w=M.nodePadding||10;M.maxSearchDistance;const $=M.arrowOffset||5,K=(j,ot,i,g)=>{for(const p of e)if(!(O.from===p.id||O.to===p.id)&&Uo(j,ot,i,g,p.left,p.top,p.width,p.height))return!0;return!1},P=j=>{if(K(o,j,d-$,j))return!1;const ot=E.top,i=E.top+E.height,g=B.top,p=B.top+B.height,x=Math.max(ot,g),G=Math.min(i,p);return x<G?j>=x+w&&j<=G-w:!1},E=e.find(j=>j.id===O.from),B=e.find(j=>j.id===O.to);if(!E||!B)return`M${o},${s} L${d},${s==y?y:s}`;if(U){const j=B.top+B.height/2;return P(j)?`M${o},${s} L${d-$},${j}`:`M${o},${s} L${d-$},${s}`}const z=k.filter(j=>j.from===O.from);if(k.filter(j=>j.to===O.to),z.length===1){const j=E.top+E.height/2;if(P(j))return`M${o},${j} L${d-$},${j}`}const l=E.top,D=E.top+E.height,q=B.top,v=B.top+B.height,N=Math.max(l,q),ht=Math.min(D,v);if(N<ht){for(let j=N+w;j<=ht-w;j+=f)if(P(j))return`M${o},${j} L${d-$},${j}`}const lt=E.top+E.height/2,_=B.left+B.width/2,et=B.top+B.height;if(D-10<q){const j=E.left+E.width/2,ot=E.top+E.height,i=B.top+B.height/2;return!K(j,D,j,i)&&!K(j,i,d-$,i)?`M${j},${ot} L${j},${D} L${j},${i} L${d-$},${i}`:`M${o},${ot} L${_},${ot} L${_},${et}`}else if(l+10>=v)return`M${o},${lt} L${_},${lt} L${_},${et}`;return`M${o},${lt} L${d},${lt}`}function qo({edges:o,nodes:s,config:d}){var L,W,U,O;const y=Q.useRef(null);return r.jsxs("svg",{ref:y,style:{position:"absolute",left:0,top:0,pointerEvents:"none",zIndex:1,width:"100%",height:"100%"},children:[r.jsxs("defs",{children:[r.jsxs("linearGradient",{id:"arrowGradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[r.jsx("stop",{offset:"0%",stopColor:"rgba(0, 255, 165, 1)"}),r.jsx("stop",{offset:"100%",stopColor:"rgba(0, 183, 255, 1)"})]}),r.jsx("marker",{id:"arrowhead",markerWidth:"5",markerHeight:"9",refX:"4",refY:"4",orient:"auto",children:r.jsx("path",{d:"M1 1 L4 3.5 L1 6",fill:"none",stroke:"url(#arrowGradient)",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round"})})]}),(()=>{const e=(o==null?void 0:o.filter(w=>w.isStart))||[];console.log("🚀 ~ firstColumnEdges:",e);const k=e.reduce((w,$)=>$.fromY>w.fromY?$:w,e[0]);console.log("🚀 ~ lastFirstColumnEdge:",k);const M=(o==null?void 0:o.filter(w=>w.isFinal))||[],f=M.reduce((w,$)=>$.toY>w.toY?$:w,M[0]);if(console.log("🚀 ~ lastThirdColumnEdge:",f),k&&f){const E=`M 13 8 Q 13 ${k.fromY-10} ${k.fromX} ${k.fromY}`,B=`M 865 4 L 865 ${f.toY} L ${f.toX} ${f.toY}`;return r.jsxs("g",{children:[r.jsx("path",{d:E,stroke:"#2D2D2D",strokeWidth:kt,fill:"none"}),r.jsx("path",{d:B,stroke:"#2D2D2D",strokeWidth:kt,fill:"none"}),r.jsx("circle",{cx:13,cy:4,r:"4",fill:"#75C8FF"}),r.jsx("circle",{cx:865,cy:4,r:"4",fill:"#75C8FF"})]})}return null})(),(L=o==null?void 0:o.filter(e=>e.isCrossColumnConnection&&e.isStart))==null?void 0:L.map((e,k)=>{let M,f,w;if(e.segments&&e.segments.length>0){M=e.segments.map((v,N)=>N===0?`M${v.x1},${v.y1} L${v.x2},${v.y2}`:`L${v.x2},${v.y2}`).join(" ");const l=e.segments[0],D=l.x2-l.x1,q=l.y2-l.y1;Math.abs(D)>Math.abs(q)?(w=(l.y1+l.y2)/2,f=l.x1+30):q<0?(w=l.y1-16,f=(l.x1+l.x2)/2):(w=l.y1+30,f=(l.x1+l.x2)/2)}else{M=Dt(e.fromX,e.fromY,e.toX,e.toY,e.toBlockHeight,d.nodeWidth,!!e.isStart,e,s,o,d);const l=M.split(" ");let D=e.fromX,q=e.fromY,v=!1;if(l.length>0&&l[0].startsWith("M")){const N=l[0].substring(1).split(",");N.length===2&&(D=parseFloat(N[0]),q=parseFloat(N[1]))}if(l.length>=3){const N=l[1],ht=l[2];if(N&&ht){const lt=N.substring(1).split(","),_=ht.substring(1).split(",");if(lt.length===2&&_.length===2){const et=parseFloat(lt[1]),j=parseFloat(_[1]);et<j&&(v=!0)}}}v?(e.fromPercent&&`${e.fromPercent}`,f=D,w=q+12):(f=D+30,w=q)}const $=e.fromPercent?`${e.fromPercent}%`:"",K=$.length*6,P=Math.max(42,K+10),E=16,B=f-P/2,z=w-E/2;return r.jsxs("g",{children:[r.jsx("path",{d:M,stroke:"#2D2D2D",strokeWidth:kt,fill:"none",markerEnd:"url(#arrowhead)",strokeLinecap:"square",strokeLinejoin:"miter"}),r.jsx("rect",{x:B,y:z,width:P,height:E,rx:"4",ry:"4",fill:"#192128"}),r.jsx("text",{x:f,y:z+E/2+.5,fontSize:"10",fill:"#00B7FF",textAnchor:"middle",dominantBaseline:"middle",pointerEvents:"auto",children:$})]},`cross-${k}`)}),(W=o==null?void 0:o.filter(e=>e.renderOnTop))==null?void 0:W.map((e,k)=>{let M,f,w;if(e.segments&&e.segments.length>0){M=e.segments.map((v,N)=>N===0?`M${v.x1},${v.y1} L${v.x2},${v.y2}`:`L${v.x2},${v.y2}`).join(" ");const l=e.segments[0],D=l.x2-l.x1,q=l.y2-l.y1;Math.abs(D)>Math.abs(q)?(w=(l.y1+l.y2)/2,f=l.x1+30):q<0?(w=l.y1-16,f=(l.x1+l.x2)/2):(w=l.y1+30,f=(l.x1+l.x2)/2)}else M=Dt(e.fromX,e.fromY,e.toX,e.toY,e.toBlockHeight,d.nodeWidth,!!e.isStart,e,s,o,d),f=(e.fromX+e.toX)/2,w=(e.fromY+e.toY)/2;const $=e.fromPercent?`${e.fromPercent}%`:"",K=$.length*6,P=Math.max(42,K+10),E=16,B=f-P/2,z=w-E/2;return r.jsxs("g",{children:[r.jsx("path",{d:M,stroke:"#2D2D2D",strokeWidth:kt,fill:"none",markerEnd:"url(#arrowhead)",strokeLinecap:"square",strokeLinejoin:"miter"}),r.jsx("rect",{x:B,y:z,width:P,height:E,rx:"4",ry:"4",fill:"#192128"}),r.jsx("text",{x:f,y:z+E/2+.5,fontSize:"10",fill:"#00B7FF",textAnchor:"middle",dominantBaseline:"middle",pointerEvents:"auto",children:$})]},`cross-other-${k}`)}),(U=o==null?void 0:o.filter(e=>e.isCrossColumnConnection&&!e.isStart&&!e.renderOnTop))==null?void 0:U.map((e,k)=>{let M,f,w;if(e.segments&&e.segments.length>0){M=e.segments.map((v,N)=>N===0?`M${v.x1},${v.y1} L${v.x2},${v.y2}`:`L${v.x2},${v.y2}`).join(" ");const l=e.segments[0],D=l.x2-l.x1,q=l.y2-l.y1;Math.abs(D)>Math.abs(q)?(w=(l.y1+l.y2)/2,f=l.x1+30):q<0?(w=l.y1-16,f=(l.x1+l.x2)/2):(w=l.y1+30,f=(l.x1+l.x2)/2)}else M=Dt(e.fromX,e.fromY,e.toX,e.toY,e.toBlockHeight,d.nodeWidth,!!e.isStart,e,s,o,d),f=(e.fromX+e.toX)/2,w=(e.fromY+e.toY)/2;const $=e.fromPercent?`${e.fromPercent}%`:"",K=$.length*6,P=Math.max(42,K+10),E=16,B=f-P/2,z=w-E/2;return r.jsxs("g",{children:[r.jsx("path",{d:M,stroke:"#2D2D2D",strokeWidth:kt,fill:"none",markerEnd:"url(#arrowhead)",strokeLinecap:"square",strokeLinejoin:"miter"}),r.jsx("rect",{x:B,y:z,width:P,height:E,rx:"4",ry:"4",fill:"#192128"}),r.jsx("text",{x:f,y:z+E/2+.5,fontSize:"10",fill:"#00B7FF",textAnchor:"middle",dominantBaseline:"middle",pointerEvents:"auto",children:$})]},`cross-other-${k}`)}),(O=o==null?void 0:o.filter(e=>!e.isCrossColumnConnection&&!e.renderOnTop))==null?void 0:O.map((e,k)=>{let M,f,w;if(e.segments&&e.segments.length>0){console.log("🔍 第四层发现segments，数量:",e.segments.length,"edge:",e),M=e.segments.map((v,N)=>N===0?`M${v.x1},${v.y1} L${v.x2},${v.y2}`:`L${v.x2},${v.y2}`).join(" ");const l=e.segments[0],D=l.x2-l.x1,q=l.y2-l.y1;Math.abs(D)>Math.abs(q)?(w=(l.y1+l.y2)/2,f=l.x1+30):q<0?(w=l.y1-16,f=(l.x1+l.x2)/2):(w=l.y1+30,f=(l.x1+l.x2)/2)}else{M=Dt(e.fromX,e.fromY,e.toX,e.toY,e.toBlockHeight,d.nodeWidth,!!e.isStart,e,s,o,d);const l=M.split(" ");let D=e.fromX,q=e.fromY,v=!1;if(l.length>0&&l[0].startsWith("M")){const N=l[0].substring(1).split(",");N.length===2&&(D=parseFloat(N[0]),q=parseFloat(N[1]))}if(l.length>=3){const N=l[1],ht=l[2];if(N&&ht){const lt=N.substring(1).split(","),_=ht.substring(1).split(",");if(lt.length===2&&_.length===2){const et=parseFloat(lt[1]),j=parseFloat(_[1]);et<j&&(v=!0)}}}v?(e.fromPercent&&`${e.fromPercent}`,f=D,w=q+12):(f=D+30,w=q)}const $=e.fromPercent?`${e.fromPercent}%`:"",K=$.length*6,P=Math.max(42,K+10),E=16,B=f-P/2,z=w-E/2;return r.jsxs("g",{children:[r.jsx("path",{d:M,stroke:"#2D2D2D",strokeWidth:kt,fill:"none",markerEnd:"url(#arrowhead)",strokeLinecap:"square",strokeLinejoin:"miter"}),r.jsx("rect",{x:B,y:z,width:P,height:E,rx:"4",ry:"4",fill:"#192128"}),r.jsx("text",{x:f,y:z+E/2+.5,fontSize:"10",fill:"#00B7FF",textAnchor:"middle",dominantBaseline:"middle",pointerEvents:"auto",children:$})]},`normal-${k}`)})]})}function Vo({data:o,isWidget:s}){return r.jsx(vt,{w:"100%",position:"relative",h:"100%",zIndex:2,children:o==null?void 0:o.map(d=>r.jsx(Zo,{data:d,isWidget:s},d.target))})}function Zo({data:o,isWidget:s}){var d;return r.jsxs(Xt,{w:"176px",p:"8px",gap:"0px",bg:s?"swap_bg_primary":"background",borderRadius:"8px",border:"1px solid",borderColor:s?"#242C33":"border",position:"absolute",left:o==null?void 0:o.left,top:(o==null?void 0:o.top)+"px","data-node-id":o==null?void 0:o.target,children:[r.jsx(vt,{w:"100%",children:r.jsx(te,{data:o,children:r.jsxs(ct,{w:"100%",h:"24px",justify:"flex-start",children:[r.jsx(Mt,{imageUrl:o==null?void 0:o.targetImg,coinType:o==null?void 0:o.originalTarget,showTagWidth:"12px",showTagHeight:"12px",w:"24px",h:"24px"}),r.jsx(at,{fontSize:"14px",color:"text_caption",children:At((o==null?void 0:o.targetSymbol)||"",16)})]})})}),(d=o==null?void 0:o.fromGroups)==null?void 0:d.map(y=>r.jsx(Qo,{data:y,isWidget:s},y.from))]},o==null?void 0:o.target)}function Qo({data:o,isWidget:s}){var d;return r.jsxs(Xt,{p:"12px 8px",bg:s?"#1F2933":"#1C1C1C",borderRadius:"8px",w:"100%",gap:"0px",mt:"8px",children:[r.jsx(at,{h:"16px",fontSize:"14px",color:"primary_gray",w:"100%",children:o==null?void 0:o.title}),r.jsx(Xt,{gap:"0px",w:"100%",align:"flex-start",mt:"10px",children:(d=o==null?void 0:o.list)==null?void 0:d.map(y=>{var L,W;return r.jsx(Jo,{data:y,children:r.jsxs(ct,{h:"22px",w:"100%",gap:"0px",cursor:"pointer",children:[r.jsx(Mt,{imageUrl:(L=Ut[y==null?void 0:y.provider])==null?void 0:L.logo,w:"16px",h:"16px"}),r.jsx(at,{fontSize:"12px",color:"primary_gray",ml:"4px",children:(W=Ut[y==null?void 0:y.provider])==null?void 0:W.name}),r.jsxs(at,{fontSize:"12px",color:"primary_gray",flex:"1",textAlign:"right",children:[y==null?void 0:y.percent,"%"]})]},y.provider)},y==null?void 0:y.id)})})]})}function Jo({children:o,data:s}){const{isApp:d}=Vt(),{getExplorerUrl:y}=co();return r.jsxs(eo,{isLazy:!0,trigger:d?"click":"hover",gutter:4,children:[r.jsx(ro,{children:o}),r.jsx(no,{children:r.jsx(so,{w:"unset",minW:"unset",children:r.jsx(io,{p:"12px",children:r.jsxs(Xt,{w:"190px",gap:"12px",className:"no-close-widget-flag",children:[r.jsxs(ct,{w:"100%",justify:"space-between",p:"0",gap:"0px",children:[r.jsx(Eo,{coinAIconUrl:s==null?void 0:s.fromLogo,coinBIconUrl:s==null?void 0:s.targetLogo,variant:"",p:"0px",w:"16px",h:"16px",imageStyle:{decoding:"async"},coinACoinType:s==null?void 0:s.from,coinBCoinType:s==null?void 0:s.target,showTagWidth:"10px",showTagHeight:"10px"}),r.jsxs(at,{fontSize:"12px",color:"text_caption",flex:1,textAlign:"left",ml:"4px",children:[At((s==null?void 0:s.fromSymbol)||"",8)," - ",At((s==null?void 0:s.targetSymbol)||"",8)]}),(s==null?void 0:s.feeRate)&&Number(s==null?void 0:s.feeRate)>0&&r.jsx(xo,{minW:"50px",h:"16px",border:"1px solid",borderColor:"border",borderRadius:"12px",p:"0px 6px",children:r.jsx(at,{fontSize:"12px",color:"#76C8FF",lineHeight:"12px",fontWeight:"400",children:s.displayFee})})]}),(s==null?void 0:s.id)&&r.jsxs(ct,{w:"100%",justify:"space-between",h:"20px",p:"0",children:[r.jsx(ct,{children:r.jsx(at,{fontSize:"12px",color:"text_paragraph",children:"Pool"})}),r.jsx(ao,{address:s==null?void 0:s.id,color:"text_caption",showLink:!!d,onClickLink:()=>{window.open(y(s==null?void 0:s.id,"poolAddress"),"_blank")}})]})]})})})})]})}function te({data:o,children:s}){const{getExplorerUrl:d}=co();return r.jsx(Fo,{placement:"top",showTooltip:!0,tooltip:r.jsxs(ct,{w:"100%",justify:"flex-start",children:[r.jsx(Mt,{imageUrl:o==null?void 0:o.targetImg,w:"20px",h:"20px",minH:"20px",minW:"20px",showTag:!0,showTagWidth:"10px",showTagHeight:"10px",coinType:o==null?void 0:o.originalTarget}),r.jsxs(at,{color:"text_caption",children:[" ",At(o==null?void 0:o.targetSymbol,10)]}),r.jsx(ao,{address:o==null?void 0:o.originalTarget,onClickLink:()=>window.open(d(o==null?void 0:o.originalTarget,"coin"))})]}),children:r.jsx(vt,{w:"100%",children:s})})}const ue=({isOpen:o,onClose:s,data:d,fromCoin:y,toCoin:L,fromAmount:W,toAmount:U,allProviders:O,mergeSwapData:e})=>{const{isApp:k}=Vt(),{getTokenListInfo:M}=lo(),f=e==null?void 0:e.allRoutes,w=(e==null?void 0:e.currentIndex)??0,$=!!(f!=null&&f.length),[K,P]=Q.useState(w),[E,B]=Q.useState([]),z=Q.useMemo(()=>f,[f]);Q.useEffect(()=>{f!=null&&f.length&&(w>=(f==null?void 0:f.length)?P(0):P(w))},[w,f==null?void 0:f.length]);const l=j=>{const ot=(f==null?void 0:f.findIndex(i=>to(i.paths[0].from)===to(j)))??-1;ot>=0&&P(ot)},D=Q.useMemo(()=>$&&(z!=null&&z[K])?{routerData:z[K]}:d,[$,z,K,d]),q=Q.useMemo(()=>O||[],[$,z,K,O]),v=Q.useRef(M);v.current=M;const[N,ht]=Q.useState(L);Q.useEffect(()=>{if(!$||!(z!=null&&z.length))return;(async()=>{var ot,i,g;try{const p=z.map(b=>b.paths[0].from),x=(g=(i=z[0])==null?void 0:i.paths[((ot=z[0])==null?void 0:ot.paths.length)-1])==null?void 0:g.target;if(!x)return;const G=await v.current([...p,x]);if(!G)return;const S=G.get(x);ht(S);const R=z.map(b=>{var tt,I;const H=b.paths[0].from,X=G.get(H);return{...X,amountIn:Jt((tt=b.amountIn)==null?void 0:tt.toString(),(X==null?void 0:X.decimals)||0),amountOut:Jt((I=b.amountOut)==null?void 0:I.toString(),(S==null?void 0:S.decimals)||0)}});B(R)}catch(p){console.error("Failed to get merge from coin list:",p)}})()},[$,z]);const lt=Q.useMemo(()=>{var j;return $&&E.length>0&&K>=0?(j=E[K])==null?void 0:j.coin_type:y==null?void 0:y.coin_type},[$,E,K,y==null?void 0:y.coin_type]),_=Q.useMemo(()=>$&&(N!=null&&N.coin_type)?N:L,[$,N==null?void 0:N.coin_type,L==null?void 0:L.coin_type]),et=Q.useMemo(()=>{var j;return $&&E.length>0&&K>=0?(j=E[K])==null?void 0:j.amountOut:U},[$,E,K,U]);return r.jsxs(mo,{autoFocus:!1,returnFocusOnClose:!1,isOpen:o,onClose:s,isCentered:!0,children:[r.jsx(yo,{}),r.jsxs(wo,{maxW:"1200px",w:k?"calc(100vw - 32px)":"910px",bg:"background",children:[r.jsx($o,{mr:"-10px",children:r.jsxs(ct,{w:"100%",gap:"24px",justify:"space-between",align:"center",children:[r.jsx(at,{fontSize:"16px",fontWeight:"500",color:"text_caption",children:"Route"}),r.jsxs(ct,{gap:"0",align:"center",children:[r.jsx(Bo,{allProviders:q}),r.jsx(jo,{mt:"0",position:"static"})]})]})}),r.jsx(To,{p:{base:"8px 16px",lg:"16px"},children:r.jsx(vt,{w:"100%",overflowX:k?"auto":"hidden",children:r.jsxs(vt,{w:"876px",children:[r.jsxs(ct,{w:"100%",h:"100%",justify:"space-between",align:"center",mb:"16px",children:[$?r.jsx(oe,{list:E,defaultIndex:K,onChange:l}):r.jsxs(ct,{children:[r.jsx(Mt,{imageUrl:y==null?void 0:y.logo_url,w:"24px",h:"24px"}),r.jsx(at,{fontSize:"14px",fontWeight:"500",color:"text_caption",children:qt(W||"0")}),r.jsx(at,{fontSize:"14px",fontWeight:"500",color:"primary_gray",children:y==null?void 0:y.symbol})]}),r.jsxs(ct,{children:[r.jsx(at,{fontSize:"14px",fontWeight:"500",color:"text_caption",children:qt(et||"0")}),r.jsx(at,{fontSize:"14px",fontWeight:"500",color:"primary_gray",children:_==null?void 0:_.symbol}),r.jsx(Mt,{imageUrl:L==null?void 0:L.logo_url,w:"24px",h:"24px"})]})]}),lt&&(_==null?void 0:_.coin_type)&&r.jsx(Go,{data:D,originFromCoinType:lt,originToCoinType:_==null?void 0:_.coin_type})]})})})]})]})};function oe({list:o,defaultIndex:s,onChange:d}){var W;const y=(W=o[s])==null?void 0:W.coin_type,L=Q.useCallback(U=>{d(U)},[d]);return r.jsx(ct,{gap:"4px",children:o.map(U=>r.jsx(ee,{coin:U,amount:U.amountIn,isActive:U.coin_type===y,onClick:L},U.coin_type))})}function ee({coin:o,amount:s,isActive:d,onClick:y}){const L=Q.useCallback(()=>{y(o.coin_type)},[y,o.coin_type]);return r.jsxs(ct,{gap:"0px",borderRadius:"16px",border:"1px solid",borderColor:d?"primary":"#262626",h:"32px",p:"4px",bg:d?"primary_opacity.10":"transparent",_hover:{borderColor:"primary"},cursor:"pointer",onClick:L,children:[r.jsx(Mt,{imageUrl:o==null?void 0:o.logo_url,w:"24px",h:"24px",borderRadius:"12px"}),d&&r.jsxs(ct,{gap:"4px",p:"0px 4px",pr:"8px",children:[r.jsx(at,{fontSize:"14px",fontWeight:"500",color:"text_caption",children:qt(s||"0")}),r.jsx(at,{fontSize:"14px",fontWeight:"500",color:"primary_gray",children:o==null?void 0:o.symbol})]})]})}function pe(){const{fetchByApi:o}=vo(),{providers:s,setProviders:d,setProvidersLoading:y,providersLoading:L}=Mo();return{fetchRouterConfig:async()=>{try{y(s.length===1);const U=await o(Po,"GET"),{providers:O}=U;O&&O.length>0&&d(O),console.log("🚀 ~ file: useGetRouterConfig.ts:13 ~ fetchRouterConfig ~ res:",U)}catch(U){console.log("🚀 ~ file: useGetRouterConfig.ts:18 ~ fetchRouterConfig ~ error:",U)}finally{y(!1)}},providersLoading:L}}export{Bo as O,ue as R,he as S,Go as V,Do as a,ge as c,pe as u};
