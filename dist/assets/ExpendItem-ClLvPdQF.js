import{r as C,j as a,V as A,H as k,m as V,T,l as G,w as U,i as J}from"./vendor-CBmAETR3.js";import{u as K}from"./useTransaction-BEUdFaaa.js";import{u as Q}from"./useAccountBalance-D7pkS3C9.js";import{u as $,e as X,A as Y,M as Z,z as j,I as O,c as D,C as f}from"./index-ihcskjKt.js";import"./cross-CbhIs7DK.js";import{u as I,L as ee}from"./LiquidityValueBlock-DS5y0rnC.js";import{a as F,j as q,c as re}from"./usePositionList-5SlPZsY2.js";import{P as N}from"./PositionPriceRangeBar-B3Gr2ilx.js";import{R as se}from"./RangeValue-B4jAazPi.js";function ae(){const{getBatchHarvestFarmsTxPayload:e,getStakeTxPayload:t,getUnstakeTxPayload:g,getHarvestFarmsTxPayload:P}=I(),{signAndExecuteTransaction:d}=K(),[m,r]=C.useState(!1),[v,c]=C.useState(!1),{fetchAccountBalance:i}=Q();return{toStakePos:async(w,y,u,n)=>{console.log("ðŸš€ ~ toStakePos ~ posInfo:",w);const{posId:h,clmmPool:x,coinTypeA:l,coinTypeB:z}=w;c(!0);try{const{tx:p,msafeParams:E}=await t(h,y,x,l,z);console.log("ðŸš€ ~ toStakePos ~ tx:",p);const S=await d(p,{getShowInfo:()=>({modalDescriptionText:`Stake ${u}`,toastTitleText:"Stake"})},{msafeParams:E});S&&(console.log("ðŸš€ ~ toStakePos ~ res:",S),n(S.events)),c(!1)}catch(p){console.log("ðŸš€ ~ toStakePos ~ error:",p),c(!1)}},toUnStakePos:async(w,y,u,n)=>{c(!0);try{const{tx:h,msafeParams:x}=await g(y,w);console.log("ðŸš€ ~ toUnstack ~ tx:",h);const l=await d(h,{getShowInfo:()=>({modalDescriptionText:`Unstake ${u}`,toastTitleText:"Unstake"})},{msafeParams:x});console.log("ðŸš€ ~ toUnStakePos ~ res:",l),l&&(i(),n()),c(!1)}catch(h){console.log("ðŸš€ ~ toUnStakePos ~ error:",h),c(!1)}},toClaimPos:async(w,y,u)=>{r(!0);try{const{tx:n,msafeParams:h}=await P(y,w);console.log("ðŸš€ ~ toClaimPos ~ tx:",n);const x=await d(n,{getShowInfo:()=>({modalDescriptionText:" Claim rewards",toastTitleText:" Claim"})},{msafeParams:h});console.log("ðŸš€ ~ toClaimPos ~ res:",x),x&&(i(),u()),r(!1)}catch(n){r(!1),console.log("ðŸš€ ~ toClaimPos ~ error:",n)}},toClaimAllPos:async(w,y)=>{r(!0);try{const u=[];w.forEach(l=>{l!=null&&l.farmsPool&&u.push({pool_id:l.farmsPool,position_nft_id:l.id})}),console.log("ðŸš€ ~ list.forEach  toClaimAllPos ~ params:",u);const{tx:n,msafeParams:h}=await e(u);console.log("ðŸš€ ~ toClaimAllPos ~ tx:",n);const x=await d(n,{getShowInfo:()=>({modalDescriptionText:" Claim rewards",toastTitleText:" Claim"})},{msafeParams:h});console.log("ðŸš€ ~ toClaimAllPos ~ res:",x),x&&setTimeout(async()=>{i(),y()},2e3),r(!1)}catch(u){r(!1),console.log("ðŸš€ ~ toClaimAllPos ~ error:",u)}},claimLoading:m,unstakeLoading:v}}function ce({positionInfo:e,symbolEllipsesDecimals:t=0,labelInfo:g,children:P}){const{posPoolsRelatedData:d,posPoolsOriginalData:m}=F(),r=d[e==null?void 0:e.posId],{getPosIsActive:v}=q(),c=C.useMemo(()=>{var B;return v(e,(B=m==null?void 0:m[(e==null?void 0:e.clmmPool)||""])==null?void 0:B.current_sqrt_price)},[e,m]),{isApp:i}=$(),[_,L]=C.useState(!0);return console.log("ðŸš€ðŸš€ðŸš€ ~ PriceRange.tsx:32 ~ priceDirect:",_),a.jsx(A,{w:{base:"100%",lg:"480px"},maxW:{base:"100%",lg:"480px"},height:"100%",alignItems:"flex-start",justifyContent:"center",children:a.jsxs(k,{justifyContent:"flex-start",height:{base:"auto",lg:"60px"},p:{base:"12px",lg:"16px"},borderRadius:"12px",bg:"position_status_bg",alignItems:{base:"flex-start",lg:"center"},w:{base:"100%",lg:"auto"},flexDirection:{base:"column",lg:"row"},gap:{base:"12px",lg:"8px"},children:[!i&&a.jsx(N,{minPrice:r==null?void 0:r.minPrice,maxPrice:r==null?void 0:r.maxPrice,currPrice:r==null?void 0:r.currentPrice,isActive:c,isShowActive:!0,priceDirect:_,wrapStyle:{flexDirection:{base:"row-reverse",lg:"column"}}}),a.jsxs(A,{align:"flex-start",gap:{base:"12px",lg:"4px"},width:{lg:"100%"},justifyContent:{lg:"space-between"},children:[a.jsxs(k,{width:{base:"100%"},justifyContent:{base:"space-between"},children:[a.jsx(V,{isLoaded:!!(g!=null&&g.text),children:a.jsx(T,{fontSize:"12px",color:"primary_gray",...g==null?void 0:g.style,children:g==null?void 0:g.text})}),P]}),i&&a.jsx(N,{minPrice:r==null?void 0:r.minPrice,maxPrice:r==null?void 0:r.maxPrice,currPrice:r==null?void 0:r.currentPrice,isActive:c,priceDirect:_,isShowActive:!0,wrapStyle:{flexDirection:{base:"row-reverse",lg:"column"}}}),a.jsx(se,{symbolEllipsesDecimals:t,displayTokenA:e==null?void 0:e.displayTokenA,displayTokenB:e==null?void 0:e.displayTokenB,setPriceDirect:L,priceInfo:{minPrice:r==null?void 0:r.minPrice,maxPrice:r==null?void 0:r.maxPrice,minPriceResever:r==null?void 0:r.minPriceResever,maxPriceResever:r==null?void 0:r.maxPriceResever}})]})]})})}function ie({positionInfo:e,apiInfo:t}){var R,M;const{farmsPosRewardsData:g,posPoolsRelatedData:P,posPoolsOriginalData:d}=F(),{getPositionBaseList:m}=re(),{currentAccount:r}=Z(),{isApp:v}=$(),c=g[e==null?void 0:e.id],i=c==null?void 0:c.reduce((s,b)=>j(s).add(b.display_amount_owed).toString(),0),{getPosIsActive:_}=q(),L=C.useMemo(()=>{var s;return _(e,(s=d==null?void 0:d[(e==null?void 0:e.clmmPool)||""])==null?void 0:s.current_sqrt_price)},[e,d]),{getClmmPosName:B}=q(),o=C.useMemo(()=>{var s;if(e!=null&&e.tokenName)return e==null?void 0:e.tokenName;{const b=(s=d==null?void 0:d[e==null?void 0:e.clmmPool])==null?void 0:s.index;return B(e==null?void 0:e.index,b)}},[e==null?void 0:e.tokenName,e==null?void 0:e.index,e==null?void 0:e.clmmPool,d]),w=G(),y=()=>{setTimeout(async()=>{await m(r==null?void 0:r.address)},2e3)},{toStakePos:u,toUnStakePos:n,toClaimPos:h,unstakeLoading:x,claimLoading:l}=ae(),z=async s=>{console.log("ðŸš€ ~ toStake ~ apiInfo:",t),u(e,t==null?void 0:t.farmsPoolAddress,o,y)},p=async()=>{n(e==null?void 0:e.id,e==null?void 0:e.farmsPool,o,y)},E=async()=>{h(e==null?void 0:e.id,e==null?void 0:e.farmsPool,y)},S=C.useMemo(()=>(c==null?void 0:c.length)>0?c.reduce((s,b)=>j(s).plus(b==null?void 0:b.display_amount_owed).toString(),"0"):"0",[c,r==null?void 0:r.address,l,x]),H=C.useMemo(()=>e&&t?e.posType=="clmm"&&t.haveFarming===!0:!1,[e==null?void 0:e.posType,t==null?void 0:t.haveFarming]);return a.jsxs(k,{bg:"bg_primary",w:"100%",gap:"16px",borderRadius:{base:"12px",lg:"20px"},border:{base:"none",lg:"1px solid"},borderColor:"border !important",p:{base:"8px",lg:"12px"},justifyContent:"space-between",flexDirection:{base:"column",lg:"row"},children:[a.jsx(ce,{positionInfo:e,symbolEllipsesDecimals:10,labelInfo:{text:o,style:{color:"text_caption",mb:"-2px"}},children:a.jsxs(k,{justify:"center",h:{base:"14px",lg:"20px"},borderRadius:"4px",p:"0px",mb:{base:"0",lg:"-2px"},cursor:"pointer",onClick:s=>{D(s),w(`/position-detail/${e==null?void 0:e.id}`)},sx:{_hover:{p:{color:"text_caption"},svg:{fill:"text_caption"}}},children:[a.jsx(T,{fontSize:"12px",color:"primary",children:"Manage position"}),a.jsx(O,{ml:"-8px",svgW:"12px",svgH:"12px",xlinkHref:"#icon-icon_arrow",variant:"gray",transition:"transform 0.5s",transform:"rotate(-90deg)"})]})}),a.jsxs(k,{w:{base:"100%",lg:"unset"},gap:{base:"8px",lg:"40px"},flexDirection:{base:"column",lg:"row"},children:[a.jsxs(A,{w:{base:"100%",lg:"unset"},align:"flex-start",justify:"space-between",gap:"4px",flexDirection:{base:"row",lg:"column"},children:[a.jsx(T,{color:"primary_gray",mb:"-12px",mt:"12px",children:"Liquidity"}),a.jsx(ee,{positionInfo:e,fontSize:"14px"})]}),a.jsxs(A,{justify:"space-between",w:{base:"100%",lg:"unset"},minW:{base:"100%",lg:"180px"},align:"flex-end",gap:"4px",flexDirection:{base:"row",lg:"column"},children:[a.jsxs(k,{gap:"4px",children:[a.jsx(T,{color:"primary_gray",children:"Earnings"}),!v&&a.jsx(U,{isLoading:l,isDisabled:x||l||j(i).eq(0),onClick:x||l||j(i).eq(0)?()=>{}:E,h:"20px",w:"48px",fontSize:"12px",borderRadius:"4px",variant:"outline",children:"Claim"})]}),a.jsxs(k,{children:[a.jsx(V,{isLoaded:!!S,children:a.jsx(A,{align:"flex-end",children:c&&(c==null?void 0:c.length)>0&&j(S).gt(0)?c==null?void 0:c.map(s=>{var b;return console.log("ðŸš€ ~ ExpendItem ~ posFarmsData && posFarmsData?.length > 0 && d(totalAmount).gt(0) :",c,(c==null?void 0:c.length)>0,S,j(S).gt(0)),a.jsx(J.Fragment,{children:j(s==null?void 0:s.display_amount_owed).gt(0)&&a.jsx(W,{coinType:(b=s==null?void 0:s.token)==null?void 0:b.coin_type,amount:(s==null?void 0:s.display_amount_owed)||0,tokenInfo:s==null?void 0:s.token},s==null?void 0:s.coinType)},s==null?void 0:s.rewarder_type)}):((R=t==null?void 0:t.farmsRewarderList)==null?void 0:R.length)>0?(M=t==null?void 0:t.farmsRewarderList)==null?void 0:M.map(s=>(console.log("ðŸš€ ~ apiInfo?.farmsRewarderList?.map ~ item:",s),a.jsx(W,{coinType:s==null?void 0:s.coinType,amount:"0"},s==null?void 0:s.coinType))):a.jsx(T,{textColor:"text_caption",textAlign:"right",children:"--"})})}),v&&a.jsx(U,{isLoading:l,isDisabled:x||l||j(i).eq(0),onClick:x||l||j(i).eq(0)?()=>{}:E,h:"20px",w:"48px",fontSize:"12px",borderRadius:"4px",variant:"outline",children:"Claim"})]})]}),a.jsxs(A,{mt:{base:"8px",lg:"0"},w:{base:"100%",lg:"unset"},children:[(e==null?void 0:e.posType)=="farms"&&a.jsx(U,{isDisabled:x,isLoading:x,variant:"outline",w:{base:"100%",lg:"100px"},h:"32px",borderRadius:"8px",fontSize:"14px",onClick:p,children:"Unstake"}),H&&!L&&a.jsx(f,{placement:"top",tooltip:a.jsx(T,{fontSize:"12px",lineHeight:"20px",w:"200px",children:"Farming rewards are only available for active positions."}),children:a.jsx(U,{isDisabled:!0,borderRadius:"8px",w:{base:"calc(100vw - 68px)",lg:"100px"},h:"32px",fontSize:"14px",children:"Stake"})}),H&&L&&a.jsx(U,{isDisabled:x,isLoading:x,w:{base:"100%",lg:"100px"},h:"32px",borderRadius:"8px",fontSize:"14px",onClick:z,children:"Stake"})]})]})]})}const W=({coinType:e,amount:t,tokenInfo:g,boxStyle:P,textAlign:d="right"})=>{const{tokenInfo:m}=X(e);return a.jsxs(k,{...P,children:[a.jsx(Y,{token:g||m,coinType:e,imgBoxStyle:{w:"20px",h:"20px"},warningIcon:{iconW:"10px",iconH:"10px"},haveName:!1,haveSymbol:!1}),a.jsxs(T,{textColor:"text_caption",textAlign:d,children:[t," ",(g==null?void 0:g.symbol)||(m==null?void 0:m.symbol)]})]})};export{ie as E,W as R,ae as u};
//# sourceMappingURL=ExpendItem-ClLvPdQF.js.map
