import{j as e,V as z,T as D,r as f,M as pt,o as at,p as dt,$ as xt,a0 as Ze,q as mt,t as ut,H as q,B as Be,w as he,X as nt,n as Ut,S as Ke,L as Ht,ax as Vt,ao as vt,l as Pt,ac as Ve,ay as Gt,K as ur}from"./vendor-CBmAETR3.js";import{S as Zt}from"./SelectTokenAndFeeConfirm-BsMtMGIm.js";import{D as Kt}from"./DepositRatio-D2zurS6C.js";import{P as ve}from"./PoolTag-DVhitHGR.js";import{T as Xt}from"./TotalAmount-B2jkoq59.js";import{P as fr}from"./PositionStatus-CKFJf5Ct.js";import{d as Jt,g as Ge,b as Bt}from"./utils-CMHkC_9A.js";import{Q as Yt,d as ye,t as F,u as ke,bo as $e,bq as Oe,E as It,I as Te,B as Qt,M as Dt,z as V,w as _t,cU as qt,ah as qe,c9 as Ot,a5 as At,dQ as bt,m as je,g as Re,P as wt,v as Me,ad as hr,bn as $t,a as kt,j as Ce,f as Tt,l as be,aW as Ue,h as ot,Z as ct,L as gr,dR as er,e as Lt,aj as jr}from"./index-BpSfzecM.js";import{n as lt}from"./cross-DJ28FxNa.js";import{T as yr}from"./TradeConfirmAmountInfo-C8pVFbTE.js";import{u as zt}from"./useTokenBalance-c3RAkCCY.js";import{T as Cr}from"./TradeInputGroup-C0B6uidS.js";import{D as Sr,u as tr,a as wr}from"./useDlmmPreCalc-CMnCKdw4.js";import{P as Et}from"./PriceInput-CVvMrCd6.js";import{b as _r,u as rr}from"./useCreatePoolHelper-DDo1nSpS.js";import{E as Nt}from"./ErrorTips-lJshH5MT.js";import{I as ir}from"./InputBox-DUnOULwS.js";import{C as Ft,S as or,a as Ar}from"./SelectPoolType-BqSI37X_.js";import{u as sr}from"./useTransaction-uEos3ZjK.js";import{u as Le}from"./useCreatePool-CDFSrv9X.js";import{c as br,d as vr}from"./config-DTm0VBgZ.js";import{u as ft}from"./useAccountBalance-DV0qM_Vy.js";import{u as Pr}from"./index-CbQm3ih3.js";import{u as Ir}from"./usePreviousValue-Da-o2xpb.js";import{u as nr}from"./swapWidget-DsvWJZa9.js";import{R as cr}from"./RefreshButton-bgRHxGzR.js";import{h as He}from"./dlmm-DdxfaipV.js";import{u as Dr}from"./useCreatePriceBin-bOk7VAIh.js";import{i as Wt}from"./index-gw6wWhzj.js";import{u as Fr}from"./SelectToken-COX6g62D.js";import"./HTextLabelBox-D0r99Smv.js";import"./WithTooltipInfo-Vqx8IrEo.js";import"./icon_active_new@2x-Bekkt6Xc.js";import"./useWrapPoolData-CMGMCXwG.js";import"./en_US-KAK2ZBDO-C1Pw6Q2s.js";import"./_baseClone-B759QteI.js";import"./_getAllKeysIn-Juzb7Mj8.js";import"./_defineProperty-Bpc363rP.js";import"./last-CxFZ9vay.js";import"./index-C7OfScvw.js";import"./addDlmmLiquidity-BTnvpcHs.js";import"./ActionButton-1ExqaF95.js";import"./usePosAdd-DG3IUn6t.js";import"./msafe-BzcjPV-e.js";import"./useGetDlmmPoolList-DgjXNLvP.js";import"./useGetPoolList-4kFQ2tyG.js";import"./index-BTngaqMa.js";import"./CetusMenu-D6ll9Vbb.js";import"./useDocumentSize-BLl0gbMB.js";import"./maxBy-BjNHtTns.js";import"./icon_clmm-sLI9GHAc.js";import"./icon_dlmm-BKyFDzFK.js";import"./CheckBox-eomO844M.js";import"./useTrack-Cdn9qear.js";import"./v4-C6aID195.js";import"./useSigner-Ct94kXtL.js";import"./useTransactionModal-DL7w_I3R.js";import"./debounce-MPJy35Ge.js";import"./index-D8UqOC8m.js";import"./YAxis-DLEZvSSr.js";import"./generateCategoricalChart-CmRMqbFo.js";import"./BarChart-3cDt1x1m.js";import"./objectSpread2-B-AaJtUa.js";import"./index-S9fozw96.js";import"./Loading-DOvYGudd.js";import"./TooltipIcon-DVhxXZmh.js";function Mt({title:p,price:a,perText:x}){return e.jsxs(z,{flex:"1",children:[e.jsx(D,{children:p}),e.jsx(D,{color:"text_caption",children:a}),e.jsx(D,{children:x})]})}function Rr(p){const{isOpen:a,onClose:x,onSubmit:c,data:r}=p,{baseToken:t,quoteToken:i,feeDisplay:h,baseAmount:d,quoteAmount:o,isReverse:g,initPrice:n,minPrice:y,maxPrice:m,isFullRange:v}=r,[I,S]=f.useState(!0);console.log("ðŸš€ ~ file: CreateConfirmModal.tsx:49 ~ CreateConfirmModal ~ data:",r,I);const{getTokenAmountValue:R}=Yt(),j=R(t==null?void 0:t.coin_type,d),M=R(i==null?void 0:i.coin_type,o),G=f.useMemo(()=>ye(j||"0").plus(M||"0").toString(),[j,M]),E=f.useMemo(()=>Jt(d,o,n,v),[d,o]),K=f.useMemo(()=>I?`${F(i==null?void 0:i.symbol)} per ${F(t==null?void 0:t.symbol)}`:`${F(t==null?void 0:t.symbol)} per ${F(i==null?void 0:i.symbol)}`,[I,t==null?void 0:t.symbol,i==null?void 0:i.symbol]),U=f.useMemo(()=>v?"0":g?I?y==null?void 0:y.displayReversePrice:m.displayPrice:I?y==null?void 0:y.displayPrice:m.displayReversePrice,[I]),l=f.useMemo(()=>v?"âˆž":g?I?m==null?void 0:m.displayReversePrice:y.displayPrice:I?m==null?void 0:m.displayPrice:y.displayReversePrice,[I]),s=v||(g?ye(y==null?void 0:y.reversePrice).lte(n)&&ye(m==null?void 0:m.reversePrice).gte(n):ye(y==null?void 0:y.price).lte(n)&&ye(m==null?void 0:m.price).gte(n)),{isApp:te}=ke();return e.jsxs(pt,{autoFocus:!1,returnFocusOnClose:!1,isOpen:a,onClose:x,isCentered:!0,children:[e.jsx(at,{}),e.jsxs(dt,{children:[e.jsx(xt,{children:e.jsx(Ze,{fontWeight:"500",fontSize:"16px",children:"Preview"})}),e.jsx(mt,{}),e.jsx(ut,{textAlign:"center",p:"0px",children:e.jsxs(z,{w:"100%",gap:"20px",p:"8px 16px",pb:"0px",children:[te?e.jsxs(q,{w:"100%",h:"40px",children:[e.jsx($e,{coinACoinType:t==null?void 0:t.coin_type,coinBCoinType:i==null?void 0:i.coin_type,coinAIconUrl:t==null?void 0:t.logo_url,coinBIconUrl:i==null?void 0:i.logo_url,imageStyle:{w:"40px",h:"40px"},imgBoxStyle:{w:"40px",h:"40px"}}),e.jsxs(z,{gap:"4px",align:"flex-start",children:[e.jsx(D,{fontSize:"16px",color:"text_caption",children:`${F(t==null?void 0:t.symbol)} - ${F(i==null?void 0:i.symbol)}`}),e.jsx(ve,{poolType:"clmm",displayFee:h})]})]}):e.jsxs(q,{w:"100%",justifyContent:"space-between",h:"40px",children:[e.jsxs(q,{children:[e.jsx($e,{coinACoinType:t==null?void 0:t.coin_type,coinBCoinType:i==null?void 0:i.coin_type,coinAIconUrl:t==null?void 0:t.logo_url,coinBIconUrl:i==null?void 0:i.logo_url,imageStyle:{w:"40px",h:"40px"},imgBoxStyle:{w:"40px",h:"40px"}}),e.jsx(D,{fontSize:"16px",color:"text_caption",children:`${F(t==null?void 0:t.symbol)} - ${F(i==null?void 0:i.symbol)}`})]}),e.jsx(ve,{poolType:"clmm",displayFee:h})]}),e.jsx(yr,{coinA:{amount:d,...t},coinB:{amount:o,...i}}),e.jsxs(Be,{w:"100%",children:[e.jsxs(q,{w:"100%",justify:"space-between",h:"32px",children:[e.jsx(D,{fontSize:"16px",fontWeight:"500",color:"text_caption",children:"Selected Range"}),e.jsx(fr,{isActive:s,isRow:!0,imgStyle:{imgW:"29px",imgH:"16px"},w:"105px",h:"32px"})]}),e.jsxs(q,{justify:"center",bg:"bg_secondary",borderRadius:"8px",h:"48px",w:"100%",gap:"4px",mt:"12px",children:[e.jsx(D,{children:"Current Price"}),e.jsx(D,{as:"span",color:"text_caption",children:Oe(I?n:It(ye(1).div(n).toFixed(18),18,!0).toString(),18)}),e.jsx(D,{children:K}),e.jsx(he,{variant:"unstyled",onClick:()=>S(!I),children:e.jsx(Te,{xlinkHref:"#icon-icon_swap1"})})]}),e.jsxs(q,{w:"100%",h:"100px",bg:"bg_secondary",borderRadius:"12px",mt:"8px",children:[e.jsx(Mt,{title:"Min Price",price:U,perText:K}),e.jsx(nt,{orientation:"vertical",h:"40px"}),e.jsx(Mt,{title:"Max Price",price:l,perText:K})]})]}),e.jsx(Kt,{tokenA:t,tokenB:i,percentMap:E,type:"text"}),e.jsx(Xt,{totalAmount:G}),e.jsx(he,{w:"calc(100% + 32px)",bottom:"0px",mt:"4px",h:"52px",borderRadius:"12px",fontSize:"16px",fontWeight:"500",onClick:c,children:"Create and Add Liquidity"})]})})]})]})}function Br(p){const{isOpen:a,onClose:x,data:c}=p,{baseToken:r,quoteToken:t,feeDisplay:i}=c;return e.jsxs(pt,{autoFocus:!1,returnFocusOnClose:!1,isOpen:a,onClose:x,isCentered:!0,children:[e.jsx(at,{}),e.jsxs(dt,{children:[e.jsx(xt,{}),e.jsx(mt,{}),e.jsx(ut,{children:e.jsx(z,{gap:"8px",pb:"8px",pt:"28px",w:"100%",children:e.jsxs(z,{gap:"8px",children:[e.jsx(Ut,{src:"/images/img_transactionsuccess@2x.png",w:"200px",h:"200px",alt:"icon"}),e.jsxs(z,{mt:"-155px",gap:"10px",children:[e.jsxs(q,{children:[e.jsx($e,{coinACoinType:r==null?void 0:r.coin_type,coinBCoinType:t==null?void 0:t.coin_type,coinAIconUrl:r==null?void 0:r.logo_url,coinBIconUrl:t==null?void 0:t.logo_url,imageStyle:{w:"24px",h:"24px"},imgBoxStyle:{w:"24px",h:"24px"}}),e.jsx(D,{fontSize:"14px",color:"text_caption",children:`${r==null?void 0:r.symbol} - ${t==null?void 0:t.symbol}`})]}),e.jsx(ve,{poolType:"clmm",displayFee:i||"--"})]}),e.jsx(Qt,{mt:"80px",borderRadius:"16px",padding:"16px",children:e.jsx(D,{color:"primary_gray",fontSize:"12px",lineHeight:"20px",children:"The pool has been created. It will usually take up to 3 min for a new pool to be presented in front end interface. Thanks for creating this pool"})}),e.jsx(he,{mt:"16px",fontSize:"14px",w:"100%",onClick:()=>{x()},children:"OK"})]})})})]})]})}function Or(p,a,x,c,r,t){const{currentAccount:i}=Dt(),h=f.useMemo(()=>{const d={text:"Create",disabled:!1};return i!=null&&i.address?!p||!a||p&&!+p||a&&!+a?(d.text="Enter an amount",d.disabled=!0,d):p&&+p&&ye(p).gt((r==null?void 0:r.balanceFormat)||0)?(d.disabled=!0,d.text=`Insufficient ${F(x==null?void 0:x.symbol)} Balance`,d):a&&+a&&ye(a).gt((t==null?void 0:t.balanceFormat)||0)?(d.disabled=!0,d.text=`Insufficient ${F(c==null?void 0:c.symbol)} Balance`,d):((!p||!a)&&(d.disabled=!0),d):(d.text="Connect Wallet",d.disabled=!1,d)},[i==null?void 0:i.address,p,a,r==null?void 0:r.balanceDisplay,t==null?void 0:t.balanceDisplay,x==null?void 0:x.coin_type,c==null?void 0:c.coin_type]);return{btnText:h.text,btnDisabled:h.disabled}}function $r({currentStep:p,editStep:a,onCreate:x,baseToken:c,quoteToken:r,baseAmount:t,quoteAmount:i,onBaseAmountChange:h,onQuoteAmountChange:d,isReverse:o,percentMap:g}){const{balanceInfo:n}=zt(c),{balanceInfo:y}=zt(r),{btnText:m,btnDisabled:v}=Or(t,i,c,r,n,y),{fetchTokenPrices:I,getTokenAmountValue:S}=Yt(),R=()=>{const E=[];c!=null&&c.coin_type&&E.push(c==null?void 0:c.coin_type),r!=null&&r.coin_type&&E.push(r==null?void 0:r.coin_type),E.length>0&&I(E)};f.useEffect(()=>{R()},[c==null?void 0:c.coin_type,r==null?void 0:r.coin_type]);const j=S(c==null?void 0:c.coin_type,t),M=S(r==null?void 0:r.coin_type,i),G=f.useMemo(()=>{if(+j&&+M)return V(j||"0").plus(M||"0").toString()},[j,M]);return e.jsx(e.Fragment,{children:p===4&&a===4?e.jsxs(z,{w:"100%",gap:"12px",bg:"bg_fifth",borderRadius:"12px",p:{base:"16px 8px",lg:"32px"},align:"flex-start",children:[e.jsx(Ze,{fontSize:"16px",fontWeight:"500",children:"Deposit amounts"}),e.jsx(Cr,{wrapStyle:{mt:"4px"},from:{wrapStyle:{h:"108px"},balance:(n==null?void 0:n.balanceFormat)||"",value:t,amountValue:j,loading:!1,onChange:E=>{h(E)},selectable:!1,placeholder:"0.0",token:c},to:{wrapStyle:{h:"108px"},balance:(y==null?void 0:y.balanceFormat)||"",value:i,amountValue:M,loading:!1,onChange:E=>{d(E)},selectable:!1,placeholder:"0.0",token:r}}),e.jsxs(z,{gap:"16px",w:"100%",border:"1px solid",borderColor:"border",borderRadius:"16px",p:{base:"16px 8px",lg:"16px"},children:[e.jsx(Xt,{totalAmount:G}),e.jsx(Kt,{tokenA:c,tokenB:r,percentMap:g,isReverse:o,type:"image"})]}),e.jsx(he,{w:"100%",onClick:x,h:"48px",fontSize:"16px",borderRadius:"12px",isDisabled:v,children:m})]}):null})}function Lr({poolType:p,...a}){return p==="dlmm"&&"minPriceData"in a?e.jsx(Sr,{...a}):e.jsx($r,{...a})}const zr=[{label:"Full Range"},{label:"Custom Range"}];function Er({editStep:p,currTick:a,currentStep:x,onEdit:c,onContinue:r,displayBaseToken:t,displayQuoteToken:i,initPrice:h,onInitPriceChange:d,displayMinPrice:o,onMinPriceChange:g,displayMaxPrice:n,onMaxPriceChange:y,isFullRange:m,isReverse:v,handleRangeModeChange:I,handleSwitchDirectionChange:S,handlePriceAction:R}){const[j,M]=f.useState("Full Range"),{isApp:G}=ke(),E=f.useMemo(()=>o?[o.tokenA,o.tokenB].filter(Boolean).map(_=>({label:_==null?void 0:_.symbol,isToken:!0,imgInfo:{src:_==null?void 0:_.logo_url,w:"16px",h:"16px",borderRadius:"50%",fallbackSrc:"/images/placeholder-token@2x.png"}})):[],[o==null?void 0:o.tokenA,o==null?void 0:o.tokenB]),K=f.useMemo(()=>`${F(i==null?void 0:i.symbol)} per ${F(t==null?void 0:t.symbol)}`,[t==null?void 0:t.symbol,i==null?void 0:i.symbol]),U=f.useMemo(()=>{var _;return m?!0:((_=o==null?void 0:o.tokenA)==null?void 0:_.coin_type)===(t==null?void 0:t.coin_type)},[m,o==null?void 0:o.tokenA,o==null?void 0:o.tokenB,t==null?void 0:t.coin_type]),{showInputPriceWarn:l,showPriceRangeWarn:s}=_r(m,a,v?n.tick:o.tick,v?o.tick:n.tick),te=f.useMemo(()=>(o==null?void 0:o.price)==="0"&&(n==null?void 0:n.price)==="âˆž",[o==null?void 0:o.price,n==null?void 0:n.price]),Y=f.useMemo(()=>!+h&&!m,[h,m]);return e.jsx(e.Fragment,{children:x>=3?p===3||x===3?e.jsxs(z,{w:"100%",gap:"32px",bg:"bg_fifth",borderRadius:"12px",p:{base:"16px 8px",lg:"32px"},children:[e.jsxs(z,{gap:"8px",w:"100%",align:"flex-start",children:[e.jsx(Ze,{fontSize:"16px",fontWeight:"500",children:"Set initial price"}),e.jsxs(Ke,{flexDir:{base:"column",lg:"row"},w:"100%",justify:"space-between",mt:"-2px",alignItems:{base:"flex-start",lg:"center"},children:[e.jsx(D,{fontSize:"12px",children:"Please set an initial price for this new pool to start."}),e.jsx(_t,{type:"outlineTab",tabList:E,currentTab:t==null?void 0:t.symbol,handleChangeTab:_=>{_.label!==(t==null?void 0:t.symbol)&&S()},wrapStyle:{w:{base:"100%",lg:"auto"},h:"32px",p:"3px",border:"1px solid",borderColor:"border",borderRadius:"8px",gap:"4px"},itemStyle:{flex:1,h:"24px",p:"4px 12px",borderRadius:"4px",gap:"4px"}})]}),e.jsx(ir,{mt:"4px",h:"48px",borderRadius:"12px",p:"16px",children:e.jsxs(Ht,{fontFamily:"Inter",justifyContent:"space-between",gap:"12px",children:[e.jsx(qt,{value:h?Oe(h,18):"",onChange:_=>{d==null||d(_)},placeholder:"0.0",inputAllowed:!0,decimals:18,style:{width:"calc(100% - 8px)",background:"none",whiteSpace:"nowrap",opacity:1,outline:"none",color:"var(--chakra-colors-text_caption)",fontSize:"16px",fontWeight:"500",height:"14px",lineHeight:"20px",touchAction:"manipulation",transition:"all 0.3s"}}),e.jsx(Vt,{children:e.jsx(D,{children:K})})]})}),h&&e.jsxs(q,{h:"20px",w:"100%",children:[e.jsxs(D,{color:"text_caption",fontSize:"12px",children:["Current Price: 1 ",F(t==null?void 0:t.symbol)," = ",qe(Oe(h,18))," ",F(i==null?void 0:i.symbol)]}),e.jsx(Te,{w:"16px",h:"16px",svgW:"16px",svgH:"16px",xlinkHref:"#icon-icon_swap1",fontSize:"12px",onClick:S})]})]}),e.jsxs(z,{w:"100%",align:"flex-start",gap:"12px",children:[e.jsx(Ze,{fontSize:"16px",fontWeight:"500",children:"Set price range"}),e.jsx(D,{fontSize:"12px",children:"Please specify a price range that you want to provide your liquidity within."}),e.jsx(_t,{type:"outlineTab",tabList:zr,currentTab:m?"Full Range":"Custom Range",handleChangeTab:_=>{M(_==null?void 0:_.label),I((_==null?void 0:_.label)==="Full Range")},wrapStyle:{w:"100%",h:"40px",p:"3px",border:"1px solid",borderColor:"border",borderRadius:"12px",gap:"4px"},itemStyle:{flex:"1",h:"32px",p:"8px",borderRadius:"8px",fontSize:"14px"}}),e.jsxs(Ke,{mt:"4px",position:"relative",flexDir:{base:"column",lg:"row"},w:"100%",gap:{base:"8px",lg:"16px"},children:[e.jsx(Be,{opacity:Y?0:1,w:{base:"100%",lg:"50%"},children:e.jsx(Et,{title:"Min Price",perText:K,data:o,direct:U,loading:!1,handleAddPrice:_=>R("Add",_),handleSubPrice:_=>R("Sub",_),setTickDataBasedOnPrice:g,isFullRange:te})}),e.jsx(Be,{opacity:Y?0:1,w:{base:"100%",lg:"50%"},children:e.jsx(Et,{title:"Max Price",perText:K,data:n,direct:U,loading:!1,handleAddPrice:_=>R("Add",_),handleSubPrice:_=>R("Sub",_),setTickDataBasedOnPrice:y,isFullRange:te})}),!+h&&!m&&e.jsx(Ot,{position:"absolute",top:"0px",left:"0",w:"100%",h:"80px",borderRadius:"12px",text:""}),G&&!+h&&!m&&e.jsx(Ot,{position:"absolute",top:"88px",left:"0",w:"100%",h:"80px",borderRadius:"12px",text:""})]}),!m&&l&&!s&&e.jsx(Nt,{p:"8px 16px",w:"100%",isShowIcon:!1,type:"warning",borderRadius:"8px",tipsFontSize:"12px",tipsLineHeight:"16px",tips:"To create a new pool, the initial price you set must be within your price range."}),!m&&s&&e.jsx(Nt,{isShowIcon:!1,tipsFontSize:"12px",justifyContent:"center",tips:"The max price should be higher than min price.",p:"0 16px",h:"28px",borderRadius:"8px"}),e.jsx(he,{mt:"4px",w:"100%",onClick:r,isDisabled:!h||!+h||!o.price||!n.price||l||s,h:"48px",fontSize:"16px",borderRadius:"12px",children:!h||!+h?"Enter initial price":"Continue"})]})]}):e.jsx(Ft,{onEdit:c,children:e.jsxs(z,{gap:"12px",align:"flex-start",children:[e.jsxs(q,{children:[e.jsx(D,{whiteSpace:"nowrap",children:"Initial Price"}),e.jsx(D,{color:"text_caption",fontWeight:"500",children:`${Oe(h,18)} ${K}`})]}),e.jsxs(q,{children:[e.jsx(D,{whiteSpace:"nowrap",children:"Price Range"}),e.jsxs(D,{color:"text_caption",fontWeight:"500",children:[m?"0 - âˆž":`${v?o.displayReversePrice:o==null?void 0:o.displayPrice} - ${v?n==null?void 0:n.displayReversePrice:n==null?void 0:n.displayPrice} `," ",`${K}`," "]})]})]})}):null})}function Nr({editStep:p,currentStep:a,onEdit:x,onContinue:c,baseToken:r,quoteToken:t,initPrice:i,onInitPriceChange:h}){ke();const[d,o]=f.useState(!0),g=()=>{o(!d)},n=f.useMemo(()=>d?`${F(t==null?void 0:t.symbol)} per ${F(r==null?void 0:r.symbol)}`:`${F(r==null?void 0:r.symbol)} per ${F(t==null?void 0:t.symbol)}`,[r==null?void 0:r.symbol,t==null?void 0:t.symbol,d]),y=f.useMemo(()=>r&&t?[r,t].filter(Boolean).map(m=>({label:m==null?void 0:m.symbol,isToken:!0,imgInfo:{src:m==null?void 0:m.logo_url,w:"16px",h:"16px",borderRadius:"50%",fallbackSrc:"/images/placeholder-token@2x.png"}})):[],[r,t]);return e.jsx(e.Fragment,{children:a>=3?p===3||a===3?e.jsxs(z,{w:"100%",gap:"32px",bg:"bg_fifth",borderRadius:"12px",p:{base:"16px 8px",lg:"32px"},children:[e.jsxs(z,{gap:"8px",w:"100%",align:"flex-start",children:[e.jsx(Ze,{fontSize:"16px",fontWeight:"500",children:"Set initial price"}),e.jsxs(Ke,{flexDir:{base:"column",lg:"row"},w:"100%",justify:"space-between",mt:"-2px",alignItems:{base:"flex-start",lg:"center"},children:[e.jsx(D,{fontSize:"12px",children:"Please set an initial price for this new pool to start"}),e.jsx(_t,{type:"outlineTab",tabList:y,currentTab:d?r==null?void 0:r.symbol:t==null?void 0:t.symbol,handleChangeTab:m=>{g()},wrapStyle:{w:{base:"100%",lg:"auto"},h:"32px",p:"3px",border:"1px solid",borderColor:"border",borderRadius:"8px",gap:"4px"},itemStyle:{flex:1,h:"24px",p:"4px 12px",borderRadius:"4px",gap:"4px"}})]}),e.jsx(ir,{mt:"4px",h:"48px",borderRadius:"12px",p:"16px",children:e.jsxs(Ht,{fontFamily:"Inter",justifyContent:"space-between",gap:"12px",children:[e.jsx(qt,{value:i?At(Oe(d?i:Ge(i),18),18):"",onChange:m=>{h==null||h(d?m:bt(m)?Ge(m):"")},placeholder:"0.0",inputAllowed:!0,decimals:18,style:{width:"calc(100% - 8px)",background:"none",whiteSpace:"nowrap",opacity:1,outline:"none",color:"var(--chakra-colors-text_caption)",fontSize:"16px",fontWeight:"500",height:"14px",lineHeight:"20px",touchAction:"manipulation",transition:"all 0.3s"}}),e.jsx(Vt,{gap:"4px",children:e.jsx(D,{children:n})})]})})]}),e.jsx(z,{w:"100%",align:"flex-start",gap:"12px",children:e.jsx(he,{mt:"4px",w:"100%",onClick:c,isDisabled:!i||!+i,h:"48px",fontSize:"16px",borderRadius:"12px",fontWeight:"500",children:!i||!+i?"Enter initial price":"Create"})})]}):e.jsx(Ft,{onEdit:x,children:e.jsx(z,{gap:"12px",align:"flex-start",children:e.jsxs(q,{children:[e.jsx(D,{whiteSpace:"nowrap",children:"Initial price"}),e.jsx(D,{color:"text_caption",fontWeight:"500",children:`${At(Oe(d?i:Ge(i),18),18)} ${n}`})]})})}):null})}function lr({poolType:p,...a}){return p==="clmm"&&"isReverse"in a?e.jsx(Er,{...a}):e.jsx(Nr,{...a})}const Wr={clmm:{2:"Select token & fee tier"},dlmm:{2:"Select token & base fee"}};function pr({currentStep:p,handleStepClick:a,totalStep:x,poolType:c}){const{isApp:r}=ke();return e.jsxs(Ke,{flexDir:{base:"row",lg:"column"},gap:"12px",flex:{base:"1",lg:"0 0 258px"},w:{base:"100%",lg:"258px"},p:{base:"12px",lg:"32px"},justify:"center",align:{base:"center",lg:"flex-start"},bg:"bg_fifth",borderRadius:"12px",children:[e.jsx(st,{step:1,title:"Select pool type",isActive:p>=1,handleStepClick:a}),x>=2&&e.jsxs(e.Fragment,{children:[e.jsx(Be,{w:"32px",h:{base:"1px",lg:"32px"},children:e.jsx(nt,{orientation:r?"horizontal":"vertical",ml:{base:"0",lg:"16px"}})}),e.jsx(st,{step:2,title:Wr[c][2],isActive:p>=2,handleStepClick:a})]}),x>=3&&e.jsxs(e.Fragment,{children:[e.jsx(Be,{w:"32px",h:{base:"1px",lg:"32px"},children:e.jsx(nt,{orientation:r?"horizontal":"vertical",ml:{base:"0",lg:"16px"}})}),e.jsx(st,{step:3,title:"Set initial price",isActive:p>=3,handleStepClick:a})]}),x>=4&&e.jsxs(e.Fragment,{children:[e.jsx(Be,{w:"32px",h:{base:"1px",lg:"32px"},children:e.jsx(nt,{orientation:r?"horizontal":"vertical",ml:{base:"0",lg:"16px"}})}),e.jsx(st,{step:4,title:"Deposit your amount",isActive:p>=4})]})]})}function st({step:p,title:a,isActive:x,handleStepClick:c}){return e.jsxs(q,{w:{base:"32px",lg:"100%"},cursor:c&&x?"pointer":"unset",onClick:()=>{c&&x&&c(p)},children:[e.jsx(Be,{as:"div",flex:"0 0 32px",h:"32px",lineHeight:"32px",textAlign:"center",border:"1px solid",fontSize:"12px",fontWeight:"500",color:x?"text_highlight":"text_paragraph",borderColor:"border",borderRadius:"8px",bg:x?"primary_disabled":"transparent",children:p}),e.jsxs(z,{align:"flex-start",display:{base:"none",lg:"flex"},children:[e.jsxs(D,{fontSize:"14px",color:x?"text_caption":"text_paragraph",fontWeight:"500",children:["Step Â ",p]}),e.jsx(D,{fontSize:"12px",color:x?"primary":"text_paragraph",fontWeight:"500",children:a})]})]})}function Mr(){const p=(r,t,i,h,d)=>{const o=i.decimals,g=h.decimals;let n;Math.abs(r)==Math.abs(je.getMinIndex(d))?n=t==="lower"?"0":"âˆž":n=Re.tickIndexToPrice(r,o,g).toString();const y=n==="âˆž"?"âˆž":Me(n,6).toString(),m=Ge(n),v=m==="âˆž"?"âˆž":Me(m,6).toString();return{id:t,tokenA:i,tokenB:h,tick:r,price:n,displayPrice:y,reversePrice:m,displayReversePrice:v,tickSpacing:d.toString(),pool:"1"}},a=(r,t)=>{const i=r.tokenA,h=r.tokenB;if(!i||!h||t.length===0)return;let d,o="";if(t==="âˆž")d=je.getMaxIndex(Number(r.tickSpacing)),o="âˆž";else if(V(t).equals(0))d=je.getMinIndex(Number(r.tickSpacing)),o="0";else if(V(t).gt(0)){const m=Re.priceToTickIndex(V(t),i.decimals,h.decimals);d=wt(Number(m),Number(r.tickSpacing)),o=Re.tickIndexToPrice(Number(d),i.decimals,h.decimals).toString()}const g=o==="âˆž"?"âˆž":Me(o,6),n=Ge(o),y=n==="âˆž"?"âˆž":Me(n,6);if(d!==void 0)return{...r,tick:d,price:o,displayPrice:g.toString(),reversePrice:n,displayReversePrice:y.toString()}},x=(r,t="Add")=>{const{tokenA:i,tokenB:h,tick:d,tickSpacing:o}=r;if(i&&h&&o){const g=t==="Add"?V(d).add(o).toNumber():V(d).sub(o).toNumber();if(V(g).gt(je.getMaxIndex(Number(r.tickSpacing)))||V(g).lt(je.getMinIndex(Number(r.tickSpacing))))return;const n=Re.tickIndexToPrice(g,i.decimals,h.decimals).toString(),y=n==="âˆž"?"âˆž":Me(n,6);if(y===r.displayPrice){const m=Number(r.tickSpacing)<20?40:1;return x({...r,tick:t==="Add"?V(d).add(Number(o)*m).toNumber():V(d).sub(Number(o)*m).toNumber()},t)}else{const m=Ge(n),v=m==="âˆž"?"âˆž":Me(m,6);return{id:r.id,tick:g,price:n.toString(),displayPrice:y.toString(),reversePrice:m.toString(),displayReversePrice:v.toString(),tokenA:i,tokenB:h,tickSpacing:o,pool:"1"}}}};return{calcInitPriceRange:(r,t,i,h,d,o,g)=>{console.log("ðŸš€ ~ file: useCreatePriceRange.ts:84 ~ useCreatePriceRange ~ calcInitPriceRange:",{tickSpacing:i,baseToken:h,quoteToken:d});try{if(i&&h&&d){const n=je.getMaxIndex(i),y=je.getMinIndex(i);if(r){const m={id:"lower",tokenA:h,tokenB:d,tick:y,price:"0",displayPrice:"0",reversePrice:"âˆž",displayReversePrice:"âˆž",tickSpacing:i.toString(),pool:new Date().getTime().toString()},v={id:"upper",tokenA:h,tokenB:d,tick:n,price:"âˆž",displayPrice:"âˆž",reversePrice:"0",displayReversePrice:"0",tickSpacing:i.toString(),pool:new Date().getTime().toString()};if(t&&+t){const I=Re.priceToTickIndex(V(t),h.decimals,d.decimals);return{minData:m,maxData:v,currTick:I}}return{minData:m,maxData:v,currTick:void 0}}else if(t&&+t){const m=Re.priceToTickIndex(V(t),h.decimals,d.decimals),v=o||wt(Number(m-i*5),Number(i));v<y&&(o=y);const I=g||wt(Number(m+i*5),Number(i));I>n&&(g=n);const S=p(v,"lower",h,d,i),R=p(I,"upper",h,d,i);return{minData:S,maxData:R,currTick:m}}}}catch(n){console.log("ðŸš€ ~ file: useCreatePriceRange.ts:228 ~ useCreatePriceRange ~ error:",n)}},handleActionPrice:x,updateTickDataBasedOnPrice:a}}function Ur(p,a){const{fee:x}=vt(),[c,r]=f.useState(void 0),[t,i]=f.useState([]),{signAndExecuteTransaction:h,transactionConfirmation:d,transactionRejected:o}=sr(),{fetchAccountBalance:g}=ft(),{preAddPool:n,fetchFeeTierList:y,getCreatePoolTxPayload:m}=rr(),{setCurrentStep:v,setEditStep:I,displayBaseToken:S,setDisplayBaseToken:R,displayQuoteToken:j,setDisplayQuoteToken:M,baseToken:G,quoteToken:E,backToStepOne:K}=Le(),[U,l]=f.useState(!0);f.useEffect(()=>{g()},[]);const[s,te]=f.useState(""),[Y,_]=f.useState(!0),[O,ge]=f.useState({}),[Z,oe]=f.useState({}),[Pe,N]=f.useState(),[pe,W]=f.useState(void 0),[ae,H]=f.useState(void 0),{calcInitPriceRange:me,handleActionPrice:ne,updateTickDataBasedOnPrice:ue}=Mr(),[T,le]=f.useState(""),[ce,k]=f.useState(""),ie=f.useCallback(()=>{var C;G&&E?y(G.coin_type,E.coin_type).then(P=>{i(P==null?void 0:P.map(Q=>({...Q,title:(Q==null?void 0:Q.title)!=="Not Created"?"Created":"Not Created"})));const b=P.filter(Q=>Q.poolAddress===void 0),$=b.find(Q=>Q.feeRate===x)||b.find(Q=>Q.feeRate==="25")||(b.length>0?b[0]:void 0)||(P.length>0?P[0]:void 0);$&&de($)}):(i((C=br)==null?void 0:C.map(P=>({...P,title:""}))),r(void 0))},[G==null?void 0:G.coin_type,E==null?void 0:E.coin_type]);f.useEffect(()=>{ie()},[ie]);const Ie=(C,P=!0)=>{Ee(2),a(C,P)},de=C=>{r(C),v(2),Ne(),fe(!0)},Xe=()=>{const C=S;if(R(j),M(C),+s){const b=It(V(1).div(s).toFixed(18),18,!0).toString();te(b)}};f.useEffect(()=>{ee(Y)},[s,c==null?void 0:c.tickSpacing]);const ee=(C,P,b)=>{we();const $=me(C,s&&+s?p?(1/Number(s)).toString():s:"",Number((c==null?void 0:c.tickSpacing)||0),p?j:S,p?S:j,P,b);console.log("ðŸš€ ~ handleInitPriceRange ~ data:",$),$?(oe($.maxData),ge($.minData),N($.currTick)):N(void 0)};f.useMemo(()=>{if(c&&S&&j)return Re.tickIndexToPrice(je.getMaxIndex(20),6,6).toFixed(9,hr.ROUND_DOWN)},[c==null?void 0:c.tickSpacing,S==null?void 0:S.decimals,j==null?void 0:j.decimals]);const Je=C=>{te(C)},fe=(C,P,b)=>{_(C),we(),ee(C,P,b)},Se=f.useMemo(()=>Y?O:p?Z:O,[Y,O,Z,p]),xe=f.useMemo(()=>Y?Z:p?O:Z,[Y,O,Z,p]),A=(C,P)=>{we();const b=ne(P,C);b&&((b==null?void 0:b.id)===(O==null?void 0:O.id)?ge(b):oe(b))},ht=Ir(Y),X=(C,P,b)=>{const $=ue(C,P);if($){$.pool=new Date().getTime().toString();let Q=O==null?void 0:O.tick,_e=Z==null?void 0:Z.tick;$.id==="lower"?(ge({...$}),Q=$.tick):(oe({...$}),_e=$.tick),Q!==void 0&&_e!==void 0&&c?ht&&(je.getMaxIndex(Number(c.tickSpacing))!==_e||je.getMinIndex(Number(c.tickSpacing))!==Q?fe(!1):fe(!0)):fe(!1,Q,_e)}else fe(!1)},ze=(C,P)=>{l(P),P?le(C):k(C);const b=De(C,P);b?(H(b),P?k(p?b.coinAmountA:b.coinAmountB):le(p?b.coinAmountB:b.coinAmountA)):(P?k(""):le(""),H(void 0))},Ee=C=>{C===1?(K("clmm"),te(""),fe(!0),we()):C===2?(v(2),I(2),te(""),fe(!0),we()):C===3?(v(3),I(3),we()):(v(4),I(4))},De=(C,P,b)=>{if(j&&S&&s&&c&&C&&+C&&(O!=null&&O.price)&&(Z!=null&&Z.price))try{const $=n({realTokenA:p?j:S,realTokenB:p?S:j,needReverse:O.tokenA.coin_type!==S.coin_type,tickSpacing:Number(c.tickSpacing),amount:C,amountCoinType:P?S.coin_type:j.coin_type,maxPrice:Y?Z.price:p?O.reversePrice:Z.price,minPrice:Y?O.price:p?Z.reversePrice:O.price,price:p?V(1).div(s).toString():s});return console.log("ðŸš€ ~ file: useCreatePool.ts:212 ~ handleAmountChange ~ res:",$),$}catch($){console.log("ðŸš€ ~ file: useCreatePool.ts:240 ~ preCalcAddPool ~ error:",$)}};Pr(()=>{const C=De("1",!0);if(C){const P=Jt(C==null?void 0:C.coinAmountA,C==null?void 0:C.coinAmountB,p?(1/Number(s)).toString():s,Y);console.log("ðŸš€ ~ file: useCreatePool.ts:273 ~ useCreatePool ~ perMap:",P),W(P)}else W(void 0)},[s,O.tick,Z.tick,Y,p,c==null?void 0:c.tickSpacing],{wait:500});const Ne=()=>{te(""),we(),_(!0)},we=()=>{le(""),k("")};return{baseToken:G,quoteToken:E,onSelectTokenChange:Ie,feeTier:c,setFeeTier:r,feeTierList:t,displayBaseToken:S,displayQuoteToken:j,handleSwitchDirectionChange:Xe,initPrice:s,handleInitPriceChange:Je,isFullRange:Y,handleRangeModeChange:fe,minTickData:O,maxTickData:Z,handleFeeTierChange:de,handlePriceAction:A,baseAmount:T,quoteAmount:ce,handleAmountChange:ze,getConfirmData:()=>({isReverse:p,baseToken:S,quoteToken:j,baseAmount:T,quoteAmount:ce,minPrice:Se,maxPrice:xe,initPrice:s,feeDisplay:c.feeDisplay,isFullRange:Y}),handleCreateAction:async()=>{const C=O.tokenA;O.tokenB,C.coin_type,U?S.coin_type:j.coin_type;const P={getShowInfo:(b,$)=>{const Q=F(S==null?void 0:S.symbol),_e=F(j==null?void 0:j.symbol),We=`Add ${qe(T)} ${Q} and ${qe(ce)} ${_e}`,Ae={modalDescriptionText:We,toastTitleText:We};if(b==="success"){let Fe=T,et=ce;$&&(Fe=$t($,S)||T,et=$t($,j)||ce);const tt=`Add ${qe(Fe)} ${Q} and ${qe(et)} ${_e}`;Ae.toastDescriptionContent=tt,Ae.modalDescriptionText=tt,Ae.toastTitleText="Create Success"}return b==="rejected"&&(Ae.toastTitleText="Create pool"),Ae}};d(P);try{const b=await m(ae),$=b.msafeParams;if(await h(b.tx,P,{showSuccessModal:!1,useDevInspect:!0,msafeParams:$}))return g(),ie(),c.feeDisplay}catch(b){console.log("ðŸš€ ~ file: useCreatePool.ts:341 ~ handleCreateAction ~ error:",b),o(P)}},percentMap:pe,currTick:Pe,displayMinPrice:Se,displayMaxPrice:xe,handleTickPriceChange:X,handleStepClick:Ee,fetchFeeTierList:y,updateFeeTierList:ie,onOk:()=>{Ee(2)}}}function ar({onEdit:p,baseToken:a,quoteToken:x,children:c}){return e.jsx(Ft,{onEdit:p,children:e.jsxs(q,{gap:"12px",children:[e.jsx($e,{coinAIconUrl:a==null?void 0:a.logo_url,coinBIconUrl:x==null?void 0:x.logo_url,coinACoinType:a==null?void 0:a.coin_type,coinBCoinType:x==null?void 0:x.coin_type,w:"36px",h:"36px"}),e.jsxs(z,{align:"flex-start",gap:"4px",children:[e.jsx(D,{color:"text_caption",fontWeight:"500",children:`${F(a==null?void 0:a.symbol)}-${F(x==null?void 0:x.symbol)}`}),c]})]})})}function Hr({onEdit:p,editStep:a,currentStep:x,onContinue:c,baseToken:r,quoteToken:t,onBaseTokenChange:i,onQuoteTokenChange:h,quoteWhiteTokenList:d,feeTier:o,feeTierList:g,onFeeTierChange:n}){return x<2?null:e.jsx(e.Fragment,{children:a===2||x===2?e.jsx(or,{poolType:"clmm",title:"Select pair",description:"Select the token you want to create a liquidity pool for.",onContinue:c,baseToken:r,onBaseTokenChange:i,quoteToken:t,onQuoteTokenChange:h,quoteWhiteTokenList:d,feeTier:o,feeTierList:g,onFeeTierChange:n,wrapStyle:{p:{base:"16px 8px",lg:"32px"}},fromSource:"createPool"}):e.jsx(ar,{onEdit:p,baseToken:r,quoteToken:t,children:e.jsx(ve,{poolType:"clmm",displayFee:typeof o=="string"?`${ye(o).div(100).toString()}%`:o==null?void 0:o.feeDisplay})})})}function Vr({onEdit:p,editStep:a,currentStep:x,onContinue:c,baseToken:r,quoteToken:t,onBaseTokenChange:i,onQuoteTokenChange:h,quoteWhiteTokenList:d,binStep:o,binStepList:g=[],onBinStepChange:n=()=>{}}){return x<2?null:e.jsx(e.Fragment,{children:a===2||x===2?e.jsx(or,{poolType:"dlmm",title:"Select pair",description:"Select the token you want to create a liquidity pool for.",onContinue:c,baseToken:r,onBaseTokenChange:i,quoteToken:t,onQuoteTokenChange:h,quoteWhiteTokenList:d,wrapStyle:{p:{base:"16px 8px",lg:"32px"}},fromSource:"createPool",binStep:o,binStepList:g,onBinStepChange:n}):e.jsx(ar,{onEdit:p,baseToken:r,quoteToken:t,children:e.jsx(ve,{poolType:"dlmm",displayFee:(o==null?void 0:o.feeDisplay)||"--",binStep:o==null?void 0:o.binStep})})})}function dr({poolType:p,...a}){return p==="dlmm"?e.jsx(Vr,{...a}):e.jsx(Hr,{...a})}function Gr({children:p,isReverse:a,handleSelectTokenChange:x}){const c=Pt(),{currentStep:r,setCurrentStep:t,editStep:i,setEditStep:h,quoteWhiteTokenList:d}=Le(),{baseToken:o,quoteToken:g,feeTier:n,feeTierList:y,displayBaseToken:m,displayQuoteToken:v,handleSwitchDirectionChange:I,initPrice:S,handleInitPriceChange:R,isFullRange:j,handleRangeModeChange:M,handleTickPriceChange:G,handleFeeTierChange:E,handlePriceAction:K,baseAmount:U,quoteAmount:l,handleAmountChange:s,getConfirmData:te,handleCreateAction:Y,percentMap:_,currTick:O,displayMinPrice:ge,displayMaxPrice:Z,handleStepClick:oe,onOk:Pe,updateFeeTierList:N}=Ur(a,x),{currentAccount:pe,onWalletModal:W}=Dt(),{isOpen:ae,onOpen:H,onClose:me}=Ve(),{isOpen:ne,onOpen:ue,onClose:T}=Ve(),{isOpen:le,onOpen:ce,onClose:k}=Ve(),{fetchAccountBalance:ie}=ft(),[Ie,de]=f.useState(),{setBackUrl:Xe}=kt(),ee=()=>{o&&g&&n&&(Xe("/create-pool"),c(`/clmm?tab=deposit&poolAddress=${n==null?void 0:n.poolAddress}`,{replace:!0}))},Je=()=>({baseToken:m,quoteToken:v,feeDisplay:Ie}),fe=f.useCallback(()=>{N==null||N(),ie()},[N]),{setFromCoin:Se,setToCoin:xe,fromCoin:A,toCoin:ht}=nr();return f.useEffect(()=>(Se(o),xe(g),()=>{Se(Ce.clmm_swap.from_coin),xe(Ce.clmm_swap.to_coin)}),[o,g]),e.jsxs(z,{w:"814px",align:"flex-start",gap:"20px",mt:"20px",children:[e.jsxs(q,{w:"100%",justifyContent:"space-between",children:[e.jsxs(he,{variant:"outline",h:"32px",onClick:()=>c("/pools"),p:"0 12px",borderRadius:"8px",bg:"background",children:[e.jsx(Te,{xlinkHref:"#icon-icon_descending",transform:"rotate(90deg)"}),e.jsx(D,{fontSize:"12px",children:"Back"})]}),e.jsx(cr,{handleRefresh:fe,w:"32px",h:"32px",borderRadius:"8px",bg:"background",innerStyle:{bg:"background"}})]}),e.jsxs(Ke,{flexDir:{base:"column",lg:"row"},w:"100%",gap:"16px",align:"flex-start",children:[e.jsx(pr,{currentStep:r,totalStep:4,handleStepClick:oe,poolType:"clmm"}),e.jsxs(z,{w:"100%",gap:"16px",children:[f.cloneElement(p,{onEdit:()=>oe(1),onContinue:()=>oe(2)}),e.jsx(dr,{poolType:"clmm",editStep:i,currentStep:r,onEdit:()=>{oe(2)},onContinue:()=>{n&&(n.poolAddress?H():oe(3))},baseToken:o,onBaseTokenChange:X=>x(X,!0),quoteToken:g,onQuoteTokenChange:X=>x(X,!1),feeTier:n,feeTierList:y,quoteWhiteTokenList:d,onFeeTierChange:X=>E(X),fromSource:"createPool"}),e.jsx(lr,{poolType:"clmm",editStep:i,currentStep:r,onEdit:()=>oe(3),onContinue:()=>{oe(4)},displayBaseToken:m,displayQuoteToken:v,initPrice:S,currTick:O,isReverse:a,onInitPriceChange:X=>R(X),handlePriceAction:K,displayMinPrice:ge,onMinPriceChange:(X,ze)=>{G(X,ze,!0)},displayMaxPrice:Z,onMaxPriceChange:(X,ze)=>{G(X,ze,!1)},handleSwitchDirectionChange:I,isFullRange:j,handleRangeModeChange:M}),e.jsx(Lr,{poolType:"clmm",currentStep:r,editStep:i,onCreate:()=>{pe?ue():W(!0)},percentMap:_,baseToken:m,quoteToken:v,baseAmount:U,quoteAmount:l,onBaseAmountChange:X=>s(X,!0),onQuoteAmountChange:X=>s(X,!1),isReverse:a})]})]}),ae&&e.jsx(Zt,{title:"This Pool already exists",subTitle:"Do you want to provide liquidity?",btnText:"Add liquidity",isOpen:ae,onClose:me,onConfirm:ee}),ne&&e.jsx(Rr,{isOpen:ne,onClose:T,onSubmit:async()=>{T();const X=await Y();X&&(de(X),ce())},data:te()}),le&&Ie&&e.jsx(Br,{isOpen:le,onClose:()=>{Pe(),k()},data:Je()})]})}function Zr(p,a){const{fee:x}=vt(),[c,r]=Gt(),t=c.get("baseFactor"),i=Tt("dlmm"),[h,d]=f.useState([]),{signAndExecuteTransaction:o,transactionConfirmation:g,transactionRejected:n}=sr(),{fetchAccountBalance:y}=ft(),m=Pt();ur();const{getBinStepConfigs:v,getCreateDLMMPoolTxPayload:I}=rr(),{currentStep:S,editStep:R,setCurrentStep:j,setEditStep:M,displayBaseToken:G,setDisplayBaseToken:E,displayQuoteToken:K,setDisplayQuoteToken:U,baseToken:l,quoteToken:s,backToStepOne:te}=Le(),{getDefaultBinPriceAndId:Y,handleActionBinPrice:_,getNumBins:O}=Dr(),{mevProtect:ge,maxCapForGas:Z,transactionMode:oe,customGasPrice:Pe}=kt();f.useEffect(()=>{y()},[]);const{initPrice:N,setInitPrice:pe,minPriceData:W,setMinPriceData:ae,maxPriceData:H,setMaxPriceData:me,baseAmount:ne,setBaseAmount:ue,quoteAmount:T,setQuoteAmount:le,isAutoFill:ce,setIsAutoFill:k,strategy:ie,setStrategy:Ie,fixAmountA:de,setFixAmountA:Xe,activeId:ee,setActiveId:Je,createBinInfos:fe,setCreateBinInfos:Se,setBinStep:xe,binStep:A,positionCount:ht,setPositionCount:X,numBins:ze,setNumBins:Ee,setBaseTokenLock:De,setQuoteTokenLock:Ne,resetCreateDlmmPoolState:we}=tr();f.useEffect(()=>()=>{we()},[]);const Rt=()=>{pe(""),Fe()},gt=async(u,w,L)=>{var J;if(console.log(u,w,L,"handleBinStepChange"),!(u!=null&&u.poolAddress)&&w&&L)try{const B=await((J=i==null?void 0:i.Pool)==null?void 0:J.getPoolAddress(ct(w,!0),ct(L,!0),u==null?void 0:u.binStep,u==null?void 0:u.baseFactor));xe(B?{...u,poolAddress:B}:u)}catch{xe(u)}else xe(u);r({baseFactor:u==null?void 0:u.baseFactor}),j(2),Rt()},Ye=f.useCallback(()=>{var u;console.log(l,s,"updateBinStep"),l&&s?v(l==null?void 0:l.coin_type,s==null?void 0:s.coin_type).then(w=>{console.log(w,"updateBinStep"),d(w==null?void 0:w.map(B=>({...B,title:(B==null?void 0:B.title)!=="Not Created"?"Created":B.title})));const L=w.filter(B=>B.poolAddress===void 0),J=L.find(B=>B.binStep==Number(x)&&B.baseFactor==Number(t))||L.find(B=>B.binStep===25)||(L.length>0?L[0]:void 0)||(w.length>0?w[0]:void 0);J&&(l!=null&&l.coin_type)&&(s!=null&&s.coin_type)&&gt(J,l==null?void 0:l.coin_type,s==null?void 0:s.coin_type)}):(d((u=vr)==null?void 0:u.map(w=>({...w,title:""}))),xe(void 0))},[l==null?void 0:l.coin_type,s==null?void 0:s.coin_type]);f.useEffect(()=>{S===2&&Ye()},[Ye,S]),f.useEffect(()=>{if(be(W)&&be(H)&&A!==void 0&&Number.isFinite(W==null?void 0:W.binId)&&Number.isFinite(H==null?void 0:H.binId)){const u=Ue.getPositionCount(W.binId,H.binId);X(u);const w=O(W.binId,H.binId);Ee(w)}},[W==null?void 0:W.binId,H==null?void 0:H.binId,A]);const C=(u,w=!0)=>{b(2),a(u,w)};f.useEffect(()=>{if(bt(N)&&ee!==void 0&&A!==void 0&&be(l)&&be(s)){const{lower_bin_id:u,upper_bin_id:w,lower_price:L,upper_price:J}=Y(A==null?void 0:A.binStep,ee,l.decimals,s.decimals),[B,se,re]=He(J);me({binId:w,price:J,displayPrice:B,reversePrice:se,displayReversePrice:re,type:"upper"});const[Qe,rt,it]=He(L);ae({binId:u,price:L,displayPrice:Qe,reversePrice:rt,displayReversePrice:it,type:"lower"})}},[N,A==null?void 0:A.binStep,l==null?void 0:l.coin_type,s==null?void 0:s.coin_type,ee,S]);const P=(u,w)=>{w?(ue(u),(u===""||V(u).lte(0))&&le("")):(le(u),(u===""||V(u).lte(0))&&ue(""))},b=u=>{u===1?(te("dlmm"),pe(""),Fe(),m("/create-pool",{replace:!0})):u===2?(j(2),M(2),pe(""),Fe()):u===3?(j(3),M(3),Fe()):(j(4),M(4))};f.useEffect(()=>{if(bt(N)&&A!==void 0&&l!==void 0&&s!==void 0){const u=Ue.getBinIdFromPrice(N,A.binStep,!1,l==null?void 0:l.decimals,s==null?void 0:s.decimals);Je(u)}},[N,A,l,s]);const $=f.useCallback((u,w,L)=>{var J,B;if(A!==void 0&&l!==void 0&&s!==void 0){const{bin_id:se,price:re}=_(w,A==null?void 0:A.binStep,l==null?void 0:l.decimals,s==null?void 0:s.decimals,u),[Qe,rt,it]=He(re);if(L)if(V(re).gt(N)){const jt=(J=Ue)==null?void 0:J.getBinIdFromPrice(N,A==null?void 0:A.binStep,!1,l==null?void 0:l.decimals,s==null?void 0:s.decimals),[yt,Ct,St]=He(N);ae({binId:jt,price:N,displayPrice:yt,reversePrice:Ct,displayReversePrice:St,type:"lower"})}else ae({binId:se,price:re,displayPrice:Qe,reversePrice:rt,displayReversePrice:it,type:"lower"});else if(V(re).lt(N)){const jt=(B=Ue)==null?void 0:B.getBinIdFromPrice(N,A==null?void 0:A.binStep,!1,l==null?void 0:l.decimals,s==null?void 0:s.decimals),[yt,Ct,St]=He(N);me({binId:jt,price:N,displayPrice:yt,reversePrice:Ct,displayReversePrice:St,type:"upper"})}else me({binId:se,price:re,displayPrice:Qe,reversePrice:rt,displayReversePrice:it,type:"upper"})}},[A,l,s,N]),{handleAutoFillPreAdd:Q,handleNotAutoFillPreAdd:_e}=wr(),We=f.useCallback(async u=>{try{if(ce&&u&&V(u).gt(0)&&l&&s&&ee!==void 0){const w=await Q({amount:de?ot(u,l==null?void 0:l.decimals).toString():ot(u,s==null?void 0:s.decimals).toString(),tokenA:l,tokenB:s,strategy:ie,isReverse:Bt(l.coin_type,s.coin_type),fixAmountA:de,lowerBinId:W.binId,upperBinId:H.binId,activeId:ee,currentBinStep:A.binStep});if(w){const{totalAmount:L,binInfos:J,coinAmountA:B,coinAmountB:se}=w;J&&Se(J),de?le(se):ue(B)}}}catch(w){console.log("handleAutoFillPreCalc ~ error",w)}},[ce,l,s,de,ee,W,H,A,ie]);f.useEffect(()=>{de&&ne&&V(ne).gt(0)&&We(ne),!de&&T&&V(T).gt(0)&&We(T)},[We,ne,T]);const Ae=f.useCallback(async()=>{if(!ce&&l&&s&&ee!==void 0&&be(W)&&be(H)){const u=await _e({coinAmountA:ot(ne||"0",l==null?void 0:l.decimals).toString(),coinAmountB:ot(T||"0",s==null?void 0:s.decimals).toString(),currentBinStep:A.binStep,tokenA:l,tokenB:s,lowerBinId:W.binId,upperBinId:H.binId,strategyType:ie,activeId:ee,isReverse:Bt(l==null?void 0:l.coin_type,s==null?void 0:s.coin_type)});if(u){const{totalAmount:w,binInfos:L}=u;L&&Se(L)}}},[ce,l,s,ee,A,ie,W,H,ne,T]);f.useEffect(()=>{Ae()},[Ae]);const Fe=()=>{ue(""),le(""),Ie(gr.Spot),ae(void 0),me(void 0),Ee(0),Se(void 0)},et=()=>({}),tt=async()=>{const u={getShowInfo:(L,J)=>{F(l==null?void 0:l.symbol),F(s==null?void 0:s.symbol);const B="Create DLMM Pool",se={modalDescriptionText:B,toastTitleText:B};if(L==="success"){const re="Create DLMM Pool";se.toastDescriptionContent=re,se.modalDescriptionText=re,se.toastTitleText="Create Success"}return L==="rejected"&&(se.toastTitleText="Create pool"),se}};g(u);let w={};try{let L=ee;const J=er(lt(l.coin_type),lt(s.coin_type));if(J){const re=V(1).div(N).toString();L=Ue.getBinIdFromPrice(re,A.binStep,!1,s.decimals,l.decimals)}w={active_id:L,bin_step:A.binStep,tokenA:J?s.coin_type:l.coin_type,tokenB:J?l.coin_type:s.coin_type,base_factor:A.baseFactor};const{tx:B,pool_id:se}=await I({active_id:L,bin_step:A.binStep,tokenA:J?s:l,tokenB:J?l:s,base_factor:A.baseFactor});if(B){const re=await o(B,u,{useDevInspect:!0,useMev:ge,showSuccessModal:!1,useFastMode:oe==="Fast Mode",maxCapForGas:Z,customGasPrice:Pe,trackData:{...w,actionType:"dlmm",action:"dlmmCreatePool"}});if(console.log("ðŸš€ ~ handleCreateAction ~ res:",re),re)return y(),Ye(),A}}catch(L){console.log("ðŸš€ ~ file: useCreatePool.ts:341 ~ handleCreateAction ~ error:",L),n(u)}},xr=u=>{pe(u)},mr=(u,w)=>{if(!l||!s)return;const L=Ue.getBinIdFromPrice(w,A.binStep,!1,l==null?void 0:l.decimals,s==null?void 0:s.decimals),[J,B,se]=He(w),re={tokenA:l,tokenB:s,binId:L,price:w,displayPrice:w,reversePrice:B,displayReversePrice:se,type:u==null?void 0:u.type};(u==null?void 0:u.type)==="lower"?ae(re):me(re)};return f.useEffect(()=>{if(be(W)&&be(H)&&ee!==void 0){const u=W.binId,w=H.binId;V(u).gt(w)?(De(!0),Ne(!0)):V(u).gt(ee)?(De(!1),Ne(!0)):V(w).lt(ee)?(De(!0),Ne(!1)):(De(!1),Ne(!1))}},[W,H,ee]),{baseToken:l,quoteToken:s,onSelectTokenChange:C,displayBaseToken:G,displayQuoteToken:K,initPrice:N,baseAmount:ne,quoteAmount:T,handleAmountChange:P,getConfirmData:et,handleCreateAction:tt,minPriceData:W,maxPriceData:H,handleStepClick:b,binStep:A,setBinStep:xe,feeOptions:h,handlePriceAction:$,handleInitPriceChange:xr,fixAmountA:de,setFixAmountA:Xe,isAutoFill:ce,setIsAutoFill:k,handleActionBinPrice:_,strategy:ie,setStrategy:Ie,handleBinStepChange:gt,onPriceChange:mr,onOk:()=>{b(2)},updateBinStep:Ye}}function Kr(p){const{isOpen:a,onClose:x,onSubmit:c}=p,{baseToken:r,quoteToken:t}=Le(),{baseAmount:i,quoteAmount:h,initPrice:d,binStep:o,strategy:g,minPriceData:n,maxPriceData:y,createBinInfos:m,positionCount:v,baseTokenLock:I,quoteTokenLock:S}=tr(),[R,j]=f.useState(!0),M=f.useMemo(()=>R?`${F(t==null?void 0:t.symbol)} per ${F(r==null?void 0:r.symbol)}`:`${F(r==null?void 0:r.symbol)} per ${F(t==null?void 0:t.symbol)}`,[R,r==null?void 0:r.symbol,t==null?void 0:t.symbol]),{isApp:G}=ke();return e.jsxs(pt,{autoFocus:!1,returnFocusOnClose:!1,isOpen:a,onClose:x,isCentered:!0,children:[e.jsx(at,{}),e.jsxs(dt,{children:[e.jsx(xt,{children:e.jsx(Ze,{fontWeight:"500",fontSize:"16px",children:"Preview"})}),e.jsx(mt,{}),e.jsx(ut,{textAlign:"center",p:"0px",children:e.jsxs(z,{w:"100%",gap:"20px",p:"8px 16px",pb:"0px",children:[G?e.jsxs(q,{w:"100%",h:"40px",children:[e.jsx($e,{coinACoinType:r==null?void 0:r.coin_type,coinBCoinType:t==null?void 0:t.coin_type,coinAIconUrl:r==null?void 0:r.logo_url,coinBIconUrl:t==null?void 0:t.logo_url,imageStyle:{w:"40px",h:"40px"},imgBoxStyle:{w:"40px",h:"40px"}}),e.jsxs(z,{align:"flex-start",gap:"4px",children:[e.jsx(D,{fontSize:"16px",color:"text_caption",children:`${F(r==null?void 0:r.symbol,8)} - ${F(t==null?void 0:t.symbol,8)}`}),e.jsx(ve,{poolType:"dlmm",displayFee:o==null?void 0:o.feeDisplay,binStep:o==null?void 0:o.binStep})]})]}):e.jsxs(q,{w:"100%",justifyContent:"space-between",h:"40px",children:[e.jsxs(q,{children:[e.jsx($e,{coinACoinType:r==null?void 0:r.coin_type,coinBCoinType:t==null?void 0:t.coin_type,coinAIconUrl:r==null?void 0:r.logo_url,coinBIconUrl:t==null?void 0:t.logo_url,imageStyle:{w:"40px",h:"40px"},imgBoxStyle:{w:"40px",h:"40px"}}),e.jsx(D,{fontSize:"16px",color:"text_caption",children:`${F(r==null?void 0:r.symbol,8)} - ${F(t==null?void 0:t.symbol,8)}`})]}),e.jsx(ve,{poolType:"dlmm",displayFee:o==null?void 0:o.feeDisplay,binStep:o==null?void 0:o.binStep})]}),e.jsxs(q,{justify:"space-between",bg:"bg_secondary",p:"16px 8px",borderRadius:"12px",h:"48px",w:"100%",mt:"12px",children:[e.jsx(D,{children:"Initial Price"}),e.jsxs(q,{gap:"4px",children:[e.jsx(D,{as:"span",color:"text_caption",children:At(Oe(R?d:It(ye(1).div(d).toFixed(18),18,!0).toString(),18),18)}),e.jsx(D,{children:M}),e.jsx(he,{variant:"unstyled",onClick:()=>j(!R),w:"20px",h:"20px",minW:"20px",display:"flex",justifyContent:"center",alignItems:"center",children:e.jsx(Te,{xlinkHref:"#icon-icon_swap1",fontSize:"16px"})})]})]}),e.jsx(he,{w:"calc(100% + 32px)",bottom:"0px",mt:"4px",h:"52px",borderRadius:"12px",fontSize:"16px",fontWeight:"500",onClick:c,children:"Create"})]})})]})]})}function Xr(p){const{isOpen:a,onClose:x,data:c}=p,{baseToken:r,quoteToken:t,binStep:i}=c;return e.jsxs(pt,{autoFocus:!1,returnFocusOnClose:!1,isOpen:a,onClose:x,isCentered:!0,children:[e.jsx(at,{}),e.jsxs(dt,{children:[e.jsx(xt,{}),e.jsx(mt,{}),e.jsx(ut,{children:e.jsx(z,{gap:"8px",pb:"8px",pt:"28px",w:"100%",children:e.jsxs(z,{gap:"8px",children:[e.jsx(Ut,{src:"/images/img_transactionsuccess@2x.png",w:"200px",h:"200px",alt:"icon"}),e.jsxs(z,{mt:"-155px",gap:"10px",children:[e.jsxs(q,{children:[e.jsx($e,{coinACoinType:r==null?void 0:r.coin_type,coinBCoinType:t==null?void 0:t.coin_type,coinAIconUrl:r==null?void 0:r.logo_url,coinBIconUrl:t==null?void 0:t.logo_url,imageStyle:{w:"24px",h:"24px"},imgBoxStyle:{w:"24px",h:"24px"}}),e.jsx(D,{fontSize:"14px",color:"text_caption",children:`${F(r==null?void 0:r.symbol,8)} - ${F(t==null?void 0:t.symbol)}`})]}),e.jsx(ve,{poolType:"dlmm",displayFee:i==null?void 0:i.feeDisplay,binStep:i==null?void 0:i.binStep})]}),e.jsx(Qt,{mt:"80px",borderRadius:"16px",padding:"16px",children:e.jsx(D,{color:"primary_gray",fontSize:"12px",lineHeight:"20px",children:"The pool has been created. It will usually take up to 3 min for a new pool to be presented in front end interface. Thanks for creating this pool"})}),e.jsx(he,{mt:"16px",fontSize:"14px",w:"100%",onClick:()=>{x()},children:"OK"})]})})})]})]})}function Jr({children:p,isReverse:a,handleSelectTokenChange:x}){const c=Pt(),{currentStep:r,setCurrentStep:t,editStep:i,setEditStep:h,quoteWhiteTokenList:d}=Le(),{baseToken:o,quoteToken:g,binStep:n,setBinStep:y,feeOptions:m,displayBaseToken:v,displayQuoteToken:I,initPrice:S,handleCreateAction:R,handleStepClick:j,handleBinStepChange:M,handleInitPriceChange:G,onOk:E,updateBinStep:K}=Zr(a,x),{currentAccount:U,onWalletModal:l}=Dt(),{isOpen:s,onOpen:te,onClose:Y}=Ve(),{isOpen:_,onOpen:O,onClose:ge}=Ve(),{isOpen:Z,onOpen:oe,onClose:Pe}=Ve(),{fetchAccountBalance:N}=ft(),pe=Tt("dlmm"),[W,ae]=f.useState(),H=()=>{o&&g&&n&&c(`/dlmm?tab=deposit&poolId=${n==null?void 0:n.poolAddress}`,{replace:!0})},me=()=>({baseToken:o,quoteToken:g,binStep:W}),ne=f.useCallback(()=>{K==null||K(),N()},[K]),{setFromCoin:ue,setToCoin:T,fromCoin:le,toCoin:ce}=nr();return f.useEffect(()=>(ue(o),T(g),()=>{ue(Ce.clmm_swap.from_coin),T(Ce.clmm_swap.to_coin)}),[o,g]),e.jsxs(z,{w:"814px",align:"flex-start",gap:"20px",mt:"20px",children:[e.jsxs(q,{w:"100%",justifyContent:"space-between",children:[e.jsxs(he,{variant:"outline",h:"32px",onClick:()=>c("/pools?tab=dlmm_pools"),p:"0 12px",borderRadius:"8px",bg:"background",children:[e.jsx(Te,{xlinkHref:"#icon-icon_descending",transform:"rotate(90deg)"}),e.jsx(D,{fontSize:"12px",children:"Back"})]}),e.jsx(cr,{handleRefresh:ne,w:"32px",h:"32px",borderRadius:"8px",bg:"background",innerStyle:{bg:"background"}})]}),e.jsxs(Ke,{flexDir:{base:"column",lg:"row"},w:"100%",gap:"16px",align:"flex-start",children:[e.jsx(pr,{currentStep:r,handleStepClick:j,totalStep:3,poolType:"dlmm"}),e.jsxs(z,{w:"100%",gap:"16px",children:[f.cloneElement(p,{onEdit:()=>j(1),onContinue:()=>j(2)}),e.jsx(dr,{poolType:"dlmm",editStep:i,currentStep:r,onEdit:()=>{j(2)},onContinue:()=>{n&&(n!=null&&n.poolAddress?te():j(3))},baseToken:o,onBaseTokenChange:k=>x(k,!0),quoteToken:g,onQuoteTokenChange:k=>x(k,!1),binStep:n,binStepList:m,quoteWhiteTokenList:d,onBinStepChange:k=>M(k,o==null?void 0:o.coin_type,g==null?void 0:g.coin_type),fromSource:"createPool"}),e.jsx(lr,{poolType:"dlmm",editStep:i,currentStep:r,onEdit:()=>j(3),onContinue:async()=>{var k;if(n){if(n!=null&&n.poolAddress)te();else if(o!=null&&o.coin_type&&(g!=null&&g.coin_type))try{const ie=await((k=pe==null?void 0:pe.Pool)==null?void 0:k.getPoolAddress(ct(o==null?void 0:o.coin_type,!0),ct(g==null?void 0:g.coin_type,!0),n==null?void 0:n.binStep,n==null?void 0:n.baseFactor));ie?(y({...n,poolAddress:ie}),te()):U?O():l(!0)}catch{U?O():l(!0)}}},baseToken:v,quoteToken:I,initPrice:S,onInitPriceChange:G})]})]}),s&&e.jsx(Zt,{title:"This Pool already exists",subTitle:"Do you want to provide liquidity?",btnText:"Add liquidity",isOpen:s,onClose:Y,onConfirm:H}),_&&e.jsx(Kr,{isOpen:_,onClose:ge,onSubmit:async()=>{ge();const k=await R();k&&(ae(k),oe())}}),Z&&W&&e.jsx(Xr,{isOpen:Z,onClose:()=>{E(),Pe()},data:me()})]})}function Yr(){const{displayBaseToken:p,setDisplayBaseToken:a,displayQuoteToken:x,setDisplayQuoteToken:c,baseToken:r,setBaseToken:t,quoteToken:i,setQuoteToken:h,poolType:d,setPoolType:o,resetCreatePoolState:g,currentStep:n}=Le(),{base:y,quote:m,fee:v}=vt(),[I]=Gt(),S=I.get("baseFactor"),{tokenInfo:R}=Lt(y),{tokenInfo:j}=Lt(m),{quoteWhiteTokenList:M}=Fr();f.useEffect(()=>()=>{g()},[]),f.useEffect(()=>{S&&o("dlmm")},[]);const G=f.useMemo(()=>p&&x?er(lt(p.coin_type),lt(x.coin_type)):!1,[p,x]),E=U=>{o(U)},K=(U,l=!0)=>{l?(t(U),a(U),c(i),(U==null?void 0:U.coin_type)===(i==null?void 0:i.coin_type)&&(h(void 0),c(void 0))):(h(U),c(U),a(r),(U==null?void 0:U.coin_type)===(r==null?void 0:r.coin_type)&&(t(void 0),a(void 0)))};return jr(()=>{j&&!Wt(j,M)?Wt(R,M)?(t(j),a(j),c(R||Ce.sui_coin),h(R||Ce.sui_coin)):(t(void 0),a(void 0),c(Ce.sui_coin),h(Ce.sui_coin)):((r===void 0||R)&&(t(R),a(R)),(i===void 0||j)&&(c(j||Ce.sui_coin),h(j||Ce.sui_coin)))},[R==null?void 0:R.coin_type,j==null?void 0:j.coin_type,M]),{poolType:d,onPoolTypeChange:E,isReverse:G,handleSelectTokenChange:K}}function po(){const{isReverse:p,handleSelectTokenChange:a,poolType:x,onPoolTypeChange:c}=Yr(),{currentStep:r}=Le(),t=f.useMemo(()=>x==="dlmm"?Jr:Gr,[x]);return e.jsx(t,{isReverse:p,handleSelectTokenChange:a,children:e.jsx(Ar,{type:x,onChange:c,currentStep:r,fromSource:"createPool"})})}export{po as default};
