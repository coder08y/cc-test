import{r as n,j as e,H as l,B as M,T as x,P as N,x as H,y as $,A as G,m as w,V as R,F as z,l as J,M as U,o as K,p as Q,t as X,q as Z}from"./vendor-CBmAETR3.js";import{a as ee,V as se,b as te,c as ae,d as ie}from"./VaultsAprBlock-CTnUP5Xj.js";import{u as re,a as oe,V as ne}from"./VaultsAction-DseJMuJm.js";import{a as le}from"./useGetPythTokenPrice-ZvbDQKwq.js";import{u as ce}from"./useAccountBalance-Bp-GiNHM.js";import{d as u,u as V,v as W,bo as pe,B as Y,M as E,l as k,k as xe}from"./index-Lo8eQgA0.js";import{u as de}from"./useInterval-FApnpfRj.js";import{V as ue,P as fe,F as ge}from"./CoinPairInfo-BkYX588i.js";import"./cross-J9VCREIf.js";import{V as he}from"./VTextLabelBox-BsJ2fzM-.js";import{s as P,u as be,M as me,P as je}from"./PositionItemContent-DaS4qjm-.js";import{a as ye}from"./usePositionList-Bupy7RnX.js";import{u as we}from"./index-BgoHGJbV.js";import{T as q}from"./TableSortTh-BghcHf2e.js";function ve(p){const{minPrice:i,maxPrice:a,currPrice:r}=p,[o,f]=n.useState(0),[j,C]=n.useState(0),d=n.useRef(null),c=n.useRef(null);n.useEffect(()=>{const b=()=>{d.current&&f(d.current.offsetWidth),c.current&&C(c.current.offsetWidth)},v=new ResizeObserver(b),S=new ResizeObserver(b);return d.current&&v.observe(d.current),c.current&&S.observe(c.current),()=>{d.current&&v.unobserve(d.current),c.current&&S.unobserve(c.current)}},[i,a,r]);const y=n.useMemo(()=>{if(a==="âˆž")return"0px";if(r&&i&&a&&o){if(u(r).lessThanOrEqualTo(a)&&u(r).greaterThanOrEqualTo(i)){const b=u(r).sub(i).div(u(a).sub(u(i))).toString();return`${u(o).mul(b).toFixed(0)}px`}if(u(r).lt(i))return"-36px";if(u(r).gt(a))return"calc(100% + 36px)"}return"0px"},[r,i,a,o]),m=n.useMemo(()=>{const b=y.replace("px","");return Number(b)-j/2+"px"},[y,j]),{isApp:A}=V();return e.jsx(e.Fragment,{children:i!==void 0&&a!==void 0&&r!==void 0?e.jsx(l,{w:"100%",height:"60px",background:"primary_opacity.10",borderRadius:"16px",p:"0px 0px 8px",children:e.jsxs(M,{w:"100%",padding:i&&u(r).lt(i)?"0 40px 0 60px":a&&u(r).gt(a)?"0 60px 0 40px":"0 40px",position:"relative",children:[e.jsx(x,{whiteSpace:"nowrap",position:"absolute",top:"20px",left:i&&u(r).lt(i)?"60px":"40px",fontSize:"12px",color:"text_caption",children:W(i)}),e.jsx(M,{w:"100%",position:"relative",height:"14px",ref:d,bgImage:"url('/images/img_range@2x.png')",bgSize:"100% 14px",bgPosition:"center",children:e.jsxs(N,{isLazy:!0,placement:"top",trigger:A?"click":"hover",autoFocus:!1,returnFocusOnClose:!1,gutter:4,children:[e.jsx(H,{children:e.jsx(M,{as:"button",children:e.jsx(M,{bg:"#fff",borderRadius:"8px",w:"4px",height:"15px",position:"absolute",top:"50%",transform:"translateY(-50%)",left:y,ml:"-2px",zIndex:"5"})})}),e.jsx($,{w:"fit-content",bg:"none",border:"none",ref:c,position:"absolute",top:"-32px !important",left:m,zIndex:"5",children:e.jsx(G,{fontSize:"12px",w:"fit-content",bg:"none",border:"none",children:e.jsx(x,{whiteSpace:"nowrap",fontSize:"12px",color:"primary",children:W(r)})})})]})}),e.jsx(x,{whiteSpace:"nowrap",position:"absolute",top:"20px",right:a&&u(r).gt(a)?"60px":"40px",fontSize:"12px",color:"text_caption",children:W(a)})]})},y):e.jsx(l,{w:"100%",height:"60px",background:"primary_opacity.10",borderRadius:"16px",p:"0 40px",children:e.jsx(w,{w:"100%",h:"20px"})})})}function Se(p){const{vaultId:i,displayTokenA:a,displayTokenB:r,feeDisplay:o,minPrice:f,maxPrice:j,currPrice:C,apiVaultInfo:d}=p,{isVaultsFarming:c}=ee(i);return e.jsxs(R,{width:"calc(100% + 32px)",padding:"0 16px",alignItems:"left",paddingBottom:"16px",borderBottom:"1px solid",borderColor:"border",children:[e.jsxs(z,{children:[e.jsx(pe,{coinAIconUrl:a==null?void 0:a.logo_url,coinBIconUrl:r==null?void 0:r.logo_url,imageStyle:{w:"32px",h:"32px"},imgBoxStyle:{w:"32px",h:"32px"}}),e.jsxs(z,{marginLeft:"8px",justifyContent:"space-between",alignItems:"center",width:"100%",children:[e.jsxs(R,{alignItems:"flex-start",gap:"4px",children:[e.jsxs(z,{alignItems:"center",children:[e.jsx(x,{fontSize:"16px",color:"text_caption",children:`${a==null?void 0:a.symbol} - ${r==null?void 0:r.symbol}`}),c&&e.jsx(ue,{imageStyle:{ml:"4px"}})]}),e.jsx(Y,{w:"auto",p:"3px 12px 2px",borderRadius:"12px",bg:"none",borderColor:"primary",children:e.jsx(x,{fontSize:"12px",color:"primary",children:o})})]}),e.jsx(z,{flexDirection:"column",children:e.jsx(he,{wrapStyle:{gap:"2px",alignItems:"flex-end !important"},title:"",titleStyle:{color:"primary",fontSize:"12px"},value:e.jsx(se,{vaultId:d==null?void 0:d.vaultId,wrapStyle:{flexDirection:"row"}}),valueStyle:{color:"text_highlight",h:"20px",lineHeight:"20px",fontSize:"14px",fontWeight:"500",textDecoration:"none"}})})]})]}),e.jsx(ve,{minPrice:f,maxPrice:j,currPrice:C})]})}function ke(p){const{currentAccount:i}=E(),{isOpen:a,setIsOpen:r,vaultId:o,category:f,displayTokenA:j,displayTokenB:C,feeDisplay:d,clmmPool:c,isReverse:y,setIsOpenFarmingModal:m,setFarmingModalAction:A,onClose:b}=p,{isOpenWalletModal:v}=E(),{getCurrentVaultDetail:S,getCurrentVaultContractInfo:D}=re(),{clearVaultsActionData:I}=oe(),{fetchAccountBalance:L}=ce(),F=J(),{vaultsPoolObj:B}=te(),t=n.useMemo(()=>B[o],[B,o]),{vaultsFarmObj:_}=ae();n.useEffect(()=>{o&&k(_)&&S(o)},[i==null?void 0:i.address,o,_]);const{getPythLastPrice:T}=ie(),g=n.useRef(!1);n.useEffect(()=>(g.current=!0,()=>{g.current=!1,I()}),[]),n.useEffect(()=>{t!=null&&t.displayCoinTypeA&&(t!=null&&t.displayCoinTypeB)&&T([t==null?void 0:t.displayCoinTypeA,t==null?void 0:t.displayCoinTypeB])},[t==null?void 0:t.displayCoinTypeA,t==null?void 0:t.displayCoinTypeB]),de({interval:20*1e3,callback:()=>{g.current&&(f=="haedal"||f=="cetus-dlmm")&&T([t==null?void 0:t.displayCoinTypeA,t==null?void 0:t.displayCoinTypeB])}});const O=()=>{console.log("ðŸš€ðŸš€ðŸš€ ~ q223VaultsDetailPage.tsx:142 ~ autoRefresh ~ autoRefresh:"),i!=null&&i.address?(L(),S(o,!0)):D(o)},{vaultListObj:s}=le(),h=n.useMemo(()=>{if(k(s)&&o)return s[o]},[s,o]);return e.jsxs(U,{isCentered:!0,isOpen:a&&!v,onClose:()=>{b()},children:[e.jsx(K,{}),e.jsx(Q,{width:{base:"100%",lg:"420px"},children:e.jsx(X,{p:"0 0 8px",children:e.jsxs(R,{width:"100%",children:[e.jsxs(R,{width:"100%",p:"6px 16px 16px",mb:"-16px",gap:"0",borderRadius:"16px",sx:{backgroundImage:"url('/images/vault_modal_bg@2x.png')",backgroundPosition:"top center",backgroundRepeat:"no-repeat",backgroundSize:"100% 320px"},children:[e.jsxs(l,{h:"36px",w:"100%",mb:"12px",children:[e.jsx(x,{color:"text_caption",fontWeight:"500",fontSize:"16px",children:"Auto Vault"}),e.jsx(Z,{})]}),e.jsx(Se,{displayTokenA:j,displayTokenB:C,feeDisplay:d,clmmPool:c,isReverse:y,minPrice:t==null?void 0:t.minPrice,maxPrice:t==null?void 0:t.maxPrice,currPrice:t==null?void 0:t.currentPrice,category:f,vaultId:o,apiVaultInfo:h}),e.jsx(ne,{vaultId:o,isModal:!0,autoRefresh:O,setIsOpenFarmingModal:m,setFarmingModalAction:A,setIsOpenPre:r})]}),e.jsxs(l,{borderTop:"1px solid",borderColor:"border",width:"100%",padding:"12px 16px 4px",justifyContent:f=="haedal"?"space-between":"center",children:[e.jsx(fe,{mt:"0",category:f}),e.jsx(x,{fontSize:"12px",_hover:{color:"primary"},whiteSpace:"nowrap",cursor:"pointer",onClick:()=>{f&&o&&(I(),F(`/vaults-detail/${o}/${f}`))},children:"Vault Details >"})]})]})})})]})}const Pe=[{label:"APR",value:"apr"},{label:"Liquidity",value:"liquidity"},{label:"Pending Fees",value:"fees"},{label:"Pending Rewards",value:"rewards"},{label:"Actions",value:"actions"}];Pe.reduce((p,i)=>(p[i.value]=i,p),{});function Ee({poolInfo:p,priceDirect:i}){var O;const a=["380px","100px","130px","170px","160px","106px"];console.log("ðŸš€ðŸš€ðŸš€ ~ PositionItem.tsx:16 ~ PositionItem ~ showNewVersionApr:",P);const r=[{label:"APR",value:"apr"},{label:"Liquidity",value:"liquidity"},{label:"Claimable Yield",value:"yield"},{label:"Est. Daily Yield",value:"dailyEarn"},{label:"Actions",value:"actions"}],o=r.reduce((s,h)=>(s[h.value]=h,s),{});console.log("ðŸš€ðŸš€ðŸš€ ~ PositionItem.tsx:38 ~ PositionItem ~ SORT_BY_OBJECT:",o);const{coinPriceObj:f}=xe(),{getPositionSortList:j}=be(),{farmsPosRewardsData:C,posRewardsData:d}=ye(),[c,y]=n.useState("desc"),[m,A]=n.useState({label:"",value:""}),b=s=>{(s==null?void 0:s.value)===m.value?y(h=>h==="desc"?"asc":"desc"):(y("desc"),A(s))},[v,S]=n.useState([]),[D,I]=n.useState(!0),[L,F]=n.useState([]),B=n.useCallback(async()=>{I(!0);try{console.log(m.value,c,p.list,"handleGetPositionList");const s=await j(m.value,c,p.list);S(s),F(s),I(!1)}catch(s){console.log(s,"handleGetPositionList"),I(!1)}},[m.value,c,p.list,j]);we(()=>{k(p)&&B()},[B],{wait:300});const t=s=>v.some(h=>u(h[s]).gt(0)),_=n.useMemo(()=>t("totalMiningAmount"),[v]),T=n.useMemo(()=>t("totalFarmingAmount"),[v]),{isApp:g}=V();return e.jsxs(R,{gap:"12px",w:"100%",children:[!g&&e.jsxs(l,{w:"100%",p:"0 16px",justify:"space-between",children:[e.jsx(x,{w:a[0],minW:{base:"unset",lg:a[0]},children:"Price Range"}),r.map((s,h)=>s.value!=="rewards"||_||T?e.jsxs(l,{gap:"4px",w:a[h+1],justify:"flex-end",children:[!P,!P,_&&s.value==="yield"&&e.jsx(me,{}),T&&s.value==="yield"&&e.jsx(ge,{}),s.value=="actions"&&e.jsx(x,{children:s.label}),s.value==="apr"&&P&&e.jsx(q,{labelInfo:o[s.value],sortRule:c,sortBy:m,clickSort:b,defaultShowSortIcon:!0,tooltip:{content:s.value==="apr"?e.jsx("span",{children:"APR based on the daily yield accrued by this position. Past performance is not indicative of future results. Calculations are an estimate and only for reference."}):""}}),s.value!=="apr"&&s.value!=="actions"&&e.jsx(q,{labelInfo:o[s.value],sortRule:c,sortBy:m,clickSort:b,defaultShowSortIcon:!0,tooltip:{content:s.value==="apr"?e.jsx("span",{children:"APR based on the daily yield accrued by this position. Past performance is not indicative of future results. Calculations are an estimate and only for reference."}):""}})]},s.value):null)]}),e.jsx(R,{w:"100%",maxH:"440px",overflow:"auto",gap:"12px",children:D&&(L==null?void 0:L.length)===0?(O=p==null?void 0:p.list)==null?void 0:O.map((s,h)=>e.jsx(Y,{w:"100%",bg:"position_bg",border:"none",p:{base:"16px 8px 12px",lg:"20px 16px "},borderRadius:"16px",children:e.jsx(l,{w:"100%",justify:"space-between",flexDirection:{base:"column",lg:"row"},children:e.jsxs(R,{w:"100%",align:"flex-start",gap:"14px",children:[g&&e.jsxs(l,{flexDirection:{base:"column",lg:"row"},w:{base:"100%",lg:"unset"},gap:"12px",children:[e.jsxs(l,{w:{base:"100%",lg:"unset"},justify:{base:"space-between",lg:"flex-start"},children:[e.jsx(x,{color:"primary_gray",fontSize:{base:"14px",lg:"12px"},children:"NFT ID"}),e.jsx(w,{isLoaded:!1,h:"14px"})]}),e.jsxs(l,{w:{base:"100%",lg:"unset"},justify:{base:"space-between",lg:"flex-start"},children:[e.jsx(x,{color:"primary_gray",fontSize:{base:"14px",lg:"12px"},ml:{base:"0",lg:"8px"},children:"Address"}),e.jsx(w,{isLoaded:!1,h:"14px"})]})]}),e.jsxs(l,{w:"100%",justify:"space-between",flexDirection:{base:"column",lg:"row"},gap:{base:"14px",lg:"8px"},children:[e.jsxs(l,{minW:{base:"unset",lg:a[0]},w:{base:"100%",lg:a[0]},justify:{base:"space-between",lg:"flex-start"},children:[g&&e.jsx(x,{color:"primary_gray",whiteSpace:"nowrap",children:"Price Range"}),e.jsx(w,{isLoaded:!1,h:"14px",w:{base:"96px",lg:"40%"}})]}),e.jsxs(l,{w:{base:"100%",lg:a[1]},justify:{base:"space-between",lg:"flex-end"},children:[g&&P&&e.jsx(l,{gap:"2px",children:e.jsx(x,{color:"primary_gray",children:"APR"})}),e.jsx(w,{isLoaded:!1,h:"14px"})]}),e.jsxs(l,{w:{base:"100%",lg:a[2]},justify:{base:"space-between",lg:"flex-end"},children:[g&&e.jsx(x,{color:"primary_gray",children:"Liquidity"}),e.jsx(w,{isLoaded:!1,h:"14px"})]}),e.jsxs(l,{w:{base:"100%",lg:a[3]},justify:{base:"space-between",lg:"flex-end"},children:[g&&e.jsx(x,{color:"primary_gray",children:"Claimable Yield"}),e.jsx(w,{isLoaded:!1,h:"14px"})]}),e.jsxs(l,{w:{base:"100%",lg:a[4]},justify:{base:"space-between",lg:"flex-end"},children:[g&&e.jsx(x,{color:"primary_gray",children:"Est. Daily Yield"}),e.jsx(w,{isLoaded:!1,h:"14px"})]}),!P,!P,e.jsx(l,{w:{base:"100%",lg:a[5]},justify:{base:"space-between",lg:"flex-end"},children:e.jsx(w,{isLoaded:!1,h:{base:"20px",lg:"14px"},w:{base:"100%",lg:"96px"}})})]})]})})},h)):L.map(s=>e.jsx(je,{poolType:"clmm",positionInfo:s,positionItemWidth:a,priceDirect:i,showMiningIcon:_,showFarmingIcon:T&&(!g||s.posType=="farms")},s==null?void 0:s.id))})]})}export{Ee as P,ke as V};
