import{f as T,e as Z,Z as m,d as u,E as A,bL as $,ad as I,i as J,n as V,bM as X}from"./index-Lo8eQgA0.js";import{u as tt}from"./activeOrders-Blk-EQ9B.js";import"./vendor-CBmAETR3.js";import"./cross-J9VCREIf.js";function at(){const e=T("dca");return{dcaCloseOrderPayload:async t=>await e.Dca.dcaCloseOrderPayload(t)}}function ut(){const e=T("dca");return{dcaWithdrawPayload:async t=>(console.log("ðŸš€ðŸš€ðŸš€ ~ file: useDcaClaim.ts:12 ~ params:",t),await e.Dca.withdrawAll(t))}}function et(e){const l=Math.floor(e/2592e3);e%=2592e3;const y=Math.floor(e/604800);e%=604800;const O=Math.floor(e/86400);e%=86400;const c=Math.floor(e/3600);e%=3600;const f=Math.floor(e/60);e%=60;const D=[];return l>0&&D.push(`${l} Month${l>1?"s":""}`),y>0&&D.push(`${y} Week${y>1?"s":""}`),O>0&&D.push(`${O} Day${O>1?"s":""}`),c>0&&D.push(`${c} Hour${c>1?"s":""}`),f>0&&D.push(`${f} Minute${f>1?"s":""}`),D.join(" ")}function lt(){const{getTokenListInfo:e}=Z(),{setDcaOrderListLoading:v,setDcaActiveOrderList:t,setDcaPastOrderList:g}=tt(),C=T("dca"),P=async(i,n=!0)=>{var s;console.log("ðŸš€ ~ getDcaOrderList ~ walletAddress:",i);try{const o=await C.Dca.getDcaOrders(i);if(console.log("ðŸš€ ~ getDcaOrderList ~ list:",o),o&&(o!=null&&o.data)&&((s=o==null?void 0:o.data)==null?void 0:s.length)>0){const{activeResult:_,pastResult:d}=await D(o==null?void 0:o.data);console.log("ðŸš€ ~ getDcaOrderList ~ activeResult, pastResult:",{activeResult:_,pastResult:d}),t(_),g(d)}else t([]),g([])}catch(o){console.log("ðŸš€ ~ getDcaOrderList ~ error:",o),t([]),g([])}finally{v(!1)}},l=async i=>{try{const n=await e(i),s=new Map;return n==null||n.forEach((o,_)=>{const d=I.pow(10,o==null?void 0:o.decimals);s.set(_,{token:o,decimalsPow:d})}),s}catch(n){console.log("ðŸš€ ~ getTokenListDetails ~ error:",n)}},y=(i,n,s,o,_)=>{const d=u(i).div(n).div(u(o).div(s)).toString(),N=u(i).div(n).div(u(_).div(s)).toString();return{minPrice:d,maxPrice:N,minPriceResever:u(1).div(u(N)).toString(),maxPriceResever:u(1).div(u(d)).toString()}},O=i=>i.in_withdrawn>0&&i.in_withdrawn==i.in_deposited?"Close":i.in_withdrawn>0&&i.out_withdrawn>0?"PartialDeal":i.amount_left_next_cycle==0&&i.next_cycle_at==0?"AllDeal":"Active",c=(i,n,s,o,_,d,N)=>{const r=a=>a==="--"?"--":u(1).div(a).toString();switch(i){case"Close":return{currentAvgPrice:"--",currentAvgPriceResever:"--",inBalanceRatio:"0",inDepositedOut:"0"};case"PartialDeal":{const a=n.sub(s).div(d).toString(),S=n.sub(s).div(n).mul(100).toDP(2,I.ROUND_HALF_UP).toString();return{currentAvgPrice:a,currentAvgPriceResever:r(a),inBalanceRatio:S,inDepositedOut:n.sub(s).toString()}}case"AllDeal":{const a=n.div(d).toString();return{currentAvgPrice:a,currentAvgPriceResever:r(a),inBalanceRatio:"100",inDepositedOut:n.sub(o).toString()}}case"Active":{const a=_.gt(0)||d.gt(0)?n.sub(o).div(_.add(d)).toString():"--",S=n.sub(o).div(n).mul(100).toDP(2,I.ROUND_HALF_UP).toString();return{currentAvgPrice:a,currentAvgPriceResever:r(a),inBalanceRatio:S,inDepositedOut:n.sub(o).toString()}}default:return{currentAvgPrice:"--",currentAvgPriceResever:"--",inBalanceRatio:"0",inDepositedOut:"0"}}},f=(i,n,s,o)=>{const _=Date.now()/1e3,d=u(_).sub(i).div(n),N=s.lte(0)&&u(o).lte(0);return d.gt(3)&&N},D=async i=>{const n=[],s=[],o=new Set;i==null||i.forEach(r=>{o.add(m(r.in_coin_type,!1)),o.add(m(r.out_coin_type,!1))});const _=await l(Array.from(o));if(_)for(const r of i)try{const{token:a,decimalsPow:S}=_.get(m(r.in_coin_type,!1)),{token:H,decimalsPow:h}=_.get(m(r.out_coin_type,!1)),p=u(r.in_deposited).div(S),M=u(r.in_deposited).div(r.in_amount_per_cycle).floor().toString(),x=u(r.in_amount_per_cycle).div(S).toString(),w=u(r.in_balance).div(S),k=u(r.in_withdrawn).div(S),R=u(r.out_balance).gt(0)?u(r.out_balance).div(h):u(0),b=u(r.out_withdrawn).div(h),B=A(p.div(M).toString()),U=w.div(x).floor().toNumber(),{minPrice:Y,maxPrice:j,minPriceResever:G,maxPriceResever:K}=y(r.in_amount_per_cycle,S,h,r.max_out_amount_per_cycle,r.min_out_amount_per_cycle),E=O(r),{currentAvgPrice:L,currentAvgPriceResever:q,inBalanceRatio:z,inDepositedOut:F}=c(E,p,k,w,R,b,S),Q=f(Number(r.created_at),Number(r.cycle_frequency),R,b),W={createAt:$(Number(r.created_at)*1e3,"YMDHM"),cycleFrequency:r.cycle_frequency,orderID:r.id,inAmountPerCycle:x,nextCycleAt:$(Number(r.next_cycle_at)*1e3,"YMDHM"),inDeposited:p.toString(),cycleCount:M,inDepositedOut:F,inBalance:w.toString(),minPrice:A(Y),maxPrice:A(j),minPriceResever:A(G),maxPriceResever:A(K),inCoin:a,outCoin:H,outBalance:R.toString(),inBalanceRatio:z,outWithdraw:b.toString(),investEvery:et(Number(r.cycle_frequency)),eachOrderSize:B,currentAvgPrice:L==="--"?"--":A(L,H.decimals),currentAvgPriceResever:L==="--"?"--":A(q,a.decimals),orderStatus:E,inWithdrawn:k.toString(),ofOrderLeft:U,isShowTradeTips:Q,next_cycle_at:r.created_at+U*Number(r.cycle_frequency),nextCycleAtTimeStamp:Number(r.next_cycle_at)*1e3,created_at:r.created_at,version:r.version};E==="Active"?n.push(W):s.push(W)}catch(a){console.log("ðŸš€ ~ buildDcaOrderList ~ error:",a)}const d=n==null?void 0:n.sort((r,a)=>a.version-r.version),N=s==null?void 0:s.sort((r,a)=>a.version-r.version);return console.log("ðŸš€ ~ buildDcaOrderList ~ activeResult, pastResult:",{activeResult:n,pastResult:s}),{activeResult:d,pastResult:N}};return{getDcaOrderList:P,buildDcaOrderList:D}}const rt=(e,v)=>({whiteTokenList:void 0,setWhiteTokenList:t=>{e(()=>({whiteTokenList:t}))},upperPriceSize:"0%",setUpperPriceSize:t=>{e(()=>({upperPriceSize:t}))},lowerPriceSize:"0%",setLowerPriceSize:t=>{e(()=>({lowerPriceSize:t}))},dcaMode:"total",setDcaMode:t=>{e(()=>({dcaMode:t}))},isDcaRefresh:!1,setIsDcaRefresh:t=>{e(()=>({isDcaRefresh:t}))},pageDirect:!1,setPageDirect:t=>{e(()=>({pageDirect:t}))},sellTotalAmount:"",setSellTotalAmount:t=>{e(()=>({sellTotalAmount:t}))},sellAmount:"",setSellAmount:t=>{e(()=>({sellAmount:t}))},buyAmount:"",setBuyAmount:t=>{e(()=>({buyAmount:t}))},sellCoin:void 0,setSellCoin:t=>{e(()=>({sellCoin:t}))},buyCoin:void 0,setBuyCoin:t=>{e(()=>({buyCoin:t}))},orderNum:"2",setOrderNum:t=>{e(()=>({orderNum:t}))},investNum:"1",setInvestNum:t=>{e(()=>({investNum:t}))},currentCoinKey:"sellCoin",setCurrentCoinKey:t=>{e(()=>({currentCoinKey:t}))},currentInvest:"Hour",setCurrentInvest:t=>{e(()=>({currentInvest:t}))},pageLoading:!0,setPageLoading:t=>{e(()=>({pageLoading:t}))},dcaConfig:{},setDcaConfig:t=>{e(()=>({dcaConfig:t}))},dcaQuote:{},setDcaQuote:t=>{e(()=>({dcaQuote:t}))},orderHistoryObj:{},setOrderHistoryObj:t=>{e(()=>({orderHistoryObj:{...v().orderHistoryObj,...t}}))},inCoinWhiteList:[],setInCoinWhiteList:t=>{e(()=>({inCoinWhiteList:t}))},outCoinWhiteList:[],setOutCoinWhiteList:t=>{e(()=>({outCoinWhiteList:t}))}}),ot=J(rt);function dt(){const{fetchByApi:e}=V(),{setOrderHistoryObj:v}=ot();return{getDcaOrderHistory:async({orderId:g,limit:C,offset:P})=>{var y;const l=await e(X,"GET",{order_id:g,limit:C,offset:P});if(console.log("ðŸš€ ~ file: useGetDcaOrderHistory.ts:16 ~ useGetDcaOrderHistory ~ res:",l),l!=null&&l.list){const O={[g]:{list:((y=l==null?void 0:l.list)==null?void 0:y.map(c=>({inAmount:c==null?void 0:c.in_amount,outAmount:c==null?void 0:c.out_amount,inCoinType:c==null?void 0:c.in_coin,outCoinType:c==null?void 0:c.out_coin,time:c==null?void 0:c.execution_at,tx:c==null?void 0:c.tx})))||[],total:(l==null?void 0:l.total)||0}};return v(O),O}}}}export{at as a,lt as b,dt as c,ot as d,ut as u};
