import{j as t,H as se,B as vi,T as I,r as n,V as we,m as xi,C as Ci,at as Yt,au as Jt,av as Qt,aw as vt,S as zi,a6 as St,a7 as _t,a8 as mt,w as Vi,l as Tt,Q as qt,ab as Xt,ad as Zt,i as jt,ao as Kt}from"./vendor-CBmAETR3.js";import{A as Ot}from"./index-DfyAgMoy.js";import{C as Bt}from"./CoinPairInfo-BH5hoU3X.js";import{u as Ct,i as It,a as rt,b as ut,S as Ji}from"./StatsInfo-ITdjG0na.js";import{S as Pt}from"./StatusPosition-CL7kLY-2.js";import{C as es,B as is,F as ts,u as Ft,P as wt,S as lt}from"./useCreatePriceBin-bOk7VAIh.js";import{u as gt}from"./index-C7OfScvw.js";import{u as bi,b as ss,c as Dt,l as ns,m as os}from"./usePositionList-heG2hQcx.js";import{a as qe,u as cs,b as ls}from"./detail-C9A3dtWB.js";import{aG as as,Q as Li,aj as ki,ai as Pe,d as ye,s as gi,aW as dt,u as _i,l as Ge,t as ei,w as Ii,cS as at,C as Si,I as fi,f as Et,a as Ni,z as $,M as xt,T as Zi,bn as Ki,L as ui,c8 as Oi,p as Pi,ah as zt,dj as ps,E as Qi,ad as qi,n as ds,dk as rs,aw as us,j as Mt,av as gs,aO as xs}from"./index-BpSfzecM.js";import{i as Xi,h as Rt,b as bs}from"./dlmm-DdxfaipV.js";import{S as hs}from"./Slippage-8fJCLOYr.js";import"./cross-DJ28FxNa.js";import{M as Nt}from"./msafe-BzcjPV-e.js";import{f as Ri}from"./index-gw6wWhzj.js";import{u as et}from"./useAccountBalance-DV0qM_Vy.js";import{u as Ei}from"./index-CbQm3ih3.js";import{u as Vt}from"./useTransactionModal-DL7w_I3R.js";import{u as kt}from"./useTokenBalance-c3RAkCCY.js";import{u as bt}from"./useTransaction-uEos3ZjK.js";import{b as ht,u as fs}from"./usePosClaimFeeAndReward-COsUjXqP.js";import{v as Wt}from"./v4-C6aID195.js";import{H as Bi}from"./HTextLabelBox-D0r99Smv.js";import{E as Ht}from"./ErrorTips-lJshH5MT.js";import{A as $t}from"./AutoClaimCheckBox-lw6rJPdV.js";import{C as ys}from"./CetusMenu-D6ll9Vbb.js";import{P as As}from"./RemoveBlock-C31WZQk2.js";import{T as hi}from"./DetailStatsInfo-aLrG-HRU.js";import{u as vs}from"./swapWidget-DsvWJZa9.js";import{B as Ss}from"./BackButton-DoozH78n.js";import{R as _s}from"./RefreshButton-bgRHxGzR.js";import{u as pt}from"./useInterval-FApnpfRj.js";import{u as ms}from"./useRpcListener-BdFabOsZ.js";import"./config-DTm0VBgZ.js";import"./PoolTag-DVhitHGR.js";import"./useGetDlmmContractPoolInfo-D5UWB-8X.js";import"./utils-CMHkC_9A.js";import"./useWrapPoolData-CMGMCXwG.js";import"./en_US-KAK2ZBDO-C1Pw6Q2s.js";import"./useGetDlmmPoolList-DgjXNLvP.js";import"./addDlmmLiquidity-BTnvpcHs.js";import"./maxBy-BjNHtTns.js";import"./VTextLabelBox-CuuDZpMe.js";import"./icon_active_new@2x-Bekkt6Xc.js";import"./YAxis-DLEZvSSr.js";import"./generateCategoricalChart-CmRMqbFo.js";import"./debounce-MPJy35Ge.js";import"./BarChart-3cDt1x1m.js";import"./ActionButton-1ExqaF95.js";import"./InputBox-DUnOULwS.js";import"./objectSpread2-B-AaJtUa.js";import"./useFavoritePool-5MLb1oZG.js";import"./useGetPoolList-4kFQ2tyG.js";import"./TooltipIcon-DVhxXZmh.js";import"./index-D8UqOC8m.js";import"./useTrack-Cdn9qear.js";import"./useSigner-Ct94kXtL.js";import"./LiquidityValueBlock-CJnPKpci.js";import"./CheckBox-eomO844M.js";import"./useDocumentSize-BLl0gbMB.js";import"./addLiquidity-DNM9DGI2.js";import"./FreshProgressV2-DfCij7Ow.js";import"./index-CgYRIMgB.js";import"./index-Dq_SzPY7.js";import"./useSwapHelper-RreJ3kMc.js";import"./detail-Cbbl8wNo.js";import"./index-CqgM3rES.js";import"./usePreviousValue-Da-o2xpb.js";const js="#00D8B6",ws="#4A9AEF";function Ms({baseSymbol:e,quoteSymbol:r}){return t.jsxs(se,{gap:"12px",children:[t.jsx(Lt,{symbol:e,color:ws}),t.jsx(Lt,{symbol:r,color:js})]})}function Lt({symbol:e,color:r}){return t.jsxs(se,{gap:"8px",children:[t.jsx(vi,{w:"8px",h:"8px",bg:r,borderRadius:"2px"}),t.jsx(I,{fontSize:"12px",children:e})]})}function Rs(e,r=!0,s){var ne,ie;const{dlmmCurrentPosBaseInfo:i,dlmmPosPoolsOriginalData:o,dlmmPosLiquidityData:p,posChartRefreshTrigger:a}=bi(),[f,Q]=n.useState([]),{isInitialized:U}=as(),{binInfos:y,currentPosDetailTab:u,setMinPriceData:c,setMaxPriceData:A,setShowPositionSelectRange:S}=qe(),[ee,B]=n.useState(),[j,_]=n.useState(),[J,ue]=n.useState(!1),{getBinsInfoByPool:H}=Ct(),[v,C]=n.useState({}),{getTokenPrice:ce}=Li(),D=ce((ne=i==null?void 0:i.tokenA)==null?void 0:ne.coin_type),L=ce((ie=i==null?void 0:i.tokenB)==null?void 0:ie.coin_type),T=n.useMemo(()=>o==null?void 0:o[i==null?void 0:i.dlmmPool],[i==null?void 0:i.dlmmPool,o]);ki(()=>{var g;if(i!=null&&i.id&&(p!=null&&p[i==null?void 0:i.id])){const te=(g=p==null?void 0:p[i==null?void 0:i.id])==null?void 0:g.binInfos,h=(te==null?void 0:te.bins)||[];Q(h)}},[i==null?void 0:i.id,p]);const Me=(g,te,h,R,W)=>{var fe,Ve;if(!g||(g==null?void 0:g.length)===0||!T||!h||!R)return[];const l=W==="increase",Z=te||[],P=h==null?void 0:h.decimals,oe=R==null?void 0:R.decimals,N=Object.fromEntries(Z==null?void 0:Z.map(b=>[String(b.bin_id),{...b,isIncrease:l,baseAmount:gi(b==null?void 0:b.amount_a,P),quoteAmount:gi(b==null?void 0:b.amount_b,oe)}])),O=(g==null?void 0:g.length)>150;let F=0;const x=T==null?void 0:T.bin_step,G=(b,m,le)=>{const pe=ye(b==null?void 0:b.liquidity).div(Math.pow(10,10)).toNumber(),q=m!=null&&m.liquidity?ye(m.liquidity).div(Math.pow(10,10)).toNumber():0,Y=le?ye(pe).add(q).toNumber():pe;F=Math.max(F,Y);const Ae=Pe(Xi(b==null?void 0:b.bin_id,x,h==null?void 0:h.decimals,R==null?void 0:R.decimals)),Ue=ye(1).div(Ae).toString(),Te=gi(b==null?void 0:b.amount_a,P),Xe=gi(b==null?void 0:b.amount_b,oe);let Oe,Be,ai,ge;if((b==null?void 0:b.bin_id)===E){const si=ye(Te).mul(Ae).add(Xe);Oe=ye(Te).mul(Ae).div(si).toString(),Be=ye(Xe).div(si).toString();const xe=gi(m==null?void 0:m.amount_a,P),Se=gi(m==null?void 0:m.amount_b,oe),he=ye(xe).mul(Ae).add(Se);ai=ye(xe).mul(Ae).div(he).toString(),ge=ye(Se).div(he).toString()}const mi=e?Ue:Ae;return{...b,liquidity:pe,totalLiquidity:Y,totalAmountA:le&&(m!=null&&m.amount_a)?ye(b.amount_a).add(m.amount_a).toString():b.amount_a,totalAmountB:le&&(m!=null&&m.amount_b)?ye(b.amount_b).add(m.amount_b).toString():b.amount_b,newBins:{...m,liquidity:q,...(b==null?void 0:b.bin_id)===E&&{quantityA:ai,quantityB:ge}},price:r?mi:ye(1).div(mi).toString(),type:W,baseSymbol:h==null?void 0:h.symbol,quoteSymbol:R==null?void 0:R.symbol,baseLogo:h==null?void 0:h.logo_url,quoteLogo:R==null?void 0:R.logo_url,baseAmount:Te,quoteAmount:Xe,quantityA:Oe,quantityB:Be,noRadius:O}},z=g.map(b=>G(b,N==null?void 0:N[String(b==null?void 0:b.bin_id)],l));if(E!==void 0&&x!==void 0&&((fe=z==null?void 0:z[0])==null?void 0:fe.bin_id)>E){const b=Pe(Xi(E,x,P,oe)),m=ye(1).div(b).toString(),le=e?m:b;z.unshift({bin_id:E,price:r||r===void 0?le:ye(1).div(le).toString(),liquidity:void 0})}if(E!==void 0&&x!==void 0&&((Ve=z==null?void 0:z[(z==null?void 0:z.length)-1])==null?void 0:Ve.bin_id)<E){const b=Pe(Xi(E,x,P,oe)),m=ye(1).div(b).toString(),le=e?m:b;z.push({bin_id:E,price:r||r===void 0?le:ye(1).div(le).toString(),liquidity:void 0})}const ke=z.sort((b,m)=>Number(b==null?void 0:b.price)-Number(m==null?void 0:m.price));B({list:ke,max:F})};ki(()=>{(f==null?void 0:f.length)>0&&(i!=null&&i.id)&&Me(f,y==null?void 0:y.bins,i==null?void 0:i.tokenA,i==null?void 0:i.tokenB,u)},[f,y==null?void 0:y.bins,i,u,r,e,T==null?void 0:T.active_id]),n.useEffect(()=>{var g,te,h;U&&((g=T==null?void 0:T.bin_manager)!=null&&g.bin_manager_handle)&&(T==null?void 0:T.id)===(i==null?void 0:i.dlmmPool)&&(ue(!0),H({pool_id:T.id,coin_type_a:T.coin_type_a,coin_type_b:T.coin_type_b},(te=i==null?void 0:i.tokenA)==null?void 0:te.decimals,(h=i==null?void 0:i.tokenB)==null?void 0:h.decimals).then(R=>{C(R.allBinObj),s(R.binList)}).finally(()=>{ue(!1)}))},[T==null?void 0:T.id,i==null?void 0:i.dlmmPool,U,a]),ki(()=>{if((T==null?void 0:T.active_id)!==void 0&&(T!=null&&T.id)&&(T==null?void 0:T.id)===(i==null?void 0:i.dlmmPool)&&!It(v)){const g=[],te=i==null?void 0:i.lowerBinId;console.log("0829 pos test###ðŸš€ ~ useDlmmPosChart ~ lower:",te);const h=i==null?void 0:i.upperBinId;console.log("0829 pos test###ðŸš€ ~ useDlmmPosChart ~ upper:",h);const R=T==null?void 0:T.binStep,W=i==null?void 0:i.tokenA,l=i==null?void 0:i.tokenB;let Z=0;for(let oe=te;oe<=h;oe+=1){const N=v==null?void 0:v[String(oe)],O=Pe(Xi(oe,R,W==null?void 0:W.decimals,l==null?void 0:l.decimals)),F=e?ye(1).div(O).toString():O,x=ye((N==null?void 0:N.liquidity)||"0").div(Math.pow(10,10)).toNumber();g.push({amount_a:(N==null?void 0:N.amount_a)||"0",amount_b:(N==null?void 0:N.amount_b)||"0",bin_id:oe,liquidity:x,price:r?F:ye(1).div(F).toString(),priceOrigin:Number(r?F:ye(1).div(F).toString()),price_per_lamport:(N==null?void 0:N.price_per_lamport)||"",baseSymbol:W==null?void 0:W.symbol,quoteSymbol:l==null?void 0:l.symbol,baseAmount:gi(N==null?void 0:N.amount_a,W==null?void 0:W.decimals),quoteAmount:gi(N==null?void 0:N.amount_b,l==null?void 0:l.decimals),baseLogo:W==null?void 0:W.logo_url,quoteLogo:l==null?void 0:l.logo_url}),Z=Math.max(Z,x)}g&&(g==null?void 0:g.length)===1&&S(!1);const P=g.sort((oe,N)=>Number(oe==null?void 0:oe.priceOrigin)-Number(N==null?void 0:N.priceOrigin));_({list:P,max:Z})}},[T==null?void 0:T.active_id,i==null?void 0:i.dlmmPool,v,r,e]);const V=(g,te)=>{var l,Z;const h=T==null?void 0:T.bin_step,R=(l=i==null?void 0:i.tokenA)==null?void 0:l.decimals,W=(Z=i==null?void 0:i.tokenB)==null?void 0:Z.decimals;if(h!==void 0&&R!==void 0&&W!==void 0&&g!==void 0&&te!==void 0){const P=dt.getPriceFromBinId(g,h,R,W),[oe,N,O]=Rt(P),F=dt.getPriceFromBinId(te,h,R,W),[x,G,z]=Rt(F),ke={binId:g,price:P,displayPrice:oe,reversePrice:N,displayReversePrice:O,type:"lower"},fe={binId:te,price:F,displayPrice:x,reversePrice:G,displayReversePrice:z};c(ke),A(fe)}},E=n.useMemo(()=>T==null?void 0:T.active_id,[T==null?void 0:T.active_id]);return{currentLiquidityBins:ee,activeBin:E,maxBinRangeData:j,handleRangeChange:V,maxBinLoading:J,tokenAPrice:D==null?void 0:D.price,tokenBPrice:L==null?void 0:L.price}}function ks({direct:e,isReverse:r,poolAllBinObjCallback:s}){const{currentLiquidityBins:i,activeBin:o,maxBinRangeData:p,handleRangeChange:a,maxBinLoading:f,tokenAPrice:Q,tokenBPrice:U}=Rs(r,e,s),{windowWidth:y}=_i(),u=n.useMemo(()=>y<810?y-44:652,[y]);return t.jsxs(we,{gap:"8px",h:"260px",children:[t.jsx(es,{width:u,activeBin:Number(o),data:i,height:162,fromPosition:!0,direct:e,isReverse:r,tokenAPrice:Q,tokenBPrice:U}),t.jsx(is,{activeBin:Number(o),data:p,width:u,height:60,isSimple:!0,onChangeRange:a,type:"row",isReverse:r,currentLiquidityBins:i,maxBinLoading:f})]})}function Ls({positionApr:e,isAprLoading:r}){var C,ce;const{dlmmCurrentPosBaseInfo:s,dlmmPosPoolsRelatedData:i,dlmmPosLiquidityData:o}=bi(),{setDlmmPosDetailDirect:p,dlmmPosDetailDirect:a}=qe(),{dlmmApiPoolInfo:f}=gt(),[Q,U]=n.useState([]),[y,u]=n.useState("30D"),c=n.useMemo(()=>a?s==null?void 0:s.displayTokenB:s==null?void 0:s.displayTokenA,[s,a]),A=n.useMemo(()=>a?s==null?void 0:s.displayTokenA:s==null?void 0:s.displayTokenB,[s,a]),S=n.useMemo(()=>i==null?void 0:i[s==null?void 0:s.id],[s==null?void 0:s.id,i]);n.useMemo(()=>o==null?void 0:o[s==null?void 0:s.id],[s==null?void 0:s.id,o]);const[ee,B]=n.useState();n.useEffect(()=>{if(A){const D=A==null?void 0:A.coin_type;B(D)}},[A==null?void 0:A.coin_type]);const j=n.useMemo(()=>Ge(s==null?void 0:s.displayTokenA)&&Ge(s==null?void 0:s.displayTokenB)?[s.displayTokenA,s.displayTokenB].filter(Boolean).map(D=>({label:D==null?void 0:D.symbol,key:D==null?void 0:D.coin_type,isToken:!0,imgInfo:{src:D==null?void 0:D.logo_url,w:"16px",h:"16px",coinType:D?D==null?void 0:D.coin_type:"",showTagWidth:"8px",showTagHeight:"8px"}})):[],[s==null?void 0:s.displayTokenA,s==null?void 0:s.displayTokenB]),_=n.useMemo(()=>a?S==null?void 0:S.currentPrice:S==null?void 0:S.currentPriceReverse,[S,a]),J=n.useMemo(()=>a?S==null?void 0:S.minPrice:S==null?void 0:S.minPriceResever,[S,a]),ue=n.useMemo(()=>a?S==null?void 0:S.maxPrice:S==null?void 0:S.maxPriceResever,[S,a]),H=n.useMemo(()=>[_,J,ue].some(D=>(D==null?void 0:D.length)>10),[_,J,ue]),v=D=>{U(D)};return t.jsxs(we,{width:"100%",bg:"bg_secondary",borderRadius:"16px",p:{base:"16px 8px ",lg:"16px"},gap:"16px",children:[t.jsxs(se,{width:"100%",justifyContent:"space-between",align:{base:"fle-start",lg:"center"},flexDirection:{base:"column",lg:"row"},children:[t.jsx(I,{color:"text_caption",fontSize:"16px",mb:{base:"8px",lg:"0"},children:"Liquidity Distribution"}),t.jsxs(se,{gap:"20px",flexDirection:{base:"column-reverse",lg:"row"},align:{base:"fle-start",lg:"center"},children:[t.jsx(Ms,{baseSymbol:ei((C=s==null?void 0:s.displayTokenA)==null?void 0:C.symbol,8),quoteSymbol:ei(((ce=s==null?void 0:s.displayTokenB)==null?void 0:ce.symbol)||"",8)}),!j||!j.length?t.jsx(xi,{h:"32px",borderRadius:"8px",w:"180px"}):t.jsx(Ii,{type:"outlineTab",tabList:j,currentTab:ee,isActive:(D,L)=>D===L.key,handleChangeTab:()=>p(!a),wrapStyle:{h:"32px",p:"3px",border:"1px solid",borderColor:"border",borderRadius:"8px",gap:"4px",zIndex:"99"},itemStyle:{flex:"1",h:"24px",p:"4px 12px",borderRadius:"4px",gap:"4px"}})]})]}),t.jsx(se,{w:"100%",justify:{base:"flex-start",lg:"center"},children:t.jsx(ts,{price:_,perText:`${ei(c==null?void 0:c.symbol,8)} per ${ei(A==null?void 0:A.symbol,8)} `,showIcon:!1})}),t.jsx(ks,{direct:a,isReverse:s==null?void 0:s.isReverse,poolAllBinObjCallback:v}),t.jsxs(se,{w:"100%",justify:"space-between",flexDirection:{base:"column",lg:"row"},children:[t.jsxs(we,{w:{base:"100%",lg:"50%"},flexDirection:{base:"row",lg:"column"},justify:{base:"space-between",lg:"center"},alignItems:{base:"center",lg:"flex-start"},flex:"1",p:"12px",bg:"card_bg",borderRadius:"8px",children:[t.jsx(I,{fontSize:"14px",h:"20px",lineHeight:"20px",whiteSpace:"nowrap",children:"Price Range"}),t.jsx(xi,{h:"14px",isLoaded:J!==void 0&&ue!==void 0,children:t.jsx(se,{flexDir:H?"column":"row",alignItems:H?"flex-start":"center",children:t.jsx(I,{fontSize:"14px",color:"text_caption",children:J==ue?at(Pe(J)):`${at(Pe(J))} - ${at(Pe(ue))}`})})})]}),t.jsxs(we,{w:{base:"100%",lg:"50%"},flexDirection:{base:"row",lg:"column"},justify:{base:"space-between",lg:"center"},alignItems:{base:"center",lg:"flex-start"},flex:"1",p:"12px",bg:"card_bg",borderRadius:"8px",children:[t.jsx(se,{w:{base:"unset",lg:"100%"},justify:"space-between",children:t.jsx(Si,{tooltip:t.jsx(I,{fontSize:"12px",lineHeight:"20px",children:"APR based on the daily yield accrued by this position. Past performance is not indicative of future results. Calculations are an estimate and only for reference."}),children:t.jsxs(se,{gap:"4px",children:[t.jsx(I,{fontSize:"14px",h:"20px",lineHeight:"20px",children:"APR"}),t.jsx(fi,{xlinkHref:"#icon-icon_tips",fontSize:"20px"})]})})}),t.jsx(xi,{isLoaded:!!S,h:"14px",children:t.jsx(I,{color:"primary",children:e??"--"})})]})]})]})}function Ts(){const e=Et("dlmm"),{liquiditySlippage:r}=Ni(),{collectRewardAndFeePayload:s}=ht();return{dlmmPreAdd:async p=>{var D;const{activeId:a,binStep:f,lowerBinId:Q,upperBinId:U,amount:y,fromToken:u,toToken:c,strategy:A,fixAmountA:S,isReverse:ee,isAutoFill:B,otherAmount:j,pool:_}=p;let J;_&&(J=await((D=e==null?void 0:e.Position)==null?void 0:D.getActiveBinIfInRange(_==null?void 0:_.bin_manager.bin_manager_handle,Q,U,a,f)));const ue=B&&J,H={active_id:a,bin_step:f,lower_bin_id:Q,upper_bin_id:U,active_bin_of_pool:J,pool_id:_==null?void 0:_.id,strategy_type:A,...ue?{fix_amount_a:S,coin_amount:y}:{amount_a:S?y:j,amount_b:S?j:y}};console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosAdd.ts:30 ~ dlmmPreAdd ~ calculateAddLiquidityInfoParams:",H);const v=await(e==null?void 0:e.Position.calculateAddLiquidityInfo(H));console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosAdd.ts:32 ~ dlmmPreAdd ~ binInfos:",v,y,j,S,ee);const C=$(v==null?void 0:v.amount_a).div(10**(ee?c==null?void 0:c.decimals:u==null?void 0:u.decimals)).toString(),ce=$(v==null?void 0:v.amount_b).div(10**(ee?u==null?void 0:u.decimals:c==null?void 0:c.decimals)).toString();return{displayCoinAmountA:ee?ce:C,displayCoinAmountB:ee?C:ce,coinAmountA:C,coinAmountB:ce,binInfos:v}},getDlmmPosAddLiquidityPayload:(p,a)=>{const{dlmmPool:f,binInfos:Q,coinTypeA:U,coinTypeB:y,positionId:u,activeId:c,collectFee:A,rewardCoins:S,strategy:ee,binStep:B}=p;if(Q&&Q.bins&&Q.bins.length>0){const j=Q.bins.filter(J=>J.amount_a!=="0"||J.amount_b!=="0"),_=[];if((j==null?void 0:j.length)>1e3){const ue=Math.ceil(j.length/1e3);for(let H=0;H<ue;H++){const v=bs(j,H,1e3),C={position_id:u,active_id:c,reward_coins:[],pool_id:f,bin_infos:v,collect_fee:!1,coin_type_a:U,coin_type_b:y,strategy_type:ee,max_price_slippage:Number(r),use_bin_infos:!1,bin_step:B},ce=e==null?void 0:e.Position.addLiquidityPayload(C);_.push(ce),a&&H===ue-1&&(C.collect_fee=!1,C.reward_coins=S,s([{dlmmPool:f,positionId:u,rewardCoins:S,coinTypeA:U,coinTypeB:y}],ce))}}else{const J={position_id:u,active_id:c,reward_coins:a?S:[],pool_id:f,bin_infos:Q,collect_fee:a,coin_type_a:U,coin_type_b:y,strategy_type:ee,max_price_slippage:Number(r),use_bin_infos:!1,bin_step:B};console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosAdd.ts:66 ~ getDlmmPosAddLiquidityPayload ~ dlmmPosAddLiquidityParams:",J);const ue=e==null?void 0:e.Position.addLiquidityPayload(J);console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosAdd.ts:67 ~ getDlmmPosAddLiquidityPayload ~ payload:",ue),_.push(ue)}return _}}}}function Gt(){return{getTokenALock:(s,i)=>{if(Ge(s)&&Ge(i)){const{lowerBinId:o,upperBinId:p}=s;console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosHelper.ts:8 ~ getTokenALock ~ lowerBinId:",o),console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosHelper.ts:9 ~ getTokenALock ~ upperBinId:",p);const a=i==null?void 0:i.active_id;if(console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosHelper.ts:11 ~ getTokenALock ~ currentTickIndex:",o,a,p),a!==void 0&&o!==void 0&&p!==void 0)return a>=o&&a<=p?!1:a>p?!0:!(a<o)}return!1},getTokenBLock:(s,i)=>{if(Ge(s)&&Ge(i)){const{lowerBinId:o,upperBinId:p}=s,a=i==null?void 0:i.active_id;if(a!==void 0&&o!==void 0&&p!==void 0)return a>=o&&a<=p||a>p?!1:(a<o,!0)}return!1}}}function ft(){const e=Et("dlmm"),{dlmmPosBaseList:r,setCurrentPosBaseInfo:s,setDlmmCurrentPosBaseInfoLoading:i}=bi(),{wrapDlmmPosBaseInfo:o}=ss(),{getPosDlmmRelatedData:p}=Dt(),a=async(Q,U,y=!1)=>{console.log("ðŸš€ðŸš€ðŸš€ ~ useGetDlmmCurrentPos.ts:15 ~ getDlmmCurrentPosBaseInfo ~ getDlmmCurrentPosBaseInfo:",a),i(!0);const u=r.find(A=>A.id===U);console.log("ðŸš€ðŸš€ðŸš€ ~ useGetDlmmCurrentPos.ts:19 ~ getDlmmCurrentPosBaseInfo ~ posBaseInfoFrom:",u);let c=null;return u&&!y&&(c=u),(!c||y)&&(c=await f(Q,U)),console.log("getCurrentPosBaseInfo ~ posInfo:",r,c),s(c),c&&p([c]),c},f=async(Q,U)=>{const y=await e.FullClient.getOwnedObjectsByPage(Q,{options:{showType:!0,showContent:!0,showOwner:!0},filter:{ObjectId:U}});return y&&y.data.length>0?(console.log("ðŸš€ðŸš€ðŸš€ ~ useGetDlmmCurrentPos.ts:45 ~ getDlmmCurrentPosByPosId ~ ownerRes:",y),await o(y.data[0])):null};return{getDlmmCurrentPosBaseInfo:a,getDlmmCurrentPosByPosId:f}}function Fs(){ht();const{dlmmCurrentPosBaseInfo:e,dlmmPosLiquidityData:r,dlmmPosPoolsRelatedData:s,dlmmPosPoolsOriginalData:i}=bi(),{setTokenAmountAfterA:o,setTokenAmountAfterB:p,minPriceData:a,maxPriceData:f,setMinPriceData:Q,setMaxPriceData:U}=qe(),{binInfos:y,setBinInfos:u,setPreCalcError:c,preCalcError:A}=qe(),{getTokenAmountValue:S}=Li(),{dlmmPreAdd:ee,getDlmmPosAddLiquidityPayload:B}=Ts(),{currentAccount:j}=xt(),{getTokenALock:_,getTokenBLock:J}=Gt(),[ue,H]=n.useState(!1),[v,C]=n.useState(!0),[ce,D]=n.useState(!1),{handleActionBinPrice:L,getNumBins:T}=Ft(),{strategy:Me,setStrategy:V,isAutoFill:E,setIsAutoFill:ne}=gt(),{dlmmPosDetailDirect:ie,isAutoClaim:g}=qe(),{transactionConfirmation:te}=Vt(),h=n.useMemo(()=>i[e==null?void 0:e.dlmmPool],[e==null?void 0:e.id,i]),[R,W]=n.useState(""),[l,Z]=n.useState(""),[P,oe]=n.useState(!1),[N,O]=n.useState(!1),[F,x]=n.useState(!0),[G,z]=n.useState(!1),[ke,fe]=n.useState(""),Ve=n.useRef("");n.useEffect(()=>{console.log("ðŸš€ ~ usePosAddPage ~ uuid:",ke),Ve.current=ke},[ke]);const b=n.useMemo(()=>e==null?void 0:e.displayTokenA,[e]),m=n.useMemo(()=>e==null?void 0:e.displayTokenB,[e]),le=n.useMemo(()=>e==null?void 0:e.tokenA,[e]),pe=n.useMemo(()=>e==null?void 0:e.tokenB,[e]),q=n.useMemo(()=>h==null?void 0:h.binStep,[h]),{buildPriceData:Y}=ut(le,pe,q),{balanceInfo:Ae}=kt(b),{balanceInfo:Ue}=kt(m),Te=S(b==null?void 0:b.coin_type,R),Xe=S(m==null?void 0:m.coin_type,l),Oe=()=>{W(""),Z(""),u({}),c(void 0)};n.useEffect(()=>{(!R||!+R)&&(!l||!+l)&&(u({}),c(void 0))},[R,l]);const Be=(k,ve)=>{if(!k&&E&&Oe(),x(ve),ve?W(k):Z(k),+k){const be=Wt();fe(be),console.log("ðŸš€ ~ handleAmountChange ~ params:",k)}else E&&(ve?Z(""):W(""))},ai=async(k,ve,be,ze=!1,Ce=!1)=>{E&&!G&&z(!0),console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosAddPage.ts:132 ~ debouncedDlmmPreAdd ~ amount:",k,ve,be);const Ee=h.binStep,oi=v?a.binId:e.lowerBinId,ci=v?f.binId:e.upperBinId;console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosAddPage.ts:140 ~ debouncedDlmmPreAdd ~ minPriceData.price:",{dlmmCurrentPosBaseInfo:e,selectLowerBinId:oi,selectUpperBinId:ci,minPriceData:a,maxPriceData:f});let di=$(oi).lt(e.lowerBinId)?e.lowerBinId:oi,d=$(ci).gt(e.upperBinId)?e.upperBinId:ci;di>d&&(di=e.lowerBinId,d=e.upperBinId);let w={pool:h,activeId:h.active_id,binStep:Ee,lowerBinId:di,upperBinId:d,strategy:Me,amount:$(k||0).mul(10**(be?b==null?void 0:b.decimals:m==null?void 0:m.decimals)).toString(),fixAmountA:e!=null&&e.isReverse?!be:be,fromToken:b,toToken:m,isReverse:e==null?void 0:e.isReverse,isAutoFill:E,otherAmount:$(ve||0).mul(10**(be?m==null?void 0:m.decimals:b==null?void 0:b.decimals)).toString()};console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosAddPage.ts:108 ~ debouncedDlmmPreAdd ~ params:",w);try{const{displayCoinAmountA:M,displayCoinAmountB:X,binInfos:ae}=await ee(w);u(ae),c(void 0),console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosAddPage.ts:166 ~ debouncedDlmmPreAdd ~ binInfos:",{binInfos:ae,params:w}),E&&(be?Ce||Z(X):ze||W(M))}catch(M){String(M).includes("is less than 1")?(c("amountTooSmall"),u({})):c(void 0)}},ge=()=>{if((R||l)&&Ge(e)){const k=F?R:l,ve=F?l:R;+k||+ve?(console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosAddPage.ts:199 ~ reCalculateResult ~ debouncedDlmmPreAdd:",k,"test",ve),ai(k,ve,F,P,N)):(u({}),c(void 0))}};n.useEffect(()=>{G&&setTimeout(()=>{z(!1)},500)},[G]);const mi=n.useMemo(()=>$(Te).add(Xe).toString(),[Te,Xe]),si=n.useMemo(()=>_(e,h),[h==null?void 0:h.active_id,e]),xe=n.useMemo(()=>J(e,h),[h==null?void 0:h.active_id,e]),Se=e!=null&&e.isReverse?xe:si,he=e!=null&&e.isReverse?si:xe,{dlmmMevProtect:Fe,maxCapForGas:_e,transactionMode:me,customGasPrice:Ye}=Ni(),{batchSignAndExecuteTransaction:Je}=bt(),{fetchAccountBalance:ni}=et(),{getDlmmCurrentPosBaseInfo:Wi}=ft(),{getList:it}=rt(),ii=async()=>{D(!0);let k={};const ve={dlmmPool:e.dlmmPool,coinTypeA:e.coinTypeA,coinTypeB:e.coinTypeB,positionId:e==null?void 0:e.id,activeId:h.active_id,collectFee:g,rewardCoins:g?h.reward_manager.rewards.map(w=>w.reward_coin):[],binInfos:y,strategy:Me,binStep:q};let be=[];console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosAddPage.ts:244 ~ toAdd ~ params:",ve);const{binInfos:ze,rewardCoins:Ce,...Ee}=ve;k={...Ee},Ce.length>0&&(k.rewardCoins=JSON.stringify(Ce));const oi=B(ve,g);be=be.concat(oi),console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosAddPage.ts:262 ~ toAdd ~ tx:",oi);const ci={action:Nt.DlmmIncreaseLiquidity,txbParams:ve},di={getShowInfo:(w,M,X,ae)=>{const K="Add "+[Ri(R,b==null?void 0:b.symbol),Ri(l,m==null?void 0:m.symbol)].filter(Boolean).join(" and "),Le={modalDescriptionText:K,toastTitleText:K},Ie=(ae==null?void 0:ae.failedResults)&&ae.failedResults.length>0&&ae.successResults.length>0;if(w==="rejected"&&Ie&&ae.failedResults.length>0&&(Le.toastDescriptionContent=`Failed transactions ${ae.failedResults.length} /${be.length} `),w==="success"){let He=R,Re=l;M&&(He=Ki(M,b)||R,Re=Ki(M,m)||l);const $e="Add "+[Ri(He,b==null?void 0:b.symbol),Ri(Re,m==null?void 0:m.symbol)].filter(Boolean).join(" and ");be.length>1?Le.toastDescriptionContent=`Completed transactions ${be.length} /${be.length} `:Le.toastDescriptionContent=$e,Le.modalDescriptionText=$e,Le.toastTitleText="Supplied Successful"}return Le}};be.length===1&&te(di),console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosAddPage.ts:299 ~ toAdd ~ tx:",oi);const d=await Je(be,di,{useMev:Fe,maxCapForGas:_e,customGasPrice:Ye,msafeParams:ci,trackData:{params:k,actionType:"dlmm",action:"dlmmIncreaseLiquidity"}});d!=null&&d.successResults?(Oe(),ni(),await it({poolId:e==null?void 0:e.dlmmPool}),Wi(j==null?void 0:j.address,e==null?void 0:e.id,!0)):e&&Wi(j==null?void 0:j.address,e==null?void 0:e.id,!0).then(w=>{console.log("ðŸš€ ~ toClaim ~ res:",w),ge()}),D(!1)},yi=()=>{ii()},[tt,Hi]=n.useState(""),[$i,Gi]=n.useState(""),ri=n.useMemo(()=>e==null?void 0:e.isReverse,[e]),de=n.useMemo(()=>s[e==null?void 0:e.id],[s,e==null?void 0:e.id]),We=n.useMemo(()=>r[e==null?void 0:e.id],[e==null?void 0:e.id,r]),ji=n.useMemo(()=>ie?de==null?void 0:de.minPrice:de==null?void 0:de.minPriceResever,[de,e==null?void 0:e.id,ie]),Ne=n.useMemo(()=>de==null?void 0:de.minPriceBinId,[de,e==null?void 0:e.id]),Ze=n.useMemo(()=>ie?de==null?void 0:de.maxPrice:de==null?void 0:de.maxPriceResever,[de,e==null?void 0:e.id,ie]),pi=n.useMemo(()=>de==null?void 0:de.maxPriceBinId,[de,e==null?void 0:e.id]),st=()=>{!e||!le||!pe||!q||(Yi([e.lowerBinId,e.upperBinId]),Hi(We==null?void 0:We.displayCoinAmountA),Gi(We==null?void 0:We.displayCoinAmountB))},[nt,Ui]=n.useState(!1);ki(()=>{We&&le&&pe&&q&&!nt&&(st(),Ui(!0)),Hi(We==null?void 0:We.displayCoinAmountA),Gi(We==null?void 0:We.displayCoinAmountB)},[ri,We,le,pe,q]);const Ti=n.useCallback((k,ve)=>{const be=ve.type==="lower";if(console.log("ðŸš€ ~ handlePriceAction ~ price:",{price:ve,isMinPrice:be,dlmmPosDetailDirect:ie,type:k,minPriceData:a,maxPriceData:f,dlmmCurrentPosBaseInfo:e}),q!==void 0&&le!==void 0&&pe!==void 0&&ji&&Ze&&Ne&&pi){const{bin_id:ze,price:Ce}=L(ve,q,le==null?void 0:le.decimals,pe==null?void 0:pe.decimals,k);if(be)if(k==="Sub"&&ze<Ne||k==="Add"&&ze>pi){const Ee=Y(Ne,be);Ee&&Q(Ee)}else{const Ee=Y(ze,be);Ee&&Q(Ee)}else if(k==="Sub"&&ze<Ne||k==="Add"&&ze>pi){const Ee=Y(pi,be);Ee&&U(Ee)}else{const Ee=Y(ze,be);Ee&&U(Ee)}}},[q,le,pe,ji,Ze,ie]),Yi=k=>{if(!le||!pe||!q)return;const ve=k[0],be=k[1],ze=Y(be,!1);ze&&U(ze);const Ce=Y(ve,!0);Ce&&Q(Ce)},[wi,yt]=n.useState(!0),At=n.useMemo(()=>wi?b:m,[b,m,wi]),ot=n.useMemo(()=>wi?m:b,[b,m,wi]);Ei(()=>{var k,ve,be,ze;if((y!=null&&y.amount_a||y!=null&&y.amount_b)&&!G&&e){let Ce=y.amount_a||"0",Ee=y.amount_b||"0";const oi=e.isReverse?Ee:Ce,ci=e.isReverse?Ce:Ee,di=e.isReverse?(k=e==null?void 0:e.tokenB)==null?void 0:k.decimals:(ve=e==null?void 0:e.tokenA)==null?void 0:ve.decimals,d=e.isReverse?(be=e==null?void 0:e.tokenA)==null?void 0:be.decimals:(ze=e==null?void 0:e.tokenB)==null?void 0:ze.decimals,w=Zi(oi,di),M=Zi(ci,d);o($(w).plus(tt).toString()),p($(M).plus($i).toString())}else o(""),p("")},[G,tt,$i,y==null?void 0:y.amount_a,y==null?void 0:y.amount_b],{wait:200}),n.useEffect(()=>()=>{Oe(),o(""),p("")},[]);const Mi=n.useMemo(()=>(de==null?void 0:de.currentStatus)==="Active",[de==null?void 0:de.currentStatus]);n.useEffect(()=>{Mi&&((h==null?void 0:h.active_id)>(f==null?void 0:f.binId)&&(h==null?void 0:h.active_id)>(a==null?void 0:a.binId)&&(oe(!ri),O(ri)),(h==null?void 0:h.active_id)<(f==null?void 0:f.binId)&&(h==null?void 0:h.active_id)<(a==null?void 0:a.binId)&&(oe(ri),O(!ri)),(h==null?void 0:h.active_id)<=(f==null?void 0:f.binId)&&(h==null?void 0:h.active_id)>=(a==null?void 0:a.binId)&&(oe(!1),O(!1)))},[h==null?void 0:h.active_id,a==null?void 0:a.binId,f==null?void 0:f.binId,Mi,ri]),n.useEffect(()=>{P&&(W(""),x(!1)),N&&(Z(""),x(!0)),!P&&!N&&(R&&!l&&x(!0),l&&!R&&x(!1))},[P,N]),n.useEffect(()=>{H(!Mi)},[Mi]);const Fi=n.useCallback(()=>{ne(!E),R!==""&&l===""&&x(!0),R===""&&l!==""&&x(!1)},[E,R,l]),Di=n.useMemo(()=>(a==null?void 0:a.binId)!==void 0&&(f==null?void 0:f.binId)!==void 0?T(a.binId,f.binId):"--",[a==null?void 0:a.binId,f==null?void 0:f.binId]),ct=n.useMemo(()=>{const k={text:"Add More Liquidity",disabled:!1};return j!=null&&j.address?A==="amountTooSmall"?(k.disabled=!0,k):!+R&&!+l?(k.text="Enter an amount",k.disabled=!0,k):!Se&&R&&$(R).gt((Ae==null?void 0:Ae.balanceFormat)||0)?(k.disabled=!0,k.text=`Insufficient ${ei(b==null?void 0:b.symbol,10)} Balance`,k):!he&&l&&$(l).gt((Ue==null?void 0:Ue.balanceFormat)||0)?(k.disabled=!0,k.text=`Insufficient ${ei(m==null?void 0:m.symbol,10)} Balance`,k):!si&&!xe&&!+R&&!+l&&E&&!P&&!N?(k.disabled=!0,k):((P&&!+l||N&&!+R)&&(k.text="Enter an amount",k.disabled=!0),k):(k.text="Connect Wallet",k.disabled=!1,k)},[R,l,Ae,Ue,j==null?void 0:j.address,E,P,N,b,m,Di]);return{displayTokenA:b,displayTokenB:m,tokenABalanceInfo:Ae,tokenBBalanceInfo:Ue,tokenAmountValueA:Te,tokenAmountValueB:Xe,tokenAmountA:R,tokenAmountB:l,handleAmountChange:Be,strategy:Me,setStrategy:V,dlmmPreAddLoading:G,isFixedDisplayTokenA:F,totalAmount:mi,btnStatusText:ct,showDisplayTokenALock:Se,showDisplayTokenBLock:he,displayTokenALock:P,displayTokenBLock:N,isAutoFill:E,isSelectRange:v,setIsSelectRange:C,handleAdd:yi,isAddLoading:ce,setIsAddLoading:D,posMinPrice:ji,posMaxPrice:Ze,posMinPriceBinId:Ne,posMaxPriceBinId:pi,minPriceData:a,maxPriceData:f,handlePriceAction:Ti,handleSlider:Yi,baseToken:At,quoteToken:ot,dlmmPosDetailDirect:ie,reCalculateResult:ge,setIsAutoFill:ne,setIsInitPrice:Ui,disabledAutoFill:ue,onAutoFillChange:Fi,numBins:Di,isReverse:ri,binStep:de==null?void 0:de.binStep,tokenA:le,tokenB:pe}}function Ut(e){const{baseToken:r,quoteToken:s,minPriceData:i,maxPriceData:o,handlePriceAction:p,posMinPrice:a,posMaxPrice:f,handleSlider:Q,isShowError:U,posMinPriceBinId:y,posMaxPriceBinId:u,isReverse:c,binStep:A,tokenA:S,tokenB:ee}=e,{setMinPriceData:B,setMaxPriceData:j}=qe(g=>({setMinPriceData:g.setMinPriceData,setMaxPriceData:g.setMaxPriceData})),{dlmmPosDetailDirect:_}=qe(),[J,ue]=n.useState(!1),{buildPriceData:H}=ut(S,ee,A),v=n.useMemo(()=>`${ei(_?s==null?void 0:s.symbol:r==null?void 0:r.symbol)} per ${ei(_?r==null?void 0:r.symbol:s==null?void 0:s.symbol)}`,[r==null?void 0:r.symbol,s==null?void 0:s.symbol,_]),C=n.useMemo(()=>i!=null&&i.displayPrice&&(o!=null&&o.displayPrice)?c?_?[o.binId*-1,i.binId*-1]:[i.binId,o.binId]:_?[i.binId,o.binId]:[o.binId*-1,i.binId*-1]:[],[i==null?void 0:i.binId,o==null?void 0:o.binId,_]),ce=n.useMemo(()=>c?_?u*-1:y:_?y:u*-1,[c,_,y,u]),D=n.useMemo(()=>c?_?y*-1:u:_?u:y*-1,[c,_,y,u]),L=n.useMemo(()=>ce===D,[ce,D]),T=n.useMemo(()=>L?ce-10:ce,[L,ce]),Me=n.useMemo(()=>L?D+10:D,[L,D]),V=n.useMemo(()=>L&&C.length===2?[T,Me]:C,[L,C,T,Me]),E=n.useMemo(()=>c!==_?i:o,[i==null?void 0:i.price,i==null?void 0:i.reversePrice,o==null?void 0:o.price,o==null?void 0:o.reversePrice,c,_]),ne=n.useMemo(()=>c!==_?o:i,[i==null?void 0:i.price,i==null?void 0:i.reversePrice,o==null?void 0:o.price,o==null?void 0:o.reversePrice,c,_]),ie=(g,te)=>{if(!S||!ee||!A)return;const h=Pe(te);let R=dt.getBinIdFromPrice(h,A,(g==null?void 0:g.type)==="lower",S==null?void 0:S.decimals,ee==null?void 0:ee.decimals);if(console.log({_binId:R,data:g,minPriceData:i,maxPriceData:o,targetPrice:h,dlmmPosDetailDirect:_,isReverse:c,posMaxPriceBinId:u,posMinPriceBinId:y,value:te},"onPriceChange"),(R<y||R>u)&&(R=(g==null?void 0:g.type)==="lower"?y:u),(g==null?void 0:g.type)==="lower"){g.changeCount=g.changeCount?g.changeCount+1:1;const W=H(R,!0);W&&(W.changeCount=g.changeCount?g.changeCount+1:1,B(W))}else{g.changeCount=g.changeCount?g.changeCount+1:1;const W=H(R,!1);W&&(W.changeCount=g.changeCount?g.changeCount+1:1,j(W))}};return t.jsxs(we,{mt:"8px",w:"100%",children:[t.jsxs(we,{w:"100%",children:[t.jsxs(se,{w:"100%",justifyContent:"space-between",children:[t.jsx(I,{fontSize:"14px",color:"primary_gray",fontWeight:"500",children:"Select Range"}),t.jsxs(se,{gap:"4px",onClick:()=>{ue(!J)},cursor:"pointer",_hover:{svg:{fill:"text_caption"}},children:[t.jsx(Si,{maxW:"280px",tooltip:t.jsx(I,{fontSize:"12px",lineHeight:"20px",children:"Customize your price range within position to optimize liquidity efficiency."}),children:t.jsx(Ci,{bg:"primary_opacity.10",h:"24px",borderRadius:"12px",p:"4px 6px",children:t.jsx(I,{fontSize:"12px",color:"primary",children:"Advanced"})})}),t.jsx(fi,{xlinkHref:"#icon-icon_descending_nor",transform:J?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.5s",fontSize:"20px"})]})]}),J&&C.length>0&&a&&f&&t.jsxs(we,{w:"100%",gap:"8px",mt:"12px",children:[t.jsxs(Yt,{min:T,max:Me,step:1,value:V,onChange:g=>{console.log(g,"RangeSlider"),!L&&Q(c?_?[g[1]*-1,g[0]*-1]:g:_?g:[g[1]*-1,g[0]*-1])},colorScheme:"teal",children:[t.jsx(Jt,{bg:"bg_secondary",children:t.jsx(Qt,{})}),t.jsx(vt,{index:0}),t.jsx(vt,{index:1})]}),t.jsxs(se,{w:"100%",justifyContent:"space-between",children:[t.jsx(I,{children:a}),t.jsx(I,{children:f})]})]})]}),J&&E&&ne&&t.jsxs(zi,{mt:"4px",position:"relative",flexDir:{base:"column",lg:"row"},w:"100%",gap:{base:"8px",lg:"16px"},children:[t.jsx(vi,{opacity:1,w:{base:"100%",lg:"50%"},children:t.jsx(wt,{verifyAction:!1,title:"Min Price",perText:v,data:E,direct:_!==c,loading:!1,minPrice:a,maxPrice:f,subDisabled:(E==null?void 0:E.type)==="lower"?(E==null?void 0:E.binId)===y:(E==null?void 0:E.binId)===u,addDisabled:(E==null?void 0:E.binId)===(ne==null?void 0:ne.binId),onPriceChange:ie,handleAddPrice:g=>{p==null||p(_!==c?"Add":"Sub",g,!0)},handleSubPrice:g=>{p==null||p(_!==c?"Sub":"Add",g,!0)}})}),t.jsx(vi,{opacity:1,w:{base:"100%",lg:"50%"},children:t.jsx(wt,{verifyAction:!1,title:"Max Price",perText:v,data:ne,direct:_!==c,loading:!1,subDisabled:E.binId===ne.binId,addDisabled:(ne==null?void 0:ne.type)==="lower"?(ne==null?void 0:ne.binId)===y:(ne==null?void 0:ne.binId)===u,minPrice:a,maxPrice:f,onPriceChange:ie,handleAddPrice:g=>{p==null||p(_!==c?"Add":"Sub",g,!1)},handleSubPrice:g=>{p==null||p(_!==c?"Sub":"Add",g,!1)}})})]}),U&&t.jsx(Ht,{isShowIcon:!1,tipsFontSize:"12px",justifyContent:"center",tips:"The max price should be higher than min price.",p:"0 16px",h:"28px",borderRadius:"8px"})]})}function Ds(){const{displayTokenA:e,displayTokenB:r,tokenABalanceInfo:s,tokenBBalanceInfo:i,tokenAmountValueA:o,tokenAmountValueB:p,tokenAmountA:a,tokenAmountB:f,handleAmountChange:Q,strategy:U,setStrategy:y,dlmmPreAddLoading:u,isFixedDisplayTokenA:c,totalAmount:A,btnStatusText:S,showDisplayTokenALock:ee,showDisplayTokenBLock:B,displayTokenALock:j,displayTokenBLock:_,isAutoFill:J,handleAdd:ue,isAddLoading:H,minPriceData:v,maxPriceData:C,posMinPrice:ce,posMaxPrice:D,handlePriceAction:L,handleSlider:T,baseToken:Me,quoteToken:V,dlmmPosDetailDirect:E,reCalculateResult:ne,onAutoFillChange:ie,numBins:g,posMinPriceBinId:te,posMaxPriceBinId:h,isReverse:R,binStep:W,tokenA:l,tokenB:Z}=Fs(),{showPositionSelectRange:P,isAutoClaim:oe,setIsAutoClaim:N,preCalcError:O}=qe(),{isApp:F}=_i();Ei(()=>{Ge(v)&&Ge(C)&&ne()},[v,C,j,_,c,a,f,U,J],{wait:300});const x=n.useMemo(()=>!(v!=null&&v.binId)||!(C!=null&&C.binId)?!1:ye(v.binId).gt(C.binId),[v==null?void 0:v.binId,C==null?void 0:C.binId]);return t.jsxs(we,{gap:"16px",w:"100%",children:[t.jsxs(we,{mb:"-6px",w:"100%",justify:"space-between",mt:"4px",justifyContent:"flex-start",alignItems:"flex-start",gap:"18px",children:[t.jsx(I,{fontSize:"14px",color:"primary_gray",fontWeight:"500",children:"Select Strategy"}),t.jsxs(se,{w:"100%",justify:"space-between",gap:"0px",children:[t.jsx(lt,{type:ui.Spot,isActive:U===ui.Spot,onClick:()=>y(ui.Spot),size:"m"}),t.jsx(lt,{type:ui.Curve,isActive:U===ui.Curve,onClick:()=>y(ui.Curve),size:"m"}),t.jsx(lt,{type:ui.BidAsk,isActive:U===ui.BidAsk,onClick:()=>y(ui.BidAsk),size:"m"})]})]}),P&&t.jsx(Ut,{isReverse:R,posMinPriceBinId:te,posMaxPriceBinId:h,minPriceData:v,maxPriceData:C,isShowError:x,posMinPrice:ce,posMaxPrice:D,handlePriceAction:L,handleSlider:T,baseToken:Me,quoteToken:V,binStep:W,tokenA:l,tokenB:Z}),t.jsxs(se,{w:"100%",justifyContent:"space-between",children:[t.jsx(I,{whiteSpace:"nowrap",fontSize:"14px",color:"primary_gray",fontWeight:"500",children:"Deposit Amounts"}),F&&!ee&&!B&&!j&&!_&&t.jsxs(St,{display:"flex",justifyContent:"end",alignItems:"center",children:[t.jsx(_t,{htmlFor:"auto-fill",mb:"0",fontSize:{base:"12px",lg:"14px"},fontWeight:"500",color:J?"text_highlight":"text_caption",children:t.jsx(Si,{maxW:"320px",tooltip:t.jsxs(I,{fontSize:"12px",lineHeight:"20px",children:[t.jsx(I,{fontSize:"12px",as:"span",color:"text_caption",children:"ON:"})," ","Enter one token amount, the other is calculated automatically.",t.jsx("br",{}),t.jsx(I,{fontSize:"12px",as:"span",color:"text_caption",children:"OFF:"})," ","Enter custom amounts for both tokens manually.",t.jsx(vi,{h:"8px"}),t.jsxs(vi,{as:"div",lineHeight:"20px",cursor:"pointer",_hover:{svg:{fill:"text_caption"}},onClick:()=>window.open("https://cetus-1.gitbook.io/cetus-docs/dlmm/dynamic-fee/fee-structure#composition-fee"),children:["A composition fee may be applied during DLMM liquidity provision if the deposited token ratio into a bin differs from the binâ€™s current ratio. ",t.jsx(fi,{xlinkHref:"#icon-icon_link1",display:"inline-block",fontSize:"16px",verticalAlign:"middle"})]})]}),children:"Auto Fill"})}),t.jsx(mt,{id:"auto-fill",isChecked:J,onChange:ie})]}),!F&&!ee&&!B&&!j&&!_&&t.jsx(Si,{maxW:"400px",tooltip:t.jsxs(I,{fontSize:"12px",lineHeight:"20px",children:[t.jsx(I,{fontSize:"12px",as:"span",color:"text_caption",children:"ON:"})," ","Enter one token amount, the other is calculated automatically.",t.jsx("br",{}),t.jsx(I,{fontSize:"12px",as:"span",color:"text_caption",children:"OFF:"})," ","Enter custom amounts for both tokens manually.",t.jsx(vi,{h:"8px"}),t.jsxs(vi,{as:"div",lineHeight:"20px",cursor:"pointer",_hover:{svg:{fill:"text_caption"}},onClick:()=>window.open("https://cetus-1.gitbook.io/cetus-docs/dlmm/dynamic-fee/fee-structure#composition-fee"),children:["A composition fee may be applied during DLMM liquidity provision if the deposited token ratio into a bin differs from the binâ€™s current ratio. ",t.jsx(fi,{xlinkHref:"#icon-icon_link1",display:"inline-block",fontSize:"16px",verticalAlign:"middle"})]})]}),children:t.jsxs(St,{display:"flex",alignItems:"center",children:[t.jsx(_t,{htmlFor:"auto-fill",mb:"0",fontSize:{base:"12px",lg:"14px"},fontWeight:"500",color:J?"text_highlight":"text_caption",children:"Auto Fill"}),t.jsx(mt,{id:"auto-fill",isChecked:J,onChange:ie})]})})]}),t.jsxs(we,{w:"100%",mt:"4px",flexDir:E?"column":"column-reverse",children:[t.jsx(Oi,{token:e,value:a,balance:(s==null?void 0:s.balanceFormat)||"",amountValue:o,placeholder:"0.0",remainBalanceAmount:.5,loading:!c&&u&&J,lock:{isLock:j||ee||x,style:{height:"calc(100% + 2px)"}},onChange:G=>{Q(G,!0)},wrapStyle:{height:"110px"},rightJustify:"space-around"}),t.jsx(Oi,{token:r,value:f,remainBalanceAmount:.5,balance:(i==null?void 0:i.balanceFormat)||"",amountValue:p,placeholder:"0.0",loading:c&&u&&J,lock:{isLock:_||B||x,style:{height:"calc(100% + 2px)"}},onChange:G=>{Q(G,!1)},wrapStyle:{height:"110px"},rightJustify:"space-around"})]}),O&&t.jsx(Ht,{tips:"Amount too small to allocate across bins. Please increase the amount.",type:"warning"}),t.jsx($t,{checked:oe,onChange:()=>{N(!oe)}}),t.jsx(Vi,{width:"100%",height:"52px",fontSize:"18px",fontWeight:"500",isDisabled:(S==null?void 0:S.disabled)||O!==void 0,isLoading:H||u,onClick:()=>ue(),children:S==null?void 0:S.text}),t.jsx(Bi,{label:"Deposit Amount",value:Pi(A,2),isLoading:u,labelStyle:{fontSize:"14px",height:"16px"},valueStyle:{fontSize:"14px"}}),t.jsx(Bi,{label:t.jsxs(se,{gap:"4px",children:[t.jsx(I,{children:"Num Bins"}),t.jsx(Si,{tooltip:"Total bins in this position or actions.",children:t.jsx(Ci,{cursor:"pointer",children:t.jsx(fi,{xlinkHref:"#icon-icon_tips",svgW:"20px",svgH:"20px"})})})]}),value:zt(g),labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px"}})]})}function Es(){const{dlmmCurrentPosBaseInfo:e,dlmmPosLiquidityData:r,dlmmPosPoolsOriginalData:s,dlmmPosPoolsRelatedData:i}=bi(),{minPriceData:o,maxPriceData:p,setMinPriceData:a,setMaxPriceData:f,setTokenAmountAfterA:Q,setTokenAmountAfterB:U}=qe();console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosremovePage.ts:23 ~ useDlmmPosRemovePage ~ dlmmPosLiquidityData:",r),console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosremovePage.ts:24 ~ useDlmmPosRemovePage ~ dlmmCurrentPosBaseInfo:",e);const{handleActionBinPrice:y,getNumBins:u}=Ft(),{binInfos:c,setBinInfos:A,dlmmPosDetailDirect:S,isAutoClaim:ee,setIsAutoClaim:B,setPreCalcError:j}=qe(),{getDlmmCurrentPosBaseInfo:_}=ft(),{getTokenAmountValue:J}=Li(),{getTokenALock:ue,getTokenBLock:H}=Gt(),{transactionConfirmation:v}=Vt(),{dlmmPreRemove:C,getDlmmPosRemoveLiquidityPayload:ce,getDlmmPosClosePositionPayload:D}=cs(),[L,T]=n.useState("both"),[Me,V]=n.useState(!1),[E,ne]=n.useState(!1),[ie,g]=n.useState(!1),[te,h]=n.useState(!1),{slippage:R}=Ni(),[W,l]=n.useState("0"),Z=Tt(),[P,oe]=n.useState(""),N=n.useRef(""),{currentAccount:O}=xt();n.useEffect(()=>{console.log("ðŸš€ ~ usePosAddPage ~ uuid:",P),N.current=P},[P]);const F=n.useMemo(()=>r[e==null?void 0:e.id],[e==null?void 0:e.id,r]),x=n.useMemo(()=>s[e==null?void 0:e.dlmmPool],[e==null?void 0:e.id,s]),G=n.useMemo(()=>i[e==null?void 0:e.id],[i]);console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosRemovePage.ts:55 ~ currentPosPoolsRelatedData ~ currentPosPoolsRelatedData:",G);const[z,ke]=n.useState(""),[fe,Ve]=n.useState(""),[b,m]=n.useState(""),[le,pe]=n.useState(""),q=n.useMemo(()=>e==null?void 0:e.isReverse,[e]);console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosRemovePage.ts:74 ~ isReverse ~ isReverse:",q);const[Y,Ae]=n.useState(),[Ue,Te]=n.useState(),[Xe,Oe]=n.useState(),[Be,ai]=n.useState(),[ge,mi]=n.useState();n.useEffect(()=>{if(G&&ge&&x&&Ye&&Je&&ni){const d=x.active_bin,w=ge.bins[ge.bins.length-1],M=ge.bins[0];if(L==="both")Ae(S?G.minPrice:G.minPriceResever),Te(S?G.maxPrice:G.maxPriceResever),Oe(G.minPriceBinId),ai(G.maxPriceBinId),si();else if(L==="onlyA"){let X=d.bin_id+1;if(X<=w.bin_id){const ae=ii(w.bin_id,!1),K=ii(X,!0);q!==S?(Ae(K.displayPrice.toString()),Te(ae.displayPrice.toString())):(Ae(ae.displayReversePrice.toString()),Te(K.displayReversePrice.toString())),ai(w.bin_id),Oe(X),f(ae),a(K)}else Ae(S?G.minPrice:G.minPriceResever),Te(S?G.maxPrice:G.maxPriceResever),ai(G.maxPriceBinId),Oe(G.minPriceBinId),si()}else if(L==="onlyB"){const X=e.isReverse;let ae=d.bin_id-1;if(ae>=M.bin_id){const K=ii(ae,!1),Le=ii(M.bin_id,!0);X!==S?(Ae(Le.displayPrice.toString()),Te(K.displayPrice.toString())):(Ae(K.displayReversePrice.toString()),Te(Le.displayReversePrice.toString())),ai(ae),Oe(M.bin_id),f(K),a(Le)}else Ae(S?G.minPrice:G.minPriceResever),Te(S?G.maxPrice:G.maxPriceResever),Oe(e.lowerBinId),ai(e.upperBinId),si()}}},[L,JSON.stringify(ge),S]);const si=()=>{!Ye||!Je||(Ce([e.lowerBinId,e.upperBinId]),ke(F==null?void 0:F.displayCoinAmountA),Ve(F==null?void 0:F.displayCoinAmountB),m(F==null?void 0:F.displayCoinAmountA),pe(F==null?void 0:F.displayCoinAmountB))},[xe,Se]=n.useState(""),[he,Fe]=n.useState(""),_e=n.useMemo(()=>e==null?void 0:e.displayTokenA,[e==null?void 0:e.displayTokenA]),me=n.useMemo(()=>e==null?void 0:e.displayTokenB,[e==null?void 0:e.displayTokenB]),Ye=n.useMemo(()=>e==null?void 0:e.tokenA,[e==null?void 0:e.tokenA]),Je=n.useMemo(()=>e==null?void 0:e.tokenB,[e==null?void 0:e.tokenB]),ni=n.useMemo(()=>x==null?void 0:x.binStep,[x]),[Wi,it]=n.useState(!1);ki(()=>{F&&Ye&&Je&&ni&&!Wi&&(si(),it(!0)),ke(F==null?void 0:F.displayCoinAmountA),Ve(F==null?void 0:F.displayCoinAmountB),m(F==null?void 0:F.displayCoinAmountA),pe(F==null?void 0:F.displayCoinAmountB)},[q,F,Ye,Je,ni]);const{buildPriceData:ii}=ut(Ye,Je,ni),[yi,tt]=n.useState(!0),Hi=n.useMemo(()=>yi?_e:me,[_e,me,yi]),$i=n.useMemo(()=>yi?me:_e,[_e,me,yi]),Gi=n.useCallback((d,w)=>{const M=w.type==="lower";if(console.log("ðŸš€ ~ handlePriceAction ~ price:",{price:w,isMinPrice:M,dlmmPosDetailDirect:S,type:d,minPriceData:o,maxPriceData:p,dlmmCurrentPosBaseInfo:e}),ni!==void 0&&Ye!==void 0&&Je!==void 0&&Y&&Ue&&Xe&&Be){const{bin_id:X,price:ae}=y(w,ni,Ye==null?void 0:Ye.decimals,Je==null?void 0:Je.decimals,d);if(M)if(d==="Sub"&&X<Xe||d==="Add"&&X>Be){const K=ii(Xe,M);K&&a(K)}else{const K=ii(X,M);K&&a(K)}else if(d==="Sub"&&X<Xe||d==="Add"&&X>Be){const K=ii(Be,M);K&&f(K)}else{const K=ii(X,M);K&&f(K)}}},[ni,Ye,Je,Y,Ue,S]),ri=J(_e==null?void 0:_e.coin_type,xe),de=J(me==null?void 0:me.coin_type,he),We=n.useMemo(()=>ue(e,x),[x==null?void 0:x.active_id,e]),ji=n.useMemo(()=>H(e,x),[x==null?void 0:x.active_id,e]),Ne=(e!=null&&e.isReverse?ji:We)||ie,Ze=(e!=null&&e.isReverse?We:ji)||te,pi=()=>{Se(""),Fe(""),l("0"),A({}),j(void 0)};n.useEffect(()=>{(!xe||!+xe)&&(!he||!+he)&&(A({}),j(void 0))},[xe,he]);const st=(d,w)=>{if(console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosremovePage.ts:91 ~ handleAmountChange ~ isFixedDisplayTokenA:",w),console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosremovePage.ts:91 ~ handleAmountChange ~ amount:",d),d||pi(),V(w),w?Se(d):Fe(d),+d){const M=Wt();oe(M),console.log("ðŸš€ ~ handleAmountChange ~ params:",d)}else w?Fe(""):Se(""),l("0")},nt=async(d,w,M=!1,X=!1)=>{E||ne(!0);const{liquidityShares:ae}=e;console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosRemovePage.ts:230 ~ debouncedDlmmPreRemove ~ dlmmCurrentPosBaseInfo:",e),console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosRemovePage.ts:231 ~ debouncedDlmmPreRemove ~ minPriceData.displayPrice:",o);const K=o==null?void 0:o.binId,Le=p==null?void 0:p.binId,Ie=ge==null?void 0:ge.bins.filter(je=>je.bin_id>=K&&je.bin_id<=Le&&(L!=="both"?je.bin_id!==x.active_bin.bin_id:!0));console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosRemovePage.ts:240 ~ debouncedDlmmPreRemove ~ bins:",Ie),console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosRemovePage.ts:230 ~ debouncedDlmmPreRemove ~ liquidityShares:",ae),console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosRemovePage.ts:230 ~ debouncedDlmmPreRemove ~ lowerBinId:",x,K,L,e.lowerBinId);const{bin_step:He,bin_manager:Re,active_id:$e}=x;if(w){if($(d).gt(z)){Se(z);return}}else if($(d).gt(fe)){Fe(fe);return}const ti={bins:Ie,activeId:$e,fixAmountA:q?!w:w,coinAmount:$(d).mul(10**(w?_e==null?void 0:_e.decimals:me==null?void 0:me.decimals)).toString(),isOnlyA:L==="both"?void 0:L=="onlyA",tokenA:Ye,tokenB:Je,isReverse:q};console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosremovePage.ts:91 ~ preRemove ~ params:",ti,_e,me);const{displayCoinAmountA:Qe,displayCoinAmountB:li,binInfos:Ke}=await C(ti);console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosRemovePage.ts:253 ~ debouncedDlmmPreRemove ~ binInfos:",Ke,Qe,li,z,fe),console.log("binInfos-binInfos",Ke,z,fe);try{A(Ke),j(void 0);let je,re=!1;L==="both"&&(w?d&&$(d).gte(z)?(je="100",re=!0):je=Qi($(Qe).div(z).mul(100).toNumber(),2,!0,qi.ROUND_DOWN):d&&$(d).gte(fe)?(je="100",re=!0):je=Qi($(li).div(fe).mul(100).toNumber(),2,!0,qi.ROUND_DOWN)),(q?L==="onlyB":L==="onlyA")&&(d&&$(d).gte(z)?(je="100",re=!0):je=Qi($(Qe).div(z).mul(100).toNumber(),2,!0,qi.ROUND_DOWN)),(q?L==="onlyA":L==="onlyB")&&(d&&$(d).gte(fe)?(je="100",re=!0):je=Qi($(li).div(fe).mul(100).toNumber(),2,!0,qi.ROUND_DOWN)),console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosRemovePage.ts:267 ~ debouncedDlmmPreRemove ~ slide:",je),re?(l("100"),L==="both"&&(Ne||Se(z),Fe(fe)),(q?L==="onlyB":L==="onlyA")&&(Se(z),Fe("")),(q?L==="onlyA":L==="onlyB")&&(Fe(fe),Se(""))):(l(String(je)),L==="both"&&(w?X||Fe(li||""):M||Se(Qe||""))),console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosremovePage.ts:141 ~ debouncedDlmmPreRemove ~ displayCoinAmountA:",Qe),console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosremovePage.ts:142 ~ debouncedDlmmPreRemove ~ displayCoinAmountB:",li)}catch(je){console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosremovePage.ts:566 ~ debouncedDlmmPreRemove ~ error:",je),String(je).includes("is less than 1")?(j("amountTooSmall"),A({})):j(void 0)}},[Ui,Ti]=n.useState(!1),{batchSignAndExecuteTransaction:Yi}=bt(),{dlmmMevProtect:wi,maxCapForGas:yt,transactionMode:At,customGasPrice:ot}=Ni(),{fetchAccountBalance:Mi}=et(),Fi=async d=>{console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosremovePage.ts:173 ~ changeSlideFun ~ num:",d),l(d);const w=(M,X)=>{L==="both"&&(Se(Ne?"":M),Fe(Ze?"":X)),L==="onlyA"&&(q?(Fe(Ze?"":X),Se("")):(Se(Ne?"":M),Fe(""))),L==="onlyB"&&(q?(Se(Ne?"":M),Fe("")):(Fe(Ze?"":X),Se("")))};if(Number(d)==100)w(z,fe);else if(Number(d)==0)pi();else try{const M=$(z).mul($(d).div(100)).toString(),X=$(fe).mul($(d).div(100)).toString();w(M,X)}catch(M){console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosremovePage.ts:188 ~ changeSlideFun ~ error:",M)}},Di=()=>{if(console.log(he,xe,Me,"reCalculateResult"),(xe||he)&&Ge(e)){if(console.log("ðŸš€ ~ reCalculateResult ~ isFixedDisplayTokenA:",{slideValue:W,isFixedDisplayTokenA:Me,tokenAmountA:xe,tokenAmountB:he}),W==="--")return;let d,w=Me;switch(L){case"both":w?(d=xe,+d||(w=!w,d=he)):(d=he,+d||(w=!w,d=xe));break;case"onlyA":d=q?he:xe;break;case"onlyB":d=q?xe:he;break}d&&+d&&nt(d,w,ie,te)}else Se(""),Fe("")},{getList:ct}=rt(),k=n.useMemo(()=>{if($(W).eq(100)&&(c!=null&&c.bins)&&e.totalShareLiquidity){const d=c.bins.reduce((w,M)=>$(w).add(M.liquidity||"0").toString(),"0");return $(d).eq(e.totalShareLiquidity)}return!1},[W,c==null?void 0:c.bins,e==null?void 0:e.totalShareLiquidity]);n.useEffect(()=>{k&&B(!0)},[k]);const ve=async()=>{let d={};try{Ti(!0);const w={dlmmPool:e.dlmmPool,coinTypeA:e.coinTypeA,coinTypeB:e.coinTypeB,positionId:e==null?void 0:e.id,rewardCoins:x.reward_manager.rewards.map(Re=>Re.reward_coin),binInfos:c,slippage:R,activeId:x==null?void 0:x.active_id,binStep:x==null?void 0:x.binStep,slideValue:Number(W)/100};console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosAddPage.ts:244 ~ toAdd ~ params:",{dlmmCurrentPosPoolsOriginalData:x,dlmmCurrentPosBaseInfo:e,parameter:w,isAllRemove:k,slideValue:W,removeSide:L,binInfos:c});const{binInfos:M,rewardCoins:X,...ae}=w;d={...ae},(X==null?void 0:X.length)>0&&(d.rewardCoins=JSON.stringify(X));const K=k?[D(w)]:ce(w,ee),Le={action:Nt.DlmmRemoveLiquidity,txbParams:w},Ie={getShowInfo:(Re,$e,ti,Qe)=>{const li="Remove "+[Ri(xe,_e==null?void 0:_e.symbol),Ri(he,me==null?void 0:me.symbol)].filter(Boolean).join(" and "),Ke={modalDescriptionText:li,toastTitleText:li},je=(Qe==null?void 0:Qe.failedResults)&&Qe.failedResults.length>0&&Qe.successResults.length>0;if(Re==="rejected"&&je&&Qe.failedResults.length>0&&(Ke.toastDescriptionContent=`Failed transactions ${Qe.failedResults.length} /${K.length} `),Re==="success"){let re=xe,De=he;$e&&(re=Ki($e,_e)||xe,De=Ki($e,me)||he),K.length>1?Ke.toastDescriptionContent=`Completed transactions ${K.length} /${K.length} `:Ke.toastDescriptionContent="",Ke.modalDescriptionText="",Ke.toastTitleText="Remove Liquidity Successful"}return Ke}};K.length===1&&v(Ie),console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosAddPage.ts:299 ~ toAdd ~ tx:",Ie,K);const He=await Yi(K,Ie,{useMev:wi,maxCapForGas:yt,customGasPrice:ot,msafeParams:Le,trackData:{params:d,actionType:"dlmm",action:k?"dlmmRemoveAllLiquidity":"dlmmDecreaseLiquidity"}});if(He&&He.successResults.length>0)if(Mi(),pi(),await ct({poolId:e==null?void 0:e.dlmmPool}),_(O==null?void 0:O.address,e==null?void 0:e.id,!0),k)Z("/pools?tab=positions");else{const Re=await _(O==null?void 0:O.address,e==null?void 0:e.id,!0);ze(!0,Re)}else e&&_(O==null?void 0:O.address,e==null?void 0:e.id,!0).then(Re=>{console.log("ðŸš€ ~ toClaim ~ res:",Re),Di()});Ti(!1)}catch(w){console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosRemovePage.ts:448 ~ toRemove ~ error:",w)}finally{Ti(!1)}},be=()=>{ve()};n.useEffect(()=>{var X,ae,K,Le,Ie,He,Re,$e,ti,Qe,li;const d=o==null?void 0:o.binId,w=p==null?void 0:p.binId;let M;if(((ae=(X=ge==null?void 0:ge.bins)==null?void 0:X[0])==null?void 0:ae.bin_id)===d&&((Le=(K=ge==null?void 0:ge.bins)==null?void 0:K.at(-1))==null?void 0:Le.bin_id)===w)M=ge;else{const Ke=(Ie=ge==null?void 0:ge.bins)==null?void 0:Ie.findIndex(De=>(De==null?void 0:De.bin_id)>=d),je=(He=ge==null?void 0:ge.bins)==null?void 0:He.findIndex(De=>(De==null?void 0:De.bin_id)>=w),re=(Re=ge==null?void 0:ge.bins)==null?void 0:Re.slice(Ke,je+1);M={amount_a:re==null?void 0:re.reduce((De,Ai)=>$(De).plus(Ai==null?void 0:Ai.amount_a).toString(),"0"),amount_b:re==null?void 0:re.reduce((De,Ai)=>$(De).plus(Ai==null?void 0:Ai.amount_b).toString(),"0"),bins:re}}if(L==="both")ke($(q?M==null?void 0:M.amount_b:M==null?void 0:M.amount_a).div(10**(_e==null?void 0:_e.decimals)).toString()),Ve($(q?M==null?void 0:M.amount_a:M==null?void 0:M.amount_b).div(10**(me==null?void 0:me.decimals)).toString());else{const Ke=(ti=($e=M==null?void 0:M.bins)==null?void 0:$e.filter(re=>(re==null?void 0:re.amount_a)!=="0"&&(re==null?void 0:re.amount_b)==="0"))==null?void 0:ti.reduce((re,De)=>$(re).plus(De==null?void 0:De.amount_a).toString(),"0"),je=(li=(Qe=M==null?void 0:M.bins)==null?void 0:Qe.filter(re=>(re==null?void 0:re.amount_a)==="0"&&(re==null?void 0:re.amount_b)!=="0"))==null?void 0:li.reduce((re,De)=>$(re).plus(De==null?void 0:De.amount_b).toString(),"0");ke($(q?je:Ke).div(10**(_e==null?void 0:_e.decimals)).toString()),Ve($(q?Ke:je).div(10**(me==null?void 0:me.decimals)).toString())}},[ge,L,_e,me,o,p,q]),Ei(()=>{x&&e&&ze(!0,e,x)},[x,e]);const ze=async(d=!1,w=e,M=x)=>{let X;if(w&&M){const{liquidityShares:He}=w,{active_bin:Re}=M;X=ps(He,ni,w.lowerBinId,Re),console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosRemovePage.ts:476 ~ useDlmmPosRemovePage ~ posLiquidityInfo:",X),mi(X)}if(!X)return;const ae=Ye.decimals||0,K=Je.decimals||0,Le=(He,Re)=>gi(He.toString(),Re);d&&((He,Re)=>{const $e=Le(He,ae),ti=Le(Re,K);console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosRemovePage.ts:855 ~ setBalances ~ amountA:",$e),console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosRemovePage.ts:855 ~ setBalances ~ amountB:",ti),ke(q?ti:$e),Ve(q?$e:ti)})(X.amount_a.toString(),X.amount_b.toString())},Ce=d=>{if(!Ye||!Je||!ni)return;const w=d[0],M=d[1],X=ii(M,!1);X&&f(X);const ae=ii(w,!0);ae&&a(ae)};Ei(()=>{Ge(o)&&Ge(p)&&Di()},[p,o,ie,te,Me,xe,he],{wait:300});const Ee=d=>{console.log("ðŸš€ ~ changeSlideValue ~ value:",d),d=="MAX"||d==100?Fi("100"):Fi(String((d+"").split("%")[0]))},oi=n.useMemo(()=>{const d={text:"Remove",disabled:!1};return console.log(Ne,Ze,xe,he,z,fe,"btnStatusText"),O!=null&&O.address?!+xe&&!+he?(d.text="Enter an amount",d.disabled=!0,d):!Ne&&xe&&$(xe).gt(z||0)||!Ze&&he&&$(he).gt(fe||0)?(d.disabled=!0,d.text="Invalid Amount",d):((Ne&&!+he||Ze&&!+xe)&&(d.text="Enter an amount",d.disabled=!0),d):(d.text="Connect Wallet",d.disabled=!1,d)},[xe,he,z,fe,O==null?void 0:O.address,Ne,Ze]),ci=n.useMemo(()=>(G==null?void 0:G.currentStatus)==="Active",[G==null?void 0:G.currentStatus]);n.useEffect(()=>{ci&&((x==null?void 0:x.active_id)>(p==null?void 0:p.binId)&&(x==null?void 0:x.active_id)>(o==null?void 0:o.binId)&&(g(!q),h(q)),(x==null?void 0:x.active_id)<(p==null?void 0:p.binId)&&(x==null?void 0:x.active_id)<(o==null?void 0:o.binId)&&(g(q),h(!q)),(x==null?void 0:x.active_id)<=(p==null?void 0:p.binId)&&(x==null?void 0:x.active_id)>=(o==null?void 0:o.binId)&&(g(!1),h(!1)))},[x==null?void 0:x.active_id,o==null?void 0:o.binId,p==null?void 0:p.binId,ci,q]),n.useEffect(()=>{Ne&&(Se(""),V(!1)),Ze&&(Fe(""),V(!0)),!Ne&&!Ze&&(xe&&!he&&V(!0),he&&!xe&&V(!1))},[Ne,Ze]),n.useEffect(()=>{E&&setTimeout(()=>{ne(!1)},500)},[E]),Ei(()=>{var d,w,M,X;if((c!=null&&c.amount_a||c!=null&&c.amount_b)&&!E&&e){const ae=+(c==null?void 0:c.amount_a),K=+(c==null?void 0:c.amount_b),Le=e.isReverse?K:ae,Ie=e.isReverse?ae:K,He=e.isReverse?(d=e==null?void 0:e.tokenB)==null?void 0:d.decimals:(w=e==null?void 0:e.tokenA)==null?void 0:w.decimals,Re=e.isReverse?(M=e==null?void 0:e.tokenA)==null?void 0:M.decimals:(X=e==null?void 0:e.tokenB)==null?void 0:X.decimals,$e=Zi(Le,He),ti=Zi(Ie,Re);Q($(b).sub($e).toString()),U($(le).sub(ti).toString())}else Q(""),U("")},[c==null?void 0:c.amount_a,c==null?void 0:c.amount_b,E,b,le],{wait:200}),n.useEffect(()=>()=>{pi(),Q(""),U("")},[]);const di=n.useMemo(()=>(o==null?void 0:o.binId)!==void 0&&(p==null?void 0:p.binId)!==void 0?u(o.binId,p.binId):"--",[o==null?void 0:o.binId,p==null?void 0:p.binId]);return{displayTokenA:_e,displayTokenB:me,tokenBalanceA:z,tokenBalanceB:fe,posMinPriceBinId:Xe,posMaxPriceBinId:Be,tokenAmountValueA:ri,tokenAmountValueB:de,showDisplayTokenALock:Ne,showDisplayTokenBLock:Ze,handleAmountChange:st,tokenAmountA:xe,tokenAmountB:he,removeSide:L,setRemoveSide:T,dlmmPreRemoveLoading:E,isFixedDisplayTokenA:Me,handleRemove:be,isRemoveLoading:Ui,changeSlideFun:Fi,slideValue:W,minPriceData:o,maxPriceData:p,handlePriceAction:Gi,posMinPrice:Y,posMaxPrice:Ue,handleSlider:Ce,baseToken:Hi,quoteToken:$i,isDirect:yi,getRemoveTokenBalance:ze,amountInfo:ge,changeSlideValue:Ee,btnStatusText:oi,isActive:ci,displayTokenALock:ie,displayTokenBLock:te,setTokenAmountA:Se,setTokenAmountB:Fe,setSlideValue:l,isReverse:q,dlmmCurrentPosPoolsOriginalData:x,currentPosPoolsRelatedData:G,isAllRemove:k,tokenA:Ye,tokenB:Je,numBins:di}}function zs(){const{displayTokenA:e,displayTokenB:r,tokenBalanceA:s,tokenBalanceB:i,showDisplayTokenALock:o,showDisplayTokenBLock:p,handleAmountChange:a,tokenAmountA:f,tokenAmountB:Q,dlmmPreRemoveLoading:U,isFixedDisplayTokenA:y,removeSide:u,setRemoveSide:c,isRemoveLoading:A,handleRemove:S,slideValue:ee,minPriceData:B,maxPriceData:j,handlePriceAction:_,posMinPrice:J,posMaxPrice:ue,handleSlider:H,baseToken:v,quoteToken:C,getRemoveTokenBalance:ce,changeSlideValue:D,btnStatusText:L,isActive:T,isAllRemove:Me,setTokenAmountA:V,setTokenAmountB:E,setSlideValue:ne,isReverse:ie,currentPosPoolsRelatedData:g,dlmmCurrentPosPoolsOriginalData:te,posMinPriceBinId:h,posMaxPriceBinId:R,tokenA:W,tokenB:l,numBins:Z}=Es(),{isApp:P}=_i(),{showPositionSelectRange:oe,dlmmPosDetailDirect:N,isAutoClaim:O,setIsAutoClaim:F}=qe(),{getTokenAmountValue:x}=Li(),[G,z]=n.useState(!1),ke=n.useMemo(()=>[{label:"Remove Both",value:"both"},{label:`Only ${P?ei(e==null?void 0:e.symbol,8):e==null?void 0:e.symbol.slice(0,8)}`,value:ie?"onlyB":"onlyA",afterIcon:{xlinkHref:"#icon-icon_tips"},tooltip:`You will remove ${ei(e==null?void 0:e.symbol,8)} from bins with prices out of the current price bin.Tokens in the current price bin will remain in the pool`},{label:`Only ${P?ei(r==null?void 0:r.symbol,8):r==null?void 0:r.symbol.slice(0,8)}`,value:ie?"onlyA":"onlyB",afterIcon:{xlinkHref:"#icon-icon_tips"},tooltip:`You will remove ${ei(r==null?void 0:r.symbol,8)} from bins with prices out of the current price bin.Tokens in the current price bin will remain in the pool`}],[e,r,ie,P]),[fe,Ve]=n.useState(!0);n.useEffect(()=>{Ge(B)&&Ge(j)&&fe&&(Ve(!1),ce(!0))},[B,j,u]);const b=n.useMemo(()=>{if(T&&g&&te){const Y=te.active_bin;return!(g.maxPriceBinId===Y.bin_id&&g.minPriceBinId===Y.bin_id)}return!1},[T,g,te]),m=n.useMemo(()=>!(B!=null&&B.price)||!(j!=null&&j.price)?!1:ye(Pe(B.price)).gt(Pe(j.price)),[B==null?void 0:B.price,j==null?void 0:j.price]),le=n.useMemo(()=>x(e==null?void 0:e.coin_type,f),[e==null?void 0:e.coin_type,f]),pe=n.useMemo(()=>x(r==null?void 0:r.coin_type,Q),[r==null?void 0:r.coin_type,Q]),q=n.useMemo(()=>ye(le).add(pe).toString(),[le,pe]);return t.jsxs(we,{w:"100%",alignItems:"flex-start",justifyContent:"flex-start",gap:"24px",children:[b&&(P?t.jsx(Ns,{isOpen:G,value:u,onClose:()=>z(!1),onClick:()=>z(!G),tabList:ke,onChange:Y=>{c(Y),Y!==u&&(V(""),E(""),ne("0"))}}):t.jsx(Ii,{type:"outlineTab",isActive:(Y,Ae)=>Y===Ae.value,wrapStyle:{w:"100%",border:"none",bg:"bg_secondary",h:"42px",justifyContent:"flex-end",p:"4px"},itemStyle:{w:{base:"33.33%",lg:"33.33%"},fontSize:"14px",padding:"8px",borderRadius:"8px",gap:"2px"},tabList:ke,currentTab:u,handleChangeTab:Y=>{c(Y==null?void 0:Y.value),(Y==null?void 0:Y.value)!==u&&(V(""),E(""),ne("0"))}})),t.jsxs(we,{w:"100%",gap:"16px",align:"flex-start",children:[oe&&t.jsx(Ut,{isShowError:m,isReverse:ie,posMinPriceBinId:h,posMaxPriceBinId:R,minPriceData:B,maxPriceData:j,posMinPrice:J,posMaxPrice:ue,handlePriceAction:_,handleSlider:H,baseToken:v,quoteToken:C,tokenA:W,tokenB:l,binStep:g==null?void 0:g.binStep}),t.jsx(I,{fontSize:"14px",color:"primary_gray",fontWeight:"500",mb:"-8px",children:"Remove Amounts"})]}),t.jsxs(we,{w:"100%",mt:"4px",flexDir:N?"column":"column-reverse",children:[(u=="both"||(ie?u=="onlyB":u=="onlyA"))&&t.jsx(Oi,{token:e,balance:s,value:f,amountValue:le,placeholder:"0.0",balanceLabel:"Available",loading:!y&&U,lock:{isLock:o,style:{height:"calc(100% + 2px)"}},needRemainBalance:!1,onChange:Y=>{a(Y,!0)},wrapStyle:{h:"110px"},rightJustify:"space-around"}),(u=="both"||(ie?u=="onlyA":u=="onlyB"))&&t.jsx(Oi,{token:r,balance:i,value:Q,amountValue:pe,balanceLabel:"Available",placeholder:"0.0",loading:y&&U,lock:{isLock:p,style:{height:"calc(100% + 2px)"}},needRemainBalance:!1,onChange:Y=>{a(Y,!1)},wrapStyle:{h:"110px"},rightJustify:"space-around"})]}),t.jsx(As,{sliderBg:"bg_secondary",percentage:ee,onChange:Y=>D(Y),textFontSize:"20px",sliderTrackHeight:"8px"}),t.jsx(se,{w:"100%",mt:"-8px",mb:"-8px",children:t.jsx($t,{isDisabled:Me,checked:O,onChange:()=>{F(!O)}})}),t.jsx(Vi,{w:"100%",height:"52px",fontWeight:"500",fontSize:"18px",isLoading:A||U,onClick:S,isDisabled:L.disabled,children:L.text}),t.jsxs(we,{w:"100%",gap:"16px",mt:"-8px",children:[t.jsx(Bi,{label:"Remove Amount",isLoading:U,value:Pi(q,2),labelStyle:{fontSize:"14px",height:"16px"},valueStyle:{fontSize:"14px"}}),t.jsx(Bi,{label:t.jsxs(se,{gap:"4px",children:[t.jsx(I,{children:"Num Bins"}),t.jsx(Si,{tooltip:"Total bins in this position or actions.",children:t.jsx(Ci,{cursor:"pointer",children:t.jsx(fi,{xlinkHref:"#icon-icon_tips",svgW:"20px",svgH:"20px"})})})]}),value:zt(Z),labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px"}})]})]})}const Ns=({isOpen:e,onClose:r,onChange:s,onClick:i,tabList:o,value:p})=>{const a=n.useMemo(()=>o.find(f=>f.value===p),[o,p]);return t.jsxs(ys,{isLazy:!0,isOpen:e,onClose:r,defaultMaxH:"315px",listProps:{p:"8px",borderRadius:"12px",w:"calc(100vw - 40px)",overflowY:"auto"},children:[t.jsx(qt,{as:Vi,variant:"unstyled",bg:"bg_secondary",cursor:"pointer",p:"3px 8px 3px 8px",borderRadius:"8px",border:"1px solid",borderColor:"border",mb:"-12px",h:"40px",w:"100%",onClick:i,children:t.jsxs(se,{width:"100%",justifyContent:"space-between",gap:"2px",children:[t.jsxs(se,{children:[t.jsx(I,{color:"text_caption",fontSize:"14px",children:a==null?void 0:a.label}),(a==null?void 0:a.tooltip)&&t.jsx(Si,{tooltip:t.jsx(I,{fontSize:"12px",lineHeight:"20px",children:a==null?void 0:a.tooltip}),children:t.jsx(Ci,{children:t.jsx(fi,{xlinkHref:"#icon-icon_tips"})})})]}),t.jsx(fi,{transition:"transform 0.5s",transform:e?"rotate(180deg)":"rotate(0deg)",xlinkHref:"#icon-icon_arrow",svgFill:e?"text_caption":"text_paragraph",fontSize:"12px"})]})}),t.jsx(we,{w:"100%",gap:"8px",p:"0",children:o.map(f=>t.jsx(Xt,{w:"100%",p:"0 12px",h:"40px",borderRadius:"8px",border:"1px solid",bg:"bg_six",fontSize:"14px",textAlign:"center",borderColor:p===(f==null?void 0:f.value)?"primary":"border",color:p===f.value?"primary":"text_caption4",fontWeight:"500",onClick:()=>{s(f==null?void 0:f.value)},children:f.label},f.value))})]})};function Vs(){_i();const e=[{label:"Increase",value:"increase"},{label:"Remove",value:"remove"}],{currentPosDetailTab:r,setCurrentPosDetailTab:s}=qe();return t.jsxs(we,{w:"100%",p:{base:"0 8px 16px",lg:"0px 16px 16px"},borderRadius:"16px",bg:"card_bg",gap:"16px",children:[t.jsxs(se,{w:"100%",justifyContent:"space-between",children:[t.jsx(Ii,{type:"borderTab",bg:"none",wrapStyle:{w:{base:"auto",lg:"100%"},h:"60px",border:"none",bg:"none"},itemStyle:{w:{base:"50%",lg:"unset"},fontSize:"16px",mr:"28px"},tabList:e,currentTab:r=="increase"?"Increase":"Remove",handleChangeTab:i=>{s(i==null?void 0:i.value)}}),t.jsx(hs,{slippageType:"liquidity",poolType:"dlmm"})]}),r=="increase"?t.jsx(Ds,{}):t.jsx(zs,{})]})}function Ws(){var U,y;const{isApp:e}=_i(),{getTokenAmountValue:r}=Li(),{dlmmCurrentPosBaseInfo:s,dlmmPosLiquidityData:i}=bi(),o=n.useMemo(()=>i==null?void 0:i[s==null?void 0:s.id],[s==null?void 0:s.id,i]),{tokenAmountAfterA:p,tokenAmountAfterB:a}=qe(),f=n.useMemo(()=>Ge(s)&&Ge(o),[s,o]),Q=n.useMemo(()=>{var u,c;return o&&(o==null?void 0:o.displayCoinAmountA)!=="--"&&(o==null?void 0:o.displayCoinAmountB)!=="--"&&s?(console.log("ðŸš€ ~ file: DlmmPositionLiquidity.tsx:24 ~ amountValue ~ currentDlmmPosLiquidity:",o),Pi(ye(r((u=s==null?void 0:s.displayTokenA)==null?void 0:u.coin_type,o==null?void 0:o.displayCoinAmountA)).plus(r((c=s==null?void 0:s.displayTokenB)==null?void 0:c.coin_type,o==null?void 0:o.displayCoinAmountB)).toString(),2)):"$--"},[o==null?void 0:o.displayCoinAmountA,o==null?void 0:o.displayCoinAmountB]);return t.jsxs(we,{gap:{base:"8px",lg:"20px"},bg:"bg_secondary",w:"100%",p:{base:"16px 8px 8px",lg:"20px 20px 0"},borderRadius:"16px",children:[t.jsxs(zi,{flexDir:{base:"column",lg:"row"},w:"100%",justify:{base:"center",lg:"space-between"},gap:{base:"24px",lg:"0"},children:[t.jsxs(zi,{flexDir:{base:"row",lg:"column"},align:{base:"center",lg:"flex-start"},justify:{base:"space-between",lg:"center"},gap:"4px",children:[t.jsx(I,{color:"primary_gray",children:"Liquidity"}),t.jsx(xi,{isLoaded:f,children:t.jsx(I,{color:"text_caption",fontSize:"16px",textDecorationColor:"primary_gray",lineHeight:"16px",children:Q})})]}),t.jsxs(se,{gap:"4px",pb:"12px",justifyContent:"center",children:[t.jsx(xi,{isLoaded:f,children:t.jsxs(se,{gap:"4px",children:[t.jsx(I,{color:"text_caption",children:ei((U=s==null?void 0:s.displayTokenA)==null?void 0:U.symbol)}),t.jsxs(I,{color:"primary",children:[o==null?void 0:o.displayPercentA,"%"]})]})}),t.jsx(Zt,{w:{base:"100px",lg:"200px"},h:"4px",value:o==null?void 0:o.displayPercentA,bg:"quote_green",sx:{'div[role="progressbar"]':{bg:"primary"}}}),t.jsx(xi,{isLoaded:f,children:t.jsxs(se,{gap:"4px",children:[t.jsxs(I,{color:"primary_green",children:[o==null?void 0:o.displayPercentB,"%"]}),t.jsx(I,{color:"text_caption",children:ei((y=s==null?void 0:s.displayTokenB)==null?void 0:y.symbol)})]})})]})]}),t.jsxs(se,{gap:{base:"8px",lg:"0px"},p:{base:"8px 0px",lg:"8px 40px 0px"},w:"100%",justify:"space-between",flexDirection:{base:"column",lg:"row"},children:[t.jsx(hi,{label:"Base",token:s==null?void 0:s.displayTokenA,amount:o==null?void 0:o.displayCoinAmountA,afterAmount:p,align:e?"flex-end":"flex-start"}),t.jsx(hi,{label:"Quote",token:s==null?void 0:s.displayTokenB,amount:o==null?void 0:o.displayCoinAmountB,afterAmount:a,align:"flex-end"})]})]})}function Hs(){const{collectRewardAndFeePayload:e}=ht(),{dlmmCurrentPosBaseInfo:r,dlmmPosRewardsData:s,dlmmPosFeeData:i,dlmmPosPoolsOriginalData:o}=bi(),[p,a]=n.useState(!1),{signAndExecuteTransaction:f}=bt(),{fetchAccountBalance:Q}=et(),{getDlmmPosPoolsOriginalObj:U}=ns(),{getDlmmPosFeeAndReward:y}=os();n.useMemo(()=>s==null?void 0:s[r==null?void 0:r.id],[r==null?void 0:r.id,s]);const u=n.useMemo(()=>o==null?void 0:o[r==null?void 0:r.dlmmPool],[o,r==null?void 0:r.dlmmPool]);return{toClaimDlmmPosition:async A=>{var ee;console.log(A,"toClaimDlmmPosition");let S={};try{a(!0);const{dlmmPool:B,id:j,coinTypeA:_,coinTypeB:J}=A,ue=s==null?void 0:s[j],H={dlmmPool:B,positionId:j,rewardCoins:(ee=ue||[])==null?void 0:ee.map(L=>L.coin_address),coinTypeA:_,coinTypeB:J},{rewardCoins:v,...C}=H;S={...C,rewardCoins:JSON.stringify(v)};const ce=e([H]),D=await f(ce,{getShowInfo:()=>({modalDescriptionText:"Claim Yield",toastTitleText:"Claim"})},{trackData:{params:S,actionType:"dlmm",action:"dlmmPosClaim"}});if(console.log("ðŸš€ ~ toClaimYield ~ res:",D),D){const L=u||await U([r]);console.log("ðŸš€ ~ toClaim ~ poolInfo:",L),setTimeout(()=>{Q(),y([A],{[L==null?void 0:L.poolAddress]:L})},2e3)}a(!1)}catch(B){a(!1),console.log("ðŸš€ðŸš€ðŸš€ ~ useDlmmPosClaim.ts:29 ~ toClaimDlmmPosition ~ error:",B)}},isClaimLoading:p}}function $s(){const{fetchByApi:e}=ds();return{getDlmmPositionHistoricalProfit:async s=>{try{const i=await e(rs,"GET",{position_id:s});if(i!=null&&i.FeeA)return i}catch(i){console.log("ðŸš€ðŸš€ðŸš€ ~ useGetClmmPositionHistoricalProfit.ts:15 ~ getClmmPositionHistoricalProfit ~ error:",i)}}}}function Gs({dailyEarnUSDDisplay:e,originResult:r}){var g,te,h,R,W;const{dlmmCurrentPosBaseInfo:s,dlmmPosFeeData:i,dlmmPosRewardsData:o,dlmmPosFeeDataLoading:p,dlmmPosFeeAndRewardsLoading:a,dlmmPosRewardsDataLoading:f,dlmmCurrentPosBaseInfoLoading:Q,dlmmPosLiquidityData:U,dlmmPosPoolsOriginalData:y}=bi(),u=n.useMemo(()=>i==null?void 0:i[s==null?void 0:s.id],[i,s]),c=n.useMemo(()=>{const l=o==null?void 0:o[s==null?void 0:s.id];return l==null?void 0:l.filter((Z,P)=>{var N,O,F,x;return $(((x=(F=(O=(N=y==null?void 0:y[s==null?void 0:s.dlmmPool])==null?void 0:N.reward_manager)==null?void 0:O.rewards)==null?void 0:F[P])==null?void 0:x.emissions_per_day)||0).gt(0)||$((Z==null?void 0:Z.display_amount_owed)||0).gt(0)})},[o,s,y]),{toClaimDlmmPosition:A,isClaimLoading:S}=Hs(),{tokenAmountAfterA:ee,tokenAmountAfterB:B,isAutoClaim:j}=qe(),[_,J]=n.useState("0"),{calculatePendingYield:ue}=fs();n.useEffect(()=>{if(s&&i&&o){const{total:l}=ue([s],{},{},{},i,o);J(l)}},[s,i,o]);const H=n.useMemo(()=>j?ee!==""||B!=="":!1,[ee,B,j]),{isApp:v}=_i(),C=n.useMemo(()=>Number(_)===0&&(!c||(c==null?void 0:c.every(l=>$(l==null?void 0:l.display_amount_owed).eq(0))))&&(!u||(u==null?void 0:u.displayFeeOwedA)=="0"&&(u==null?void 0:u.displayFeeOwedB)=="0")||S,[a,S,u,_,c]),ce=[{label:"Unclaimed",value:"Unclaimed"},{label:"Claimed",value:"Claimed"}],[D,L]=n.useState(ce[0]),T=l=>{L(l)},{getDlmmPositionHistoricalProfit:Me}=$s(),[V,E]=n.useState(null),ne=async()=>{var Z,P,oe;const l=await Me(s==null?void 0:s.id);console.log("ðŸš€ðŸš€ðŸš€ ~ DetailStatsInfo.tsx:93 ~ handleGetClmmPositionHistoricalProfit ~ res:",l),(V===null||((Z=l==null?void 0:l.FeeA)==null?void 0:Z.Amount)!==void 0&&$(Pe((P=l==null?void 0:l.FeeA)==null?void 0:P.Amount)).gt((oe=V==null?void 0:V.FeeA)==null?void 0:oe.Amount))&&E(l)};ki(()=>{s!=null&&s.id&&ne()},[s==null?void 0:s.id,u,c,U]);const ie=async()=>{var N,O,F,x,G;await A(s);const l=$(((N=V==null?void 0:V.FeeA)==null?void 0:N.Amount)||0).add((u==null?void 0:u.displayFeeOwedA)||0).toString(),Z=$(((O=V==null?void 0:V.FeeB)==null?void 0:O.Amount)||0).add((u==null?void 0:u.displayFeeOwedB)||0).toString(),oe=us([...c==null?void 0:c.map(z=>z==null?void 0:z.coin_address),...(F=V==null?void 0:V.Mining)==null?void 0:F.map(z=>z==null?void 0:z.CoinType)]).map(z=>{var b,m,le;const ke=((b=c==null?void 0:c.find(pe=>(pe==null?void 0:pe.coin_address)===z))==null?void 0:b.display_amount_owed)||"0",fe=((le=(m=V==null?void 0:V.Mining)==null?void 0:m.find(pe=>(pe==null?void 0:pe.CoinType)===z))==null?void 0:le.Amount)||"0",Ve=$(Pe(ke)).add(Pe(fe)).toString();return{CoinType:z,Amount:Ve||0}});E({FeeA:{Amount:l,CoinType:(x=V==null?void 0:V.FeeA)==null?void 0:x.CoinType},FeeB:{Amount:Z,CoinType:(G=V==null?void 0:V.FeeB)==null?void 0:G.CoinType},Mining:oe}),await ne()};return t.jsxs(we,{bg:"bg_secondary",w:"100%",p:{base:"16px 8px",lg:"20px 20px 0"},borderRadius:"16px",children:[t.jsxs(se,{w:"100%",justify:"space-between",children:[t.jsx(zi,{flexDir:{base:"row",lg:"column"},alignItems:{base:"center",lg:"flex-start"},justify:{base:"space-between",lg:"center"},w:{base:"100%",lg:"auto"},children:t.jsxs(se,{gap:"28px",children:[t.jsxs(we,{align:"flex-start",children:[t.jsx(I,{color:"primary_gray",children:"Claimable Yield"}),t.jsx(xi,{isLoaded:!!_&&!!s&&!!i&&!!o,children:t.jsx(I,{color:"text_caption",fontSize:"16px",children:Pi(_,2)})})]}),e!==null&&t.jsxs(zi,{flexDir:{base:"column",lg:"row"},bg:"card_bg",borderRadius:"8px",p:"8px",children:[t.jsx(I,{fontSize:"12px",children:"Est. Daily Yield"}),t.jsx(xi,{isLoaded:!!_&&!!s&&!!i&&!!o,children:t.jsx(I,{fontSize:"12px",color:"primary",children:e?e!=="$0"?`+${e}`:e:"$0"})})]})]})}),t.jsx(Vi,{isLoading:S,isDisabled:C&&!+_||_==="--",onClick:()=>ie(),w:"112px",h:"28px",borderRadius:"8px",fontWeight:"500",fontSize:"14px",children:"Claim"})]}),t.jsxs(we,{p:{base:"20px 0px 0",lg:"20px 40px 0px"},w:"100%",gap:"26px",children:[t.jsx(we,{align:"flex-start",w:"100%",children:t.jsx(Ii,{type:"outlineTab",tabList:ce,currentTab:D==null?void 0:D.label,handleChangeTab:T,wrapStyle:{w:"158px",h:"28px",p:"4px",borderRadius:"8px"},itemStyle:{flex:{lg:"1",base:"auto"},fontSize:"12px",margin:"0px",borderRadius:"4px"}})}),D.value=="Unclaimed"?t.jsxs(se,{justify:"space-between",w:"100%",gap:"0px",flexWrap:"wrap",flexDirection:{base:"column",lg:"row"},children:[t.jsx(hi,{label:"Fees",token:s==null?void 0:s.displayTokenA,amount:u==null?void 0:u.displayFeeOwedA,afterAmount:H&&j?"0":"",align:v?"flex-end":"flex-start"}),t.jsx(hi,{label:v?"":"Fees",token:s==null?void 0:s.displayTokenB,amount:u==null?void 0:u.displayFeeOwedB,afterAmount:H&&j?"0":"",align:"flex-end"}),c==null?void 0:c.map((l,Z)=>t.jsx(jt.Fragment,{children:t.jsx(hi,{label:v?Z==0?"Mining Rewards":"":"Mining Rewards",token:l==null?void 0:l.token,amount:l==null?void 0:l.display_amount_owed,afterAmount:H&&j?"0":"",align:v?"flex-end":Z%2===0?"flex-start":"flex-end"})},l==null?void 0:l.coin_address))]}):t.jsxs(se,{justify:"space-between",w:"100%",gap:"0px",flexWrap:"wrap",flexDirection:{base:"column",lg:"row"},children:[t.jsx(hi,{label:"Fees",token:s==null?void 0:s.displayTokenA,amount:(g=V==null?void 0:V.FeeA)==null?void 0:g.Amount,align:v?"flex-end":"flex-start",afterAmount:""}),t.jsx(hi,{label:v?"":"Fees",token:s==null?void 0:s.displayTokenB,amount:(te=V==null?void 0:V.FeeB)==null?void 0:te.Amount,align:"flex-end",afterAmount:""}),(W=(R=(h=V==null?void 0:V.Mining)==null?void 0:h.filter)==null?void 0:R.call(h,l=>{var Z;return(l==null?void 0:l.Amount)&&((Z=$(Pe(l==null?void 0:l.Amount)))==null?void 0:Z.gt(0))}))==null?void 0:W.map((l,Z)=>t.jsx(jt.Fragment,{children:t.jsx(hi,{label:v?Z==0?"Mining Rewards":"":"Mining Rewards",coinType:l==null?void 0:l.CoinType,amount:l==null?void 0:l.Amount,align:v?"flex-end":Z%2===0?"flex-start":"flex-end",afterAmount:""})},l==null?void 0:l.CoinType))]})]})]})}function to(){var b,m,le,pe,q;const e=Tt(),{position_nft_id:r}=Kt(),{fetchAccountBalance:s}=et(),{dlmmCurrentPosBaseInfo:i,dlmmPosLiquidityData:o,dlmmPosPoolsRelatedData:p,dlmmPosRewardsData:a,dlmmPosRewardsDataLoading:f,resetDlmmPositionState:Q,setPosChartRefreshTrigger:U}=bi(),{resetDlmmPosDetail:y}=qe(),{fetchTokenPrices:u,getTokenAmountValue:c}=Li(),{dlmmApiPoolInfo:A,dlmmApiPoolInfoLoading:S}=gt(),{getDlmmCurrentPosBaseInfo:ee}=ft(),{getPosDlmmRelatedData:B}=Dt(),{getList:j}=rt(),_=n.useMemo(()=>o[i==null?void 0:i.id],[i==null?void 0:i.id,o]);pt({interval:5*1e3,callback:()=>{H&&i&&B([i],!0)}});const J=(b=p==null?void 0:p[i==null?void 0:i.id])!=null&&b.displayFee?`${(m=p==null?void 0:p[i==null?void 0:i.id])==null?void 0:m.displayFee}%`:void 0,ue=((le=p==null?void 0:p[i==null?void 0:i.id])==null?void 0:le.binStep)||"--",{currentAccount:H}=xt();n.useEffect(()=>{H!=null&&H.address&&r&&ee(H==null?void 0:H.address,r)},[H==null?void 0:H.address,r]);const v=n.useMemo(()=>p[i==null?void 0:i.id],[p]),{setCurrentPosDetailTab:C}=qe(),{setFromCoin:ce,setToCoin:D,fromCoin:L,toCoin:T}=vs();n.useEffect(()=>(i!=null&&i.dlmmPool&&(j({poolId:i==null?void 0:i.dlmmPool}),u([i==null?void 0:i.coinTypeA,i==null?void 0:i.coinTypeB]),i!=null&&i.displayTokenA&&(i!=null&&i.displayTokenB)&&(ce(i==null?void 0:i.displayTokenA),D(i==null?void 0:i.displayTokenB))),()=>{ce(Mt.clmm_swap.from_coin),D(Mt.clmm_swap.to_coin)}),[i==null?void 0:i.dlmmPool]),n.useEffect(()=>{if(i!=null&&i.dlmmPool&&a){j({poolId:i==null?void 0:i.dlmmPool});const Y=i==null?void 0:i.coinTypeA,Ae=i==null?void 0:i.coinTypeB,Ue=new Set;for(const[Xe,Oe]of Object.entries(a))Xe===(i==null?void 0:i.id)&&Oe.forEach(Be=>{Be.coin_address!==Y&&Be.coin_address!==Ae&&Ue.add(Be.coin_address)});const Te=Array.from(Ue);Te.length>0&&u(Te)}},[a]),ms({onRpcChange:()=>{Ve(),H!=null&&H.address&&s()}});const{getExplorerUrl:Me}=gs();n.useEffect(()=>()=>{y(),Q()},[]);const V=()=>{window.history.length>1?e(-1):e("/pools?tab=positions")},{setBackUrl:E}=Ni(),ne=n.useMemo(()=>{var Y;if(((Y=A==null?void 0:A.miningAprList)==null?void 0:Y.length)>0)return"help"},[A]),ie=o[i==null?void 0:i.id],g=c((pe=i==null?void 0:i.displayTokenA)==null?void 0:pe.coin_type,ie==null?void 0:ie.displayCoinAmountA),te=c((q=i==null?void 0:i.displayTokenB)==null?void 0:q.coin_type,ie==null?void 0:ie.displayCoinAmountB),h=n.useMemo(()=>ye(g).plus(te).toString(),[g,te]),[R,W]=n.useState(null),[l,Z]=n.useState(null),[P,oe]=n.useState(null),{getDlmmPositionDailyEarning:N}=ls(),[O,F]=n.useState(!0),x=async()=>{F(!0);try{const Y=await N(i==null?void 0:i.id,h);if(Y){const{aprDisplay:Ae,dailyEarnUSDDisplay:Ue,originResult:Te}=Y;console.log("ðŸš€ðŸš€ðŸš€ ~ PositionChartInfo.tsx:155 ~ handleGetPositionApr ~ originResult:",Te),W(Ae),Z(Ue),oe(Te)}F(!1)}catch{F(!1)}};n.useEffect(()=>{i!=null&&i.id&&(ye(h).gt(0)?x():F(!1))},[i==null?void 0:i.id,h]),pt({interval:60*1e3,callback:()=>{x()}});const G=n.useMemo(()=>(v==null?void 0:v.currentStatus)==="Active",[v==null?void 0:v.currentStatus]),z=n.useMemo(()=>(v==null?void 0:v.currentStatus)==="Inactive",[v==null?void 0:v.currentStatus]),ke=n.useMemo(()=>(v==null?void 0:v.currentStatus)!==void 0,[v==null?void 0:v.currentStatus]),{isApp:fe}=_i(),Ve=n.useCallback(async Y=>{U(),i!=null&&i.dlmmPool&&await j({poolId:i==null?void 0:i.dlmmPool}),Y&&ee(H==null?void 0:H.address,r,!0),s(),x()},[i,i==null?void 0:i.id,h]);return pt({interval:5*1e3,callback:()=>{H&&i&&B([i],!1)}}),t.jsxs(we,{gap:"12px",w:"100%",pt:"20px",align:"flex-start",children:[t.jsxs(se,{w:"100%",justifyContent:"space-between",flexDirection:{base:"column-reverse",lg:"row"},children:[t.jsx(se,{w:{base:"100%",lg:"unset"},justifyContent:"space-between",children:t.jsx(Ss,{text:"Back",onClick:()=>{V()}})}),t.jsxs(se,{w:{base:"100%",lg:"unset"},children:[t.jsx(Vi,{w:{base:"100%",lg:"unset"},bg:"bg_secondary",fontSize:"14px",p:"0 16px",h:"32px",borderRadius:"8px",fontWeight:"500",variant:"outline",onClick:Y=>{E(`/dlmm-position-detail/${i==null?void 0:i.id}`),e(`/dlmm?poolId=${i==null?void 0:i.dlmmPool}`)},children:"Create a new position"}),t.jsx(_s,{handleRefresh:Ve,isAutoRefresh:!0,refreshInterval:5,w:"28px",h:"28px",innerStyle:{bg:"none"}})]})]}),t.jsxs(se,{w:"100%",justifyContent:"space-between",flexDirection:{base:"column",lg:"row"},children:[t.jsxs(xi,{w:{base:"100%",lg:"unset"},isLoaded:!!(i!=null&&i.dlmmPool),children:[t.jsx(Bt,{type:"column",poolType:"dlmm",symbolFontWeight:"500",symbolFontSize:"20px",symbolEllipsesDecimals:10,nameEllipsesDecimals:20,poolInfo:{feeDisplay:J,binStep:ue,...i,poolAddress:i==null?void 0:i.dlmmPool},haveFarming:_==null?void 0:_.haveFarming,showPoolTypeTag:!0,versionBlockPosition:"right",padding:"8px 0",moreDetails:!0}),t.jsxs(se,{children:[t.jsxs(se,{p:"2px 8px",borderRadius:"8px",bg:"bg_secondary",children:[t.jsxs(I,{fontSize:"12px",color:"primary_gray",children:["ID ",i==null?void 0:i.tokenName]}),t.jsx(I,{children:"|"}),(i==null?void 0:i.id)&&t.jsx(xs,{fontWeight:"500",showCopy:!1,color:"primary_gray",address:i==null?void 0:i.id,showLink:!1,onClickLink:()=>{window.open(Me(i==null?void 0:i.id,"nftAddress"),"_blank")}})]}),ke&&t.jsx(Pt,{isActive:G,isLoading:!v&&!Ge(v)})]})]}),t.jsxs(se,{w:{base:"100%",lg:"unset"},gap:{base:"12px",lg:"28px"},flexDirection:{base:"column",lg:"row"},children:[t.jsx(Ji,{label:"Pool APR",value:t.jsx(Ot,{poolInfo:A,placement:fe?"bottom-end":"bottom",children:t.jsxs(se,{justify:"flex-end",align:"flex-end",gap:"4px",lineHeight:"14px",h:"14px",children:[t.jsx(I,{as:"span",fontSize:"14px",color:ne?"primary":"text_caption",fontWeight:"500",cursor:ne?"help":"text",textUnderlineOffset:"2px",textDecoration:ne?"underline dotted":"none",children:(A==null?void 0:A.feeAndMiningAprDisplay)!==""?A==null?void 0:A.feeAndMiningAprDisplay:"--"}),(A==null?void 0:A.haveFarming)&&t.jsxs(I,{fontSize:"12px",lineHeight:"12px",h:"12px",color:"primary",fontWeight:"500",children:["+",A==null?void 0:A.farmingAprDisplay]})]})}),loading:!(A!=null&&A.poolAddress)}),t.jsx(Ji,{label:"TVL",value:(A==null?void 0:A.tvlDisplay)||"",loading:!(A!=null&&A.poolAddress)}),t.jsx(Ji,{label:"Volume (24H)",value:(A==null?void 0:A.volume24Display)||"",loading:!(A!=null&&A.volume24Display)}),t.jsx(Ji,{label:"Fees (24H)",value:(A==null?void 0:A.fees24Display)||"",loading:!(A!=null&&A.poolAddress)})]})]}),t.jsxs(se,{flexDirection:{base:"column-reverse",lg:"row"},width:"100%",justifyContent:"space-between",align:"flex-start",mt:"8px",children:[t.jsxs(we,{width:{base:"100%",lg:"684px"},position:"relative",gap:"16px",children:[t.jsx(Ls,{positionApr:z?"0%":ke?R:null,isAprLoading:O}),t.jsx(Ws,{}),t.jsx(Gs,{dailyEarnUSDDisplay:z?"$0":ke?l:null,originResult:P})]}),t.jsx(we,{width:{base:"100%",lg:"460px"},children:t.jsx(Vs,{})})]})]})}export{to as default};
