import{f as _,M as X,N as S,e as O,Q as R,d as y,Z as V,T as x,k as G,j as v,$ as b,U as h,V as A,W as E,X as M}from"./index-ihcskjKt.js";import"./cross-CbhIs7DK.js";import{u as P}from"./index-BgZD3vRA.js";import{r as f}from"./vendor-CBmAETR3.js";function $(){const t=_("xcetus"),{currentAccount:e}=X(),n=f.useRef(e==null?void 0:e.address);f.useEffect(()=>{n.current=e==null?void 0:e.address},[e==null?void 0:e.address]);const{setLockCetusListLoading:o,clearData:s,setLockCetusList:d,setAvailableXCetusAmount:u,veNFT:w,setAvailableXCetusAmountLoading:c}=S();return{fetchOwnerLockCetusList:async(a,m=e==null?void 0:e.address)=>{if(!m){o(!1),s();return}c(!0);try{const r=await t.XCetusModule.getOwnerRedeemLockList(m);console.log("ðŸš€ ~ fetchOwnerLockCetusList ~ lockList:",{lockList:r,veNFT:a,availableXCetusAmount:b.getAvailableXCetus(a,r)}),m===n.current&&(r.sort((l,C)=>l.locked_until_time-C.locked_until_time),d(r),a&&u(b.getAvailableXCetus(a,r)))}catch(r){console.log("ðŸš€ ~ fetchOwnerLockCetusList ~ error:",r)}finally{o(!1),c(!1)}}}}function K(){const t=_("xcetus"),{setDividendRewardList:e}=S();return{fetchVeNFTDividendInfo:async o=>{try{const s=await t.XCetusModule.getVeNFTDividendInfo(o);console.log("ðŸš€ ~ file: useXCetusHelper.ts:62 ~ fetchVeNFTDividendInfo ~ dividendInfo:",s),s&&e(s.rewards)}catch(s){console.log("ðŸš€ ~ fetchVeNFTDividendInfo ~ error:",s,o)}}}}function Q(){const t=_("xcetus"),{currentAccount:e}=X(),{fetchOwnerLockCetusList:n}=$(),{setVeNFTLoading:o,clearData:s,setVeNFT:d,setAvailableXCetusAmountLoading:u}=S();return{fetchOwnerVeNFT:async(c=e==null?void 0:e.address,L)=>{if(!c){o(!1),s();return}o(!0);try{const a=await t.XCetusModule.getOwnerVeNFT(c,L);if(console.log("ðŸš€ ~ fetchOwnerVeNFT ~ veNFT:",a),a)return d(a,c),n(a,c),a}catch(a){console.log("ðŸš€ ~ fetchOwnerVeNFT ~ error:",a)}finally{o(!1),u(!1)}}}}function W(){const{dividendManager:t}=S(),[e,n]=f.useState(),[o,s]=f.useState(),d=u=>{const w=Date.now()/1e3,{start_time:c,interval_day:L}=u,a=Number(b.getNextStartTime(u).toString()),m=v.env=="testnet"?Math.ceil((w-c)/(L*60)):Math.ceil((w-c)/(L*24*3600));n(m),s(a)};return f.useEffect(()=>{t&&d(t)},[t]),{currentPeriod:e,nextStartTime:o,calculateCurrPeriod:d}}function z(t,e){const{fetchTokenInfo:n}=O(),{getTokenAmountValue:o}=R(),{coinPriceObj:s}=G(),[d,u]=f.useState("0"),w=f.useCallback(async()=>{if(!(!t||!e))try{const c=t.bonus,L=c.map(C=>V(C.name,!1)),a=await n(L),m=c.map(C=>{const k=V(C.name,!1),i=a==null?void 0:a.get(k);if(i){const g=x(C.value,i.decimals).toString();return o(k,g)}return"0"}).reduce((C,k)=>C.add(k),y(0)),r=o(v.cetus_coin.coin_type,x(e,9).toString()),l=y(r).gt(0)?m.div(7).mul(365).div(r).mul(100).toFixed(2):"0";u(Number(l)>0&&Number(l)<.01?"0.01":l.toString())}catch(c){console.error("Error calculating APR:",c),u("0.01")}},[t==null?void 0:t.bonus,e,s]);return P(()=>{w()},[t==null?void 0:t.bonus,e,s]),{cetusApr:d}}function D(t){const{dividendRewardList:e}=S(),{fetchTokenInfo:n}=O(),{getTokenAmountValue:o}=R(),[s,d]=f.useState([]),[u,w]=f.useState([]),[c,L]=f.useState("0"),a=f.useCallback(async()=>{let m=y(0);const r=e.filter(i=>!(i.period===t||i.rewards.find(g=>y(g.amount).eq(0))));console.log("ðŸš€ ~ file: useXCetusHelper.ts:107 ~ calculateRewards ~ filteredList:",{filteredList:r,dividendRewardList:e,currentPeriod:t}),w(r);const l={},C=r.flatMap(i=>i.rewards.map(g=>V(g.coin_type,!1))),k=await n(C);r.forEach(i=>{for(const g of i.rewards){const T=V(g.coin_type,!1),F=k==null?void 0:k.get(T);if(F){const N=x(g.amount,F.decimals).toString(),p=o(T,N);m=m.add(p),l[T]=l[T]?{...l[T],amount:y(l[T].amount).add(N).toString(),value:y(l[T].value).add(p).toString()}:{amount:N,coin_type:T,value:p}}}}),d(Object.values(l).filter(i=>y(i.amount).gt(0)).sort((i,g)=>y(g.value).sub(i.value).toNumber())),L(m.toString())},[e,o,t]);return f.useEffect(()=>{t&&a()},[e,t]),{summaryRewardList:s,rewardList:u,totalRewardValue:c}}const j=`${h.xcetus.package_id}::xcetus::VeNFT`,H=`${h.xcetus.package_id}::lock_coin::LockedCoin<${v.cetus_coin.coin_type}>`;function I(t){let e;return t.forEach(n=>{if(n){const o=A(E(n)).source_address;if(o===j&&n.data&&n.data.content){const{fields:s}=n.data.content;return e={...M(n),id:s.id.id,index:s.index,type:o,xcetus_balance:s.xcetus_balance},e}}}),e}async function J(t,e){const n=[];for(let o=0;o<t.length;o++){const s=t[o];if(s&&A(E(s)).source_address===H&&s.data){const u=b.buildLockCetus(s.data.content);u.xcetus_amount=await e.XCetusModule.getXCetusAmount(u.id),n.push(u)}}return n}export{j as X,K as a,W as b,D as c,z as d,H as e,I as f,J as g,Q as u};
//# sourceMappingURL=useXCetusHelper-CrXtSO0d.js.map
