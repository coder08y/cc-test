import{A as ct}from"./aggregator-DkD3pjAG.js";import{u as nt}from"./useTransaction-BEUdFaaa.js";import{n as ut,aj as it,M as $e,Q as be,d as H,Z as d,ar as ae,j as L,G as _e,a as ft,a3 as lt,e as pt,bk as Se,aT as mt,h as yt,bl as oe,bm as dt,ah as J,bn as ge}from"./index-ihcskjKt.js";import{u as ht}from"./index-CLM3E_Q3.js";import{c as Ae,d as _t}from"./useSwapHelper-CDwInMwe.js";import{a as we}from"./index-78J_CBpj.js";import{u as St}from"./useAccountBalance-D7pkS3C9.js";import{n as gt,T as Re,f as wt}from"./cross-CbhIs7DK.js";import{r as a,ao as Rt,l as Tt}from"./vendor-CBmAETR3.js";import{u as ce}from"./useTokenBalance-EOIPKTy-.js";import{u as vt}from"./useFindBestRouting-BrNyL9M1.js";import{u as $t}from"./useChainTime-DkQgY6Ea.js";import{v as Te}from"./v4-C6aID195.js";function bt(i){const{fetchByApi:f}=ut(),[p,e]=a.useState([]),t=async n=>{const m=n.filter(o=>!(o.is_verified===void 0?o.is_trusted:o.is_verified));try{const o=m.map(w=>w.coin_type).join(","),{coins:y}=await f(`/router_v3/honey_pot_check?coins=${o}`,"GET");return console.log("ðŸš€ðŸš€ðŸš€ ~ useCheckTokenScamsAlert.ts:23 ~ checkIsScamsCoin ~ coins:",y),y&&y.length>0?y.filter(l=>l.is_honey_pot_scam):[]}catch(o){console.log("ðŸš€ ~ file: useCheckTokenScamsAlert.ts:19 ~ checkTokenScams ~ error:",o)}return[]};return it(()=>{e([]),i.length>0&&t(i).then(n=>{e(n)})},[i]),{scamsCoinList:p}}function ve(){const{currentAccount:i}=$e(),{isOpenRfqSwitch:f,rfqConfigs:p,setRfqConfigs:e}=Ae(),{getTokenAmountValue:t}=be(),{getBalanceInfoFromCache:n}=ce(),{getCountDown:m}=$t(),y=a.useMemo(()=>"rfq",["v1"]),w=async u=>{const{fromToken:_,toToken:T,amount:Q,uuid:A}=u;try{const S=await ae(`${L.rfq_api}/${y}/quote`,{from:d(_.coin_type,!1),target:d(T.coin_type,!1),amount_in:Q,sender:(i==null?void 0:i.address)||gt("0x0")});console.log("ðŸš€ ~ fetchRfqQuote ~ res:",S);const h=_e(S.amount_in.toString(),_.decimals).toString(),v=_e(S.amount_out.toString(),T.decimals).toString(),N={rfqQuote:S,uuid:A,fromAmountUi:h,toAmountUi:v,price:H(v).div(h).toString()};return N.rfqQuote.total_countdown=await m(S.expired_at),console.log("ðŸš€ ~ fetchRfqQuote ~ swapRfqData:",N),N}catch(S){console.log("ðŸš€ ~ fetchRfqQuote ~ error:",S);return}},l=async u=>{try{return(await ae(`${L.rfq_api}/${y}/confirm`,{id:u})).transactions}catch(_){throw console.log("ðŸš€ ~ handleRfqQuote ~ error:",_),new Error("Failed to fetch rfq transactions")}},M=async()=>{try{const u=await ae(`${L.rfq_api}/${y}/status`);return u&&e(u),u}catch(u){console.log("ðŸš€ ~ fetchRfqConfigs ~ error:",u);return}},I=a.useCallback((u,_,T)=>{var S;if(!(i!=null&&i.address)||!(p!=null&&p.enable)||!f)return!1;const Q=t(u.coin_type,T);if(!H(Q).gte(p.quote_limit.min)||!H(Q).lte(p.quote_limit.max))return!1;const A=n(u);return!(A!=null&&A.balanceFormat)||H(A.balanceFormat).lt(T)?!1:((S=p.allow_paths)==null?void 0:S.some(h=>d(u.coin_type,!1)===d(h.from,!1)&&d(_.coin_type,!1)===d(h.target,!1)))??!1},[p,f,i==null?void 0:i.address,t,n]);return{fetchRfqQuote:w,fetchRfqTransactions:l,fetchRfqConfigs:M,verifyRfqAvailable:I}}const At=L.env==="mainnet"?"0xeb863165a109f7791a3182be08aff1438ab2a429314fc135ae19d953afe1edd6":"0xd67361aaecc23e5fdfd77970a61153ca183dfcb2ae466e65a60e3859eeb8aad0";function Lt(i,f,p){const{fromCoin:e,toCoin:t,setFromCoin:n,setToCoin:m,setToAmount:o,fromAmount:y,toAmount:w,setFromAmount:l,setFindRouterLoading:M,setByAmountIn:I,byAmountIn:u,setRfqData:_,setRouterData:T,rfqData:Q,routerData:A,userSelectQuoteMode:S}=i,{from:h,to:v}=Rt(),{currentAccount:N}=$e(),{fetchRfqQuote:qe,verifyRfqAvailable:ke}=ve(),{findBestRouters:xe,checkProvidersKeys:De}=vt(),{fetchRfqTransactions:Be}=ve(),{fetchTokenPrices:Pe,getTokenAmountValue:ne}=be(),{slippage:ue,mevProtect:Fe,maxCapForGas:Ee,transactionMode:Me,customGasPrice:Ie}=ft(),{aggregatorSDK:Qe}=lt(),g=Tt(),{fetchTokenInfo:ie}=pt(),[Ue,X]=a.useState(!1),{signAndExecuteTransaction:Ge,transactionConfirmation:Ke}=nt(),{providersSwitchStates:Y,isOpenRfqSwitch:Le}=Ae(),{fetchAccountBalance:Oe}=St(),{setCurrentProTab:W,currentProTab:U,isProMode:je,setProTransactionList:Ve,coinBvPrice:C,coinBvPirceUnit:Ne,showTokenInfo:Ze}=ht(),{balanceInfo:ze}=ce(e),{balanceInfo:He}=ce(t),Je=ne(e==null?void 0:e.coin_type,y),Xe=ne(t==null?void 0:t.coin_type,w),[fe,le]=a.useState(""),ee=a.useRef(""),Z=a.useRef(!0),O=a.useRef(""),j=a.useRef(""),q=a.useRef(),k=a.useRef(),pe=a.useRef([]);a.useEffect(()=>{q.current=e},[e]),a.useEffect(()=>{k.current=t},[t]),a.useEffect(()=>{ee.current=fe},[fe]),a.useEffect(()=>{Z.current=u},[u]),a.useEffect(()=>{O.current=y},[y]),a.useEffect(()=>{j.current=w},[w]);const Ye=a.useMemo(()=>String(v)+String(h),[h,v]);a.useEffect(()=>{f||We()},[Ye]);const We=a.useCallback(()=>{P(),!h&&!v?(n(L.clmm_swap.from_coin),m(L.clmm_swap.to_coin),g("/swap")):(h&&Se(h)?ie(h).then(s=>{s?(s==null?void 0:s.coin_type)!==(e==null?void 0:e.coin_type)&&n(s):g(`/swap/${e==null?void 0:e.coin_type}/${t==null?void 0:t.coin_type}`)}).catch(()=>{g(`/swap/${e==null?void 0:e.coin_type}/${t==null?void 0:t.coin_type}`)}):n(void 0),v&&Se(v)?ie(v).then(s=>{s?(s==null?void 0:s.coin_type)!==(t==null?void 0:t.coin_type)&&m(s):g(`/swap/${e==null?void 0:e.coin_type}/${t==null?void 0:t.coin_type}`)}).catch(()=>{g(`/swap/${e==null?void 0:e.coin_type}/${t==null?void 0:t.coin_type}`)}):m(void 0))},[h,v]),me=mt(async(s,r,c,$)=>{if(console.log("ðŸš€ðŸš€ðŸš€ ~ useSwap.ts:182 ~ findRouters ~ providersSwitchStates:",Y),q.current&&k.current&&+s){const F=f?Object.entries(ct).map(([x,D])=>x):Object.entries(Y).filter(([x,D])=>D===!0).map(([x,D])=>x);(+O.current||+j.current)&&(M(!0),_(void 0));const E=yt(s,r?q.current.decimals:k.current.decimals);$&&!f&&r&&ke(q.current,k.current,s)&&qe({fromToken:q.current,toToken:k.current,amount:E.toString(),uuid:c}).then(x=>{ee.current===c&&_(x)});const K=await De(F);console.log("ðŸš€ðŸš€ðŸš€ ~ useSwap.ts:203 ~ findRouters ~ providersKeys:",F),console.log("ðŸš€ðŸš€ðŸš€ ~ useSwap.ts:203 ~ findRouters ~ checkProvidersKeysRes:",K);const R=await xe({fromToken:q.current,toToken:k.current,amount:E.toString(),providersKeys:K,by_amount_in:r,uuid:c});M(!1),ee.current===c&&(pe.current=K,r?+O.current?(o((R==null?void 0:R.toAmountUi)||""),T(R)):o(""):+j.current?(l((R==null?void 0:R.fromAmountUi)||""),T(R)):l(""))}else P(!r)},500),Ce=(s,r,c=!1)=>{if(p&&(p.current=void 0),I(r),r?(l(s),c&&o("")):(o(s),c&&l("")),+s&&q.current&&k.current){const $=Te();le($),me(s,r,$,!0)}else M(!1),_(void 0),T(void 0),!s&&we(s)?P():r?o(""):l("")},G=(s=!0)=>{p&&(p.current=void 0);const r=Z.current?O.current:j.current;if(console.log("ðŸš€ ~ file: useSwap.ts:273 ~ reCalculateRouteData ~ amount:",r,Z.current,O.current,j.current),+r&&q.current&&k.current){const c=Te();le(c),me(r,Z.current,c,s)}else we(r)&&P()};a.useEffect(()=>{G()},[JSON.stringify(Y)+Le]);const et=a.useCallback((s,r=!0)=>{P(),f?r?(s&&d((s==null?void 0:s.coin_type)||"")===d((t==null?void 0:t.coin_type)||"")&&m(e),n(s)):(s&&d((s==null?void 0:s.coin_type)||"")===d((e==null?void 0:e.coin_type)||"")&&n(t),m(s)):r?s&&d((s==null?void 0:s.coin_type)||"")===d((t==null?void 0:t.coin_type)||"")?(W(U==="Buy"?"Sell":"Buy"),g(`/swap/${s==null?void 0:s.coin_type}/${e==null?void 0:e.coin_type}`)):g(`/swap/${s==null?void 0:s.coin_type}/${t==null?void 0:t.coin_type}`):s&&d((s==null?void 0:s.coin_type)||"")===d((e==null?void 0:e.coin_type)||"")?(W(U==="Buy"?"Sell":"Buy"),g(`/swap/${t==null?void 0:t.coin_type}/${s==null?void 0:s.coin_type}`)):g(`/swap/${e==null?void 0:e.coin_type}/${s==null?void 0:s.coin_type}`)},[e==null?void 0:e.coin_type,t==null?void 0:t.coin_type,U]),{amountLimit:tt}=_t(ue,A),P=s=>{s===void 0?(l(""),o("")):s?l(""):o(""),M(!1),_(void 0),T(void 0)};a.useEffect(()=>{ye()},[e==null?void 0:e.coin_type,t==null?void 0:t.coin_type]);const ye=()=>{const s=[];e&&s.push(e.coin_type),t&&s.push(t.coin_type),s.length>0&&Pe(s)},st=()=>S==="rfq"?Q:A,rt=async s=>{var R,x;const r="rfqQuote"in s;X(!1);let c,$,F,E,K;try{if(F=s.fromAmountUi,E=s.toAmountUi,r)$=async()=>{const B=await Be(s.rfqQuote.id);return console.log("ðŸš€ ~ file: useSwap.ts:481 ~ handleRouterSwap ~ transactions:",B),Re.from(wt(B))};else{const B=new Re,b={router:s.routerData,partner:At,txb:B,slippage:Number(ue),refreshAllCoins:!0};console.log("ðŸš€ ~ handleRouterSwap ~ sdkParams:",b),$=async()=>(await Qe.fastRouterSwap(b),B),console.log("useSwap ðŸš€ ~ txb= ~ txb:",await $),K={action:"AggregatorSwap",txbParams:{...b,router:dt(b==null?void 0:b.router)}}}X(!1);let D={currentCoin:Ze,type:U};c={isSwapWidget:f,actionType:"swap",getShowInfo:(B,b)=>{const te=`Swapping ${J(F)} ${e==null?void 0:e.symbol} for ${J(E)} ${t==null?void 0:t.symbol}`,V={modalDescriptionText:te,toastTitleText:te};if(B==="success"){let se=F,re=E;b&&(se=ge(b,e)||F,re=ge(b,t)||E);const he=`Swapped ${J(se)} ${e==null?void 0:e.symbol} for ${J(re)} ${t==null?void 0:t.symbol}`;V.toastDescriptionContent=he,V.modalDescriptionText=he,V.toastTitleText="Swap Successful",je&&(D={...D,amount:U==="Buy"?re:se,time:new Date().getTime(),price:C==null?void 0:C.price,priceUnit:Ne},Ve(D))}return B==="rejected"&&(V.toastTitleText=te.replace("Swapping","Swap")),V}},f||Ke(c),console.log("ðŸš€ ~ handleRouterSwap ~ txb:",$);const de=await Ge($,c,{useMev:Fe,useFastMode:!r&&Me==="Fast Mode",maxCapForGas:Ee,customGasPrice:Ie,msafeParams:K,otherParams:{routerData:i,providerKey:pe.current,from:(R=q.current)==null?void 0:R.coin_type,to:(x=k.current)==null?void 0:x.coin_type}});return console.log("ðŸš€ ~ file: useSwap.ts:272 ~ doSwapAction ~ res:",de),de?(P(),Oe(),!0):(G(),!1)}catch(D){console.log("ðŸš€ ~ handleRouterSwap ~ error text:",D)}},{scamsCoinList:z}=bt(e&&t?[e,t]:[]),at=a.useMemo(()=>{if(z.length===0)return;const s=e&&z.some(c=>c.coin_type===e.coin_type),r=t&&z.some(c=>c.coin_type===t.coin_type);if(s&&r&&(e!=null&&e.symbol)&&(t!=null&&t.symbol))return`${e.symbol} and ${t.symbol} are`;if(s&&(e!=null&&e.symbol))return`${e.symbol} token is `;if(r&&(t!=null&&t.symbol))return`${t.symbol} token is `},[z,e,t]),ot=async(s,r)=>{r&&W(U==="Buy"?"Sell":"Buy","toggleBtn"),s?(f?(n(t),m(e)):(n(t),m(e),g(`/swap/${t==null?void 0:t.coin_type}/${e==null?void 0:e.coin_type}`)),l(w),o(""),I(!0),await oe(200),G()):u?(f?(n(t),m(e)):g(`/swap/${t==null?void 0:t.coin_type}/${e==null?void 0:e.coin_type}`),l(""),o(y),I(!1),await oe(200),G()):(f?(n(t),m(e)):g(`/swap/${e==null?void 0:e.coin_type}/${t==null?void 0:t.coin_type}`),l(w),o(""),I(!0),await oe(200),G())};return a.useEffect(()=>()=>{f||(n(void 0),m(void 0)),l(""),o("")},[]),{handleSelectToken:et,handleAmountChange:Ce,fromAmount:y,toAmount:w,fromAmountValue:Je,toAmountValue:Xe,amountLimit:tt,getSwapSecondaryData:st,reCalculateRouteData:G,fromBalanceInfo:ze,toBalanceInfo:He,handleRouterSwap:rt,scamsText:at,refreshMarketPrice:ye,isOpenConfirmModel:Ue,setIsOpenConfirmModel:X,resetInputAmount:P,onReverseClick:ot}}export{ve as a,bt as b,At as c,Lt as u};
//# sourceMappingURL=useSwap-Dd8XQ9_C.js.map
