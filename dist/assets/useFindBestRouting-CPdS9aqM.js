import{u as v,a as g}from"./useSwapHelper-BDfKH-rI.js";import{a3 as O,ae as S,O as F,s as D}from"./index-Lo8eQgA0.js";import{B as l}from"./cross-J9VCREIf.js";function K(){const{aggregatorSDK:p}=O(),{getSwapPoolAddress:R}=v(),{deepbookV3Config:A,setDeepbookV3Config:B,providers:y}=S(),I=r=>{if(console.log("ðŸš€ ~ isDisableDegrade ~ res:",r),r&&r.error){const o=r.error.code;return o===g.InsufficientLiquidity||o===g.HoneyPot||o===g.NumberTooLarge}return!1},h=async r=>{console.log("ðŸš€ðŸš€ðŸš€ ~ useFindBestRouting.ts:35 ~ checkProvidersKeys ~ providersKeys:",r);const o=y.length>0?r.filter(e=>y.includes(e)):r;if(r.includes("DEEPBOOKV3")){let e=A;const u=new Date().getTime()/1e3;if(e===null||u-((e==null?void 0:e.last_update_time)||0)>60)try{e=await p.getDeepBookV3Config(),B(e)}catch(a){console.log("ðŸš€ ~ checkProvidersKeys ~ error:",a)}if(e&&e.is_alternative_payment){const{deep_fee_vault:a}=e;if(a<Number(F(20,6)))return o.filter(t=>t!=="DEEPBOOKV3")}}return o},P=async r=>{var m;const{fromToken:o,toToken:e,amount:u,providersKeys:a,by_amount_in:t,uuid:i}=r;console.log("ðŸš€ ~ useFindBestRouting ~ options:",r);let s={uuid:i,byAmountIn:t,isDegrade:!1};try{if(a.length===0)return s=d(!1,t,i,o,e,{error:{code:g.InsufficientLiquidity,msg:""},amountIn:new l(u),amountOut:new l("0"),byAmountIn:t,routes:[],insufficientLiquidity:!0}),s;const c={from:o.coin_type,target:e.coin_type,amount:new l(u),byAmountIn:t,depth:3,splitAlgorithm:void 0,splitFactor:void 0,splitCount:void 0,providers:a};console.log("ðŸš€ ~ file: useFindBestRouting.ts:26 ~ findBestRouters ~ routerParams:",c);const n=await p.findRouters(c);if(console.log("ðŸš€ ~ file: useFindBestRouting.ts:145 ~ findBestRouters ~ routerRes:",{routerRes:n}),n&&I(n))s=d(!1,t,i,o,e,n);else{if(!n||((m=n==null?void 0:n.paths)==null?void 0:m.length)===0)throw Error("not find router");s=d(!1,t,i,o,e,n)}}catch(c){try{console.log("ðŸš€ ~ file: useFindBestRouting.ts:105 ~ findRouters ~ error:",c);const n=await R(o,e);if(n.length===0){const b={amountIn:new l("0"),amountOut:new l("0"),byAmountIn:t,routes:[],insufficientLiquidity:!0,error:{code:g.NoRouter,msg:""}};s=d(!0,t,i,o,e,b)}const w={from:o.coin_type,target:e.coin_type,amount:new l(u),byAmountIn:t,pools:n};console.log("ðŸš€ ~ file: useFindBestRouting.ts:115 ~ findRouters ~ routerParams:",w);const f=await p.swapInPools(w);if(console.log("ðŸš€ ~ findBestRouters ~ swapInPools res:",f),!f||!f.routeData)s=d(!0,t,i,o,e);else return t?f.routeData.amountIn=new l(u):f.routeData.amountOut=new l(u),d(!0,t,i,o,e,f.routeData)}catch(n){console.log("ðŸš€ ~ file: useFindBestRouting.ts:120 ~ swapInPools ~  error:",n),s={uuid:i,byAmountIn:t,isDegrade:!0}}}return s},d=(r,o,e,u,a,t)=>{var i;if(console.log("ðŸš€ ~ file: useSwap.ts:166 ~ handleRouterData ~ res:",{isDegrade:r,routerData:t}),t){const s=t.error!==void 0,m=D(t.amountIn.toString(),u.decimals),c=D(t.amountOut.toString(),a.decimals);return{routerData:s?void 0:t,fromAmountUi:s?o?m:"":m,toAmountUi:s&&o?"":c,uuid:e,byAmountIn:o,isDegrade:r,errorCode:(i=t.error)==null?void 0:i.code}}else return{uuid:e,byAmountIn:o,isDegrade:r}};return{findBestRouters:P,checkProvidersKeys:h}}export{K as u};
