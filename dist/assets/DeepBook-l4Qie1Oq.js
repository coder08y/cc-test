const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PriceReference-ChO8PXix.js","assets/vendor-CBmAETR3.js","assets/index-Lo8eQgA0.js","assets/cross-J9VCREIf.js","assets/index-VqB3HDun.css","assets/MarketSource-Do5c0CXX.js","assets/TooltipIcon-Bqqgb7rr.js","assets/Ratio-CbQBFi3e.js","assets/YAxis-BKUOtGTb.js","assets/generateCategoricalChart-C4prEJcQ.js","assets/debounce-MPJy35Ge.js","assets/LineChart-4eXBYul_.js","assets/Line-mopvTbgP.js"])))=>i.map(i=>d[i]);
var gi=Object.defineProperty;var fi=(i,e,t)=>e in i?gi(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var st=(i,e,t)=>fi(i,typeof e!="symbol"?e+"":e,t);import{r as p,j as n,M as Dt,o as It,p as jt,$ as Bt,q as Wt,t as Ut,V as K,H,T as U,B as pe,D as bi,E as xi,G as mi,J as Ti,w as Fe,Y as Zt,m as se,n as ss,O as Ns,Q as Ss,U as Cs,ab as Ds,l as is,ac as _i,I as yi,a8 as wi,k as Et,ao as Oi}from"./vendor-CBmAETR3.js";import{i as Ei,K as vi,bU as He,M as ge,l as Is,d as X,Q as Ft,f2 as Ri,v as Kt,z as it,c8 as Ai,w as ot,av as js,aO as Li,a as ut,u as ze,an as Bs,I as Ne,S as Mi,C as Ws,j as Xt,bl as Ni,Y as Si,aL as Ci,B as ns,f3 as Di,E as de,bJ as Us,aT as Fs,n as Hs,f4 as Ii,f5 as ji,a8 as Bi,f6 as Wi,b as Ui,bo as zs,as as ks,f7 as qe,ad as Ys,f8 as Fi,cU as Hi,f9 as zi,fa as ki,bL as Yi}from"./index-Lo8eQgA0.js";import{H as ct}from"./HTextLabelBox-0wWY3DfK.js";import{R as Xs}from"./RefreshButton-BEUAg1WA.js";import{u as fs}from"./useTokenBalance-B8pbbpGD.js";import{_ as Xi}from"./cross-J9VCREIf.js";import{C as Pi}from"./CheckBox-BfyJMUfq.js";import{u as bt}from"./useAccountBalance-Bp-GiNHM.js";import{u as os}from"./useTransactionModal-Bz8Bofje.js";import{u as as}from"./useTransaction-C3m_5TTr.js";import{u as Ps}from"./useDocumentSize-DzZXzGS0.js";import{E as Pt,C as qi}from"./charting_library.esm-BuRCvzzK.js";import{v as Gi}from"./v4-C6aID195.js";import{u as qs}from"./useInterval-FApnpfRj.js";import{T as Ht}from"./Table-N6ht64Bc.js";import{S as Vi}from"./SearchInput-Ci9E2gMO.js";import{L as $i}from"./Loading-DOvYGudd.js";import{C as zt}from"./CoinPairInfo-BkYX588i.js";import{S as Ji}from"./Slippage-jToMHVh_.js";import{N as at}from"./NoData-BFX9XpKb.js";import{T as Gs}from"./TypeCon-DisMvTLJ.js";import"./useTrack-T_4vPqTb.js";import"./useSigner-Dol5aKH6.js";import"./index-BgoHGJbV.js";import"./debounce-MPJy35Ge.js";import"./index-D8UqOC8m.js";import"./config-DTm0VBgZ.js";import"./PoolTag-DVhitHGR.js";import"./index-D39Sw25C.js";import"./TooltipIcon-Bqqgb7rr.js";const Zi=(i,e)=>({deepBookPools:[],setDeepBookPools:t=>i({deepBookPools:t}),deepBookPoolsObj:{},setDeepBookPoolsObj:t=>i({deepBookPoolsObj:t}),deepBookPoolLoading:!1,setDeepBookPoolLoading:t=>i({deepBookPoolLoading:t}),currentDeepBookPool:{},setCurrentDeepBookPool:t=>i({currentDeepBookPool:t}),deepBookOrderBookLoading:!0,setDeepBookOrderBookLoading:t=>i({deepBookOrderBookLoading:t}),deepBookAskList:[],setDeepBookAskList:t=>i({deepBookAskList:t}),deepBookBidList:[],setDeepBookBidList:t=>i({deepBookBidList:t}),queryDeepBookPoolLoading:!1,setQueryDeepBookPoolLoading:t=>i({queryDeepBookPoolLoading:t}),queryDeepBookPools:[],setQueryDeepBookPools:t=>i({queryDeepBookPools:t}),currentBalanceManagerInfoMap:{},setCurrentBalanceManagerInfo:(t,s)=>i(o=>({currentBalanceManagerInfoMap:{...o.currentBalanceManagerInfoMap,[t]:s}})),getCurrentBalanceManagerInfo:t=>e().currentBalanceManagerInfoMap[t]||null,balanceManagerList:[],setBalanceManagerList:t=>i({balanceManagerList:t}),managerBalanceObjs:[],setManagerBalanceObjs:t=>i({managerBalanceObjs:t}),deepBookOpenOrders:[],setDeepBookOpenOrders:t=>i({deepBookOpenOrders:t}),showOpenOrdersNum:0,setShowOpenOrdersNum:t=>i({showOpenOrdersNum:t}),cancelOrderLoading:!1,setCancelOrderLoading:t=>i({cancelOrderLoading:t}),orderListLoading:!1,setOrderListLoading:t=>i({orderListLoading:t}),isCheckedAllMarkets:!1,setIsCheckedAllMarkets:t=>i({isCheckedAllMarkets:t}),deepBookOrderHistory:[],setDeepBookOrderHistory:t=>{var s;return i({deepBookOrderHistory:t,showDeepBookOrderHistoryNum:(s=t==null?void 0:t.filter(o=>{var a;return(o==null?void 0:o.poolId)===((a=e().currentDeepBookPool)==null?void 0:a.address)||e().isCheckedAllMarkets}))==null?void 0:s.length})},deepBookOrderHistoryLoading:!0,setDeepBookOrderHistoryLoading:t=>i({deepBookOrderHistoryLoading:t}),showDeepBookOrderHistoryNum:0,setShowDeepBookOrderHistoryNum:t=>i({showDeepBookOrderHistoryNum:t}),deepBookSettleList:[],setDeepBookSettleList:t=>i({deepBookSettleList:t}),deepBookSettleListLoading:!1,setDeepBookSettleListLoading:t=>i({deepBookSettleListLoading:t}),claimSettleLoading:!1,setClaimSettleLoading:t=>i({claimSettleLoading:t}),depositAssetsLoading:!1,setDepositAssetsLoading:t=>i({depositAssetsLoading:t}),withdrawAssetsLoading:!1,setWithdrawAssetsLoading:t=>i({withdrawAssetsLoading:t}),localDeepBookPools:[],setLocalDeepBookPools:t=>i({localDeepBookPools:t}),placeOrderPrice:"",setPlaceOrderPrice:t=>i({placeOrderPrice:t}),orderType:"Market",setOrderType:t=>i({orderType:t}),deepbookPrice:void 0,setDeepbookPrice:t=>{i(()=>({deepbookPrice:t}))}}),Q=Ei(vi(Zi,{name:"useDeepBookStore",partialize:i=>{const{currentBalanceManagerInfoMap:e,localDeepBookPools:t}=i;return{currentBalanceManagerInfoMap:e,localDeepBookPools:t}},version:1}));function Se(){const{deepBookSDK:i}=He(),{setBalanceManagerList:e,setCurrentBalanceManagerInfo:t,getCurrentBalanceManagerInfo:s,setManagerBalanceObjs:o}=Q(),{currentAccount:a}=ge(),r=p.useRef(a==null?void 0:a.address);p.useEffect(()=>{r.current=a==null?void 0:a.address},[a==null?void 0:a.address]);const l=async(c,h,u)=>{var f,b;try{const g=c.map(O=>({coinType:O.coin_type,decimals:O.decimals}));if(g.length<1)return[];let y=u||((f=s(h))==null?void 0:f.balanceManager);if(!y){const O=await d(h);(O==null?void 0:O.length)>0&&(y=(b=O==null?void 0:O[0])==null?void 0:b.balanceManager)}const T=await i.DeepbookUtils.getManagerBalance({account:h,balanceManager:y,coins:[...g]});o(T)}catch(g){console.log("🚀 ~ file: useDeepbook.ts:245 ~ getManagerBalance ~ error:",g)}},d=async c=>{const h=await i.DeepbookUtils.getBalanceManager(c);console.log("🚀🚀🚀 ~ useGetDeepBookManagerBalance.ts:43 ~ getBalanceManagerInfo ~ res:",h),e(h);const u=s(c);if(r.current==c)return u&&Is(u)?t(c,u):h&&h.length>0?t(c,h[0]):t(c,{}),h};return{getBalanceManagerInfo:d,getManagerBalance:l}}function rs(){const{currentDeepBookPool:i,managerBalanceObjs:e}=Q(),t=p.useMemo(()=>{var d,c;return i!=null&&i.address?(c=e[(d=i==null?void 0:i.baseAssets)==null?void 0:d.coin_type])==null?void 0:c.adjusted_balance:"0"},[i==null?void 0:i.address,e]),s=p.useMemo(()=>{var d,c;return i!=null&&i.address?(c=e[(d=i==null?void 0:i.quoteAssets)==null?void 0:d.coin_type])==null?void 0:c.adjusted_balance:"0"},[i==null?void 0:i.address,e]),{balanceInfo:o}=fs(i==null?void 0:i.baseAssets),{balanceInfo:a}=fs(i==null?void 0:i.quoteAssets),r=p.useMemo(()=>X(t).add((o==null?void 0:o.balanceFormat)??0).toString(),[t,o]),l=p.useMemo(()=>X(s).add((a==null?void 0:a.balanceFormat)??0).toString(),[s,a]);return{baseFreeBalance:t,quoteFreeBalance:s,baseBalance:o,quoteBalance:a,allBaseBalance:r,allQuoteBalance:l}}function Ki({token:i,title:e,isOpen:t,onClose:s,onConfirm:o,isBaseAsset:a}){const[r,l]=p.useState(""),[d,c]=p.useState(25),[h,u]=p.useState("slider"),f=[{label:"25%"},{label:"50%"},{label:"75%"},{label:"MAX"}],{getTokenAmountValue:b}=Ft(),g=b(i==null?void 0:i.coin_type,r),{baseFreeBalance:y,quoteFreeBalance:T,baseBalance:O,quoteBalance:N}=rs(),R=p.useMemo(()=>e==="Deposit"?a?O==null?void 0:O.balanceFormat:N==null?void 0:N.balanceFormat:a?y:T,[e,a,O==null?void 0:O.balanceFormat,N==null?void 0:N.balanceFormat,y,T]),w=p.useMemo(()=>Ri.isSuiCoin((i==null?void 0:i.coin_type)||""),[i==null?void 0:i.coin_type]),I=p.useMemo(()=>d===100?"MAX":`${d}%`,[d]),x=p.useCallback((M,v="slider")=>{if(u(v),M==="MAX"||M===100)c(100);else{const m=Number(String(M).replace("%",""));c(m)}},[]),W=p.useCallback(M=>{M.label==="MAX"?x(100,"tab"):x(M.label,"tab")},[x]),S=p.useCallback(M=>{x(`${M}%`,"slider")},[x]),C=p.useCallback(M=>{u("input"),l(M)},[]);p.useEffect(()=>{if(console.log("🚀🚀🚀 ~ AssetsInfoModal.tsx:103 ~ AssetsInfoModal ~ slideValue:",d),d&&(h==="slider"||h==="tab")&&R){const M=w&&e=="Deposit"&&d==100?.05:0,v=Kt(it(R).mul(d).div(100).sub(M).toString(),i==null?void 0:i.decimals,!0);l(v)}},[d,h,R,i==null?void 0:i.decimals,w,e]),p.useEffect(()=>{if(r&&h==="input"&&R){console.log("🚀🚀🚀 ~ AssetsInfoModal.tsx:112 ~ AssetsInfoModal ~ inputValue:",r);const M=w&&e=="Deposit"?.05:0,v=it(r).add(M).div(it(R)).mul(100),m=it(v).gt(100)?100:Number(v);console.log("🚀🚀🚀 ~ AssetsInfoModal.tsx:118 ~ AssetsInfoModal ~ clampedPercentage:",m),c(m)}},[r,h,R]);const A=p.useMemo(()=>+r?it(r).gt(R||0)?{text:`Insufficient ${i==null?void 0:i.symbol} balance`,disabled:!0}:{text:e==="Deposit"?"Deposit":"Withdraw",disabled:!1}:{text:"",disabled:!0},[r,R,i==null?void 0:i.symbol,e]);return n.jsxs(Dt,{autoFocus:!1,returnFocusOnClose:!1,trapFocus:!1,isOpen:t,onClose:()=>s(!1),isCentered:!0,children:[n.jsx(It,{}),n.jsxs(jt,{children:[n.jsx(Bt,{children:e}),n.jsx(Wt,{}),n.jsx(Ut,{textAlign:"center",p:"0 16px 16px",children:n.jsxs(K,{w:"100%",gap:"20px",children:[n.jsx(Ai,{wrapStyle:{h:"unset"},placeholder:"0.0",value:r,needRemainBalance:e==="Deposit"&&w,amountValue:g,onChange:C,balance:R,token:i,balanceLabel:e==="Deposit"?"":"Available",inputStyle:{width:"100%"},half:!1,max:!1}),n.jsxs(H,{w:"100%",justify:"space-between",children:[n.jsx(U,{fontSize:"20px",color:"text_caption",whiteSpace:"nowrap",children:it(d).gt(0)&&d<.01?"<0.01":`${Kt(d,2)}%`}),n.jsx(ot,{type:"outlineTab",tabList:f,currentTab:I,handleChangeTab:W,wrapStyle:{w:{base:"220px",lg:"350px"},h:"32px",p:"3px",borderRadius:"8px"},itemStyle:{flex:1,fontSize:"14px",margin:0}})]}),n.jsx(pe,{w:"100%",mt:"-10px",children:n.jsxs(bi,{"aria-label":"assets-info-slider",min:0,max:100,focusThumbOnChange:!1,value:d,onChange:S,children:[n.jsx(xi,{bg:"bg_secondary",h:"8px",children:n.jsx(mi,{h:"4px"})}),n.jsx(Ti,{})]})}),n.jsx(Fe,{w:"100%",fontWeight:"500",onClick:()=>o(r),isDisabled:A.disabled,children:A.text||e})]})})]})]})}function Qi({isOpen:i,onClose:e}){const{currentAccount:t}=ge(),{getExplorerUrl:s}=js(),{balanceManagerList:o,getCurrentBalanceManagerInfo:a,currentBalanceManagerInfoMap:r,setCurrentBalanceManagerInfo:l}=Q(),d=p.useMemo(()=>t!=null&&t.address?a(t==null?void 0:t.address):null,[t==null?void 0:t.address,r]);return n.jsxs(Dt,{autoFocus:!1,returnFocusOnClose:!1,trapFocus:!1,isOpen:i,onClose:()=>e(!1),isCentered:!0,children:[n.jsx(It,{}),n.jsxs(jt,{w:"326px",children:[n.jsx(Bt,{children:"Change Account"}),n.jsx(Wt,{}),n.jsx(Ut,{textAlign:"center",pb:"20px",children:n.jsx(K,{w:"100%",gap:"20px",align:"flex-start",children:o==null?void 0:o.map(c=>n.jsxs(H,{sx:{_hover:{p:{color:"text_caption"}}},cursor:"pointer",onClick:()=>{l(t==null?void 0:t.address,c),e()},children:[n.jsx(Pi,{checked:(d==null?void 0:d.balanceManager)==(c==null?void 0:c.balanceManager),onClick:()=>{}}),n.jsx(Li,{subStringLengthStart:12,subStringLengthEnd:12,address:c==null?void 0:c.balanceManager,fontSize:"14px",isAddressCancelBubble:!1,hasUnderline:!1,color:(d==null?void 0:d.balanceManager)==(c==null?void 0:c.balanceManager)?"text_caption":"text_paragraph",onAddressClick:()=>l(t==null?void 0:t.address,c),onClickLink:()=>window.open(s(c==null?void 0:c.balanceManager,"account"))})]},c==null?void 0:c.address))})})]})]})}function Ce(){const{deepBookSDK:i}=He(),{currentDeepBookPool:e,setDeepBookAskList:t,setDeepBookBidList:s,setDeepBookOrderBookLoading:o,deepBookPrice:a}=Q(),r=c=>{var h,u,f,b;return{address:c==null?void 0:c.address,baseCoin:{coinType:(h=c==null?void 0:c.baseAssets)==null?void 0:h.coin_type,decimals:(u=c==null?void 0:c.baseAssets)==null?void 0:u.decimals},quoteCoin:{coinType:(f=c==null?void 0:c.quoteAssets)==null?void 0:f.coin_type,decimals:(b=c==null?void 0:c.quoteAssets)==null?void 0:b.decimals}}},l=c=>c.map(h=>({...h,total:h.price*h.quantity}));return{getOrderBook:async(c,h,u=!1,f=9)=>{var b,g,y;try{if(!(e!=null&&e.price))return;u&&o(!0);const T=r(e),O=h.split(".")[1]?h.split(".")[1].length:0,N=((y=(g=(b=e==null?void 0:e.price)==null?void 0:b.split("."))==null?void 0:g[0])==null?void 0:y.length)||0,R=O<N?N+1:O,w=await i.DeepbookUtils.getOrderBook(T,c,R);console.log("🚀🚀🚀 ~ useGetDeepBookOrderBook.ts:41 ~ getOrderBook ~ res:",w);const I=l(JSON.parse(JSON.stringify(w.ask))),x=l(JSON.parse(JSON.stringify(w.bid)));(c==="ask"||c==="all")&&t(I),(c==="bid"||c==="all")&&s(x),o(!1)}catch(T){console.error("getOrderBook error:",T)}},getRequestPool:r}}function en(){const{deepBookSDK:i}=He(),{getCurrentBalanceManagerInfo:e}=Q(),{currentAccount:t}=ge(),{getRequestPool:s}=Ce(),{getBalanceManagerInfo:o}=Se();return{getDeepBookAssetsDepositPayload:async(l,d,c)=>{var y,T;const h=s(l);let u=(y=e(t==null?void 0:t.address))==null?void 0:y.balanceManager;if(!u){const O=await o(t==null?void 0:t.address);(O==null?void 0:O.length)>0&&(u=(T=O==null?void 0:O[0])==null?void 0:T.balanceManager)}const f=t==null?void 0:t.address,b=c?h.baseCoin:h.quoteCoin;let g=null;return u?g=i.DeepbookUtils.depositIntoManager({account:f,balanceManager:u,coin:b,amountToDeposit:d}):g=i.DeepbookUtils.createAndDepsit({account:f,coin:b,amountToDeposit:d}),console.log("toDeposit tx:",g),g},getDeepBookAssetsWithdrawPayload:async(l,d,c)=>{var y;const h=s(l),u=(y=e(t==null?void 0:t.address))==null?void 0:y.balanceManager,f=t==null?void 0:t.address,b=c==="base"?h.baseCoin:h.quoteCoin;return await i.DeepbookUtils.withdrawFromManager({account:f,balanceManager:u,coin:b,amountToWithdraw:d})}}}function tn(){const{currentDeepBookPool:i,setDepositAssetsLoading:e,setWithdrawAssetsLoading:t,getCurrentBalanceManagerInfo:s}=Q(),{getDeepBookAssetsDepositPayload:o,getDeepBookAssetsWithdrawPayload:a}=en(),{transactionConfirmation:r}=os(),{signAndExecuteTransaction:l}=as(),{mevProtect:d,maxCapForGas:c,transactionMode:h,customGasPrice:u}=ut(),{fetchAccountBalance:f}=bt(),{getManagerBalance:b}=Se(),{currentAccount:g}=ge();return{deposit:async(O,N)=>{var R;try{e(!0);const w=N?i==null?void 0:i.baseAssets:i==null?void 0:i.quoteAssets,I=X(O).mul(X(Math.pow(10,w==null?void 0:w.decimals))).toString();let x={getShowInfo:(C,A)=>{const M=`Deposit ${O} ${w==null?void 0:w.symbol}`,v={modalDescriptionText:M,toastTitleText:M};return C==="success"&&(v.toastDescriptionContent=`Deposit ${O} ${w==null?void 0:w.symbol}`,v.modalDescriptionText=`Deposit ${O} ${w==null?void 0:w.symbol}`,v.toastTitleText="Deposit successful"),v}};r(x);const W=await o(i,I,N),S=await l(W,x,{useMev:d,useFastMode:h==="Fast Mode",maxCapForGas:c,customGasPrice:u,msafeParams:{}});console.log("🚀🚀🚀 ~ useTradeCard.ts:135 ~ placeMarketOrder ~ res:",S),S&&(f(),b([{coin_type:i==null?void 0:i.baseAssets.coin_type,decimals:i==null?void 0:i.baseAssets.decimals},{coin_type:i==null?void 0:i.quoteAssets.coin_type,decimals:i==null?void 0:i.quoteAssets.decimals}],g==null?void 0:g.address,(R=s(g==null?void 0:g.address))==null?void 0:R.balanceManager)),setTimeout(()=>{e(!1)},2e3)}catch(w){console.log("🚀🚀🚀 ~ useDeepBookAssetsInfo.ts:14 ~ deposit ~ error:",w)}},withdraw:async(O,N)=>{var R;try{t(!0);const w=N?i==null?void 0:i.baseAssets:i==null?void 0:i.quoteAssets;console.log("🚀🚀🚀 ~ useDeepBookAssetsActions.ts:80 ~ deposit ~ tokenInfo:",w);const I=X(O).mul(X(Math.pow(10,w==null?void 0:w.decimals))).toString();let x={getShowInfo:(C,A)=>{const M=`Withdraw ${O} ${w==null?void 0:w.symbol}`,v={modalDescriptionText:M,toastTitleText:M};return C==="success"&&(v.toastDescriptionContent="Withdraw successful",v.modalDescriptionText=`Withdraw ${O} ${w==null?void 0:w.symbol}`,v.toastTitleText=`Withdraw ${O} ${w==null?void 0:w.symbol}`),v}};r(x);const W=await a(i,I,N?"base":"quote"),S=await l(W,x,{useMev:d,useFastMode:h==="Fast Mode",maxCapForGas:c,customGasPrice:u,msafeParams:{}});console.log("🚀🚀🚀 ~ useTradeCard.ts:135 ~ placeMarketOrder ~ res:",S),S&&(f(),b([{coin_type:i==null?void 0:i.baseAssets.coin_type,decimals:i==null?void 0:i.baseAssets.decimals},{coin_type:i==null?void 0:i.quoteAssets.coin_type,decimals:i==null?void 0:i.quoteAssets.decimals}],g==null?void 0:g.address,(R=s(g==null?void 0:g.address))==null?void 0:R.balanceManager)),setTimeout(()=>{t(!1)},2e3)}catch(w){console.log("🚀🚀🚀 ~ useDeepBookAssetsInfo.ts:14 ~ deposit ~ error:",w)}}}}function bs({token:i,onDeposit:e,onWithdraw:t,freeBalance:s,balanceInfo:o,lockBalance:a}){const r=!(i!=null&&i.symbol);return n.jsxs(K,{align:"flex-start",w:"100%",height:"160px",gap:"12px",mt:"12px",children:[r?n.jsxs(H,{w:"100%",children:[n.jsx(Zt,{}),n.jsx(se,{})]}):n.jsxs(H,{w:"100%",children:[n.jsx(Mi,{imageUrl:i==null?void 0:i.logo_url,imgBoxStyle:{w:"24px",h:"24px"},imageStyle:{w:"24px",h:"24px"}}),n.jsx(U,{color:"text_caption",children:i==null?void 0:i.symbol})]}),n.jsxs(H,{w:"100%",h:"20px",justify:"space-between",children:[n.jsxs(H,{gap:"4px",children:[n.jsx(U,{children:"Locked"}),n.jsx(Ws,{tooltip:n.jsx(U,{fontSize:"12px",children:"Locked in Limit Orders"}),placement:"top",children:n.jsx(Ne,{xlinkHref:"#icon-icon_tips",svgW:"20px",svgH:"20px"})})]}),r?n.jsx(se,{}):n.jsx(U,{color:"text_caption",children:a})]}),n.jsx(ct,{isLoading:!1,label:"Free Balance",value:r?n.jsx(se,{}):s??"0.00",labelStyle:{fontSize:"14px",h:"20px",lineHeight:"20px"},valueStyle:{fontSize:"14px",h:"20px",lineHeight:"20px"},skeletonStyle:{valueW:"96px",valueH:"16px"}}),n.jsx(ct,{isLoading:!1,label:"Wallet Balance",value:r?n.jsx(se,{}):Kt((o==null?void 0:o.balanceFormat)??0),labelStyle:{fontSize:"14px",h:"20px",lineHeight:"20px"},valueStyle:{fontSize:"14px",h:"20px",lineHeight:"20px"},skeletonStyle:{valueW:"96px",valueH:"16px"}}),n.jsxs(H,{w:"100%",children:[n.jsx(Fe,{variant:"outline",h:"28px",w:"50%",borderRadius:"8px",isDisabled:X((o==null?void 0:o.balanceFormat)??0).lte(0),fontSize:"12px",onClick:()=>e(i),children:"Deposit"}),n.jsx(Fe,{variant:"ghost",h:"28px",w:"50%",borderRadius:"8px",isDisabled:X(s??0).lte(0),fontSize:"12px",borderColor:"transparent !important",onClick:()=>t(i),children:"Withdraw"})]})]})}function Vs(){var m;const{currentDeepBookPool:i,currentBalanceManagerInfoMap:e,deepBookOpenOrders:t}=Q(),{currentAccount:s}=ge(),[o,a]=p.useState(!1),[r,l]=p.useState(!1),[d,c]=p.useState("Deposit"),[h,u]=p.useState(),{getCurrentBalanceManagerInfo:f,balanceManagerList:b}=Q(),g=Q(E=>{const F=s==null?void 0:s.address;return F&&E.currentBalanceManagerInfoMap[F]||null}),{getManagerBalance:y}=Se(),{deposit:T,withdraw:O}=tn();p.useEffect(()=>{g!=null&&g.balanceManager&&(i!=null&&i.address)&&(s!=null&&s.address)&&y([{coin_type:i==null?void 0:i.baseAssets.coin_type,decimals:i==null?void 0:i.baseAssets.decimals},{coin_type:i==null?void 0:i.quoteAssets.coin_type,decimals:i==null?void 0:i.quoteAssets.decimals}],s==null?void 0:s.address,g==null?void 0:g.balanceManager)},[g,s==null?void 0:s.address,i]);const{baseFreeBalance:N,quoteFreeBalance:R,baseBalance:w,quoteBalance:I}=rs(),x=p.useMemo(()=>{const E={baseLock:"0",quoteLock:"0"};if((t==null?void 0:t.length)>0){let F="0",B="0";t.forEach(V=>{(i==null?void 0:i.address)===(V==null?void 0:V.address)&&((V==null?void 0:V.side)=="Buy"?B=X(B).add(X(V.originalQuantity).sub(X(V.filledQuantity)).mul(V.price)).toString():F=X(F).add(X(V.originalQuantity).sub(X(V.filledQuantity))).toString())}),E.baseLock=F,E.quoteLock=B}return E},[t,i]),W=E=>{u(E),c("Deposit"),a(!0)},S=E=>{u(E),c("Withdraw"),a(!0)},{fetchAccountBalance:C}=bt(),A=()=>{i!=null&&i.address&&(s!=null&&s.address)&&(y([{coin_type:i==null?void 0:i.baseAssets.coin_type,decimals:i==null?void 0:i.baseAssets.decimals},{coin_type:i==null?void 0:i.quoteAssets.coin_type,decimals:i==null?void 0:i.quoteAssets.decimals}],s==null?void 0:s.address,g==null?void 0:g.balanceManager),C())},{size:M}=Ps(),{isApp:v}=ze();return n.jsxs(K,{w:"100%",align:"flex-start",bg:"bg_secondary",borderRadius:"12px",h:"100%",children:[n.jsx(pe,{w:"100%",p:"16px 16px 0",children:n.jsxs(H,{w:"100%",borderBottom:"1px solid",borderColor:"border",pb:"12px",children:[n.jsxs(H,{w:"100%",children:[n.jsx(U,{fontSize:"16px",color:"text_caption",children:"Asset Info"}),v&&n.jsx(Xs,{handleRefresh:A,w:"28px",h:"28px",minW:"28px",innerStyle:{bg:"none"}})]}),(b==null?void 0:b.length)>1&&n.jsx(K,{p:"6px 8px 8px",bg:"primary_opacity.10",borderRadius:"8px",justify:"center",children:n.jsxs(H,{w:"auto",gap:"0px",cursor:"pointer",align:"flex-end",onClick:()=>l(!0),_hover:{svg:{fill:"text_caption"}},lineHeight:"40px",children:[n.jsx(U,{lineHeight:"1",color:"primary",children:Bs(g==null?void 0:g.balanceManager)}),n.jsx(Ne,{xlinkHref:"#icon-icon_descending_nor",svgW:"20px",svgH:"20px",mb:"-3px",transform:"rotate(-90deg)"})]})})]})}),n.jsxs(K,{w:"100%",align:"flex-start",p:"0 16px 16px",minHeight:"334px",h:{base:"100%",lg:(M==null?void 0:M.h)-80-430-8-46-40},overflow:"auto",bg:"bg_secondary",children:[n.jsx(bs,{token:i==null?void 0:i.baseAssets,onDeposit:W,onWithdraw:S,depositDisabled:X((w==null?void 0:w.balanceFormat)??0).lte(0),withdrawDisabled:X(N??0).lte(0),freeBalance:N,balanceInfo:w,lockBalance:x==null?void 0:x.baseLock}),n.jsx(bs,{token:i==null?void 0:i.quoteAssets,onDeposit:W,onWithdraw:S,depositDisabled:X((I==null?void 0:I.balanceFormat)??0).lte(0),withdrawDisabled:X(R??0).lte(0),balanceInfo:I,freeBalance:R,lockBalance:x==null?void 0:x.quoteLock}),o&&n.jsx(Ki,{token:h,title:d,isOpen:o,isBaseAsset:(h==null?void 0:h.symbol)===((m=i==null?void 0:i.baseAssets)==null?void 0:m.symbol),onClose:()=>a(!1),onConfirm:E=>{var F,B;d==="Deposit"?T(E,(h==null?void 0:h.symbol)===((F=i==null?void 0:i.baseAssets)==null?void 0:F.symbol)).then(()=>{a(!1)}):O(E,(h==null?void 0:h.symbol)===((B=i==null?void 0:i.baseAssets)==null?void 0:B.symbol)).then(()=>{a(!1)})}}),r&&n.jsx(Qi,{isOpen:r,onClose:()=>l(!1)})]})]})}let he=null,Ke=new Map,We="disconnected",qt=!1,$e=null,_t=new Map,nt=null,yt=!1,lt=0,wt=0,ls=new Set;const sn=i=>{ls.add(i)},nn=i=>{ls.delete(i)},on=()=>{const i=Date.now(),e=i-wt;e>5e3&&(console.log(`WebSocket reconnected after ${e}ms, executing compensation...`),console.log(`Compensation time range: ${new Date(wt).toISOString()} to ${new Date(i).toISOString()}`),ls.forEach(t=>{try{t(wt,i)}catch(s){console.error("Error executing reconnection compensation callback:",s)}}))},an=i=>{const[e,t]=p.useState(We),[s,o]=p.useState(0),a=p.useRef(new Map),r=p.useRef(i);r.current=i;const l=p.useRef(0),d=p.useRef(0),c=p.useCallback(A=>{We=A,t(A)},[]),h=p.useCallback(()=>yt?(lt++,"change_sub"):(yt=!0,lt=1,"subscribe"),[]),u=p.useCallback(()=>{yt=!1,lt=0},[]),f=p.useCallback(()=>{if(he&&he.readyState===WebSocket.OPEN)try{const A={op:"ping"};he.send(JSON.stringify(A)),console.log("Sent ping message")}catch(A){console.error("Failed to send heartbeat:",A)}},[]),b=p.useCallback(()=>{var M;nt&&clearInterval(nt);const A=((M=r.current)==null?void 0:M.heartbeatInterval)||3e4;nt=setInterval(()=>{f()},A)},[f]),g=p.useCallback(()=>{nt&&(clearInterval(nt),nt=null)},[]);p.useCallback((A,M)=>{var v,m;return M.matcher?M.matcher(A):!!(M.messageType&&A.op===M.messageType||M.source&&A.source===M.source||M.category&&A.category===M.category||M.poolAddresses&&M.poolAddresses.length>0&&(A.sub_addrs&&A.sub_addrs.some(E=>M.poolAddresses.includes(E))||(v=A.data)!=null&&v.tokenId&&M.poolAddresses.includes(A.data.tokenId)||(m=A.data)!=null&&m.poolId&&M.poolAddresses.includes(A.data.poolId)))},[]);const y=p.useCallback(A=>{try{const M=JSON.parse(A.data);if(console.log("Received message:",M),M.op){const v=Ke.get(M.op);v&&v.forEach(E=>E(M));const m=a.current.get(M.op);m&&m.forEach(E=>E(M))}if(M.category){const v=Ke.get(M.category);v&&v.forEach(E=>E(M));const m=a.current.get(M.category);m&&m.forEach(E=>E(M))}if(M.source){const v=Ke.get(M.source);v&&v.forEach(E=>E(M));const m=a.current.get(M.source);m&&m.forEach(E=>E(M))}}catch(M){console.error("Error parsing WebSocket message:",M)}},[]),T=p.useCallback(A=>he&&he.readyState===WebSocket.OPEN?(he.send(JSON.stringify(A)),!0):!1,[]),O=p.useCallback(()=>{var M,v,m;if(qt=!1,console.log("deepbook websocket  connect"),he){if(he.readyState===WebSocket.OPEN){c("connected"),b();return}if(he.readyState===WebSocket.CONNECTING){c("connecting");return}}const A=((M=r.current)==null?void 0:M.url)||"wss://stream.cetus.zone/ws";c("connecting");try{he=new WebSocket(A),he.onopen=()=>{l.current=0,c("connected"),o(0),console.log("WebSocket connected"),b(),_t.forEach(E=>{T(E)}),on()},he.onmessage=y,he.onclose=()=>{var E,F;if(c("disconnected"),console.log("WebSocket disconnected"),g(),u(),wt=Date.now(),!qt&&document.visibilityState==="visible"){const B=((E=r.current)==null?void 0:E.maxReconnectAttempts)||5;if(l.current<B){const $=((F=r.current)==null?void 0:F.reconnectInterval)||5e3;setTimeout(()=>{l.current+=1,o(ne=>ne+1),O()},$)}}},he.onerror=E=>{c("error"),console.error("WebSocket error:",E)}}catch(E){console.error("Dial error:",E);const F=((v=r.current)==null?void 0:v.maxReconnectAttempts)||5;l.current<F&&setTimeout(()=>{l.current+=1,O()},((m=r.current)==null?void 0:m.reconnectInterval)||5e3)}},[y,T,c,b,g,u]),N=p.useCallback(()=>{qt=!0,g(),he&&(c("disconnecting"),he.close(),he=null,c("disconnected"))},[c,g]),R=p.useCallback(()=>{var M;const A=((M=r.current)==null?void 0:M.visibilityDisconnectDelay)||6e4;if(document.visibilityState==="hidden")d.current=new Date().getTime(),$e&&clearTimeout($e),$e=setTimeout(()=>{he&&he.readyState===WebSocket.OPEN&&N()},A);else{if($e&&(clearTimeout($e),$e=null,console.log("")),new Date().getTime()-d.current>3e5){window.location.reload();return}(!he||he.readyState===WebSocket.CLOSED)&&O()}},[O,N]),w=p.useCallback((A,M,v)=>{var m,E;return Ke.has(A)||Ke.set(A,new Set),(m=Ke.get(A))==null||m.add(M),a.current.has(A)||a.current.set(A,new Set),(E=a.current.get(A))==null||E.add(M),()=>{var F,B;(F=Ke.get(A))==null||F.delete(M),(B=a.current.get(A))==null||B.delete(M)}},[]),I=p.useCallback((A,{isSubscription:M=!1}={})=>{M&&A.op==="subscribe"&&(A.op=h(),console.log(`Subscription operation: ${A.op} (count: ${lt})`));const v=T(A);if(M&&v){const m=`${A.op}_${A.source}_${A.category}`;_t.set(m,A)}return v},[T,h]),x=p.useCallback(A=>{const M=`${A.op}_${A.source}_${A.category}`;_t.delete(M);const v={op:"unsubscribe",source:A.source,category:A.category,sub_addrs:A.sub_addrs};T(v)},[T]),W=p.useCallback(A=>I({op:"subscribe",source:"deepbookv3",category:"pool-price",sub_addrs:A},{isSubscription:!0}),[I]),S=p.useCallback(()=>({hasInitialSubscription:yt,subscriptionCount:lt,activeSubscriptionsCount:_t.size}),[]),C=p.useCallback(()=>{f()},[f]);return p.useEffect(()=>{var A;return t(We),(A=r.current)!=null&&A.autoConnect&&We==="disconnected"&&O(),document.addEventListener("visibilitychange",R),()=>{a.current.clear(),document.removeEventListener("visibilitychange",R),$e&&clearTimeout($e)}},[O,R]),{state:e,isConnected:e==="connected",reconnectCount:s,connect:O,disconnect:N,subscribe:w,send:I,unsubscribe:x,getSocket:()=>he,ping:C,subscribePoolPrice:W,getSubscriptionStats:S,addReconnectCompensation:sn,removeReconnectCompensation:nn,getConnectionHealth:()=>({state:We,isConnected:We==="connected",isConnecting:We==="connecting",isDisconnected:We==="disconnected",isError:We==="error",isDisconnecting:We==="disconnecting"})}},Qe={1:"1min",10:"10min",15:"15min",30:"30min",60:"hour",240:"4hour","1D":"day","1W":"week"};let Gt=null;function rn(){const i=p.useRef(),e=p.useRef(),t=p.useRef(),s=p.useRef(),{subscribe:o,send:a,disconnect:r,addReconnectCompensation:l,removeReconnectCompensation:d}=an({autoConnect:!0,maxReconnectAttempts:5}),c=p.useRef();return p.useEffect(()=>(c.current=async(b,g)=>{var y,T;if(i.current&&e.current&&t.current){console.log("🔄 Executing reconnection compensation for K-line data..."),console.log(`🔄 Compensation time range: ${new Date(b).toISOString()} to ${new Date(g).toISOString()}`);try{const O=Math.floor(b/1e3),N=Math.floor(g/1e3);console.log(`🔄 Compensation timestamps: ${O} to ${N}`);const R=Qe[e.current],w=`${(y=Xt)==null?void 0:y.cetus_api}/v3/sui/deepbookv3/prices?date_type=${R}&start_timestamp=${O}&end_timestamp=${N}&address=${i.current}`;console.log("🔄 Compensation API URL:",w);const x=await(await fetch(w)).json();if((x==null?void 0:x.code)===0&&((T=x==null?void 0:x.data)!=null&&T.lists)&&Array.isArray(x.data.lists)){const W=x.data.lists.map(S=>({time:X(S.timestamp).mul(1e3).toNumber(),high:Number(S.high),low:Number(S.low),open:Number(S.open),close:Number(S.settle)}));console.log(`🔄 Compensation successful: got ${W.length} data points`),W.sort((S,C)=>S.time-C.time),W.forEach(S=>{t.current(S)})}else console.warn("🔄 Compensation API returned no data or error")}catch(O){console.error("🔄 Compensation failed:",O)}}},l(c.current),()=>{c.current&&d(c.current)}),[l,d]),{getDeepbookHistoricalData:async({poolId:b,resolution:g,from:y,to:T,firstDataRequest:O,callback:N,onErrorCallback:R})=>{var C;i.current=b;const w=Gi();Gt=w;const I=Qe[g],x=`${(C=Xt)==null?void 0:C.cetus_api}/v3/sui/deepbookv3/prices?date_type=${I}&start_timestamp=${y}&end_timestamp=${T}&address=${b}`,W=async()=>{var A,M;try{const m=await(await fetch(x)).json();if((m==null?void 0:m.code)===500)throw new Error("Server Error: 500");if((m==null?void 0:m.code)===0&&((A=m==null?void 0:m.data)==null?void 0:A.length)===0)return null;const E=((M=m==null?void 0:m.data)==null?void 0:M.lists)||[];return(E==null?void 0:E.map(B=>({time:X(B.timestamp).mul(1e3).toNumber(),high:Number(B.high),low:Number(B.low),open:Number(B.open),close:Number(B.settle)})))||[]}catch(v){return console.error("getDeepbookHistoricalData 🚀 ~ fetchData Error:",v),Gt!==w?(console.log("🚀 ~ Request aborted due to poolId change."),[]):(console.log("Retrying in 5 seconds..."),await Ni(5e3),Gt!==w?(console.log("🚀 ~ Request aborted due to poolId change."),[]):await W())}},S=await W();S?N(S,{noData:!1}):N([],{noData:!0})},subscribeKlineData:({poolId:b,resolution:g,callback:y})=>{if(console.log("🚀 ~ subscribeKlineData ~ { poolId, resolution, callback }:",{poolId:b,resolution:g,callback:y}),!g||!(Qe!=null&&Qe[g])||!b)return()=>{};i.current=b,e.current=g,t.current=y;const T=s.current?"change_sub":"subscribe";s.current&&s.current(),s.current=o("pool-price",R=>{var x;if(console.log("Received pool-price message:",R),!(R!=null&&R.body)||(R==null?void 0:R.op)!=="data"){console.log("Message does not contain valid list data");return}const w=R==null?void 0:R.body;if(!w){console.log("No valid data in list");return}if(!((x=R==null?void 0:R.sub_addr)!=null&&x.includes(b))){console.log("Pool ID mismatch:",{poolId:b,messageTokenId:R==null?void 0:R.sub_addr});return}const I={time:X(w.timestamp).mul(1e3).toNumber(),high:Number(w.high),low:Number(w.low),open:Number(w.open),close:Number(w.settle)};y(I)});const O={op:T,source:"deepbookv3",category:"pool-price",sub_addr:b,data_types:[Qe[g]]};return a(O,{isSubscription:!0})?console.log("Successfully sent subscription message for pool:",b):console.error("Failed to send subscription message for pool:",b),()=>{s.current&&(s.current(),s.current=void 0),i.current=void 0,e.current=void 0,t.current=void 0}},getLatestKlineData:async({poolId:b,resolution:g,from:y,to:T,firstDataRequest:O,callback:N,onErrorCallback:R})=>{var w,I,x,W,S;try{const C=Qe[g],A=`${(w=Xt)==null?void 0:w.cetus_api}/v3/sui/deepbookv3/prices?date_type=${C}&start_timestamp=${y}&end_timestamp=${T}&address=${b}`,v=await(await fetch(A,{method:"GET",headers:{accept:"application/json"}})).json(),m=(S=(I=v==null?void 0:v.data)==null?void 0:I.lists)==null?void 0:S[((W=(x=v==null?void 0:v.data)==null?void 0:x.lists)==null?void 0:W.length)-1];return m?[{time:X(m.timestamp).mul(1e3).toNumber(),high:Number(m.high),low:Number(m.low),open:Number(m.open),close:Number(m.settle)}]:[]}catch(C){return console.log("🚀 ~ getLatestKlineData ~ error:",C),[]}},disconnectDeepbookWs:r}}class ln{constructor(e,t,s,o,a){st(this,"poolId");st(this,"resolution");st(this,"onChangePrice");st(this,"getHistoricalData");st(this,"subscribeKlineData");var r;this.poolId=((r=e==null?void 0:e.split("::"))==null?void 0:r[1])||"",this.resolution=t,this.onChangePrice=a,this.getHistoricalData=s,this.subscribeKlineData=o}onReady(e){setTimeout(()=>{e({supported_resolutions:["1","10","15","30","60","240","D","W"],supports_time:!0})},0)}resolveSymbol(e,t,s){console.log("🚀 ~ DataFeed ~ resolveSymbol ~ symbolName:",e),console.log("🚀 ~ DataFeed ~ resolveSymbol ~ symbolInfo:");const o=e.split("::"),a=o[0],r=Number(o[2])||2;console.log("🚀 ~ DataFeed ~ resolveSymbol ~ unit:",r),setTimeout(()=>{t({name:a,ticker:a,type:"crypto",session:"24x7",timezone:"Etc/UTC",minmov:1,format:"price",pricescale:Math.pow(10,r),has_intraday:!0,has_empty_bars:!0,has_daily:!0,has_weekly_and_monthly:!0,supported_resolutions:["1","10","15","30","60","240","D","W"],volume_precision:2})},0)}getBars(e,t,s,o,a){const{from:r,to:l,firstDataRequest:d}=s;console.log("🚀 ~ DataFeed getBars ~ resolution111:",t,e),console.log("🚀 ~ DataFeed getBars ~ periodParams:",s);const c=this.poolId;this.getHistoricalData({poolId:c,resolution:t,from:r,to:l,callback:o,onErrorCallback:a,firstDataRequest:d})}subscribeBars(e,t,s,o,a){console.log("subscribeBar 🚀 ~ DataFeed ~ symbolInfo:",e),console.log("subscribeBar 🚀 ~ DataFeed ~ this poolId:",this.poolId);const r=this.poolId;this.subscribeKlineData({poolId:r,resolution:t,callback:s})}unsubscribeBars(e){clearInterval(this[e])}}const dn=({poolId:i,onChartReady:e,poolPriceUnit:t,onChangePrice:s})=>{const o=p.useRef(null),a=p.useRef(null),r=p.useRef(!1),[l,d]=p.useState([]),[,c]=p.useState(!1),[h,u]=p.useState(""),{getDeepbookHistoricalData:f,subscribeKlineData:b,disconnectDeepbookWs:g}=rn();return p.useEffect(()=>(console.log("tv chart component Mounted"),r.current=!0,()=>{g()}),[]),p.useEffect(()=>{if(!o.current||!i||!t||!Pt)return;console.log("chart poolPriceUnit: ",t),console.log("tv chart init useEffect isMounted.current: ",r.current),u(i);const y={symbol:`${i}::${t}`,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,interval:"15",container:"tv_chart_container",datafeed:new ln(i,"1",f,b,s),library_path:"/charting_library_new/",locale:"en",autosize:!0,theme:"dark",settings_overrides:{},overrides:{"paneProperties.backgroundGradientStartColor":"#0F0F0F","paneProperties.backgroundGradientEndColor":"#0F0F0F","paneProperties.background":"#0F0F0F","paneProperties.backgroundType":"solid","Overlay.barStyle.upColor":"#68FFD8","Overlay.barStyle.downColor":"#FF5073","mainSeriesProperties.priceLineWidth":1,"priceScale.precision":2,"priceScale.minMove":.01,"mainSeriesProperties.style":1},custom_css_url:"/css/tv-chart-dart.css",disabled_features:["header_symbol_search","header_compare","timeframes_toolbar","volume_force_overlay","create_volume_indicator_by_default"],enabled_features:["header_widget","chart_style_hilo_last_price","hide_left_toolbar_by_default","hide_resolution_in_legend","two_character_bar_marks_labels"],custom_formatters:{priceFormatterFactory:(O,N)=>(console.log("🚀 ~ priceFormatterFactory ~ symbolInfo:",O),O?{format:(R,w)=>Si(R)}:null)},favorites:{intervals:["60"],indicators:["Awesome Oscillator","Bollinger Bands"],chartTypes:["Candles","Line"]}};console.log("🚀 ~ useEffect ~ document.getElementById(tv_chart_container):",document.getElementById("tv_chart_container"));const T=new Pt(y);return a.current=T,console.log("🚀 ~ useEffect ~ tvWidgetRef.current:",a.current),T.onChartReady(()=>{console.log("🚀 ~ useEffect ~ tvWidget.onChartReady:"),c(!0),e==null||e()}),()=>{if(a.current){try{a.current.remove()}catch(O){console.error("Error removing TradingView widget:",O)}a.current=null,c(!1)}}},[i,r.current,t,Pt]),p.useCallback(()=>{if(a.current)try{a.current.startFullscreen()}catch(y){console.error("Error toggling fullscreen:",y)}},[]),n.jsx(K,{w:"100%",h:"100%",children:n.jsx("div",{id:"tv_chart_container",ref:o,style:{width:"100%",height:"100%"}})})};function $s({currentDeepBookPool:i}){const{setDeepbookPrice:e}=Q(),t=a=>{a!=null&&a.poolId&&(a!=null&&a.price)&&e({...a})},s=p.useMemo(()=>{var a,r;return`${(a=i==null?void 0:i.baseAssets)==null?void 0:a.symbol}-${(r=i==null?void 0:i.quoteAssets)==null?void 0:r.symbol}::${i==null?void 0:i.address}`||""},[i==null?void 0:i.address]),o=p.useMemo(()=>i!=null&&i.price?String(Ci(i==null?void 0:i.price)):"4",[i==null?void 0:i.address]);return n.jsx(K,{w:"100%",h:"100%",children:n.jsxs(pe,{p:"0",overflow:"hidden",position:"relative",borderRadius:"12px",w:"100%",h:"100%",children:[!s||o===void 0&&n.jsx(qi,{}),s&&o!==void 0&&n.jsx(dn,{poolId:s,poolPriceUnit:o,onChangePrice:t})]})})}function Qt(){return n.jsx(ns,{minWidth:{base:"100%",lg:"1160px"},borderRadius:"8px",border:"none",minH:{base:"68px",lg:"40px"},p:"0",gap:"0",children:n.jsxs(H,{h:"100%",w:"100%",justify:"center",gap:{base:"12px",lg:"40px"},flexDirection:{base:"row",lg:"row"},p:{base:"12px",lg:"0"},justifyContent:{base:"center",lg:"center"},children:[n.jsxs(H,{gap:"4px",children:[n.jsx(U,{fontSize:"12px",children:"Settlement Venue:"}),n.jsx(ss,{w:"75px",h:"12px",src:"/images/deepbook/logo_deepbook@2x.png"})]}),n.jsx(H,{gap:"4px",children:n.jsxs(H,{_hover:{textDecoration:"underline",color:"text_caption"},sx:{_hover:{"&>p":{textDecoration:"underline",color:"text_caption"},"&>div>svg":{fill:"text_caption"}}},children:[n.jsx(U,{cursor:"pointer",onClick:()=>{window.open("https://deepbook.cetus.zone/v2","_blank")},fontSize:"12px",children:"DeepBook V2"}),n.jsx(Ne,{xlinkHref:"#icon-icon_link2",fontSize:"14px"})]})})]})})}const xs={background:"rgba(118,200,255,0.1)",border:"1px solid rgba(118,200,255,0.2)"},cn=({orderBookTab:i,setOrderBookTab:e})=>{const t=[{key:"all",image:"/images/deepbook/icon_greenredprice@2x.png"},{key:"bid",image:"/images/deepbook/icon_greenprice@2x.png"},{key:"ask",image:"/images/deepbook/icon_redprice@2x.png"}];return n.jsx(n.Fragment,{children:t.map(s=>n.jsx(H,{cursor:"pointer",borderRadius:"4px",p:"2px",border:"1px solid transparent",...i===s.key&&xs,_hover:i!==s.key?{...xs,border:"1px solid transparent"}:{},children:n.jsx(ss,{w:"16px",h:"16px",src:s.image,fallbackSrc:Di,onClick:()=>e(s.key)})},s.key))})},hn=({orderBookTab:i,tickSize:e,visibleRows:t})=>{var S,C,A,M,v;const{deepBookAskList:s,deepBookBidList:o,deepBookOrderBookLoading:a,currentDeepBookPool:r,setPlaceOrderPrice:l,orderType:d,deepbookPrice:c}=Q(),[h,u]=p.useState(new Set),{isApp:f}=ze(),b=p.useRef({asks:[],bids:[]}),g=p.useRef(!0),y=p.useMemo(()=>({asks:s.sort((m,E)=>parseFloat(E.price)-parseFloat(m.price)).reverse()||[],bids:o.sort((m,E)=>parseFloat(E.price)-parseFloat(m.price))||[]}),[s,o]);p.useEffect(()=>{if(y.asks.length===0&&y.bids.length===0)return;if(g.current){b.current=y,g.current=!1;return}const m=new Set,E=ee=>`${ee.price}-${ee.total}-${ee.quantity}`,F=ee=>{const D=new Map;return ee.forEach(P=>{const z=E(P);D.set(z,P)}),D},B=F(y.asks),V=F(y.bids),$=F(b.current.asks),ne=F(b.current.bids);if(B.forEach((ee,D)=>{$.get(D)||m.add(`ask-${D}`)}),V.forEach((ee,D)=>{ne.get(D)||m.add(`bid-${D}`)}),m.size>0){u(m);const ee=setTimeout(()=>{u(new Set)},1e3);return b.current=y,()=>clearTimeout(ee)}},[y]),p.useEffect(()=>{r!=null&&r.address&&(b.current={asks:[],bids:[]},g.current=!0)},[r==null?void 0:r.address]);const T=p.useMemo(()=>y.asks.slice(0,t).reverse(),[y.asks,t]),O=p.useMemo(()=>y.bids.slice(0,t),[y.bids,t]),N=p.useMemo(()=>{const m=T.length>0?Math.max(...T.map(F=>F.total||0)):0,E=O.length>0?Math.max(...O.map(F=>F.total||0)):0;return Math.max(m,E)},[T,O]),R=p.useCallback((m,E)=>E===0?0:m/E*100,[]),w=p.useMemo(()=>c&&(c!=null&&c.price)&&(c==null?void 0:c.poolId)==(r==null?void 0:r.address)?c==null?void 0:c.price:"",[r==null?void 0:r.address,c]),I=p.useCallback((m,E,F,B)=>{const V=R(m.total||0,N),$=E?"rgba(255, 80, 116, 0.1)":"rgba(103, 255, 216, 0.1)",ne=E?"#FF5074":"#67FFD8",D=(te=>`${te.price}-${te.total}-${te.quantity}`)(m),P=`${E?"ask":"bid"}-${D}`,z=h.has(P),G=(te,oe)=>{const fe=X(te),ce=X(oe),xe=fe.mod(ce);return fe.sub(xe).toString()};return n.jsxs(H,{as:"div",role:"group",w:"100%",h:"20px",cursor:"pointer",position:"relative",spacing:0,justify:"space-between",p:"0 1px",transition:"all 0.3s ease-in-out",_hover:{bg:"rgba(118,200,255,0.05)"},onClick:()=>d=="Limit"?l(m.price):null,children:[n.jsx(pe,{position:"absolute",top:"0",bottom:"0",h:"20px",bg:$,width:`calc(${V}% - 2px)`,zIndex:"0",transition:"all 0.3s ease-in-out",_groupHover:{bg:E?"rgba(255, 80, 116, 0.2)":"rgba(103, 255, 216, 0.2)"},left:B&&!E?"auto":"1px",right:B&&!E?"1px":"auto"}),z&&n.jsx(pe,{position:"absolute",top:"0",bottom:"0",h:"20px",bg:E?"rgba(255, 80, 116, 0.2)":"rgba(103, 255, 216, 0.2)",zIndex:"0",animation:"slideIn 0.5s ease-out",left:B&&!E?"auto":"1px",right:B&&!E?"1px":"auto"}),B&&!E?n.jsxs(n.Fragment,{children:[n.jsx(U,{position:"relative",zIndex:"1",fontSize:"12px",color:"text_caption",textAlign:"left",flex:"1",pl:E?"0px":"16px",transition:"all 0.3s ease-in-out",children:de(m.quantity||0,2)}),n.jsx(U,{position:"relative",zIndex:"1",fontSize:"12px",fontWeight:"500",color:ne,textAlign:"right",flex:"1",pr:E?"16px":"0px",transition:"all 0.3s ease-in-out",_groupHover:{textDecoration:"underline"},children:de(G(m.price,e)||0,6)})]}):n.jsxs(n.Fragment,{children:[n.jsx(U,{position:"relative",zIndex:"1",pl:{base:"0px",lg:"16px"},fontSize:"12px",fontWeight:"500",color:ne,textAlign:"left",flex:"1",transition:"all 0.3s ease-in-out",_groupHover:{textDecoration:"underline"},children:de(G(m.price,e)||0,6)}),n.jsx(U,{position:"relative",pr:{base:"16px",lg:"0px"},zIndex:"1",fontSize:"12px",color:"text_caption",textAlign:"right",flex:"1",transition:"all 0.3s ease-in-out",children:de(m.quantity||0,2)})]}),!B&&n.jsx(U,{position:"relative",zIndex:"1",pr:"16px",fontSize:"12px",color:"text_caption",textAlign:"right",flex:"1",transition:"all 0.3s ease-in-out",children:Us(m.total||0,4)})]},`${P}-${m.size}-${m.total}`)},[R,N,h,d,l,e]),x=p.useCallback(()=>{var m,E,F;return n.jsx(H,{w:"100%",h:"36px",justify:"flex-start",p:"0px 16px",bg:"card_bg",m:i=="all"?"4px 0":i=="bid"?"4px 0 0 0":"0",gap:"4px",children:r!=null&&r.price?n.jsxs(n.Fragment,{children:[n.jsx(Ne,{xlinkHref:"#icon-icon_arrow",boxW:"12px",boxH:"12px",svgFill:(m=r==null?void 0:r.priceChange)!=null&&m.includes("-")?"primary_red":"primary_green",transform:(E=r==null?void 0:r.priceChange)!=null&&E.includes("-")?"rotate(0deg)":"rotate(180deg)"}),n.jsx(U,{fontSize:"16px",color:(F=r==null?void 0:r.priceChange)!=null&&F.includes("-")?"primary_red":"primary_green",children:de(w,6)})]}):n.jsx(se,{isLoaded:!r,w:"100%",h:"33px"})})},[w,r]),W=p.useMemo(()=>{if(i==="all")return f?n.jsxs(H,{w:"100%",spacing:"0",h:"calc(100% - 34px)",justify:"space-between",gap:"8px",children:[n.jsx(K,{w:"50%",spacing:"4px",h:"100%",justify:(T==null?void 0:T.length)==t?"flex-end":"flex-start",children:a?Array.from({length:t},(m,E)=>n.jsx(se,{w:"calc(100% - 16px)",h:"20px"},`empty-bid-${E}`)):O.map((m,E)=>I(m,!1,E,f))}),n.jsx(K,{w:"50%",spacing:"4px",h:"100%",justify:(T==null?void 0:T.length)==t?"flex-end":"flex-start",children:a?Array.from({length:t},(m,E)=>n.jsx(se,{w:"calc(100% - 16px)",h:"20px"},`empty-ask-${E}`)):T.reverse().map((m,E)=>I(m,!0,E,f))})]}):n.jsxs(K,{w:"100%",spacing:"4px",h:"calc(100% - 22px)",justify:"center",children:[a?Array.from({length:t},(m,E)=>n.jsx(se,{w:{base:"100%",lg:"calc(100% - 32px)"},h:"20px"},`empty-ask-${E}`)):T.map((m,E)=>I(m,!0,E)),x(),a?Array.from({length:t},(m,E)=>n.jsx(se,{w:"calc(100% - 32px)",h:"20px"},`empty-bid-${E}`)):O.map((m,E)=>I(m,!1,E))]});if(i==="bid")return n.jsxs(K,{w:"100%",spacing:"4px",h:"calc(100% - 22px)",justify:"flex-start",children:[x(),a?Array.from({length:t},(m,E)=>n.jsx(se,{w:"calc(100% - 32px)",h:"20px"},`empty-bid-${E}`)):O.map((m,E)=>I(m,!1,E))]});if(i==="ask")return n.jsxs(K,{w:"100%",spacing:"4px",h:"calc(100% - 22px)",justify:"flex-end",children:[a?Array.from({length:t},(m,E)=>n.jsx(se,{w:"calc(100% - 32px)",h:"20px"},`empty-ask-${E}`)):T.map((m,E)=>I(m,!0,E)),x()]})},[i,T,O,t,I,x,a,f]);return n.jsxs(pe,{w:"100%",h:"100%",overflow:"hidden",children:[n.jsx("style",{children:`
          @keyframes slideIn {
            from {
              transform: translateX(-10px);
              opacity: 0;
            }
            to {
              transform: translateX(0);
              opacity: 1;
            }
          }
        `}),!f&&n.jsxs(H,{w:"100%",spacing:0,justify:"space-between",p:"10px 16px 0px",bg:"bg_secondary",position:"relative",zIndex:"99",children:[n.jsxs(U,{fontSize:"12px",w:"100%",color:"primary_gray",fontWeight:"500",children:["Price (",((S=r==null?void 0:r.quoteAssets)==null?void 0:S.symbol)||"--",")"]}),n.jsxs(U,{fontSize:"12px",w:"100%",color:"primary_gray",fontWeight:"500",textAlign:"right",children:["Amt. (",((C=r==null?void 0:r.baseAssets)==null?void 0:C.symbol)||"--",")"]}),n.jsxs(U,{fontSize:"12px",textAlign:"right",w:"100%",color:"primary_gray",fontWeight:"500",children:["Total (",((A=r==null?void 0:r.quoteAssets)==null?void 0:A.symbol)||"--",")"]})]}),f&&n.jsxs(H,{w:"100%",spacing:0,gap:"8px",justify:"space-between",p:"10px 16px",bg:"bg_secondary",position:"relative",zIndex:"99",children:[n.jsxs(H,{w:"50%",justifyContent:"space-between",children:[n.jsxs(U,{fontSize:"12px",w:"100%",color:"primary_gray",fontWeight:"500",children:["Total (",((M=r==null?void 0:r.quoteAssets)==null?void 0:M.symbol)||"--",")"]}),n.jsx(U,{fontSize:"12px",w:"100%",color:"primary_gray",fontWeight:"500",textAlign:"right",children:"Price"})]}),n.jsxs(H,{w:"50%",justifyContent:"space-between",children:[n.jsx(U,{fontSize:"12px",w:"100%",color:"primary_gray",fontWeight:"500",children:"Price"}),n.jsxs(U,{fontSize:"12px",textAlign:"right",w:"100%",color:"primary_gray",fontWeight:"500",children:["Total (",((v=r==null?void 0:r.quoteAssets)==null?void 0:v.symbol)||"--",")"]})]})]}),W]})},un=({orderBookTab:i,tickSizeList:e,defaultTickSize:t,setDefaultTickSize:s})=>{const{getOrderBook:o}=Ce(),[a,r]=p.useState(!1),[l,d]=p.useState(0),c=p.useRef(null),h=u=>{s(u),o(i,u,!1,9)};return p.useEffect(()=>{c.current&&d(c.current.offsetWidth)},[t]),n.jsxs(Ns,{onOpen:()=>r(!0),onClose:()=>r(!1),children:[n.jsx(Ss,{children:n.jsxs(H,{ref:c,border:"1px solid",borderRadius:"8px",p:"6px 8px",cursor:"pointer",minW:"40px",w:"auto",h:"24px",justifyContent:"space-between",borderColor:"border",children:[n.jsx(U,{color:a?"text_caption":"text_paragraph",children:t}),n.jsx(Ne,{xlinkHref:"#icon-icon_arrow",boxW:"12px",boxH:"12px",transform:a?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s ease-in-out",svgFill:a?"text_caption":"text_paragraph"})]})}),n.jsx(Cs,{p:"0",minW:"unset",zIndex:99999,borderRadius:"8px",border:"1px solid",borderColor:"border",w:`${l}px`,children:e.map(u=>n.jsx(Ds,{onClick:()=>h(u),p:"8px",bg:"none",justifyContent:"flex-start",cursor:"pointer",_hover:{color:"text_caption"},children:u},u))})]})};function Js({isOpenCard:i}){const{currentDeepBookPool:e}=Q(),[t,s]=p.useState("all"),o=p.useMemo(()=>{if(e!=null&&e.address){const N=e.tickSize;return[X(N).toString(),X(N).mul(10).toString(),X(N).mul(100).toString()]}else return[X(1e-4).toString(),X(.001).toString(),X(.01).toString()]},[e==null?void 0:e.address]),[a,r]=p.useState("0.0001");p.useEffect(()=>{e!=null&&e.address&&r(e.tickSize)},[e==null?void 0:e.address]);const l=p.useRef(null),[d,c]=p.useState(0),h=p.useRef(0);function u(N){const R=Math.floor(N),w=(N-R)*10;return w>=7?R+1:w>=6?R:Math.round(N)}const{isApp:f}=ze(),b=p.useMemo(()=>{if(!d)return 6;const N=f?22:44,R=f?0:48,w=d-N-R,x=Math.max(5,u(w/(2*24)));return t!=="all"||f?x*2:x},[d,t,f]),g=p.useCallback(Fs(N=>{console.log("🚀🚀🚀 ~ index.tsx:76 ~ OrderBookBlock ~ height:",N),Math.abs(N-h.current)>2&&(c(N),h.current=N)},300),[]);p.useEffect(()=>{const N=new ResizeObserver(R=>{for(const w of R){const I=Math.round(w.contentRect.height);g(I)}});if(l.current){N.observe(l.current);const R=Math.round(l.current.clientHeight);console.log("🚀🚀🚀 ~ index.tsx:100 ~ OrderBookBlock ~ initialHeight:",R),c(R),h.current=R}return()=>{N.disconnect()}},[g,i]);const{getOrderBook:y}=Ce(),[T,O]=p.useState(0);return qs({interval:1e3,callback:()=>{O(T+1),T>=10&&(O(0),e!=null&&e.address&&y(t,a,!1))}}),n.jsxs(K,{bg:"bg_secondary",w:"100%",h:"100%",borderRadius:"8px",gap:"0px",children:[n.jsxs(K,{w:"100%",justifyContent:"space-between",p:{base:"0px 16px 0px",lg:"12px 16px 0px"},children:[n.jsxs(H,{w:"100%",justifyContent:"space-between",justify:"center",children:[n.jsx(U,{color:"text_caption",fontSize:"14px",fontWeight:"500",children:"Orderbook"}),n.jsxs(H,{children:[!f&&n.jsx(cn,{orderBookTab:t,setOrderBookTab:s}),n.jsx(un,{orderBookTab:t,tickSizeList:o,defaultTickSize:a,setDefaultTickSize:r})]})]}),n.jsx(pe,{w:"100%",height:"1px",bg:"border"})]}),n.jsx(pe,{w:"100%",flex:"1",h:"100%",ref:l,children:n.jsx(hn,{orderBookTab:t,tickSize:a,visibleRows:b})})]})}const ms=["0xde096bb2c59538a25c89229127fe0bc8b63ecdbe52a3693099cc40a1d8a2cfd4","0xe9aecf5859310f8b596fbe8488222a7fb15a55003455c9f42d1b60fab9cca9ba","0xc69f7755fec146583e276a104bcf91e0c9f0cab91dcdb1c202e8d76a5a5a1101","0x52f9bf16d9e7eff79da73d5e3dea39fe1ef8c77684bf4ec2c6566b41396404d0"];function ds(){const{fetchByApi:i}=Hs(),{setDeepBookPools:e,setDeepBookPoolLoading:t,setCurrentDeepBookPool:s,setQueryDeepBookPoolLoading:o,setQueryDeepBookPools:a,setDeepBookPoolsObj:r,deepBookPools:l,localDeepBookPools:d,setLocalDeepBookPools:c,setDeepbookPrice:h}=Q(),u=is(),f=async T=>{try{const O=d.map(w=>w.address);console.log("🚀🚀🚀 ~ useGetDeepBookPools.ts:33 ~ getDeepBookPools ~ poolIds:",O),T&&!O.includes(T)&&O.push(T);const N=[...new Set(O)],{data:R}=await i(Ii,"POST",{pool_ids:N});if(R&&(R==null?void 0:R.list.length)>0){const w=R.list.map(W=>g(W,O));console.log("🚀🚀🚀 ~ useGetDeepBookPools.ts:43 ~ getDeepBookPools ~ result:",w);const I=T?w.find(W=>W.address===T):w[0];if(!d.map(W=>W.address).includes(T)&&!(I!=null&&I.inWhiteList)){const S=[{...I,isLocal:!0},...d];c(S)}return e(w),r(w.reduce((W,S)=>(W[S.address]=S,W),{})),t(!1),s(I),h({poolId:I.address,price:I.price}),u(`/deepbook/${I.address}`),w}}catch(O){return e([]),t(!1),console.error("🚀🚀🚀 ~ useGetDeepBookPools.ts:14 ~ getDeepBookPools ~ error:",O),[]}},b=async T=>{const{data:O}=await i(ji,"POST",{pool_id:T});if(O){const N=g(O);return console.log("🚀🚀🚀 ~ useGetDeepBookPools.ts:62 ~ getCurrentDeepBookPool ~ result:",N),N}},g=(T,O=[])=>{const{base_asset:N,quote_asset:R,address:w,high:I,low:x,vol_usd_day:W,price:S,in_white_list:C,price_change:A,lot_size:M,tick_size:v,min_size:m,vol_24h:E,vol_24h_usd:F,taker_fee_rate:B}=T,V=N.decimals,$=R.decimals,ne=X(M).div(Math.pow(10,N.decimals)).toString(),ee=X(v).div(X(Math.pow(10,$-V+9))).toString(),D=X(m).div(Math.pow(10,N.decimals)).toString();return{address:w,baseAssets:{...N,is_verified:!0,logo_url:N.icon_url},quoteAssets:{...R,is_verified:!0,logo_url:R.icon_url},high:I,low:x,volUsdDay:W,price:S,priceDisplay:de(S),inWhiteList:C,priceChange:Bi(A),lotSize:ne,tickSize:ee,minSize:D,vol24h:E,vol24hDisplay:de(E),vol24hUsdDisplay:de(F),isAbandoned:ms.includes(w),takerFeeRate:B,sort:ms.includes(w)?0:1,isLocal:!C&&(d.some(P=>P.address===w)||O.includes(w))}};return{getDeepBookPools:f,queryDeepBookPoolByValue:async T=>{try{o(!0);const{data:O}=await i(Wi,"POST",{text:T});if(O&&(O==null?void 0:O.list.length)>0){const N=O.list.map(R=>({...g(R),isLocal:d.some(w=>w.address===R.address)})).sort((R,w)=>w.sort-R.sort);return console.log(N,"result##"),a(N),setTimeout(()=>{o(!1)},500),N}}catch(O){return console.error("🚀🚀🚀 ~ useGetDeepBookPools.ts:96 ~ queryDeepBookPoolByValue ~ error:",O),o(!1),null}},getCurrentDeepBookPool:b}}const Vt=[];function pn({isOpen:i,onClose:e}){var I;const[t,s]=p.useState(""),{queryDeepBookPoolByValue:o}=ds(),{queryDeepBookPoolLoading:a,currentDeepBookPool:r,setDeepbookPrice:l}=Q(),d=Fs(x=>{o(x)},300),c=x=>{const W=x.replace(/[^[a-zA-Z0-9\s]+$/g,"");s(W),W&&d(W)},h=is(),{deepBookPools:u,queryDeepBookPools:f,setDeepBookPools:b,localDeepBookPools:g,setLocalDeepBookPools:y,setCurrentDeepBookPool:T,setQueryDeepBookPools:O}=Q(),{showCommonToast:N}=Ui(),R=x=>{const W=[{...x,isLocal:!0},...u];console.log("🚀🚀🚀 ~ ManageModal.tsx:43 ~ importDeepBookPool ~ newPools:",W),b(W);const S=[{...x,isLocal:!0},...g];if(console.log("🚀🚀🚀 ~ ManageModal.tsx:45 ~ importDeepBookPool ~ newLocalPools:",S),y(S),T({...x,isLocal:!0}),l({poolId:x.address,price:x.price}),h(`/deepbook/${x.address}`),N("Added","success"),t){const C=f.map(A=>A.address==x.address?{...A,isLocal:!0}:A);O(C)}},w=x=>{var C,A,M;const W=u.filter(v=>v.address!==x.address);console.log("🚀🚀🚀 ~ ManageModal.tsx:54 ~ removeDeepBookPool ~ newPools:",W),b(W),console.log("🚀🚀🚀 ~ ManageModal.tsx:57 ~ removeDeepBookPool ~ localDeepBookPools:",g);const S=g.filter(v=>v.address!==x.address);if(y(S),console.log("🚀🚀🚀 ~ ManageModal.tsx:58 ~ removeDeepBookPool ~ currentDeepBookPool?.address:",r==null?void 0:r.address),console.log("🚀🚀🚀 ~ ManageModal.tsx:59 ~ removeDeepBookPool ~ pool.address:",x.address),(r==null?void 0:r.address)===x.address&&(console.log("🚀🚀🚀 ~ ManageModal.tsx:62 ~ removeDeepBookPool ~ newPools[0]:",W[0]),T(W[0]),l({poolId:(C=W[0])==null?void 0:C.address,price:(A=W[0])==null?void 0:A.price}),h(`/deepbook/${(M=W[0])==null?void 0:M.address}`)),console.log("🚀🚀🚀 ~ ManageModal.tsx:86 ~ removeDeepBookPool ~ inputValue:",t),t){const v=f.filter(m=>m.address!==t).map(m=>m.address==x.address?{...m,isLocal:!1}:m);console.log("🚀🚀🚀 ~ ManageModal.tsx:88 ~ removeDeepBookPool ~ newQueryDeepBookPools:",v),v.length==0&&(e(!1),s("")),O(v)}N("Removed","success")};return n.jsxs(Dt,{autoFocus:!1,returnFocusOnClose:!1,trapFocus:!1,isOpen:i,onClose:()=>e(!1),isCentered:!0,children:[n.jsx(It,{}),n.jsxs(jt,{w:{base:"100%",lg:"356px"},overflow:"hidden",children:[n.jsx(Bt,{children:"Manage"}),n.jsx(Wt,{}),n.jsxs(Ut,{textAlign:"center",p:"0",children:[n.jsx(pe,{w:"100%",p:"0 16px 12px",children:n.jsx(Vi,{borderRadius:"8px",placeholder:"Search by token or pool address",searchText:t,onChange:x=>c(x)})}),n.jsx(K,{w:"100%",gap:"0px",h:(Vt==null?void 0:Vt.length)>4?"235px":a?"337px":"auto",overflowY:"auto",maxH:"337px",position:"relative",children:a?n.jsx($i,{positionStyle:"absolute"}):(I=t?f:u)==null?void 0:I.map(x=>{var W,S;return n.jsxs(H,{w:"100%",borderRadius:"12px",p:"0px 16px",justify:"space-between",_hover:{bg:"primary_opacity.10"},onClick:()=>{!x.isAbandoned&&!x.isLocal&&!x.inWhiteList?(R(x),e(!1)):(T(x),l({poolId:x.address,price:x.price}),h(`/deepbook/${x.address}`),e(!1))},children:[n.jsx(zt,{showFee:!1,poolInfo:{...x,poolAddress:x==null?void 0:x.address,displayTokenA:{...x==null?void 0:x.baseAssets,is_verified:!0,logo_url:(W=x==null?void 0:x.baseAssets)==null?void 0:W.icon_url},displayTokenB:{...x==null?void 0:x.quoteAssets,is_verified:!0,logo_url:(S=x==null?void 0:x.quoteAssets)==null?void 0:S.icon_url}},imgStyle:{w:"28px",h:"28px",filter:x.isAbandoned?"grayscale(100%)":"none"}}),(x==null?void 0:x.isAbandoned)&&n.jsx(U,{fontSize:"12px",bg:"primary_opacity.10",color:"primary",p:"4px",borderRadius:"4px",children:"Sunset"}),!(x!=null&&x.inWhiteList)&&!(x!=null&&x.isLocal)&&n.jsx(Fe,{variant:"ghost",w:"60px",h:"24px",fontSize:"12px",onClick:C=>{C.stopPropagation(),R(x)},cursor:"pointer",children:"+Add"}),(x==null?void 0:x.isLocal)&&n.jsx(Ws,{tooltip:n.jsx(U,{fontSize:"12px",children:"Remove"}),placement:"top",children:n.jsx(Ne,{xlinkHref:"#icon-icon_del",w:"20px",h:"20px",onClick:C=>{C.stopPropagation(),w(x)}})})]},x==null?void 0:x.poolAddress)})})]})]})]})}function Ts({currentDeepBookPool:i}){var u,f,b,g,y,T;const e=_i(),[t,s]=p.useState(!1),[o,a]=p.useState(!1),r=is(),{deepBookPools:l,setCurrentDeepBookPool:d,setDeepbookPrice:c}=Q(),{isApp:h}=ze();return n.jsxs(H,{w:{base:"auto",lg:"auto"},position:"relative",zIndex:"100",cursor:"pointer",onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),children:[n.jsxs(Ns,{isOpen:e.isOpen,onClose:e.onClose,placement:"bottom-start",gutter:8,strategy:"fixed",children:[n.jsx(Ss,{as:Fe,bg:"none",_hover:{bg:"none"},_active:{bg:"none"},p:"0",onClick:e.onOpen,w:{base:"auto",lg:"auto"},h:"40px",children:n.jsx(se,{isLoaded:i==null?void 0:i.price,children:n.jsxs(H,{children:[n.jsx(zs,{coinACoinType:(u=i==null?void 0:i.baseAssets)==null?void 0:u.coin_type,coinBCoinType:(f=i==null?void 0:i.quoteAssets)==null?void 0:f.coin_type,coinAIconUrl:(b=i==null?void 0:i.baseAssets)==null?void 0:b.icon_url,coinBIconUrl:(g=i==null?void 0:i.quoteAssets)==null?void 0:g.icon_url}),n.jsx(U,{fontSize:"16px",color:"text_caption",fontWeight:"500",children:`${((y=i==null?void 0:i.baseAssets)==null?void 0:y.symbol)||""} - ${((T=i==null?void 0:i.quoteAssets)==null?void 0:T.symbol)||""}`}),n.jsx(Ne,{fontSize:"12px",xlinkHref:"#icon-icon_arrow",transition:"transform 0.5s",transform:e.isOpen?"rotate(180deg)":"rotate(0deg)",svgFill:o?"text_caption":"text_paragraph"})]})})}),n.jsxs(Cs,{w:{base:"370px",lg:"466px"},borderRadius:"12px",p:"0px",mt:"0",zIndex:"9999",maxH:"400px",overflow:"hidden",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.15)",children:[n.jsx(Ds,{closeOnSelect:!1,p:"0",w:"100%",children:n.jsx(pe,{w:"100%",maxH:"240px",overflowY:"auto",p:"4px 0px",sx:{scrollbarGutter:"stable both-edges"},children:n.jsx(Ht,{rowKey:"address",columns:gn(h),dataSource:l,skeletonLength:3,loading:!1,trPadding:"12px",tableContainerWrapStyle:{minH:"200px"},onRowClick:O=>{d(O),c({poolId:O.address,price:O.price}),r(`/deepbook/${O.address}`),e.onClose()},rowStyle:{h:"52px",cursor:"pointer",_hover:{bg:"primary_opacity.10)"}}})})}),n.jsx(H,{justify:"center",w:"100%",borderTop:"1px solid",borderColor:"border",children:n.jsx(Fe,{w:"166px",m:"16px",h:"28px",borderRadius:"8px",fontSize:"14px",variant:"outline",onClick:()=>{s(!0),e.onClose()},children:"Manage Pool"})})]})]}),t&&n.jsx(pn,{isOpen:t,onClose:()=>s(!1)})]})}const gn=i=>[{title:n.jsx(U,{fontSize:"12px",fontWeight:"500",children:"Pool"}),thConfig:{w:"50%"},key:"token",render:e=>{var t,s,o,a,r,l;return n.jsx(H,{justify:"flex-start",sx:{minW:"unset",p:{margin:"0"}},m:"-12px 0",children:n.jsx(se,{isLoaded:!0,children:n.jsxs(H,{children:[n.jsxs(H,{filter:e!=null&&e.isAbandoned?"grayscale(100%)":"none",children:[n.jsx(zs,{coinACoinType:(t=e==null?void 0:e.baseAssets)==null?void 0:t.coin_type,coinBCoinType:(s=e==null?void 0:e.quoteAssets)==null?void 0:s.coin_type,coinAIconUrl:(o=e==null?void 0:e.baseAssets)==null?void 0:o.icon_url,coinBIconUrl:(a=e==null?void 0:e.quoteAssets)==null?void 0:a.icon_url,w:"28px",h:"28px"}),n.jsx(U,{fontSize:"14px",color:"text_caption",children:`${((r=e==null?void 0:e.baseAssets)==null?void 0:r.symbol)||""} - ${((l=e==null?void 0:e.quoteAssets)==null?void 0:l.symbol)||""}`})]}),(e==null?void 0:e.isAbandoned)&&n.jsx(U,{fontSize:"12px",bg:"primary_opacity.10",color:"primary",p:"2px 4px",borderRadius:"4px",children:"Sunset"})]})})})}},{title:n.jsx(U,{fontSize:"12px",fontWeight:"500",textAlign:"right",children:"Price"}),thConfig:{w:"25%"},key:"price24h",render:({priceDisplay:e})=>n.jsx(H,{gap:"0",justify:"flex-end",children:n.jsx(U,{color:"text_caption",children:e})})},!i&&{title:n.jsx(U,{fontSize:"12px",fontWeight:"500",children:"24H Change"}),thConfig:{w:"25%"},key:"vol24h",render:({priceChange:e})=>n.jsxs(H,{gap:"2px",justify:"flex-end",children:[e!=="0%"&&n.jsx(Ne,{fontSize:"12px",xlinkHref:"#icon-icon_arrow",transition:"transform 0.5s",transform:e!=null&&e.includes("-")?"rotate(0deg)":"rotate(180deg)",svgFill:e!=null&&e.includes("-")?"primary_red":"primary_green"}),n.jsx(U,{color:e!=null&&e.includes("-")?"primary_red":e==="0%"?"text_caption":"primary_green",children:e!=null&&e.includes("-")?e==null?void 0:e.split("-")[1]:e})]})}],fn=p.lazy(()=>Xi(()=>import("./PriceReference-ChO8PXix.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12])));function bn({currentDeepBookPool:i,isOpen:e,onClose:t,onCloseDetails:s}){var a,r,l;const{isApp:o}=ze();return n.jsxs(Dt,{autoFocus:!1,returnFocusOnClose:!1,trapFocus:!1,isOpen:e,onClose:()=>t(!1),isCentered:!0,children:[n.jsx(It,{}),n.jsxs(jt,{w:{base:"100%",lg:"416px"},children:[n.jsxs(Bt,{children:[(a=i==null?void 0:i.baseAssets)==null?void 0:a.symbol,"-",(r=i==null?void 0:i.quoteAssets)==null?void 0:r.symbol," Market Details"]}),n.jsx(Wt,{}),n.jsx(Ut,{textAlign:"center",pb:"20px",children:n.jsxs(K,{w:"100%",gap:"0px",children:[n.jsxs(H,{justify:"space-between",w:"100%",children:[n.jsx(U,{color:"primary_gray",children:"Min Order Size"}),n.jsxs(U,{color:"text_caption",children:[i==null?void 0:i.minSize," ",(l=i==null?void 0:i.baseAssets)==null?void 0:l.symbol]})]}),n.jsx(p.Suspense,{fallback:n.jsxs(K,{w:"100%",align:"flex-start",mt:"20px",children:[n.jsxs(K,{w:"100%",align:"flex-start",children:[n.jsxs(H,{w:"100%",children:[n.jsx(Zt,{w:"28px",h:"28px"}),n.jsx(se,{h:"16px",w:"60px",borderRadius:"4px"})]}),n.jsx(se,{h:"16px",w:"120px",borderRadius:"4px"})]}),n.jsxs(K,{w:"100%",align:"flex-start",mt:"20px",children:[n.jsxs(H,{w:"100%",children:[n.jsx(Zt,{w:"28px",h:"28px"}),n.jsx(se,{h:"16px",w:"60px",borderRadius:"4px"})]}),n.jsx(se,{h:"16px",w:"120px",borderRadius:"4px"})]})]}),children:n.jsx(fn,{fromCoin:i==null?void 0:i.baseAssets,toCoin:i==null?void 0:i.quoteAssets,wrapStyle:{gap:"16px"},titleStyle:{height:"auto",m:"16px 0 4px",sx:{">p":{color:"primary_gray"}}},itemStyle:{bg:"bg_secondary",p:"16px",borderRadius:"8px"},chartStyle:{flex:o?"0 0 150px":""},type:"deepbook"})})]})})]})]})}const _s=({priceChange:i,isLoading:e})=>{if(e)return n.jsx(se,{height:"12px",width:"50px"});if(!i||i==="0%")return n.jsx(U,{color:"text_caption",children:i});const t=i.includes("-"),s=t?i.split("-")[1]:i;return n.jsxs(H,{gap:"2px",justify:"flex-end",children:[n.jsx(Ne,{fontSize:"12px",xlinkHref:"#icon-icon_arrow",transition:"transform 0.5s",transform:t?"rotate(0deg)":"rotate(180deg)",svgFill:t?"primary_red":"primary_green"}),n.jsx(U,{color:t?"primary_red":"primary_green",fontSize:{base:"12px",lg:"14px"},children:s})]})},ys=({priceDisplay:i,priceUsd:e,symbol:t,isLoading:s})=>n.jsxs(K,{align:"flex-start",w:{base:"50%",lg:"auto"},children:[n.jsxs(U,{fontSize:"12px",fontWeight:"500",children:["Price (",t||"--",")"]}),n.jsx(H,{w:{base:"100%",lg:"auto"},children:s?n.jsxs(H,{flexDirection:{base:"column",lg:"row"},alignItems:{base:"flex-start",lg:"center"},gap:{base:"4px",lg:"8px"},children:[n.jsx(se,{height:{base:"12px",lg:"12px"},width:{base:"80px",lg:"60px"}}),n.jsx(se,{height:{base:"12px",lg:"12px"},width:{base:"100px",lg:"80px"}})]}):n.jsxs(H,{flexDirection:{base:"column",lg:"row"},alignItems:{base:"flex-start",lg:"center"},gap:{base:"4px",lg:"8px"},children:[n.jsx(U,{fontSize:{base:"12px",lg:"14px"},fontWeight:{base:"600",lg:"400"},color:"text_caption",children:i}),n.jsx(U,{fontSize:{base:"12px",lg:"14px"},children:ks(e)})]})})]}),ws=({vol24hDisplay:i,vol24hUsdDisplay:e,symbol:t,isLoading:s})=>n.jsxs(K,{align:"flex-start",w:{base:"50%",lg:"auto"},children:[n.jsxs(U,{fontSize:"12px",fontWeight:{base:"500",lg:"400"},children:["24h Volume (",t||"--",")"]}),s?n.jsxs(H,{flexDirection:{base:"column",lg:"row"},alignItems:{base:"flex-start",lg:"center"},gap:{base:"4px",lg:"8px"},children:[n.jsx(se,{height:{base:"12px",lg:"12px"},width:{base:"70px",lg:"70px"}}),n.jsx(se,{height:{base:"12px",lg:"12px"},width:{base:"60px",lg:"90px"}})]}):n.jsxs(H,{flexDirection:{base:"column",lg:"row"},alignItems:{base:"flex-start",lg:"center"},gap:{base:"4px",lg:"8px"},children:[n.jsx(U,{color:"text_caption",fontSize:{base:"12px",lg:"14px"},children:i}),n.jsx(U,{fontSize:{base:"12px",lg:"14px"},children:ks(e)})]})]}),Os=({high:i,low:e,symbol:t,isLoading:s,isApp:o})=>n.jsx(K,{align:"flex-start",w:{base:"50%",lg:"auto"},children:o?n.jsxs(K,{alignItems:"flex-start",children:[n.jsx(U,{fontSize:"12px",fontWeight:"400",display:{base:"block",lg:"none"},children:"24h High/Low"}),n.jsx(H,{children:s?n.jsx(se,{h:"12px",w:"60px"}):n.jsxs(n.Fragment,{children:[n.jsx(U,{fontSize:"12px",fontWeight:"400",color:"primary_green",children:de(i)}),n.jsx(U,{fontSize:"12px",children:t})]})}),n.jsx(H,{children:s?n.jsx(se,{h:"12px",w:"60px"}):n.jsxs(n.Fragment,{children:[n.jsx(U,{fontSize:"12px",fontWeight:"400",color:"primary_red",children:de(e)}),n.jsx(U,{fontSize:"12px",children:t})]})})]}):n.jsxs(n.Fragment,{children:[n.jsxs(H,{children:[n.jsx(U,{fontSize:"12px",whiteSpace:"nowrap",fontWeight:"500",display:{base:"none",lg:"block"},children:"24h High"}),s?n.jsxs(n.Fragment,{children:[n.jsx(se,{h:"14px",w:"60px"}),n.jsx(se,{h:"12px",w:"60px"})]}):n.jsxs(H,{children:[n.jsx(U,{fontSize:"14px",color:"primary_green",children:de(i)}),n.jsx(U,{fontSize:"12px",children:t})]})]}),n.jsxs(H,{children:[n.jsx(U,{fontSize:"12px",whiteSpace:"nowrap",fontWeight:"500",display:{base:"none",lg:"block"},children:"24h Low"}),s?n.jsxs(n.Fragment,{children:[n.jsx(se,{h:"14px",w:"60px"}),n.jsx(se,{h:"12px",w:"60px"})]}):n.jsxs(H,{children:[n.jsx(U,{fontSize:"14px",color:"primary_red",children:de(e)}),n.jsx(U,{fontSize:"12px",children:t})]})]})]})}),Es=({onClick:i,isOpenCard:e,setIsOpenCard:t,isLoading:s,isApp:o})=>n.jsx(se,{isLoaded:!s,children:n.jsxs(H,{cursor:"pointer",_hover:{p:{color:"text_caption"}},children:[n.jsxs(H,{onClick:i,children:[n.jsxs(U,{fontSize:"12px",color:"primary_gray",children:[n.jsx(pe,{as:"span",display:{base:"none",lg:"none"},children:"Details"}),n.jsx(pe,{as:"span",display:{base:"none",lg:"inline"},children:"Market Details"})]}),n.jsx(ss,{w:{base:"24px",lg:"20px"},h:{base:"24px",lg:"20px"},src:"/images/deepbook/icon_details.png"})]}),o&&n.jsx(Ne,{fontSize:"12px",xlinkHref:"#icon-icon_unfold",w:"20px",h:"20px",onClick:()=>t(!e),transform:e?"rotate(0deg)":"rotate(180deg)",transition:"transform 0.3s"})]})});function Zs({isOpenCard:i,setIsOpenCard:e}){var T,O,N,R;const{getTokenAmountValue:t}=Ft(),{currentDeepBookPool:s,deepBookPoolLoading:o,deepbookPrice:a}=Q(),{windowWidth:r,isApp:l}=ze(),d=t((T=s==null?void 0:s.baseAssets)==null?void 0:T.coin_type,s==null?void 0:s.vol24h),c=r<1340,h=o||!((O=s==null?void 0:s.quoteAssets)!=null&&O.symbol),u={symbol:(N=s==null?void 0:s.quoteAssets)==null?void 0:N.symbol,isLoading:h},[f,b]=p.useState(!1),g=p.useMemo(()=>a&&(a!=null&&a.price)&&(a==null?void 0:a.poolId)==(s==null?void 0:s.address)?s==null?void 0:s.price:"",[s==null?void 0:s.address,a]),y=t((R=s==null?void 0:s.quoteAssets)==null?void 0:R.coin_type,g);return n.jsxs(ns,{borderRadius:"8px",border:"none",maxHeight:"100%",h:{base:"auto",lg:"64px"},p:{base:"20px 16px 24px",lg:"0 16px"},children:[n.jsxs(K,{w:"100%",gap:"20px",display:{base:"flex",lg:"none"},children:[n.jsxs(H,{w:"100%",justify:"space-between",children:[n.jsx(Ts,{currentDeepBookPool:s}),n.jsx(Es,{onClick:()=>b(!0),isOpenCard:i,setIsOpenCard:e,isLoading:h,isApp:l})]}),i&&n.jsxs(H,{w:"100%",children:[n.jsx(ys,{priceDisplay:de(g),priceUsd:y,...u}),n.jsxs(K,{align:"flex-start",flex:"1",children:[n.jsx(U,{fontSize:"12px",fontWeight:"500",children:"24h Change"}),n.jsx(_s,{priceChange:s==null?void 0:s.priceChange,isLoading:h})]})]}),i&&n.jsxs(H,{w:"100%",justify:"space-between",gap:"16px",children:[n.jsx(ws,{vol24hDisplay:s==null?void 0:s.vol24hDisplay,vol24hUsdDisplay:d,...u}),n.jsx(Os,{high:s==null?void 0:s.high,low:s==null?void 0:s.low,...u,isApp:l})]})]}),n.jsxs(H,{w:"100%",h:"100%",justify:"space-between",display:{base:"none",lg:"flex"},children:[n.jsxs(H,{gap:"28px",children:[n.jsx(Ts,{currentDeepBookPool:s}),n.jsx(pe,{h:"32px",w:"1px",bg:"border"}),n.jsx(ys,{priceDisplay:de(g),priceUsd:y,...u}),n.jsxs(K,{align:"flex-start",children:[n.jsx(U,{fontSize:"12px",whiteSpace:"nowrap",fontWeight:"500",children:"24h Change"}),n.jsx(_s,{priceChange:s==null?void 0:s.priceChange,isLoading:h})]}),n.jsx(ws,{vol24hDisplay:s==null?void 0:s.vol24hDisplay,vol24hUsdDisplay:d,...u}),!c&&n.jsx(Os,{high:s==null?void 0:s.high,low:s==null?void 0:s.low,...u})]}),n.jsx(Es,{onClick:()=>b(!0),isOpenCard:i,setIsOpenCard:e,isLoading:h,isApp:l})]}),f&&n.jsx(bn,{currentDeepBookPool:s,isOpen:f,onClose:()=>b(!1),onCloseDetails:()=>b(!1)})]})}function kt(){var O;const{currentDeepBookPool:i,getCurrentBalanceManagerInfo:e,setDeepBookOpenOrders:t,deepBookPools:s,setOrderListLoading:o,isCheckedAllMarkets:a,setCancelOrderLoading:r}=Q(),{currentAccount:l}=ge(),{getRequestPool:d}=Ce(),{deepBookSDK:c}=He(),{getBalanceManagerInfo:h}=Se(),u=p.useRef(!1);p.useEffect(()=>{u.current=a},[a]);const f=(O=e(l==null?void 0:l.address))==null?void 0:O.balanceManager,b=p.useRef();p.useEffect(()=>{b.current=f},[f]);const g=async(N=i,R=!0)=>{var w,I;try{R&&o(!0);let x=(w=e(l==null?void 0:l.address))==null?void 0:w.balanceManager;if(!x){const A=await c.DeepbookUtils.getBalanceManager(l==null?void 0:l.address);(A==null?void 0:A.length)>0&&(x=(I=A==null?void 0:A[0])==null?void 0:I.balanceManager)}const W=d(N),S=await c.DeepbookUtils.getOpenOrder(W,l==null?void 0:l.address,x),C=S.map(A=>y(A,N));return x==b.current&&(t(C),o(!1)),r(!1),console.log("🚀🚀🚀 ~ useGetDeepBookOpenOrders.ts:18 ~ getDeepBookOpenOrders ~ list:",S),C}catch(x){o(!1),console.log("🚀🚀🚀 ~ useGetDeepBookOpenOrders.ts:29 ~ getDeepBookOpenOrders ~ error:",x)}},y=(N,R)=>{const{order_id:w,isBid:I,price:x,quantity:W,filled_quantity:S}=N,{baseAssets:C,quoteAssets:A,address:M}=R,v=A.decimals,m=C.decimals,E=X(W).div(Math.pow(10,m)).toString(),F=X(S).div(Math.pow(10,m)).toString();return{orderId:w,side:I?"Buy":"Sell",baseAsset:R.baseAssets.symbol,quoteAsset:R.quoteAssets.symbol,price:X(x.toString()).div(Math.pow(10,v-m+9)).toString(),originalQuantity:E,filledQuantity:F,baseAssets:C,quoteAssets:A,address:M}};return{getDeepBookOpenOrders:g,getDeepBookAllOpenOrders:async(N=!0)=>{var R,w;try{N&&o(!0);let I=(R=e(l==null?void 0:l.address))==null?void 0:R.balanceManager;if(console.log("🚀🚀🚀 ~ useGetDeepBookOpenOrders.ts:76 ~ getDeepBookAllOpenOrders ~ deepBookAccount:",I),!I){const W=await h(l==null?void 0:l.address);(W==null?void 0:W.length)>0&&(I=(w=W==null?void 0:W[0])==null?void 0:w.balanceManager)}const x=[];for(let W=0;W<s.length;W++){const S=s[W],C=d(S),M=(await c.DeepbookUtils.getOpenOrder(C,l==null?void 0:l.address,I)).map(v=>y(v,S));x.push(...M)}console.log("🚀🚀🚀 ~ useGetDeepBookOpenOrders.ts:82 ~ getDeepBookAllOpenOrders ~ allList:",x),u.current&&I==b.current&&(t(x),o(!1))}catch(I){o(!1),console.log("🚀🚀🚀 ~ useGetDeepBookOpenOrders.ts:85 ~ getDeepBookAllOpenOrders ~ error:",I)}}}}function xn(){const{deepBookSDK:i}=He(),{getRequestPool:e}=Ce();return{getEstimatedMaxFee:async(s,o,a,r)=>{if(qe(s.takerFeeRate).lte(0))return"0";const l={...e(s),taker_fee:s.takerFeeRate},d=s.baseAssets.decimals,c=s.quoteAssets.decimals,h=qe(s.lotSize).mul(10**d),u=qe(o).mul(10**d).div(h).toDP(0,Ys.ROUND_HALF_UP).mul(h).toString(),f=qe(a).mul(10**(c-d+9)).toString();console.log("getEstimatedMaxFee params: ",{pool:l,quantity:u,price:f});const b=await i.DeepbookUtils.estimatedMaxFee(l,u,f,!1,r=="bid",!1);console.log("🚀🚀🚀 ~ useGetDeepBookEstFee.ts:29 ~ getEstimatedMaxFee ~ res:",b);const g=r=="bid"?s.quoteAssets.decimals:s.baseAssets.decimals;return b!=null&&b.quantity?qe(b==null?void 0:b.quantity).div(Math.pow(10,g)).toString():"0"}}}function mn(){const{deepBookAskList:i,deepBookBidList:e}=Q();return{getOrderBestPrice:s=>{var a,r;return(s==="bid"?(a=i[0])==null?void 0:a.price:(r=e[0])==null?void 0:r.price)||"0"}}}function Tn(){const{deepBookSDK:i}=He(),{currentAccount:e}=ge(),{getCurrentBalanceManagerInfo:t}=Q(),{getRequestPool:s}=Ce(),{getBalanceManagerInfo:o}=Se();return{getPlaceLimitOrderPayload:async(r,l,d,c,h,u)=>{var f,b;try{const g=s(r),y=r.baseAssets.decimals;let T,O=u||((f=t(e==null?void 0:e.address))==null?void 0:f.balanceManager);if(!O){const w=await o(e==null?void 0:e.address);(w==null?void 0:w.length)>0&&(O=(b=w==null?void 0:w[0])==null?void 0:b.balanceManager)}const N=qe(r.lotSize).mul(10**y),R=qe(d).mul(10**y).div(N).floor().mul(N).toString();return O?T=await i.DeepbookUtils.placeLimitOrder(O,g,l,R,c,qe(h).mul(Math.pow(10,c=="bid"?r.quoteAssets.decimals:r.baseAssets.decimals)).toString(),e==null?void 0:e.address,!1):T=await i.DeepbookUtils.createDepositThenPlaceLimitOrder(g,l,R,c,qe(h).mul(Math.pow(10,c=="bid"?r.quoteAssets.decimals:r.baseAssets.decimals)).toString(),e==null?void 0:e.address,!1),{tx:T}}catch(g){console.log("🚀 ~ file: useDeepbookV3.ts:365 ~ placeLimitOrder ~ error:",g)}}}}function _n(){const{deepBookSDK:i}=He(),{getCurrentBalanceManagerInfo:e}=Q(),{currentAccount:t}=ge(),{getRequestPool:s}=Ce(),{deepBookSlippage:o}=ut(),{getBalanceManagerInfo:a}=Se();return{getPlaceMarketOrderPayload:async(l,d,c,h,u)=>{var f;console.log("🚀🚀🚀 ~ usePlaceMarketOrder.ts:23 ~ getPlaceMarketOrderPayload ~ quantityInput:",{quantityInput:d,slippageQuoteValue:h});try{let b=e(t==null?void 0:t.address).balanceManager;if(!b){const x=await a(t==null?void 0:t.address);(x==null?void 0:x.length)>0&&(b=(f=x==null?void 0:x[0])==null?void 0:f.balanceManager)}const g=s(l);console.log("🚀🚀🚀 ~ usePlaceMarketOrder.ts:31 ~ getPlaceMarketOrderPayload ~ poolInfo:",l);const y=l.baseAssets.decimals,T=l.quoteAssets.decimals,O=X(l.lotSize).mul(10**y),N=X(d).mul(10**y).div(O).floor().mul(O).toString(),R=c==="bid",w=Fi(X(h).mul(10**T).toString(),0);let I;return b?I=await i.DeepbookUtils.placeMarketOrder(b,g,N,String(w),R,X(u).mul(Math.pow(10,c=="bid"?l.quoteAssets.decimals:l.baseAssets.decimals)).toString(),t==null?void 0:t.address,!1):I=await i.DeepbookUtils.createDepositThenPlaceMarketOrder(g,N,c,X(u).mul(Math.pow(10,c=="bid"?l.quoteAssets.decimals:l.baseAssets.decimals)).toString(),t==null?void 0:t.address,!1,Number(o)/100),{tx:I}}catch(b){console.log("placeMarketOrder error: ",b)}}}}function yn(){var gs;const{currentDeepBookPool:i,managerBalanceObjs:e,getCurrentBalanceManagerInfo:t,currentBalanceManagerInfoMap:s,isCheckedAllMarkets:o,deepBookAskList:a,deepBookBidList:r}=Q(),{currentAccount:l}=ge(),{getTokenAmountValue:d}=Ft(),{getEstimatedMaxFee:c}=xn(),{getPlaceMarketOrderPayload:h}=_n(),{getOrderBestPrice:u}=mn(),{mevProtect:f,maxCapForGas:b,transactionMode:g,customGasPrice:y}=ut(),{deepBookSlippage:T}=ut(),{baseFreeBalance:O,quoteFreeBalance:N,allBaseBalance:R,allQuoteBalance:w}=rs(),{transactionConfirmation:I}=os(),{signAndExecuteTransaction:x}=as(),{fetchAccountBalance:W}=bt(),{getManagerBalance:S}=Se(),{getPlaceLimitOrderPayload:C}=Tn(),{getDeepBookOpenOrders:A,getDeepBookAllOpenOrders:M}=kt(),[v,m]=p.useState("Buy"),[E,F]=p.useState(!1),{placeOrderPrice:B,setPlaceOrderPrice:V,orderType:$,setOrderType:ne,deepBookPrice:ee}=Q(),[D,P]=p.useState(""),z=p.useRef(""),G=p.useRef("");p.useEffect(()=>{z.current=D,G.current=B},[D,B]);const te=p.useMemo(()=>l!=null&&l.address?t(l==null?void 0:l.address):null,[l==null?void 0:l.address,s]),oe=p.useMemo(()=>X(D||"0").gt("0")&&X(D).lt(i==null?void 0:i.minSize),[D,i==null?void 0:i.address]);p.useEffect(()=>{i!=null&&i.address&&(P(""),V((ee==null?void 0:ee.price)||(i==null?void 0:i.price)))},[i==null?void 0:i.address,$,ee]);const fe=p.useMemo(()=>D&&X(D).gt("0")?X(D||"0").mul(B||"0").toString():"--",[D,i==null?void 0:i.price]),ce=p.useMemo(()=>{if($=="Market"){const ae=v==="Buy",Ee=u(ae?"bid":"ask");if(D){const Ie=X(Ee).mul(D);return ae?Ie.add(Ie.mul(T)).toString():Ie.sub(Ie.mul(T)).toString()}else return D?"--":"0"}},[$,D,T,v,a,r]),xe=p.useMemo(()=>B!=="--"?X(D||0).mul(B||0).toString():D?"--":"0",[B,D]),De=p.useMemo(()=>$==="Market"?ce:xe,[$,ce,xe,a,r]),Ze=d((gs=i==null?void 0:i.quoteAssets)==null?void 0:gs.coin_type,De),mt=p.useMemo(()=>v==="Buy"?w:R,[v,R,w]),[ke,k]=p.useState("0"),[ye,Ye]=p.useState(!1);p.useEffect(()=>{X(B||"0").gt(0)&&X(D||"0").gt(0)?(Ye(!0),c(i,D,B,v==="Buy"?"bid":"ask").then(ae=>{z.current&&G.current&&k(ae),Ye(!1)})):k("0")},[B,D,v,a,r]);const Xe=p.useMemo(()=>{var Tt,je;if(oe)return{text:"",disabled:!0};if(!+B)return{text:"",disabled:!0};if(!+De)return{text:"",disabled:!0};if(ye)return{text:"",disabled:!0};const ae=v==="Buy",Ee=ye?0:ke,Ie=ae?w:R,tt=ae?X(De).add(X(Ee)).toString():X(D).add(X(Ee)).toString();return tt!=="--"&&X(tt).gt(Ie??0)?{text:`Insufficient ${ae?(Tt=i==null?void 0:i.quoteAssets)==null?void 0:Tt.symbol:(je=i==null?void 0:i.baseAssets)==null?void 0:je.symbol} balance`,disabled:!0}:$==="Market"&&(!D||D==="0"||!B||B==="0")?{text:"",disabled:!0}:$==="Limit"&&(!B||B==="0"||!D||D==="0")?{text:"",disabled:!0}:{text:"",disabled:!1}},[oe,fe,D,v,$,w,R,i,De,ke,ye]),us=()=>{o?M():A()},ci=async()=>{try{F(!0);let ae={getShowInfo:(tt,Tt)=>{const je="Creating order",Be={modalDescriptionText:je,toastTitleText:je};return tt==="success"&&(Be.toastDescriptionContent="Order placed successfully",Be.modalDescriptionText=je,Be.toastTitleText="Place order Successful"),Be}};I(ae),console.log("🚀🚀🚀 ~ useTradeCard.ts:225 ~ placeMarketOrder ~ marketTotal:",ce);const{tx:Ee}=await h(i,D,v==="Buy"?"bid":"ask",ce,ke),Ie=await x(Ee,ae,{useMev:f,useFastMode:g==="Fast Mode",maxCapForGas:b,customGasPrice:y,msafeParams:{}});console.log("🚀🚀🚀 ~ useTradeCard.ts:135 ~ placeMarketOrder ~ res:",Ie),Ie&&(W(),P(""),S([{coin_type:i==null?void 0:i.baseAssets.coin_type,decimals:i==null?void 0:i.baseAssets.decimals},{coin_type:i==null?void 0:i.quoteAssets.coin_type,decimals:i==null?void 0:i.quoteAssets.decimals}],l==null?void 0:l.address,te==null?void 0:te.balanceManager),us()),F(!1)}catch(ae){console.log("🚀🚀🚀 ~ useTradeCard.ts:90 ~ getPlaceMarketOrderPayload ~ error:",ae),F(!1)}},hi=async()=>{try{F(!0);let ae={getShowInfo:(tt,Tt)=>{const je="Creating order",Be={modalDescriptionText:je,toastTitleText:je};return tt==="success"&&(Be.toastDescriptionContent="Order placed successfully",Be.modalDescriptionText=je,Be.toastTitleText="Place order Successful"),Be}};I(ae);const{tx:Ee}=await C(i,B,D,v==="Buy"?"bid":"ask",ke);await x(Ee,ae,{useMev:f,useFastMode:g==="Fast Mode",maxCapForGas:b,customGasPrice:y,msafeParams:{}})&&(F(!1),W(),P(""),S([{coin_type:i==null?void 0:i.baseAssets.coin_type,decimals:i==null?void 0:i.baseAssets.decimals},{coin_type:i==null?void 0:i.quoteAssets.coin_type,decimals:i==null?void 0:i.quoteAssets.decimals}],l==null?void 0:l.address,te==null?void 0:te.balanceManager),us()),F(!1)}catch(ae){console.log("🚀🚀🚀 ~ useTradeCard.ts:173 ~ placeLimitOrder ~ error:",ae)}};function ps(ae){const Ee=ae.toString().split(".")[1];return Ee&&Ee.length>1?Ee.length:0}const ui=p.useMemo(()=>{const ae=i==null?void 0:i.tickSize;return ae?ps(ae):0},[i==null?void 0:i.address]),pi=p.useMemo(()=>{const ae=i==null?void 0:i.minSize;return ae?ps(ae):0},[i==null?void 0:i.address]);return{currentDeepBookPool:i,tradeType:v,setTradeType:m,orderType:$,setOrderType:ne,price:B,setPrice:V,amount:D,setAmount:P,isShowOrderVolumeError:oe,estTotal:fe,estTotalUsd:Ze,available:mt,maxFee:ke,maxFeeIsLoading:ye,btnInfo:Xe,getPlaceMarketOrderPayload:h,placeMarketOrder:ci,baseFreeBalance:O,quoteFreeBalance:N,placeOrderLoading:E,placeLimitOrder:hi,total:De,tickSizeUnit:ui,minSizeUnit:pi}}function vs(i){const{title:e,symbol:t,value:s,onChange:o,isMarket:a,decimals:r}=i,l=p.useRef(null),[d,c]=p.useState(!1);return n.jsxs(K,{w:"100%",ref:l,p:"12px",border:"1px solid",borderRadius:"12px",bg:"bg_secondary",alignItems:"flex-start",gap:"0px",position:"relative",zIndex:"5",onFocus:()=>{c(!0)},onBlur:()=>{c(!1)},borderColor:d?"token_active_border":"border",boxShadow:d?"0px 0px 6px 0px #0067AD":"",children:[n.jsx(U,{fontSize:"12px",fontWeight:"500",children:e}),n.jsxs(H,{w:"100%",alignItems:"flex-start",pt:"8px",children:[a?n.jsx(yi,{value:"Market",disabled:!0,placeholder:"Market",color:"text_caption !important",fontSize:"18px",fontWeight:"500",h:"18px"}):n.jsx(Hi,{value:s,onChange:o,decimals:r,placeholder:"0.0",style:{width:"calc(100% - 8px)",background:"none",whiteSpace:"nowrap",opacity:1,outline:"none",color:"var(--chakra-colors-text_caption)",fontSize:"18px",height:"18px",lineHeight:"18px",touchAction:"manipulation",transition:"all 0.3s",fontWeight:"500"}}),n.jsx(U,{mt:"-8px",fontWeight:"500",children:t})]})]})}const wn=({minSize:i,baseSymbol:e})=>n.jsx(K,{w:"100%",h:"44px",borderRadius:"12px",bg:"primary_yellow_opacity.10",mt:"-30px",justifyContent:"flex-end",pb:"4px",children:n.jsxs(U,{fontSize:"12px",color:"primary_yellow",children:["Order volume must be greater than ",de(i)," ",e]})});function On(i){const{from:e,to:t,isShowOrderVolumeError:s,minSize:o,isMarket:a}=i;return n.jsxs(K,{w:"100%",borderRadius:"8px",bg:"bg_secondary",position:"relative",zIndex:"5",children:[n.jsx(vs,{...e,isMarket:a}),n.jsx(vs,{...t}),s&&n.jsx(wn,{minSize:o,baseSymbol:t.symbol})]})}const En=[{label:"Buy"},{label:"Sell"}],vn=({currentTab:i,setCurrentTab:e})=>n.jsx(ot,{type:"outlineTab",tabList:En,currentTab:i,handleChangeTab:t=>e(t==null?void 0:t.label),wrapStyle:{w:"100%",h:"40px",p:"4px",border:"1px solid",borderColor:"border",borderRadius:"8px",gap:"4px",zIndex:"99"},itemStyle:{w:"50%",h:"100%",p:"4px 8px",borderRadius:"4px",gap:"4px",justifyContent:"center",alignItems:"center",fontSize:"14px",fontWeight:"500",sx:{'&[data-active="true"]':{backgroundColor:i=="Buy"?"primary_green_opacity.10":"primary_red_opacity.10",color:i=="Buy"?"primary_green":"primary_red"}}},selectTabItemTextStyle:{color:"primary_gray",sx:{'&[data-active="true"]':{color:i=="Buy"?"primary_green":"primary_red"}}}}),Rn=[{label:"Market"},{label:"Limit"}],An=({currentTab:i,setCurrentTab:e})=>{const{currentDeepBookPool:t,isCheckedAllMarkets:s}=Q(),{getManagerBalance:o}=Se(),{currentAccount:a}=ge(),{getCurrentBalanceManagerInfo:r}=Q(),l=r(a==null?void 0:a.address),{fetchAccountBalance:d}=bt(),{getDeepBookAllOpenOrders:c,getDeepBookOpenOrders:h}=kt(),u=()=>{o([{coin_type:t==null?void 0:t.baseAssets.coin_type,decimals:t==null?void 0:t.baseAssets.decimals},{coin_type:t==null?void 0:t.quoteAssets.coin_type,decimals:t==null?void 0:t.quoteAssets.decimals}],a==null?void 0:a.address,l==null?void 0:l.balanceManager),d(),s?c():h(t)};return n.jsxs(H,{w:"100%",borderRadius:"8px",bg:"bg_secondary",justifyContent:"space-between",children:[n.jsx(ot,{type:"borderTab",tabList:Rn,currentTab:i,handleChangeTab:f=>e(f==null?void 0:f.label),wrapStyle:{w:"132px",h:"40px",border:"none",gap:"32px",pl:"4px"},itemStyle:{w:"50%",h:"100%",borderRadius:"4px",gap:"4px",justifyContent:"center",alignItems:"center",fontSize:"14px",fontWeight:"500"},selectTabItemTextStyle:{color:"primary_gray"}}),n.jsxs(H,{children:[i=="Market"&&n.jsx(Ji,{slippageType:"deepbook"}),n.jsx(Xs,{w:"28px",h:"28px",innerStyle:{w:"26px",h:"26px",bg:"none",fontSize:"12px"},handleRefresh:u})]})]})},Ln=({currentOrderType:i,isShowOrderVolumeError:e,estTotal:t,currentDeepBookPool:s,estTotalUsd:o,available:a,maxFee:r,maxFeeIsLoading:l,tradeType:d,total:c,isLoading:h})=>{var u,f,b,g,y;return n.jsxs(K,{w:"100%",p:e?"0px 0px 8px":"8px 0px",gap:"12px",children:[n.jsx(ct,{label:i=="Limit"?"Total":"Est.Total",value:c==="--"?n.jsx(U,{color:"text_caption",children:"--"}):n.jsxs(H,{whiteSpace:"nowrap",w:"100%",children:[n.jsxs(U,{color:"text_caption",children:[de(c)," ",(u=s==null?void 0:s.quoteAssets)==null?void 0:u.symbol]}),n.jsxs(U,{children:["$",Us(o)]})]}),labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px",maxW:"100%"},wrapStyle:{h:"20px",lineHeight:"20px"}}),n.jsx(ct,{label:"Available",value:h?n.jsx(se,{}):`${de(a,void 0,void 0,Ys.ROUND_DOWN)} ${d==="Buy"?(f=s==null?void 0:s.quoteAssets)==null?void 0:f.symbol:(b=s==null?void 0:s.baseAssets)==null?void 0:b.symbol}`,labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px"},wrapStyle:{h:"20px",lineHeight:"20px"}}),n.jsx(ct,{label:n.jsxs(H,{gap:"2px",children:[n.jsx(U,{children:"Fee"}),n.jsx(Ne,{xlinkHref:"#icon-icon_tips",svgW:"20px",svgH:"20px"})]}),labelStyle:{textDecoration:"unset"},value:l||h?n.jsx(se,{}):`${r} ${d==="Buy"?(g=s==null?void 0:s.quoteAssets)==null?void 0:g.symbol:(y=s==null?void 0:s.baseAssets)==null?void 0:y.symbol}`,valueStyle:{fontSize:"14px"},leftTooltip:"Max fee estimated",wrapStyle:{h:"20px",lineHeight:"20px"}})]})};function Ks(){var C,A,M,v;const{tradeType:i,setTradeType:e,orderType:t,setOrderType:s,price:o,setPrice:a,amount:r,setAmount:l,currentDeepBookPool:d,isShowOrderVolumeError:c,estTotal:h,estTotalUsd:u,available:f,maxFee:b,maxFeeIsLoading:g,btnInfo:y,placeMarketOrder:T,placeOrderLoading:O,placeLimitOrder:N,total:R,tickSizeUnit:w,minSizeUnit:I}=yn(),{currentAccount:x,onWalletModal:W}=ge(),S=!((C=d==null?void 0:d.baseAssets)!=null&&C.symbol)||!((A=d==null?void 0:d.quoteAssets)!=null&&A.symbol);return n.jsxs(K,{w:"100%",bg:"bg_secondary",p:"16px",borderRadius:"12px",children:[n.jsx(vn,{currentTab:i,setCurrentTab:e}),n.jsx(An,{currentTab:t,setCurrentTab:s}),n.jsx(On,{from:{title:"Price",symbol:(M=d==null?void 0:d.quoteAssets)==null?void 0:M.symbol,value:o,onChange:m=>a(m),decimals:w},to:{title:"Amount",symbol:(v=d==null?void 0:d.baseAssets)==null?void 0:v.symbol,value:r,onChange:m=>l(m),decimals:I},isShowOrderVolumeError:c,minSize:d==null?void 0:d.minSize,isMarket:t=="Market"}),n.jsx(Ln,{currentOrderType:t,isShowOrderVolumeError:c,estTotal:h,currentDeepBookPool:d,estTotalUsd:u,available:f,maxFee:b,maxFeeIsLoading:g,tradeType:i,total:R,isLoading:S}),x!=null&&x.address?n.jsx(Fe,{w:"100%",fontSize:"16px",fontWeight:"500",isDisabled:y==null?void 0:y.disabled,onClick:t=="Market"?T:N,isLoading:O,children:(y==null?void 0:y.text)||`Place ${i} Order`}):n.jsx(Fe,{w:"100%",fontSize:"16px",fontWeight:"500",onClick:()=>W(!0),children:"Connect Wallet"})]})}function Mn(){const{deepBookSDK:i}=He(),{getRequestPool:e}=Ce(),{getCurrentBalanceManagerInfo:t}=Q(),{currentAccount:s}=ge();return{getCancelOrderPayload:async(r,l)=>{var u;console.log("🚀🚀🚀 ~ useGetCancelOrderPayload.ts:13 ~ getCancelOrderPayload ~ poolInfo:",r),console.log("🚀🚀🚀 ~ useGetCancelOrderPayload.ts:13 ~ getCancelOrderPayload ~ orderId:",l);const d=e(r);console.log("🚀🚀🚀 ~ useGetCancelOrderPayload.ts:15 ~ getCancelOrderPayload ~ pool:",d);const c=(u=t(s==null?void 0:s.address))==null?void 0:u.balanceManager;return await i.DeepbookUtils.cancelOrders([{orderId:l,poolInfo:d}],c)},getcancellAllOrderPayload:async r=>{var h;const l=r.map(u=>({orderId:u.orderId,poolInfo:e(u)})),d=(h=t(s==null?void 0:s.address))==null?void 0:h.balanceManager;return await i.DeepbookUtils.cancelOrders(l,d)}}}function Nn(){const{deepBookSDK:i}=He(),{getCurrentBalanceManagerInfo:e,currentDeepBookPool:t}=Q(),{currentAccount:s}=ge(),{getRequestPool:o}=Ce(),{getBalanceManagerInfo:a}=Se();return{getClaimSettlePayload:async()=>{var c,h;let l=(c=e(s==null?void 0:s.address))==null?void 0:c.balanceManager;if(!l){const u=await a(s==null?void 0:s.address);(u==null?void 0:u.length)>0&&(l=(h=u==null?void 0:u[0])==null?void 0:h.balanceManager)}const d=o(t);return i.DeepbookUtils.withdrawSettledAmounts({poolInfo:d,balanceManager:l})}}}function Qs(){const{currentAccount:i}=ge(),{setDeepBookSettleList:e,setDeepBookSettleListLoading:t,getCurrentBalanceManagerInfo:s,currentDeepBookPool:o}=Q(),{getRequestPool:a}=Ce(),{deepBookSDK:r}=He(),{getBalanceManagerInfo:l}=Se(),d=async()=>{var h,u;t(!0);try{let f=(h=s(i==null?void 0:i.address))==null?void 0:h.balanceManager;const b=a(o);if(!f){const T=await l(i==null?void 0:i.address);(T==null?void 0:T.length)>0&&(f=(u=T==null?void 0:T[0])==null?void 0:u.balanceManager)}const g=await r.DeepbookUtils.getAccount(f,[b]);if(!g){e([]),t(!1);return}console.log("🚀🚀🚀 ~ useGetDeepBookSettleList.ts:27 ~ getSettleList ~ res:",g);const y=g==null?void 0:g.map(T=>c(T));e(y),t(!1)}catch(f){console.log("🚀🚀🚀 ~ useGetDeepBookSettleList.ts:58 ~ getSettleList ~ error:",f),e([]),t(!1)}},c=h=>{var N,R,w;const{baseAssets:u,quoteAssets:f,address:b}=o,g=X((N=h==null?void 0:h.settled_balances)==null?void 0:N.base).div(10**(u==null?void 0:u.decimals)).toString(),y=X((R=h==null?void 0:h.settled_balances)==null?void 0:R.quote).div(10**(f==null?void 0:f.decimals)).toString(),T=X((w=h==null?void 0:h.settled_balances)==null?void 0:w.deep).div(10**6).toString(),O=X(g).gt(0)||X(y).gt(0);return{address:b,baseAssets:u,quoteAssets:f,baseSettle:g,quoteSettle:y,deepSettle:T,canClaim:O}};return{getSettleList:d}}function cs(){const{getCancelOrderPayload:i,getcancellAllOrderPayload:e}=Mn(),{currentDeepBookPool:t,cancelOrderLoading:s,setCancelOrderLoading:o,deepBookOpenOrders:a,setDeepBookOpenOrders:r,setClaimSettleLoading:l}=Q(),{transactionConfirmation:d}=os(),{signAndExecuteTransaction:c}=as(),{mevProtect:h,maxCapForGas:u,transactionMode:f,customGasPrice:b}=ut(),{fetchAccountBalance:g}=bt(),{getManagerBalance:y}=Se(),{currentAccount:T}=ge(),{getCurrentBalanceManagerInfo:O,currentBalanceManagerInfoMap:N}=Q(),{getDeepBookOpenOrders:R}=kt(),{getClaimSettlePayload:w}=Nn(),{getSettleList:I}=Qs(),x=p.useMemo(()=>T!=null&&T.address?O(T==null?void 0:T.address):null,[T==null?void 0:T.address,N]);return{cancelOrder:async(A,M)=>{try{o(!0);let v={getShowInfo:(F,B)=>{const V="Canceling order",$={modalDescriptionText:V,toastTitleText:V};return F==="success"&&($.toastDescriptionContent="Order canceled successfully",$.modalDescriptionText=V,$.toastTitleText="Cancel order Successful"),$}};d(v);const m=await i(A,M),E=await c(m,v,{useMev:h,useFastMode:f==="Fast Mode",maxCapForGas:u,customGasPrice:b,msafeParams:{}});console.log("🚀🚀🚀 ~ useTradeCard.ts:135 ~ placeMarketOrder ~ res:",E),E&&(g(),y([{coin_type:t==null?void 0:t.baseAssets.coin_type,decimals:t==null?void 0:t.baseAssets.decimals},{coin_type:t==null?void 0:t.quoteAssets.coin_type,decimals:t==null?void 0:t.quoteAssets.decimals}],T==null?void 0:T.address,x==null?void 0:x.balanceManager)),setTimeout(()=>{R(A)},2e3)}catch(v){console.log("🚀🚀🚀 ~ useOrderActions.ts:10 ~ cancelOrder ~ error:",v)}},cancelAllOrder:async(A=a)=>{try{o(!0);let M={getShowInfo:(E,F)=>{const B="Canceling All Order",V={modalDescriptionText:B,toastTitleText:B};return E==="success"&&(V.toastDescriptionContent="Order canceled successfully",V.modalDescriptionText=B,V.toastTitleText="Cancel order Successful"),V}};d(M);const v=await e(A),m=await c(v,M,{useMev:h,useFastMode:f==="Fast Mode",maxCapForGas:u,customGasPrice:b,msafeParams:{}});console.log("🚀🚀🚀 ~ useTradeCard.ts:135 ~ placeMarketOrder ~ res:",m),m&&(g(),y([{coin_type:t==null?void 0:t.baseAssets.coin_type,decimals:t==null?void 0:t.baseAssets.decimals},{coin_type:t==null?void 0:t.quoteAssets.coin_type,decimals:t==null?void 0:t.quoteAssets.decimals}],T==null?void 0:T.address,x==null?void 0:x.balanceManager),r([])),setTimeout(()=>{o(!1)},2e3)}catch(M){console.log("🚀🚀🚀 ~ useOrderActions.ts:10 ~ cancelOrder ~ error:",M)}},claimSettled:async()=>{try{l(!0);let A={getShowInfo:(m,E)=>{const F="Claiming settled",B={modalDescriptionText:F,toastTitleText:F};return m==="success"&&(B.toastDescriptionContent="Claimed settled successfully",B.modalDescriptionText=F,B.toastTitleText="Claim settled Successful"),B}};d(A);const M=await w(),v=await c(M,A,{useMev:h,useFastMode:f==="Fast Mode",maxCapForGas:u,customGasPrice:b,msafeParams:{}});console.log("🚀🚀🚀 ~ useTradeCard.ts:135 ~ placeMarketOrder ~ res:",v),v&&(g(),y([{coin_type:t==null?void 0:t.baseAssets.coin_type,decimals:t==null?void 0:t.baseAssets.decimals},{coin_type:t==null?void 0:t.quoteAssets.coin_type,decimals:t==null?void 0:t.quoteAssets.decimals}],T==null?void 0:T.address,x==null?void 0:x.balanceManager),I()),setTimeout(()=>{l(!1)},2e3)}catch{}}}}function Sn(){const{deepBookOpenOrders:i,cancelOrderLoading:e,orderListLoading:t,setShowOpenOrdersNum:s}=Q(),{cancelOrder:o}=cs(),[a,r]=p.useState(""),{currentAccount:l,onWalletModal:d}=ge(),c=p.useMemo(()=>i.filter(h=>a?a.split(",").includes(h.side):!0),[i,a]);return p.useEffect(()=>{s(c==null?void 0:c.length)},[c==null?void 0:c.length]),n.jsx(Ht,{dataSource:c,columns:Cn(a,r,o,e),loading:t,fixedHeader:!0,headBg:"bg_secondary",noData:l!=null&&l.address?(c==null?void 0:c.length)==0?n.jsx(at,{type:"nodata",text:"No orders",noBorder:!0,bg:"none"}):void 0:n.jsx(at,{type:"nowallet",noBorder:!0,bg:"none",onboard:()=>d(!0)}),tableContainerWrapStyle:{h:"100%"}})}const Cn=(i,e,t,s)=>[{title:n.jsx(U,{color:"primary_gray",fontSize:"12px",pt:"8px",fontWeight:"500",children:"Market"}),key:"#",thConfig:{w:"30%"},render:(o,a)=>n.jsx(H,{h:"32px",children:n.jsx(zt,{poolInfo:{displayTokenA:o==null?void 0:o.baseAssets,displayTokenB:o==null?void 0:o.quoteAssets,poolAddress:o==null?void 0:o.poolId},imgStyle:{w:"24px",h:"24px"},showFee:!1,coinPairInfoWrapStyle:{p:"0px"}})})},{title:n.jsx(H,{justifyContent:"flex-end",pt:"8px",height:"24px",fontWeight:"500",children:n.jsx(Gs,{type:i,setType:e,filterList:["Buy","Sell"],labelText:"Side"})}),key:"side",thConfig:{w:"18%"},render:o=>{var d,c,h;const a={Buy:{color:"primary_green",bg:"primary_green_opacity.10"},Sell:{color:"primary_red",bg:"primary_red_opacity.10"}},{color:r,bg:l}=a[o==null?void 0:o.side];return n.jsx(H,{w:"100%",justifyContent:"flex-end",children:n.jsx(U,{fontSize:"12px",color:r,bg:l,h:"20px",p:"0 8px",borderRadius:"4px",lineHeight:"20px",children:((c=(d=o==null?void 0:o.side)==null?void 0:d[0])==null?void 0:c.toUpperCase())+((h=o==null?void 0:o.side)==null?void 0:h.slice(1))})})}},{title:n.jsx(U,{color:"primary_gray",fontSize:"12px",textAlign:"right",pt:"8px",fontWeight:"500",children:"Price"}),key:"price",thConfig:{w:"18%"},render:o=>n.jsx(U,{w:"100%",textAlign:"right",color:"text_caption",children:de(o==null?void 0:o.price)})},{title:n.jsx(U,{color:"primary_gray",fontSize:"12px",textAlign:"right",pt:"8px",fontWeight:"500",children:"Filled/Qty"}),key:"filled",thConfig:{w:"18%"},render:o=>n.jsxs(H,{w:"100%",justify:"flex-end",gap:"0px",children:[n.jsx(U,{color:"primary",children:de(o==null?void 0:o.filledQuantity)}),n.jsx(U,{children:"/"}),n.jsx(U,{color:"text_caption",children:de(o==null?void 0:o.originalQuantity)})]})},{title:n.jsx(U,{color:"primary_gray",fontSize:"12px",pt:"8px",fontWeight:"500",children:"Action"}),key:"action",thConfig:{w:"18%"},render:o=>n.jsx(H,{w:"100%",justify:"flex-end",children:n.jsx(Fe,{w:"80px",h:"24px",borderRadius:"8px",fontSize:"12px",variant:"ghost",borderColor:"transparent !important",onClick:()=>t(o,o.orderId),isLoading:s,children:"Cancel"})})}];function Dn(){const{getSettleList:i}=Qs(),{deepBookPools:e,deepBookSettleList:t,deepBookSettleListLoading:s,currentDeepBookPool:o}=Q(),{currentAccount:a,onWalletModal:r}=ge();p.useEffect(()=>{(e==null?void 0:e.length)>0&&(a!=null&&a.address)&&i()},[e==null?void 0:e.length,a==null?void 0:a.address,o==null?void 0:o.address]);const{claimSettled:l}=cs();return n.jsx(Ht,{dataSource:t,columns:In(l),loading:s,fixedHeader:!0,headBg:"none",noData:a!=null&&a.address?(t==null?void 0:t.length)==0?n.jsx(at,{type:"nodata",text:"No settled balance",noBorder:!0,bg:"none"}):void 0:n.jsx(at,{type:"nowallet",noBorder:!0,bg:"none",onboard:()=>r(!0)})})}const In=i=>[{title:n.jsx(U,{color:"primary_gray",fontSize:"12px",pt:"8px",fontWeight:"500",children:"Market"}),key:"#",thConfig:{w:"60%"},render:(e,t)=>n.jsx(H,{h:"32px",children:n.jsx(zt,{poolInfo:{displayTokenA:e==null?void 0:e.baseAssets,displayTokenB:e==null?void 0:e.quoteAssets,poolAddress:e==null?void 0:e.address},imgStyle:{w:"24px",h:"24px"},showFee:!1,coinPairInfoWrapStyle:{p:"0px"}})})},{title:n.jsx(U,{color:"primary_gray",fontSize:"12px",pt:"8px",fontWeight:"500",textAlign:"right",children:"Tokens"}),key:"tokens",thConfig:{w:"10%"},render:e=>{var t,s;return n.jsxs(H,{w:"100%",justify:"flex-end",children:[n.jsxs(U,{color:"text_caption",children:[de(e==null?void 0:e.baseSettle)," ",(t=e==null?void 0:e.baseAssets)==null?void 0:t.symbol]}),n.jsx(U,{color:"text_caption",fontSize:"12px",children:"|"}),n.jsxs(U,{color:"text_caption",children:[de(e==null?void 0:e.quoteSettle)," ",(s=e==null?void 0:e.quoteAssets)==null?void 0:s.symbol]})]})}},{title:n.jsx(U,{color:"primary_gray",fontSize:"12px",pt:"8px",fontWeight:"500",children:"Action"}),key:"action",thConfig:{w:"10%"},render:e=>n.jsx(H,{w:"100%",justify:"flex-end",children:n.jsx(Fe,{w:"80px",h:"24px",borderRadius:"8px",fontSize:"12px",variant:"ghost",borderColor:"transparent !important",isDisabled:!e.canClaim,onClick:()=>i(e),children:"Claim"})})}];function jn(){const{deepBookOrderHistory:i,deepBookOrderHistoryLoading:e,currentDeepBookPool:t,isCheckedAllMarkets:s,deepBookPools:o,setShowDeepBookOrderHistoryNum:a}=Q(),{currentAccount:r,onWalletModal:l}=ge(),[d,c]=p.useState(""),h=p.useMemo(()=>s?i:i==null?void 0:i.filter(f=>f.poolId==(t==null?void 0:t.address)),[i,t,s]),u=p.useMemo(()=>h.filter(f=>d?d.split(",").includes(f.side):!0),[h,d]);return p.useEffect(()=>{a(u==null?void 0:u.length)},[u==null?void 0:u.length]),n.jsx(Ht,{dataSource:u,columns:Bn(d,c),loading:e,headBg:"bg_secondary",tableContainerWrapStyle:{h:"100%"},noData:r!=null&&r.address?(u==null?void 0:u.length)==0?n.jsx(at,{type:"nodata",text:"No trade history",noBorder:!0,bg:"none"}):void 0:n.jsx(at,{type:"nowallet",noBorder:!0,bg:"none",onboard:()=>l(!0)})})}const Bn=(i,e)=>{const{getExplorerUrl:t}=js();return[{title:n.jsx(U,{color:"primary_gray",fontSize:"12px",pt:"8px",fontWeight:"500",children:"Market"}),key:"#",thConfig:{w:"30%"},render:(s,o)=>n.jsx(H,{children:n.jsx(zt,{poolInfo:{displayTokenA:s==null?void 0:s.baseAssets,displayTokenB:s==null?void 0:s.quoteAssets,poolAddress:s==null?void 0:s.poolId},imgStyle:{w:"24px",h:"24px"},showFee:!1,coinPairInfoWrapStyle:{p:"0px"}})})},{title:n.jsx(H,{justifyContent:"flex-end",pt:"8px",height:"24px",fontWeight:"500",children:n.jsx(Gs,{type:i,setType:e,filterList:["Buy","Sell"],labelText:"Side"})}),key:"side",thConfig:{w:"18%",textAlign:"right"},render:s=>{var l,d,c;const o={Buy:{color:"primary_green",bg:"primary_green_opacity.10"},Sell:{color:"primary_red",bg:"primary_red_opacity.10"}},{color:a,bg:r}=o[s==null?void 0:s.side];return n.jsx(H,{w:"100%",justify:"flex-end",children:n.jsx(U,{fontSize:"12px",color:a,bg:r,h:"20px",p:"0 8px",borderRadius:"4px",lineHeight:"20px",children:((d=(l=s==null?void 0:s.side)==null?void 0:l[0])==null?void 0:d.toUpperCase())+((c=s==null?void 0:s.side)==null?void 0:c.slice(1))})})}},{title:n.jsx(U,{color:"primary_gray",fontSize:"12px",pt:"8px",fontWeight:"500",children:"Order Price"}),key:"orderPrice",thConfig:{w:"18%",textAlign:"right"},render:s=>n.jsx(U,{w:"100%",textAlign:"right",color:"text_caption",children:de(s==null?void 0:s.price)})},{title:n.jsx(U,{color:"primary_gray",fontSize:"12px",pt:"8px",fontWeight:"500",children:"Qty"}),key:"filled",thConfig:{w:"18%",textAlign:"right"},render:s=>n.jsx(K,{w:"100%",justify:"flex-end",gap:"0px",children:n.jsx(H,{w:"100%",justify:"flex-end",gap:"4px",children:n.jsx(U,{color:"text_caption",children:de(s==null?void 0:s.total)})})})},{title:n.jsx(U,{color:"primary_gray",fontSize:"12px",pt:"8px",fontWeight:"500",children:"Txns"}),key:"action",thConfig:{w:"18%"},render:s=>n.jsxs(H,{w:"100%",justify:"flex-end",gap:"4px",onClick:()=>{window.open(t(s==null?void 0:s.tx,"tx"),"_blank")},_hover:{cursor:"pointer",svg:{fill:"primary"},"&>p":{color:"primary",textDecoration:"underline"}},children:[n.jsx(U,{children:Bs(s==null?void 0:s.tx)}),n.jsx(Ne,{xlinkHref:"#icon-icon_link1",fontSize:"16px"})]})}]},ei=({isShowAllMarkets:i,isCheckedAllMarkets:e,setIsCheckedAllMarkets:t,isShowCancelAll:s,cancelAllOrder:o,wrapStyle:a})=>(ze(),n.jsxs(H,{gap:"12px",w:{base:"100%",lg:"auto"},...a,children:[i&&n.jsxs(H,{_hover:{cursor:"pointer",_sx:{"& > p":{color:"text_caption"}}},children:[n.jsx(U,{whiteSpace:"nowrap",fontSize:"12px",children:"All Markets"}),n.jsx(wi,{isChecked:e,onChange:()=>t(!e)})]}),s&&n.jsx(U,{whiteSpace:"nowrap",fontSize:"12px",_hover:{cursor:"pointer",color:"text_caption"},onClick:()=>o(),children:"Cancel All"})]})),Wn=({tabList:i,currentTab:e,setCurrentTab:t,isCheckedAllMarkets:s,setIsCheckedAllMarkets:o,isShowCancelAll:a,cancelAllOrder:r,isShowAllMarkets:l})=>{const{isApp:d}=ze();return n.jsx(H,{p:"0 16px",overflow:"auto",children:n.jsxs(H,{borderBottom:"1px solid",borderColor:"border",minW:{base:"440px",lg:"auto"},w:"100%",children:[n.jsx(ot,{type:"borderTab",tabList:i,currentTab:e,handleChangeTab:c=>t(c==null?void 0:c.label),wrapStyle:{w:"100%",h:"44px",border:"none",gap:"40px"},itemStyle:{h:"100%",borderRadius:"4px",gap:"4px",justifyContent:"center",alignItems:"center",fontSize:"14px",fontWeight:"500",whiteSpace:"nowrap"},selectTabItemTextStyle:{color:"primary_gray"}}),!d&&n.jsx(ei,{isShowAllMarkets:l,isCheckedAllMarkets:s,setIsCheckedAllMarkets:o,isShowCancelAll:a,cancelAllOrder:r})]})})};function ti(){const{isCheckedAllMarkets:i,setIsCheckedAllMarkets:e,deepBookOpenOrders:t,deepBookPools:s,deepBookOrderHistory:o,currentDeepBookPool:a,orderListLoading:r,deepBookOrderHistoryLoading:l,showOpenOrdersNum:d,showDeepBookOrderHistoryNum:c}=Q(),{cancelAllOrder:h}=cs(),{currentAccount:u}=ge(),[f,b]=p.useState("Open Orders"),{isApp:g}=ze(),y=p.useMemo(()=>[{label:"Open Orders",num:d>0&&(u!=null&&u.address)&&!r?d:void 0},{label:"Trade History",num:c>0&&(u!=null&&u.address)&&!l?c:void 0},{label:"Settled Balance",tooltip:"Settled balance will be claimed automatically to your free balance if you conduct new actions in the same pool. Or you could manually claim it from here.",afterIcon:{xlinkHref:"#icon-icon_tips",fontSize:"20px"},tooltipPlacement:"top"}],[u==null?void 0:u.address,f,r,l,d,c]);return n.jsxs(ns,{p:"0px",h:"100%",borderRadius:"8px",border:"none",children:[n.jsx(Wn,{tabList:y,currentTab:f,setCurrentTab:b,isCheckedAllMarkets:i,setIsCheckedAllMarkets:e,isShowCancelAll:f=="Open Orders"&&(t==null?void 0:t.length)>0,isShowAllMarkets:f!=="Settled Balance",cancelAllOrder:h}),g&&n.jsx(ei,{isShowAllMarkets:f!=="Settled Balance",isCheckedAllMarkets:i,setIsCheckedAllMarkets:e,isShowCancelAll:f=="Open Orders"&&(t==null?void 0:t.length)>0,cancelAllOrder:h,wrapStyle:{p:"8px 16px 0px",justifyContent:"space-between"}}),n.jsxs(K,{w:"100%",h:{base:"180px",lg:"calc(100% - 44px)"},children:[f=="Open Orders"&&n.jsx(Sn,{}),f=="Trade History"&&n.jsx(jn,{}),f=="Settled Balance"&&n.jsx(Dn,{})]})]})}function Un({currentDeepBookPool:i,deepBookPools:e,currentAccount:t,currentBalanceManagerInfo:s}){const[o,a]=p.useState({label:"Chart",value:"chart"}),[r,l]=p.useState(!0),[d,c]=p.useState({label:"Markets",value:"Markets"}),h=[{label:"Chart",value:"chart"},{label:"Orderbook",value:"orderBook"}],u=[{label:"Markets",value:"Markets"},{label:"Trade",value:"trade"},{label:"Account",value:"account"}],f=b=>{a(b)};return n.jsxs(K,{w:"100%",paddingBottom:"68px",children:[n.jsx(Zs,{isOpenCard:r,setIsOpenCard:l}),d.value==="Markets"&&n.jsxs(K,{bg:"bg_secondary",w:"100%",h:"516px",gap:"0",children:[n.jsx(H,{padding:"16px",w:"100%",children:n.jsx(ot,{type:"outlineTab",tabList:h,currentTab:o==null?void 0:o.label,handleChangeTab:f,wrapStyle:{w:"100%",h:"40px",p:"4px",borderRadius:"8px"},itemStyle:{flex:{lg:"1",base:"auto"},fontSize:"14px",margin:"0px",borderRadius:"4px"}})}),o.value==="chart"&&n.jsx($s,{currentDeepBookPool:i}),o.value==="orderBook"&&n.jsx(Js,{isOpenCard:r})]}),d.value==="trade"&&n.jsxs(n.Fragment,{children:[n.jsx(Ks,{}),n.jsx(ti,{})]}),d.value==="account"&&n.jsx(Vs,{}),n.jsx(Qt,{}),n.jsx(ot,{type:"borderTab",tabList:u,currentTab:d==null?void 0:d.label,handleChangeTab:c,wrapStyle:{w:"100%",h:"60px",minH:"60px",borderRadius:"0px",bg:"bg_secondary",border:"none",position:"fixed",bottom:"0px",left:"0px",zIndex:"1000"},itemStyle:{flex:{lg:"1",base:"auto"},fontSize:"14px",margin:"0px",borderRadius:"4px"}})]})}var Fn=Object.defineProperty,Hn=(i,e,t)=>e in i?Fn(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,_=(i,e,t)=>Hn(i,typeof e!="symbol"?e+"":e,t);const pt=class Ot{constructor(e){_(this,"_name"),this._name=e}static flip(e){return e===Ot.HORZ?Ot.VERT:Ot.HORZ}getName(){return this._name}toString(){return this._name}};_(pt,"HORZ",new pt("horz"));_(pt,"VERT",new pt("vert"));let J=pt;class q{constructor(e,t,s,o){_(this,"x"),_(this,"y"),_(this,"width"),_(this,"height"),this.x=e,this.y=t,this.width=s,this.height=o}static empty(){return new q(0,0,0,0)}static fromJson(e){return new q(e.x,e.y,e.width,e.height)}toJson(){return{x:this.x,y:this.y,width:this.width,height:this.height}}snap(e){this.x=Math.round(this.x/e)*e,this.y=Math.round(this.y/e)*e,this.width=Math.round(this.width/e)*e,this.height=Math.round(this.height/e)*e}static getBoundingClientRect(e){const{x:t,y:s,width:o,height:a}=e.getBoundingClientRect();return new q(t,s,o,a)}static getContentRect(e){const t=e.getBoundingClientRect(),s=window.getComputedStyle(e),o=parseFloat(s.paddingLeft),a=parseFloat(s.paddingRight),r=parseFloat(s.paddingTop),l=parseFloat(s.paddingBottom),d=parseFloat(s.borderLeftWidth),c=parseFloat(s.borderRightWidth),h=parseFloat(s.borderTopWidth),u=parseFloat(s.borderBottomWidth),f=t.width-d-o-a-c,b=t.height-h-r-l-u;return new q(t.left+d+o,t.top+h+r,f,b)}static fromDomRect(e){return new q(e.x,e.y,e.width,e.height)}relativeTo(e){return new q(this.x-e.x,this.y-e.y,this.width,this.height)}clone(){return new q(this.x,this.y,this.width,this.height)}equals(e){return this.x===(e==null?void 0:e.x)&&this.y===(e==null?void 0:e.y)&&this.width===(e==null?void 0:e.width)&&this.height===(e==null?void 0:e.height)}equalSize(e){return this.width===(e==null?void 0:e.width)&&this.height===(e==null?void 0:e.height)}getBottom(){return this.y+this.height}getRight(){return this.x+this.width}get bottom(){return this.y+this.height}get right(){return this.x+this.width}getCenter(){return{x:this.x+this.width/2,y:this.y+this.height/2}}positionElement(e,t){this.styleWithPosition(e.style,t)}styleWithPosition(e,t="absolute"){return e.left=this.x+"px",e.top=this.y+"px",e.width=Math.max(0,this.width)+"px",e.height=Math.max(0,this.height)+"px",e.position=t,e}contains(e,t){return this.x<=e&&e<=this.getRight()&&this.y<=t&&t<=this.getBottom()}removeInsets(e){return new q(this.x+e.left,this.y+e.top,Math.max(0,this.width-e.left-e.right),Math.max(0,this.height-e.top-e.bottom))}centerInRect(e){this.x=(e.width-this.width)/2,this.y=(e.height-this.height)/2}_getSize(e){let t=this.width;return e===J.VERT&&(t=this.height),t}toString(){return"(Rect: x="+this.x+", y="+this.y+", width="+this.width+", height="+this.height+")"}}const Me=class ue{constructor(e,t,s){_(this,"name"),_(this,"orientation"),_(this,"indexPlus"),this.name=e,this.orientation=t,this.indexPlus=s,ue.values.set(this.name,this)}static getByName(e){return ue.values.get(e)}static getLocation(e,t,s){if(t=(t-e.x)/e.width,s=(s-e.y)/e.height,t>=.25&&t<.75&&s>=.25&&s<.75)return ue.CENTER;const o=s>=t,a=s>=1-t;return o?a?ue.BOTTOM:ue.LEFT:a?ue.RIGHT:ue.TOP}getName(){return this.name}getOrientation(){return this.orientation}getDockRect(e){return this===ue.TOP?new q(e.x,e.y,e.width,e.height/2):this===ue.BOTTOM?new q(e.x,e.getBottom()-e.height/2,e.width,e.height/2):this===ue.LEFT?new q(e.x,e.y,e.width/2,e.height):this===ue.RIGHT?new q(e.getRight()-e.width/2,e.y,e.width/2,e.height):e.clone()}split(e,t){if(this===ue.TOP){const s=new q(e.x,e.y,e.width,t),o=new q(e.x,e.y+t,e.width,e.height-t);return{start:s,end:o}}else if(this===ue.LEFT){const s=new q(e.x,e.y,t,e.height),o=new q(e.x+t,e.y,e.width-t,e.height);return{start:s,end:o}}if(this===ue.RIGHT){const s=new q(e.getRight()-t,e.y,t,e.height),o=new q(e.x,e.y,e.width-t,e.height);return{start:s,end:o}}else{const s=new q(e.x,e.getBottom()-t,e.width,t),o=new q(e.x,e.y,e.width,e.height-t);return{start:s,end:o}}}reflect(){return this===ue.TOP?ue.BOTTOM:this===ue.LEFT?ue.RIGHT:this===ue.RIGHT?ue.LEFT:ue.TOP}toString(){return"(DockLocation: name="+this.name+", orientation="+this.orientation+")"}};_(Me,"values",new Map);_(Me,"TOP",new Me("top",J.VERT,0));_(Me,"BOTTOM",new Me("bottom",J.VERT,1));_(Me,"LEFT",new Me("left",J.HORZ,0));_(Me,"RIGHT",new Me("right",J.HORZ,1));_(Me,"CENTER",new Me("center",J.VERT,0));let Y=Me;var Oe=(i=>(i.Close_Tab="Close",i.Close_Tabset="Close tab set",i.Active_Tabset="Active tab set",i.Move_Tabset="Move tab set",i.Move_Tabs="Move tabs(?)",i.Maximize="Maximize tab set",i.Restore="Restore tab set",i.Popout_Tab="Popout selected tab",i.Overflow_Menu_Tooltip="Hidden tabs",i.Error_rendering_component="Error rendering component",i.Error_rendering_component_retry="Retry",i))(Oe||{}),L=(i=>(i.FLEXLAYOUT__BORDER="flexlayout__border",i.FLEXLAYOUT__BORDER_="flexlayout__border_",i.FLEXLAYOUT__BORDER_TAB_CONTENTS="flexlayout__border_tab_contents",i.FLEXLAYOUT__BORDER_BUTTON="flexlayout__border_button",i.FLEXLAYOUT__BORDER_BUTTON_="flexlayout__border_button_",i.FLEXLAYOUT__BORDER_BUTTON_CONTENT="flexlayout__border_button_content",i.FLEXLAYOUT__BORDER_BUTTON_LEADING="flexlayout__border_button_leading",i.FLEXLAYOUT__BORDER_BUTTON_TRAILING="flexlayout__border_button_trailing",i.FLEXLAYOUT__BORDER_BUTTON__SELECTED="flexlayout__border_button--selected",i.FLEXLAYOUT__BORDER_BUTTON__UNSELECTED="flexlayout__border_button--unselected",i.FLEXLAYOUT__BORDER_TOOLBAR_BUTTON_OVERFLOW="flexlayout__border_toolbar_button_overflow",i.FLEXLAYOUT__BORDER_TOOLBAR_BUTTON_OVERFLOW_="flexlayout__border_toolbar_button_overflow_",i.FLEXLAYOUT__BORDER_INNER="flexlayout__border_inner",i.FLEXLAYOUT__BORDER_INNER_="flexlayout__border_inner_",i.FLEXLAYOUT__BORDER_INNER_TAB_CONTAINER="flexlayout__border_inner_tab_container",i.FLEXLAYOUT__BORDER_INNER_TAB_CONTAINER_="flexlayout__border_inner_tab_container_",i.FLEXLAYOUT__BORDER_TAB_DIVIDER="flexlayout__border_tab_divider",i.FLEXLAYOUT__BORDER_LEADING="flexlayout__border_leading",i.FLEXLAYOUT__BORDER_SIZER="flexlayout__border_sizer",i.FLEXLAYOUT__BORDER_TOOLBAR="flexlayout__border_toolbar",i.FLEXLAYOUT__BORDER_TOOLBAR_="flexlayout__border_toolbar_",i.FLEXLAYOUT__BORDER_TOOLBAR_BUTTON="flexlayout__border_toolbar_button",i.FLEXLAYOUT__BORDER_TOOLBAR_BUTTON_FLOAT="flexlayout__border_toolbar_button-float",i.FLEXLAYOUT__DRAG_RECT="flexlayout__drag_rect",i.FLEXLAYOUT__EDGE_RECT="flexlayout__edge_rect",i.FLEXLAYOUT__EDGE_RECT_TOP="flexlayout__edge_rect_top",i.FLEXLAYOUT__EDGE_RECT_LEFT="flexlayout__edge_rect_left",i.FLEXLAYOUT__EDGE_RECT_BOTTOM="flexlayout__edge_rect_bottom",i.FLEXLAYOUT__EDGE_RECT_RIGHT="flexlayout__edge_rect_right",i.FLEXLAYOUT__ERROR_BOUNDARY_CONTAINER="flexlayout__error_boundary_container",i.FLEXLAYOUT__ERROR_BOUNDARY_CONTENT="flexlayout__error_boundary_content",i.FLEXLAYOUT__FLOATING_WINDOW_CONTENT="flexlayout__floating_window_content",i.FLEXLAYOUT__LAYOUT="flexlayout__layout",i.FLEXLAYOUT__LAYOUT_MOVEABLES="flexlayout__layout_moveables",i.FLEXLAYOUT__LAYOUT_OVERLAY="flexlayout__layout_overlay",i.FLEXLAYOUT__LAYOUT_TAB_STAMPS="flexlayout__layout_tab_stamps",i.FLEXLAYOUT__LAYOUT_MAIN="flexlayout__layout_main",i.FLEXLAYOUT__LAYOUT_BORDER_CONTAINER="flexlayout__layout_border_container",i.FLEXLAYOUT__LAYOUT_BORDER_CONTAINER_INNER="flexlayout__layout_border_container_inner",i.FLEXLAYOUT__OUTLINE_RECT="flexlayout__outline_rect",i.FLEXLAYOUT__OUTLINE_RECT_EDGE="flexlayout__outline_rect_edge",i.FLEXLAYOUT__SPLITTER="flexlayout__splitter",i.FLEXLAYOUT__SPLITTER_EXTRA="flexlayout__splitter_extra",i.FLEXLAYOUT__SPLITTER_="flexlayout__splitter_",i.FLEXLAYOUT__SPLITTER_BORDER="flexlayout__splitter_border",i.FLEXLAYOUT__SPLITTER_DRAG="flexlayout__splitter_drag",i.FLEXLAYOUT__SPLITTER_HANDLE="flexlayout__splitter_handle",i.FLEXLAYOUT__SPLITTER_HANDLE_HORZ="flexlayout__splitter_handle_horz",i.FLEXLAYOUT__SPLITTER_HANDLE_VERT="flexlayout__splitter_handle_vert",i.FLEXLAYOUT__ROW="flexlayout__row",i.FLEXLAYOUT__TAB="flexlayout__tab",i.FLEXLAYOUT__TAB_POSITION="flexlayout__tab_position",i.FLEXLAYOUT__TAB_MOVEABLE="flexlayout__tab_moveable",i.FLEXLAYOUT__TAB_OVERLAY="flexlayout__tab_overlay",i.FLEXLAYOUT__TABSET="flexlayout__tabset",i.FLEXLAYOUT__TABSET_CONTAINER="flexlayout__tabset_container",i.FLEXLAYOUT__TABSET_HEADER="flexlayout__tabset_header",i.FLEXLAYOUT__TABSET_HEADER_CONTENT="flexlayout__tabset_header_content",i.FLEXLAYOUT__TABSET_MAXIMIZED="flexlayout__tabset-maximized",i.FLEXLAYOUT__TABSET_SELECTED="flexlayout__tabset-selected",i.FLEXLAYOUT__TABSET_TAB_DIVIDER="flexlayout__tabset_tab_divider",i.FLEXLAYOUT__TABSET_CONTENT="flexlayout__tabset_content",i.FLEXLAYOUT__TABSET_TABBAR_INNER="flexlayout__tabset_tabbar_inner",i.FLEXLAYOUT__TABSET_TABBAR_INNER_="flexlayout__tabset_tabbar_inner_",i.FLEXLAYOUT__TABSET_LEADING="flexlayout__tabset_leading",i.FLEXLAYOUT__TABSET_TABBAR_INNER_TAB_CONTAINER="flexlayout__tabset_tabbar_inner_tab_container",i.FLEXLAYOUT__TABSET_TABBAR_INNER_TAB_CONTAINER_="flexlayout__tabset_tabbar_inner_tab_container_",i.FLEXLAYOUT__TABSET_TABBAR_OUTER="flexlayout__tabset_tabbar_outer",i.FLEXLAYOUT__TABSET_TABBAR_OUTER_="flexlayout__tabset_tabbar_outer_",i.FLEXLAYOUT__TAB_BORDER="flexlayout__tab_border",i.FLEXLAYOUT__TAB_BORDER_="flexlayout__tab_border_",i.FLEXLAYOUT__TAB_BUTTON="flexlayout__tab_button",i.FLEXLAYOUT__TAB_BUTTON_STRETCH="flexlayout__tab_button_stretch",i.FLEXLAYOUT__TAB_BUTTON_CONTENT="flexlayout__tab_button_content",i.FLEXLAYOUT__TAB_BUTTON_LEADING="flexlayout__tab_button_leading",i.FLEXLAYOUT__TAB_BUTTON_OVERFLOW="flexlayout__tab_button_overflow",i.FLEXLAYOUT__TAB_BUTTON_OVERFLOW_COUNT="flexlayout__tab_button_overflow_count",i.FLEXLAYOUT__TAB_BUTTON_TEXTBOX="flexlayout__tab_button_textbox",i.FLEXLAYOUT__TAB_BUTTON_TRAILING="flexlayout__tab_button_trailing",i.FLEXLAYOUT__TAB_BUTTON_STAMP="flexlayout__tab_button_stamp",i.FLEXLAYOUT__TAB_TOOLBAR="flexlayout__tab_toolbar",i.FLEXLAYOUT__TAB_TOOLBAR_BUTTON="flexlayout__tab_toolbar_button",i.FLEXLAYOUT__TAB_TOOLBAR_ICON="flexlayout__tab_toolbar_icon",i.FLEXLAYOUT__TAB_TOOLBAR_BUTTON_="flexlayout__tab_toolbar_button-",i.FLEXLAYOUT__TAB_TOOLBAR_BUTTON_FLOAT="flexlayout__tab_toolbar_button-float",i.FLEXLAYOUT__TAB_TOOLBAR_STICKY_BUTTONS_CONTAINER="flexlayout__tab_toolbar_sticky_buttons_container",i.FLEXLAYOUT__TAB_TOOLBAR_BUTTON_CLOSE="flexlayout__tab_toolbar_button-close",i.FLEXLAYOUT__POPUP_MENU_CONTAINER="flexlayout__popup_menu_container",i.FLEXLAYOUT__POPUP_MENU_ITEM="flexlayout__popup_menu_item",i.FLEXLAYOUT__POPUP_MENU_ITEM__SELECTED="flexlayout__popup_menu_item--selected",i.FLEXLAYOUT__POPUP_MENU="flexlayout__popup_menu",i.FLEXLAYOUT__MINI_SCROLLBAR="flexlayout__mini_scrollbar",i.FLEXLAYOUT__MINI_SCROLLBAR_CONTAINER="flexlayout__mini_scrollbar_container",i))(L||{});class we{constructor(e,t){_(this,"type"),_(this,"data"),this.type=e,this.data=t}}const _e=class me{static addNode(e,t,s,o,a){return new we(me.ADD_NODE,{json:e,toNode:t,location:s.getName(),index:o,select:a})}static moveNode(e,t,s,o,a){return new we(me.MOVE_NODE,{fromNode:e,toNode:t,location:s.getName(),index:o,select:a})}static deleteTab(e){return new we(me.DELETE_TAB,{node:e})}static deleteTabset(e){return new we(me.DELETE_TABSET,{node:e})}static renameTab(e,t){return new we(me.RENAME_TAB,{node:e,text:t})}static selectTab(e){return new we(me.SELECT_TAB,{tabNode:e})}static setActiveTabset(e,t){return new we(me.SET_ACTIVE_TABSET,{tabsetNode:e,windowId:t})}static adjustWeights(e,t){return new we(me.ADJUST_WEIGHTS,{nodeId:e,weights:t})}static adjustBorderSplit(e,t){return new we(me.ADJUST_BORDER_SPLIT,{node:e,pos:t})}static maximizeToggle(e,t){return new we(me.MAXIMIZE_TOGGLE,{node:e,windowId:t})}static updateModelAttributes(e){return new we(me.UPDATE_MODEL_ATTRIBUTES,{json:e})}static updateNodeAttributes(e,t){return new we(me.UPDATE_NODE_ATTRIBUTES,{node:e,json:t})}static popoutTab(e){return new we(me.POPOUT_TAB,{node:e})}static popoutTabset(e){return new we(me.POPOUT_TABSET,{node:e})}static closeWindow(e){return new we(me.CLOSE_WINDOW,{windowId:e})}static createWindow(e,t){return new we(me.CREATE_WINDOW,{layout:e,rect:t})}};_(_e,"ADD_NODE","FlexLayout_AddNode");_(_e,"MOVE_NODE","FlexLayout_MoveNode");_(_e,"DELETE_TAB","FlexLayout_DeleteTab");_(_e,"DELETE_TABSET","FlexLayout_DeleteTabset");_(_e,"RENAME_TAB","FlexLayout_RenameTab");_(_e,"SELECT_TAB","FlexLayout_SelectTab");_(_e,"SET_ACTIVE_TABSET","FlexLayout_SetActiveTabset");_(_e,"ADJUST_WEIGHTS","FlexLayout_AdjustWeights");_(_e,"ADJUST_BORDER_SPLIT","FlexLayout_AdjustBorderSplit");_(_e,"MAXIMIZE_TOGGLE","FlexLayout_MaximizeToggle");_(_e,"UPDATE_MODEL_ATTRIBUTES","FlexLayout_UpdateModelAttributes");_(_e,"UPDATE_NODE_ATTRIBUTES","FlexLayout_UpdateNodeAttributes");_(_e,"POPOUT_TAB","FlexLayout_PopoutTab");_(_e,"POPOUT_TABSET","FlexLayout_PopoutTabset");_(_e,"CLOSE_WINDOW","FlexLayout_CloseWindow");_(_e,"CREATE_WINDOW","FlexLayout_CreateWindow");let Z=_e;class j{constructor(e,t,s,o){_(this,"name"),_(this,"alias"),_(this,"modelName"),_(this,"pairedAttr"),_(this,"pairedType"),_(this,"defaultValue"),_(this,"alwaysWriteJson"),_(this,"type"),_(this,"required"),_(this,"fixed"),_(this,"description"),this.name=e,this.alias=void 0,this.modelName=t,this.defaultValue=s,this.alwaysWriteJson=o,this.required=!1,this.fixed=!1,this.type="any"}setType(e){return this.type=e,this}setAlias(e){return this.alias=e,this}setDescription(e){this.description=e}setRequired(){return this.required=!0,this}setFixed(){return this.fixed=!0,this}setpairedAttr(e){this.pairedAttr=e}setPairedType(e){this.pairedType=e}}_(j,"NUMBER","number");_(j,"STRING","string");_(j,"BOOLEAN","boolean");class xt{constructor(){_(this,"attributes"),_(this,"nameToAttribute"),this.attributes=[],this.nameToAttribute=new Map}addWithAll(e,t,s,o){const a=new j(e,t,s,o);return this.attributes.push(a),this.nameToAttribute.set(e,a),a}addInherited(e,t){return this.addWithAll(e,t,void 0,!1)}add(e,t,s){return this.addWithAll(e,void 0,t,s)}getAttributes(){return this.attributes}getModelName(e){const t=this.nameToAttribute.get(e);if(t!==void 0)return t.modelName}toJson(e,t){for(const s of this.attributes){const o=t[s.name];(s.alwaysWriteJson||o!==s.defaultValue)&&(e[s.name]=o)}}fromJson(e,t){for(const s of this.attributes){let o=e[s.name];o===void 0&&s.alias&&(o=e[s.alias]),o===void 0?t[s.name]=s.defaultValue:t[s.name]=o}}update(e,t){for(const s of this.attributes)if(Object.prototype.hasOwnProperty.call(e,s.name)){const o=e[s.name];o===void 0?delete t[s.name]:t[s.name]=o}}setDefaults(e){for(const t of this.attributes)e[t.name]=t.defaultValue}pairAttributes(e,t){for(const s of t.attributes)if(s.modelName&&this.nameToAttribute.has(s.modelName)){const o=this.nameToAttribute.get(s.modelName);o.setpairedAttr(s),s.setpairedAttr(o),o.setPairedType(e)}}toTypescriptInterface(e,t){var s,o;const a=[],r=this.attributes.sort((l,d)=>l.name.localeCompare(d.name));a.push("export interface I"+e+"Attributes {");for(let l=0;l<r.length;l++){const d=r[l];let c=d.type,h,u=d,f;u.defaultValue!==void 0?h=u.defaultValue:u.modelName!==void 0&&t!==void 0&&t.nameToAttribute.get(u.modelName)!==void 0&&(f=u.modelName,u=t.nameToAttribute.get(f),h=u.defaultValue,c=u.type);const b=JSON.stringify(h),g=u.required?"":"?";let y=`	/**
	  `;d.description?y+=d.description:d.pairedType&&((s=d.pairedAttr)!=null&&s.description)&&(y+=`Value for ${d.pairedType} attribute ${d.pairedAttr.name} if not overridden`,y+=`

	  `,y+=(o=d.pairedAttr)==null?void 0:o.description),y+=`

	  `,d.fixed?y+=`Fixed value: ${b}`:f?y+=`Default: inherited from Global attribute ${d.modelName} (default ${b})`:y+=`Default: ${b}`,y+=`
	 */`,a.push(y),a.push("	"+d.name+g+": "+c+`;
`)}return a.push("}"),a.join(`
`)}}class ve{constructor(e,t,s,o,a){_(this,"node"),_(this,"rect"),_(this,"location"),_(this,"index"),_(this,"className"),this.node=e,this.rect=t,this.location=s,this.index=o,this.className=a}}class vt{constructor(e){_(this,"borders"),_(this,"borderMap"),_(this,"layoutHorizontal"),this.borders=[],this.borderMap=new Map,this.layoutHorizontal=!0}static fromJson(e,t){const s=new vt(t);s.borders=e.map(o=>Re.fromJson(o,t));for(const o of s.borders)s.borderMap.set(o.getLocation(),o);return s}toJson(){return this.borders.map(e=>e.toJson())}getLayoutHorizontal(){return this.layoutHorizontal}getBorders(){return this.borders}getBorderMap(){return this.borderMap}forEachNode(e){for(const t of this.borders){e(t,0);for(const s of t.getChildren())s.forEachNode(e,1)}}setPaths(){for(const e of this.borders){const t="/border/"+e.getLocation().getName();e.setPath(t);let s=0;for(const o of e.getChildren())o.setPath(t+"/t"+s),s++}}findDropTargetNode(e,t,s){for(const o of this.borders)if(o.isShowing()){const a=o.canDrop(e,t,s);if(a!==void 0)return a}}}class Yt{constructor(e){_(this,"model"),_(this,"attributes"),_(this,"parent"),_(this,"children"),_(this,"rect"),_(this,"path"),_(this,"listeners"),this.model=e,this.attributes={},this.children=[],this.rect=q.empty(),this.listeners=new Map,this.path=""}getId(){let e=this.attributes.id;return e!==void 0||(e=this.model.nextUniqueId(),this.setId(e)),e}getModel(){return this.model}getType(){return this.attributes.type}getParent(){return this.parent}getChildren(){return this.children}getRect(){return this.rect}getPath(){return this.path}getOrientation(){return this.parent===void 0?this.model.isRootOrientationVertical()?J.VERT:J.HORZ:J.flip(this.parent.getOrientation())}setEventListener(e,t){this.listeners.set(e,t)}removeEventListener(e){this.listeners.delete(e)}setId(e){this.attributes.id=e}fireEvent(e,t){this.listeners.has(e)&&this.listeners.get(e)(t)}getAttr(e){let t=this.attributes[e];if(t===void 0){const s=this.getAttributeDefinitions().getModelName(e);s!==void 0&&(t=this.model.getAttribute(s))}return t}forEachNode(e,t){e(this,t),t++;for(const s of this.children)s.forEachNode(e,t)}setPaths(e){let t=0;for(const s of this.children){let o=e;s.getType()==="row"?o+="/r"+t:s.getType()==="tabset"?o+="/ts"+t:s.getType()==="tab"&&(o+="/t"+t),s.path=o,s.setPaths(o),t++}}setParent(e){this.parent=e}setRect(e){this.rect=e}setPath(e){this.path=e}setWeight(e){this.attributes.weight=e}setSelected(e){this.attributes.selected=e}findDropTargetNode(e,t,s,o){let a;if(this.rect.contains(s,o)){if(this.model.getMaximizedTabset(e)!==void 0)a=this.model.getMaximizedTabset(e).canDrop(t,s,o);else if(a=this.canDrop(t,s,o),a===void 0&&this.children.length!==0){for(const r of this.children)if(a=r.findDropTargetNode(e,t,s,o),a!==void 0)break}}return a}canDrop(e,t,s){}canDockInto(e,t){if(t!=null){if(t.location===Y.CENTER&&t.node.isEnableDrop()===!1||t.location===Y.CENTER&&e.getType()==="tabset"&&e.getName()!==void 0||t.location!==Y.CENTER&&t.node.isEnableDivide()===!1)return!1;if(this.model.getOnAllowDrop())return this.model.getOnAllowDrop()(e,t)}return!0}removeChild(e){const t=this.children.indexOf(e);return t!==-1&&this.children.splice(t,1),t}addChild(e,t){return t!=null?this.children.splice(t,0,e):(this.children.push(e),t=this.children.length-1),e.parent=this,t}removeAll(){this.children=[]}styleWithPosition(e){return e==null&&(e={}),this.rect.styleWithPosition(e)}isEnableDivide(){return!0}toAttributeString(){return JSON.stringify(this.attributes,void 0,"	")}}const Rt=class Je extends Yt{constructor(e,t,s=!0){super(e),_(this,"tabRect",q.empty()),_(this,"moveableElement"),_(this,"tabStamp"),_(this,"renderedName"),_(this,"extra"),_(this,"visible"),_(this,"rendered"),_(this,"scrollTop"),_(this,"scrollLeft"),this.extra={},this.moveableElement=null,this.tabStamp=null,this.rendered=!1,this.visible=!1,Je.attributeDefinitions.fromJson(t,this.attributes),s===!0&&e.addNode(this)}static fromJson(e,t,s=!0){return new Je(t,e,s)}getName(){return this.getAttr("name")}getHelpText(){return this.getAttr("helpText")}getComponent(){return this.getAttr("component")}getWindowId(){return this.parent instanceof re?this.parent.getWindowId():Le.MAIN_WINDOW_ID}getWindow(){const e=this.model.getwindowsMap().get(this.getWindowId());if(e)return e.window}getConfig(){return this.attributes.config}getExtraData(){return this.extra}isPoppedOut(){return this.getWindowId()!==Le.MAIN_WINDOW_ID}isSelected(){return this.getParent().getSelectedNode()===this}getIcon(){return this.getAttr("icon")}isEnableClose(){return this.getAttr("enableClose")}getCloseType(){return this.getAttr("closeType")}isEnablePopout(){return this.getAttr("enablePopout")}isEnablePopoutIcon(){return this.getAttr("enablePopoutIcon")}isEnablePopoutOverlay(){return this.getAttr("enablePopoutOverlay")}isEnableDrag(){return this.getAttr("enableDrag")}isEnableRename(){return this.getAttr("enableRename")}isEnableWindowReMount(){return this.getAttr("enableWindowReMount")}getClassName(){return this.getAttr("className")}getContentClassName(){return this.getAttr("contentClassName")}getTabSetClassName(){return this.getAttr("tabsetClassName")}isEnableRenderOnDemand(){return this.getAttr("enableRenderOnDemand")}getMinWidth(){return this.getAttr("minWidth")}getMinHeight(){return this.getAttr("minHeight")}getMaxWidth(){return this.getAttr("maxWidth")}getMaxHeight(){return this.getAttr("maxHeight")}isVisible(){return this.visible}toJson(){const e={};return Je.attributeDefinitions.toJson(e,this.attributes),e}saveScrollPosition(){this.moveableElement&&(this.scrollLeft=this.moveableElement.scrollLeft,this.scrollTop=this.moveableElement.scrollTop)}restoreScrollPosition(){this.scrollTop&&requestAnimationFrame(()=>{this.moveableElement&&this.scrollTop&&(this.moveableElement.scrollTop=this.scrollTop,this.moveableElement.scrollLeft=this.scrollLeft)})}setRect(e){e.equals(this.rect)||(this.fireEvent("resize",{rect:e}),this.rect=e)}setVisible(e){e!==this.visible&&(this.visible=e,this.fireEvent("visibility",{visible:e}))}getScrollTop(){return this.scrollTop}setScrollTop(e){this.scrollTop=e}getScrollLeft(){return this.scrollLeft}setScrollLeft(e){this.scrollLeft=e}isRendered(){return this.rendered}setRendered(e){this.rendered=e}getTabRect(){return this.tabRect}setTabRect(e){this.tabRect=e}getTabStamp(){return this.tabStamp}setTabStamp(e){this.tabStamp=e}getMoveableElement(){return this.moveableElement}setMoveableElement(e){this.moveableElement=e}setRenderedName(e){this.renderedName=e}getNameForOverflowMenu(){const e=this.getAttr("altName");return e!==void 0?e:this.renderedName}setName(e){this.attributes.name=e}delete(){this.parent.remove(this),this.fireEvent("close",{})}updateAttrs(e){Je.attributeDefinitions.update(e,this.attributes)}getAttributeDefinitions(){return Je.attributeDefinitions}setBorderWidth(e){this.attributes.borderWidth=e}setBorderHeight(e){this.attributes.borderHeight=e}static getAttributeDefinitions(){return Je.attributeDefinitions}static createAttributeDefinitions(){const e=new xt;return e.add("type",Je.TYPE,!0).setType(j.STRING).setFixed(),e.add("id",void 0).setType(j.STRING).setDescription("the unique id of the tab, if left undefined a uuid will be assigned"),e.add("name","[Unnamed Tab]").setType(j.STRING).setDescription("name of tab to be displayed in the tab button"),e.add("altName",void 0).setType(j.STRING).setDescription("if there is no name specifed then this value will be used in the overflow menu"),e.add("helpText",void 0).setType(j.STRING).setDescription("An optional help text for the tab to be displayed upon tab hover."),e.add("component",void 0).setType(j.STRING).setDescription("string identifying which component to run (for factory)"),e.add("config",void 0).setType("any").setDescription("a place to hold json config for the hosted component"),e.add("tabsetClassName",void 0).setType(j.STRING).setDescription("class applied to parent tabset when this is the only tab and it is stretched to fill the tabset"),e.add("enableWindowReMount",!1).setType(j.BOOLEAN).setDescription("if enabled the tab will re-mount when popped out/in"),e.addInherited("enableClose","tabEnableClose").setType(j.BOOLEAN).setDescription("allow user to close tab via close button"),e.addInherited("closeType","tabCloseType").setType("ICloseType").setDescription("see values in ICloseType"),e.addInherited("enableDrag","tabEnableDrag").setType(j.BOOLEAN).setDescription("allow user to drag tab to new location"),e.addInherited("enableRename","tabEnableRename").setType(j.BOOLEAN).setDescription("allow user to rename tabs by double clicking"),e.addInherited("className","tabClassName").setType(j.STRING).setDescription("class applied to tab button"),e.addInherited("contentClassName","tabContentClassName").setType(j.STRING).setDescription("class applied to tab content"),e.addInherited("icon","tabIcon").setType(j.STRING).setDescription("the tab icon"),e.addInherited("enableRenderOnDemand","tabEnableRenderOnDemand").setType(j.BOOLEAN).setDescription("whether to avoid rendering component until tab is visible"),e.addInherited("enablePopout","tabEnablePopout").setType(j.BOOLEAN).setAlias("enableFloat").setDescription("enable popout (in popout capable browser)"),e.addInherited("enablePopoutIcon","tabEnablePopoutIcon").setType(j.BOOLEAN).setDescription("whether to show the popout icon in the tabset header if this tab enables popouts"),e.addInherited("enablePopoutOverlay","tabEnablePopoutOverlay").setType(j.BOOLEAN).setDescription(`if this tab will not work correctly in a popout window when the main window is backgrounded (inactive)
            then enabling this option will gray out this tab`),e.addInherited("borderWidth","tabBorderWidth").setType(j.NUMBER).setDescription("width when added to border, -1 will use border size"),e.addInherited("borderHeight","tabBorderHeight").setType(j.NUMBER).setDescription("height when added to border, -1 will use border size"),e.addInherited("minWidth","tabMinWidth").setType(j.NUMBER).setDescription("the min width of this tab"),e.addInherited("minHeight","tabMinHeight").setType(j.NUMBER).setDescription("the min height of this tab"),e.addInherited("maxWidth","tabMaxWidth").setType(j.NUMBER).setDescription("the max width of this tab"),e.addInherited("maxHeight","tabMaxHeight").setType(j.NUMBER).setDescription("the max height of this tab"),e}};_(Rt,"TYPE","tab");_(Rt,"attributeDefinitions",Rt.createAttributeDefinitions());let le=Rt;function si(){return typeof window<"u"&&window.matchMedia&&window.matchMedia("(hover: hover) and (pointer: fine)").matches}function hs(i,e,t){let s;const o=e.getName(),a=e.getName();t===void 0&&(t=0),s===void 0&&e.getIcon()!==void 0&&(t!==0?s=n.jsx("img",{style:{width:"1em",height:"1em",transform:"rotate("+t+"deg)"},src:e.getIcon(),alt:"leadingContent"}):s=n.jsx("img",{style:{width:"1em",height:"1em"},src:e.getIcon(),alt:"leadingContent"}));const l={leading:s,content:o,name:a,buttons:[]};return i.customizeTab(e,l),e.setRenderedName(l.name),l}function gt(i){let e=!1;return i.nativeEvent instanceof MouseEvent&&(i.nativeEvent.button!==0||i.ctrlKey||i.altKey||i.metaKey||i.shiftKey)&&(e=!0),e}function es(i,e){const t=[...Rs("iframe",e),...Rs("webview",e)];for(const s of t)s.style.pointerEvents=i?"auto":"none"}function Rs(i,e){return[...e.getElementsByTagName(i)]}function ii(i,e,t,s,o){e.preventDefault();const a=d=>{d.preventDefault(),t(d.clientX,d.clientY)},r=d=>{d.preventDefault(),o()},l=()=>{i.removeEventListener("pointermove",a),i.removeEventListener("pointerup",l),i.removeEventListener("pointercancel",r),s()};i.addEventListener("pointermove",a),i.addEventListener("pointerup",l),i.addEventListener("pointercancel",r)}function ni(i){if(i instanceof le)return i.isEnablePopout();if(i instanceof re){for(const e of i.getChildren())if(e.isEnablePopout()===!1)return!1;return!0}return!1}function As(i,e){const t=i.getAttribute("style"),s=e.getAttribute("style");return t===s?!1:(t?e.setAttribute("style",t):e.removeAttribute("style"),!0)}function zn(){const i=navigator.userAgent;return i.includes("Safari")&&!i.includes("Chrome")&&!i.includes("Chromium")}function At(i,e){if(i!==void 0&&(i instanceof re||i instanceof Re)){const t=i.getSelected();t!==-1&&(e===t&&i.getChildren().length>0?e>=i.getChildren().length&&i.setSelected(i.getChildren().length-1):e<t?i.setSelected(t-1):e>t||i.setSelected(-1))}}function dt(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,i=>(i^crypto.getRandomValues(new Uint8Array(1))[0]&15>>i/4).toString(16))}const Lt=class Ue extends Yt{constructor(e,t){super(e),_(this,"tabStripRect",q.empty()),_(this,"contentRect",q.empty()),_(this,"calculatedMinHeight"),_(this,"calculatedMinWidth"),_(this,"calculatedMaxHeight"),_(this,"calculatedMaxWidth"),this.calculatedMinHeight=0,this.calculatedMinWidth=0,this.calculatedMaxHeight=0,this.calculatedMaxWidth=0,Ue.attributeDefinitions.fromJson(t,this.attributes),e.addNode(this)}static fromJson(e,t,s){const o=new Ue(t,e);if(e.children!=null)for(const a of e.children){const r=le.fromJson(a,t);o.addChild(r)}return o.children.length===0&&o.setSelected(-1),e.maximized&&e.maximized===!0&&(s.maximizedTabSet=o),e.active&&e.active===!0&&(s.activeTabSet=o),o}getName(){return this.getAttr("name")}isEnableActiveIcon(){return this.getAttr("enableActiveIcon")}getSelected(){const e=this.attributes.selected;return e!==void 0?e:-1}getSelectedNode(){const e=this.getSelected();if(e!==-1)return this.children[e]}getWeight(){return this.getAttr("weight")}getAttrMinWidth(){return this.getAttr("minWidth")}getAttrMinHeight(){return this.getAttr("minHeight")}getMinWidth(){return this.calculatedMinWidth}getMinHeight(){return this.calculatedMinHeight}getMinSize(e){return e===J.HORZ?this.getMinWidth():this.getMinHeight()}getAttrMaxWidth(){return this.getAttr("maxWidth")}getAttrMaxHeight(){return this.getAttr("maxHeight")}getMaxWidth(){return this.calculatedMaxWidth}getMaxHeight(){return this.calculatedMaxHeight}getMaxSize(e){return e===J.HORZ?this.getMaxWidth():this.getMaxHeight()}getConfig(){return this.attributes.config}isMaximized(){return this.model.getMaximizedTabset(this.getWindowId())===this}isActive(){return this.model.getActiveTabset(this.getWindowId())===this}isEnableDeleteWhenEmpty(){return this.getAttr("enableDeleteWhenEmpty")}isEnableDrop(){return this.getAttr("enableDrop")}isEnableTabWrap(){return this.getAttr("enableTabWrap")}isEnableDrag(){return this.getAttr("enableDrag")}isEnableDivide(){return this.getAttr("enableDivide")}isEnableMaximize(){return this.getAttr("enableMaximize")}isEnableClose(){return this.getAttr("enableClose")}isEnableSingleTabStretch(){return this.getAttr("enableSingleTabStretch")}isEnableTabStrip(){return this.getAttr("enableTabStrip")}isAutoSelectTab(){return this.getAttr("autoSelectTab")}isEnableTabScrollbar(){return this.getAttr("enableTabScrollbar")}getClassNameTabStrip(){return this.getAttr("classNameTabStrip")}getTabLocation(){return this.getAttr("tabLocation")}toJson(){const e={};return Ue.attributeDefinitions.toJson(e,this.attributes),e.children=this.children.map(t=>t.toJson()),this.isActive()&&(e.active=!0),this.isMaximized()&&(e.maximized=!0),e}calcMinMaxSize(){this.calculatedMinHeight=this.getAttrMinHeight(),this.calculatedMinWidth=this.getAttrMinWidth(),this.calculatedMaxHeight=this.getAttrMaxHeight(),this.calculatedMaxWidth=this.getAttrMaxWidth();for(const e of this.children){const t=e;this.calculatedMinWidth=Math.max(this.calculatedMinWidth,t.getMinWidth()),this.calculatedMinHeight=Math.max(this.calculatedMinHeight,t.getMinHeight()),this.calculatedMaxWidth=Math.min(this.calculatedMaxWidth,t.getMaxWidth()),this.calculatedMaxHeight=Math.min(this.calculatedMaxHeight,t.getMaxHeight())}this.calculatedMinHeight+=this.tabStripRect.height,this.calculatedMaxHeight+=this.tabStripRect.height}canMaximize(){return this.isEnableMaximize()?this.getModel().getMaximizedTabset(this.getWindowId())===this?!0:!(this.getParent()===this.getModel().getRoot(this.getWindowId())&&this.getModel().getRoot(this.getWindowId()).getChildren().length===1):!1}setContentRect(e){this.contentRect=e}getContentRect(){return this.contentRect}setTabStripRect(e){this.tabStripRect=e}setWeight(e){this.attributes.weight=e}setSelected(e){this.attributes.selected=e}getWindowId(){return this.parent.getWindowId()}canDrop(e,t,s){let o;if(e===this){const a=Y.CENTER,r=this.tabStripRect;o=new ve(this,r,a,-1,L.FLEXLAYOUT__OUTLINE_RECT)}else{if(this.getWindowId()!==Le.MAIN_WINDOW_ID&&!ni(e))return;if(this.contentRect.contains(t,s)){let a=Y.CENTER;this.model.getMaximizedTabset(this.parent.getWindowId())===void 0&&(a=Y.getLocation(this.contentRect,t,s));const r=a.getDockRect(this.rect);o=new ve(this,r,a,-1,L.FLEXLAYOUT__OUTLINE_RECT)}else if(this.tabStripRect!=null&&this.tabStripRect.contains(t,s)){let a,r,l;if(this.children.length===0)a=this.tabStripRect.clone(),r=a.y+3,l=a.height-4,a.width=2;else{let d=this.children[0];a=d.getTabRect(),r=a.y,l=a.height;let c=this.tabStripRect.x,h=0;for(let u=0;u<this.children.length;u++){if(d=this.children[u],a=d.getTabRect(),a.y!==r&&(r=a.y,c=this.tabStripRect.x),h=a.x+a.width/2,c<=t&&t<h&&a.y<s&&s<a.getBottom()){const f=Y.CENTER,b=new q(a.x-2,a.y,3,a.height);if(this.rect.x<a.x&&a.x<this.rect.getRight()){o=new ve(this,b,f,u,L.FLEXLAYOUT__OUTLINE_RECT);break}else return}c=h}}if(o==null&&a.getRight()<this.rect.getRight()){const d=Y.CENTER,c=new q(a.getRight()-2,r,3,l);o=new ve(this,c,d,this.children.length,L.FLEXLAYOUT__OUTLINE_RECT)}}}if(e.canDockInto(e,o))return o}delete(){this.parent.removeChild(this)}remove(e){const t=this.removeChild(e);this.model.tidy(),At(this,t)}drop(e,t,s,o){const a=t;if(this===e)return;let r=e.getParent(),l=0;if(r!==void 0&&(l=r.removeChild(e),r instanceof Re&&r.getSelected()===l?r.setSelected(-1):At(r,l)),e instanceof le&&r===this&&l<s&&s>0&&s--,a===Y.CENTER){let d=s;if(d===-1&&(d=this.children.length),e instanceof le)this.addChild(e,d),(o||o!==!1&&this.isAutoSelectTab())&&this.setSelected(d);else if(e instanceof Te)e.forEachNode((c,h)=>{c instanceof le&&(this.addChild(c,d),d++)},0);else{for(let c=0;c<e.getChildren().length;c++){const h=e.getChildren()[c];this.addChild(h,d),d++}this.getSelected()===-1&&this.children.length>0&&this.setSelected(0)}this.model.setActiveTabset(this,this.parent.getWindowId())}else{let d=e;if(e instanceof le){const u=this.model.getOnCreateTabSet();d=new Ue(this.model,u?u(e):{}),d.addChild(e),r=d}else if(e instanceof Te){const u=this.getParent();if(e.getOrientation()===u.getOrientation()&&(t.getOrientation()===u.getOrientation()||t===Y.CENTER)){const f=new Te(this.model,this.getWindowId(),{});f.addChild(e),d=f}}else d=e;const c=this.parent,h=c.getChildren().indexOf(this);if(c.getOrientation()===a.orientation)d.setWeight(this.getWeight()/2),this.setWeight(this.getWeight()/2),c.addChild(d,h+a.indexPlus);else{const u=new Te(this.model,this.getWindowId(),{});u.setWeight(this.getWeight()),u.addChild(this),this.setWeight(50),d.setWeight(50),u.addChild(d,a.indexPlus),c.removeChild(this),c.addChild(u,h)}d instanceof Ue&&this.model.setActiveTabset(d,this.getWindowId())}this.model.tidy()}updateAttrs(e){Ue.attributeDefinitions.update(e,this.attributes)}getAttributeDefinitions(){return Ue.attributeDefinitions}static getAttributeDefinitions(){return Ue.attributeDefinitions}static createAttributeDefinitions(){const e=new xt;return e.add("type",Ue.TYPE,!0).setType(j.STRING).setFixed(),e.add("id",void 0).setType(j.STRING).setDescription("the unique id of the tab set, if left undefined a uuid will be assigned"),e.add("weight",100).setType(j.NUMBER).setDescription("relative weight for sizing of this tabset in parent row"),e.add("selected",0).setType(j.NUMBER).setDescription("index of selected/visible tab in tabset"),e.add("name",void 0).setType(j.STRING),e.add("config",void 0).setType("any").setDescription("a place to hold json config used in your own code"),e.addInherited("enableDeleteWhenEmpty","tabSetEnableDeleteWhenEmpty").setDescription("whether to delete this tabset when is has no tabs"),e.addInherited("enableDrop","tabSetEnableDrop").setDescription("allow user to drag tabs into this tabset"),e.addInherited("enableDrag","tabSetEnableDrag").setDescription("allow user to drag tabs out this tabset"),e.addInherited("enableDivide","tabSetEnableDivide").setDescription("allow user to drag tabs to region of this tabset, splitting into new tabset"),e.addInherited("enableMaximize","tabSetEnableMaximize").setDescription("allow user to maximize tabset to fill view via maximize button"),e.addInherited("enableClose","tabSetEnableClose").setDescription("allow user to close tabset via a close button"),e.addInherited("enableSingleTabStretch","tabSetEnableSingleTabStretch").setDescription("if the tabset has only a single tab then stretch the single tab to fill area and display in a header style"),e.addInherited("classNameTabStrip","tabSetClassNameTabStrip").setDescription("a class name to apply to the tab strip"),e.addInherited("enableTabStrip","tabSetEnableTabStrip").setDescription("enable tab strip and allow multiple tabs in this tabset"),e.addInherited("minWidth","tabSetMinWidth").setDescription("minimum width (in px) for this tabset"),e.addInherited("minHeight","tabSetMinHeight").setDescription("minimum height (in px) for this tabset"),e.addInherited("maxWidth","tabSetMaxWidth").setDescription("maximum width (in px) for this tabset"),e.addInherited("maxHeight","tabSetMaxHeight").setDescription("maximum height (in px) for this tabset"),e.addInherited("enableTabWrap","tabSetEnableTabWrap").setDescription("wrap tabs onto multiple lines"),e.addInherited("tabLocation","tabSetTabLocation").setDescription("the location of the tabs either top or bottom"),e.addInherited("autoSelectTab","tabSetAutoSelectTab").setType(j.BOOLEAN).setDescription("whether to select new/moved tabs in tabset"),e.addInherited("enableActiveIcon","tabSetEnableActiveIcon").setType(j.BOOLEAN).setDescription("whether the active icon (*) should be displayed when the tabset is active"),e.addInherited("enableTabScrollbar","tabSetEnableTabScrollbar").setType(j.BOOLEAN).setDescription("whether to show a mini scrollbar for the tabs"),e}};_(Lt,"TYPE","tabset");_(Lt,"attributeDefinitions",Lt.createAttributeDefinitions());let re=Lt;const Mt=class be extends Yt{constructor(e,t,s){super(e),_(this,"windowId"),_(this,"minHeight"),_(this,"minWidth"),_(this,"maxHeight"),_(this,"maxWidth"),this.windowId=t,this.minHeight=Ge,this.minWidth=Ge,this.maxHeight=Ve,this.maxWidth=Ve,be.attributeDefinitions.fromJson(s,this.attributes),this.normalizeWeights(),e.addNode(this)}static fromJson(e,t,s){const o=new be(t,s.windowId,e);if(e.children!=null)for(const a of e.children)if(a.type===re.TYPE){const r=re.fromJson(a,t,s);o.addChild(r)}else{const r=be.fromJson(a,t,s);o.addChild(r)}return o}getWeight(){return this.attributes.weight}toJson(){const e={};be.attributeDefinitions.toJson(e,this.attributes),e.children=[];for(const t of this.children)e.children.push(t.toJson());return e}getWindowId(){return this.windowId}setWindowId(e){this.windowId=e}setWeight(e){this.attributes.weight=e}getSplitterBounds(e){const t=this.getOrientation()===J.HORZ,s=this.getChildren(),o=this.model.getSplitterSize(),a=s[0].getRect(),r=s[s.length-1].getRect();let l=t?[a.x,r.getRight()]:[a.y,r.getBottom()];const d=t?[a.x,r.getRight()]:[a.y,r.getBottom()];for(let c=0;c<e;c++){const h=s[c];l[0]+=t?h.getMinWidth():h.getMinHeight(),d[0]+=t?h.getMaxWidth():h.getMaxHeight(),c>0&&(l[0]+=o,d[0]+=o)}for(let c=s.length-1;c>=e;c--){const h=s[c];l[1]-=(t?h.getMinWidth():h.getMinHeight())+o,d[1]-=(t?h.getMaxWidth():h.getMaxHeight())+o}return l=[Math.max(d[1],l[0]),Math.min(d[0],l[1])],l}getSplitterInitials(e){const t=this.getOrientation()===J.HORZ,s=this.getChildren(),o=this.model.getSplitterSize(),a=[];let r=0;for(let c=0;c<s.length;c++){const u=s[c].getRect(),f=t?u.width:u.height;a.push(f),r+=f}const l=s[e].getRect(),d=(t?l.x:l.y)-o;return{initialSizes:a,sum:r,startPosition:d}}calculateSplit(e,t,s,o,a){const r=this.getOrientation()===J.HORZ,l=this.getChildren(),d=l[e],c=r?d.getMaxWidth():d.getMaxHeight(),h=[...s];if(t<a){let f=a-t,b=0;h[e]+f>c?(b=h[e]+f-c,h[e]=c):h[e]+=f;for(let g=e-1;g>=0;g--){const y=l[g],T=r?y.getMinWidth():y.getMinHeight();if(h[g]-f>T){h[g]-=f;break}else f-=h[g]-T,h[g]=T}for(let g=e+1;g<l.length;g++){const y=l[g],T=r?y.getMaxWidth():y.getMaxHeight();if(h[g]+b<T){h[g]+=b;break}else b-=T-h[g],h[g]=T}}else{let f=t-a,b=0;h[e-1]+f>c?(b=h[e-1]+f-c,h[e-1]=c):h[e-1]+=f;for(let g=e;g<l.length;g++){const y=l[g],T=r?y.getMinWidth():y.getMinHeight();if(h[g]-f>T){h[g]-=f;break}else f-=h[g]-T,h[g]=T}for(let g=e-1;g>=0;g--){const y=l[g],T=r?y.getMaxWidth():y.getMaxHeight();if(h[g]+b<T){h[g]+=b;break}else b-=T-h[g],h[g]=T}}return h.map(f=>Math.max(.1,f)*100/o)}getMinSize(e){return e===J.HORZ?this.getMinWidth():this.getMinHeight()}getMinWidth(){return this.minWidth}getMinHeight(){return this.minHeight}getMaxSize(e){return e===J.HORZ?this.getMaxWidth():this.getMaxHeight()}getMaxWidth(){return this.maxWidth}getMaxHeight(){return this.maxHeight}calcMinMaxSize(){this.minHeight=Ge,this.minWidth=Ge,this.maxHeight=Ve,this.maxWidth=Ve;let e=!0;for(const t of this.children){const s=t;s.calcMinMaxSize(),this.getOrientation()===J.VERT?(this.minHeight+=s.getMinHeight(),this.maxHeight+=s.getMaxHeight(),e||(this.minHeight+=this.model.getSplitterSize(),this.maxHeight+=this.model.getSplitterSize()),this.minWidth=Math.max(this.minWidth,s.getMinWidth()),this.maxWidth=Math.min(this.maxWidth,s.getMaxWidth())):(this.minWidth+=s.getMinWidth(),this.maxWidth+=s.getMaxWidth(),e||(this.minWidth+=this.model.getSplitterSize(),this.maxWidth+=this.model.getSplitterSize()),this.minHeight=Math.max(this.minHeight,s.getMinHeight()),this.maxHeight=Math.min(this.maxHeight,s.getMaxHeight())),e=!1}}tidy(){let e=0;for(;e<this.children.length;){const t=this.children[e];if(t instanceof be){t.tidy();const s=t.getChildren();if(s.length===0)this.removeChild(t);else if(s.length===1){const o=s[0];if(this.removeChild(t),o instanceof be){let a=0;const r=o.getChildren();for(const l of r)a+=l.getWeight();for(let l=0;l<r.length;l++){const d=r[l];d.setWeight(t.getWeight()*d.getWeight()/a),this.addChild(d,e+l)}}else o.setWeight(t.getWeight()),this.addChild(o,e)}else e++}else t instanceof re&&t.getChildren().length===0&&t.isEnableDeleteWhenEmpty()?(this.removeChild(t),t===this.model.getMaximizedTabset(this.windowId)&&this.model.setMaximizedTabset(void 0,this.windowId)):e++}if(this===this.model.getRoot(this.windowId)&&this.children.length===0){const t=this.model.getOnCreateTabSet();let s=t?t():{};s={...s,selected:-1};const o=new re(this.model,s);this.model.setActiveTabset(o,this.windowId),this.addChild(o)}}canDrop(e,t,s){const o=s-this.rect.y,a=t-this.rect.x,r=this.rect.width,l=this.rect.height,d=10,c=50;let h;if(!(this.getWindowId()!==Le.MAIN_WINDOW_ID&&!ni(e))){if(this.model.isEnableEdgeDock()&&this.parent===void 0){if(t<this.rect.x+d&&o>l/2-c&&o<l/2+c){const u=Y.LEFT,f=u.getDockRect(this.rect);f.width=f.width/2,h=new ve(this,f,u,-1,L.FLEXLAYOUT__OUTLINE_RECT_EDGE)}else if(t>this.rect.getRight()-d&&o>l/2-c&&o<l/2+c){const u=Y.RIGHT,f=u.getDockRect(this.rect);f.width=f.width/2,f.x+=f.width,h=new ve(this,f,u,-1,L.FLEXLAYOUT__OUTLINE_RECT_EDGE)}else if(s<this.rect.y+d&&a>r/2-c&&a<r/2+c){const u=Y.TOP,f=u.getDockRect(this.rect);f.height=f.height/2,h=new ve(this,f,u,-1,L.FLEXLAYOUT__OUTLINE_RECT_EDGE)}else if(s>this.rect.getBottom()-d&&a>r/2-c&&a<r/2+c){const u=Y.BOTTOM,f=u.getDockRect(this.rect);f.height=f.height/2,f.y+=f.height,h=new ve(this,f,u,-1,L.FLEXLAYOUT__OUTLINE_RECT_EDGE)}if(h!==void 0&&!e.canDockInto(e,h))return}return h}}drop(e,t,s){const o=t,a=e.getParent();a&&a.removeChild(e),a!==void 0&&a instanceof re&&a.setSelected(0),a!==void 0&&a instanceof Re&&a.setSelected(-1);let r;if(e instanceof re||e instanceof be)r=e,r instanceof be&&r.getOrientation()===this.getOrientation()&&(t.getOrientation()===this.getOrientation()||t===Y.CENTER)&&(r=new be(this.model,this.windowId,{}),r.addChild(e));else{const c=this.model.getOnCreateTabSet();r=new re(this.model,c?c(e):{}),r.addChild(e)}let l=this.children.reduce((c,h)=>c+h.getWeight(),0);l===0&&(l=100),r.setWeight(l/3);const d=!this.model.isRootOrientationVertical();if(o===Y.CENTER)s===-1?this.addChild(r,this.children.length):this.addChild(r,s);else if(d&&o===Y.LEFT||!d&&o===Y.TOP)this.addChild(r,0);else if(d&&o===Y.RIGHT||!d&&o===Y.BOTTOM)this.addChild(r);else if(d&&o===Y.TOP||!d&&o===Y.LEFT){const c=new be(this.model,this.windowId,{}),h=new be(this.model,this.windowId,{});h.setWeight(75),r.setWeight(25);for(const u of this.children)h.addChild(u);this.removeAll(),c.addChild(r),c.addChild(h),this.addChild(c)}else if(d&&o===Y.BOTTOM||!d&&o===Y.RIGHT){const c=new be(this.model,this.windowId,{}),h=new be(this.model,this.windowId,{});h.setWeight(75),r.setWeight(25);for(const u of this.children)h.addChild(u);this.removeAll(),c.addChild(h),c.addChild(r),this.addChild(c)}r instanceof re&&this.model.setActiveTabset(r,this.windowId),this.model.tidy()}isEnableDrop(){return!0}getAttributeDefinitions(){return be.attributeDefinitions}updateAttrs(e){be.attributeDefinitions.update(e,this.attributes)}static getAttributeDefinitions(){return be.attributeDefinitions}normalizeWeights(){let e=0;for(const t of this.children)e+=t.getWeight();e===0&&(e=1);for(const t of this.children){const s=t;s.setWeight(Math.max(.001,100*s.getWeight()/e))}}static createAttributeDefinitions(){const e=new xt;return e.add("type",be.TYPE,!0).setType(j.STRING).setFixed(),e.add("id",void 0).setType(j.STRING).setDescription("the unique id of the row, if left undefined a uuid will be assigned"),e.add("weight",100).setType(j.NUMBER).setDescription("relative weight for sizing of this row in parent row"),e}};_(Mt,"TYPE","row");_(Mt,"attributeDefinitions",Mt.createAttributeDefinitions());let Te=Mt;class et{constructor(e,t){_(this,"_windowId"),_(this,"_layout"),_(this,"_rect"),_(this,"_window"),_(this,"_root"),_(this,"_maximizedTabSet"),_(this,"_activeTabSet"),_(this,"_toScreenRectFunction"),this._windowId=e,this._rect=t,this._toScreenRectFunction=s=>s}visitNodes(e){this.root.forEachNode(e,0)}get windowId(){return this._windowId}get rect(){return this._rect}get layout(){return this._layout}get window(){return this._window}get root(){return this._root}get maximizedTabSet(){return this._maximizedTabSet}get activeTabSet(){return this._activeTabSet}set rect(e){this._rect=e}set layout(e){this._layout=e}set window(e){this._window=e}set root(e){this._root=e}set maximizedTabSet(e){this._maximizedTabSet=e}set activeTabSet(e){this._activeTabSet=e}get toScreenRectFunction(){return this._toScreenRectFunction}set toScreenRectFunction(e){this._toScreenRectFunction=e}toJson(){return this._window&&this._window.screenTop>-1e4&&(this.rect=new q(this._window.screenLeft,this._window.screenTop,this._window.outerWidth,this._window.outerHeight)),{layout:this.root.toJson(),rect:this.rect.toJson()}}static fromJson(e,t,s){const o=t.getwindowsMap().size,a=e.rect?q.fromJson(e.rect):new q(50+50*o,50+50*o,600,400);a.snap(10);const r=new et(s,a);return r.root=Te.fromJson(e.layout,t,r),r}}const Ge=0,Ve=99999,Nt=class ie{constructor(){_(this,"attributes"),_(this,"idMap"),_(this,"changeListeners"),_(this,"borders"),_(this,"onAllowDrop"),_(this,"onCreateTabSet"),_(this,"windows"),_(this,"rootWindow"),this.attributes={},this.idMap=new Map,this.borders=new vt(this),this.windows=new Map,this.rootWindow=new et(ie.MAIN_WINDOW_ID,q.empty()),this.windows.set(ie.MAIN_WINDOW_ID,this.rootWindow),this.changeListeners=[]}doAction(e){var t;let s;switch(e.type){case Z.ADD_NODE:{const o=new le(this,e.data.json,!0),a=this.idMap.get(e.data.toNode);(a instanceof re||a instanceof Re||a instanceof Te)&&(a.drop(o,Y.getByName(e.data.location),e.data.index,e.data.select),s=o);break}case Z.MOVE_NODE:{const o=this.idMap.get(e.data.fromNode);if(o instanceof le||o instanceof re||o instanceof Te){if(o===this.getMaximizedTabset(o.getWindowId())){const r=this.windows.get(o.getWindowId());r.maximizedTabSet=void 0}const a=this.idMap.get(e.data.toNode);(a instanceof re||a instanceof Re||a instanceof Te)&&a.drop(o,Y.getByName(e.data.location),e.data.index,e.data.select)}this.removeEmptyWindows();break}case Z.DELETE_TAB:{const o=this.idMap.get(e.data.node);o instanceof le&&o.delete(),this.removeEmptyWindows();break}case Z.DELETE_TABSET:{const o=this.idMap.get(e.data.node);if(o instanceof re){const a=[...o.getChildren()];for(let r=0;r<a.length;r++){const l=a[r];l.isEnableClose()&&l.delete()}o.getChildren().length===0&&o.delete(),this.tidy()}this.removeEmptyWindows();break}case Z.POPOUT_TABSET:{const o=this.idMap.get(e.data.node);if(o instanceof re){const a=o.isMaximized(),r=this.windows.get(o.getWindowId()),l=dt(),d=new et(l,r.toScreenRectFunction(o.getRect())),c={type:"row",children:[]},h=Te.fromJson(c,this,d);d.root=h,this.windows.set(l,d),h.drop(o,Y.CENTER,0),a&&(this.rootWindow.maximizedTabSet=void 0)}this.removeEmptyWindows();break}case Z.POPOUT_TAB:{const o=this.idMap.get(e.data.node);if(o instanceof le){const a=dt();let r=q.empty();o.getParent()instanceof re?r=o.getParent().getRect():r=o.getParent().getContentRect();const l=this.windows.get(o.getWindowId()),d=new et(a,l.toScreenRectFunction(r)),c=dt(),h={type:"row",children:[{type:"tabset",id:c}]},u=Te.fromJson(h,this,d);d.root=u,this.windows.set(a,d),this.idMap.get(c).drop(o,Y.CENTER,0,!0)}this.removeEmptyWindows();break}case Z.CLOSE_WINDOW:{const o=this.windows.get(e.data.windowId);o&&((t=this.rootWindow.root)==null||t.drop(o.root,Y.CENTER,-1),this.rootWindow.visitNodes((a,r)=>{a instanceof Te&&a.setWindowId(ie.MAIN_WINDOW_ID)}),this.windows.delete(e.data.windowId));break}case Z.CREATE_WINDOW:{const o=dt(),a=new et(o,q.fromJson(e.data.rect)),r=Te.fromJson(e.data.layout,this,a);a.root=r,this.windows.set(o,a),s=o;break}case Z.RENAME_TAB:{const o=this.idMap.get(e.data.node);o instanceof le&&o.setName(e.data.text);break}case Z.SELECT_TAB:{const o=this.idMap.get(e.data.tabNode),a=e.data.windowId?e.data.windowId:ie.MAIN_WINDOW_ID,r=this.windows.get(a);if(o instanceof le){const l=o.getParent(),d=l.getChildren().indexOf(o);l instanceof Re?l.getSelected()===d?l.setSelected(-1):l.setSelected(d):l instanceof re&&(l.getSelected()!==d&&l.setSelected(d),r.activeTabSet=l)}break}case Z.SET_ACTIVE_TABSET:{const o=e.data.windowId?e.data.windowId:ie.MAIN_WINDOW_ID,a=this.windows.get(o);if(e.data.tabsetNode===void 0)a.activeTabSet=void 0;else{const r=this.idMap.get(e.data.tabsetNode);r instanceof re&&(a.activeTabSet=r)}break}case Z.ADJUST_WEIGHTS:{const a=this.idMap.get(e.data.nodeId).getChildren();for(let r=0;r<a.length;r++)a[r].setWeight(e.data.weights[r]);break}case Z.ADJUST_BORDER_SPLIT:{const o=this.idMap.get(e.data.node);o instanceof Re&&o.setSize(e.data.pos);break}case Z.MAXIMIZE_TOGGLE:{const o=e.data.windowId?e.data.windowId:ie.MAIN_WINDOW_ID,a=this.windows.get(o),r=this.idMap.get(e.data.node);r instanceof re&&(r===a.maximizedTabSet?a.maximizedTabSet=void 0:(a.maximizedTabSet=r,a.activeTabSet=r));break}case Z.UPDATE_MODEL_ATTRIBUTES:{this.updateAttrs(e.data.json);break}case Z.UPDATE_NODE_ATTRIBUTES:{this.idMap.get(e.data.node).updateAttrs(e.data.json);break}}this.updateIdMap();for(const o of this.changeListeners)o(e);return s}getActiveTabset(e=ie.MAIN_WINDOW_ID){const t=this.windows.get(e);if(t&&t.activeTabSet&&this.getNodeById(t.activeTabSet.getId()))return t.activeTabSet}getMaximizedTabset(e=ie.MAIN_WINDOW_ID){return this.windows.get(e).maximizedTabSet}getRoot(e=ie.MAIN_WINDOW_ID){return this.windows.get(e).root}isRootOrientationVertical(){return this.attributes.rootOrientationVertical}isEnableRotateBorderIcons(){return this.attributes.enableRotateBorderIcons}getBorderSet(){return this.borders}getwindowsMap(){return this.windows}visitNodes(e){this.borders.forEachNode(e);for(const[t,s]of this.windows)s.root.forEachNode(e,0)}visitWindowNodes(e,t){this.windows.has(e)&&(e===ie.MAIN_WINDOW_ID&&this.borders.forEachNode(t),this.windows.get(e).visitNodes(t))}getNodeById(e){return this.idMap.get(e)}getFirstTabSet(e=this.windows.get(ie.MAIN_WINDOW_ID).root){const t=e.getChildren()[0];return t instanceof re?t:this.getFirstTabSet(t)}static fromJson(e){const t=new ie;if(ie.attributeDefinitions.fromJson(e.global,t.attributes),e.borders&&(t.borders=vt.fromJson(e.borders,t)),e.popouts)for(const s in e.popouts){const o=e.popouts[s],a=et.fromJson(o,t,s);t.windows.set(s,a)}return t.rootWindow.root=Te.fromJson(e.layout,t,t.getwindowsMap().get(ie.MAIN_WINDOW_ID)),t.tidy(),t}toJson(){const e={};ie.attributeDefinitions.toJson(e,this.attributes),this.visitNodes(s=>{s.fireEvent("save",{})});const t={};for(const[s,o]of this.windows)s!==ie.MAIN_WINDOW_ID&&(t[s]=o.toJson());return{global:e,borders:this.borders.toJson(),layout:this.rootWindow.root.toJson(),popouts:t}}getSplitterSize(){return this.attributes.splitterSize}getSplitterExtra(){return this.attributes.splitterExtra}isEnableEdgeDock(){return this.attributes.enableEdgeDock}isSplitterEnableHandle(){return this.attributes.splitterEnableHandle}setOnAllowDrop(e){this.onAllowDrop=e}setOnCreateTabSet(e){this.onCreateTabSet=e}addChangeListener(e){this.changeListeners.push(e)}removeChangeListener(e){const t=this.changeListeners.findIndex(s=>s===e);t!==-1&&this.changeListeners.splice(t,1)}toString(){return JSON.stringify(this.toJson())}removeEmptyWindows(){const e=new Set;for(const[t]of this.windows)if(t!==ie.MAIN_WINDOW_ID){let s=0;this.visitWindowNodes(t,o=>{o instanceof le&&s++}),s===0&&e.add(t)}for(const t of e)this.windows.delete(t)}setActiveTabset(e,t){const s=this.windows.get(t);s&&(e?s.activeTabSet=e:s.activeTabSet=void 0)}setMaximizedTabset(e,t){const s=this.windows.get(t);s&&(e?s.maximizedTabSet=e:s.maximizedTabSet=void 0)}updateIdMap(){this.idMap.clear(),this.visitNodes(e=>{this.idMap.set(e.getId(),e)})}addNode(e){const t=e.getId();if(this.idMap.has(t))throw new Error(`Error: each node must have a unique id, duplicate id:${e.getId()}`);this.idMap.set(t,e)}findDropTargetNode(e,t,s,o){let a=this.windows.get(e).root.findDropTargetNode(e,t,s,o);return a===void 0&&e===ie.MAIN_WINDOW_ID&&(a=this.borders.findDropTargetNode(t,s,o)),a}tidy(){for(const[e,t]of this.windows)t.root.tidy()}updateAttrs(e){ie.attributeDefinitions.update(e,this.attributes)}nextUniqueId(){return"#"+dt()}getAttribute(e){return this.attributes[e]}getOnAllowDrop(){return this.onAllowDrop}getOnCreateTabSet(){return this.onCreateTabSet}static toTypescriptInterfaces(){ie.attributeDefinitions.pairAttributes("RowNode",Te.getAttributeDefinitions()),ie.attributeDefinitions.pairAttributes("TabSetNode",re.getAttributeDefinitions()),ie.attributeDefinitions.pairAttributes("TabNode",le.getAttributeDefinitions()),ie.attributeDefinitions.pairAttributes("BorderNode",Re.getAttributeDefinitions());const e=[];e.push(ie.attributeDefinitions.toTypescriptInterface("Global",void 0)),e.push(Te.getAttributeDefinitions().toTypescriptInterface("Row",ie.attributeDefinitions)),e.push(re.getAttributeDefinitions().toTypescriptInterface("TabSet",ie.attributeDefinitions)),e.push(le.getAttributeDefinitions().toTypescriptInterface("Tab",ie.attributeDefinitions)),e.push(Re.getAttributeDefinitions().toTypescriptInterface("Border",ie.attributeDefinitions)),console.log(e.join(`
`))}static createAttributeDefinitions(){const e=new xt;return e.add("enableEdgeDock",!0).setType(j.BOOLEAN).setDescription("enable docking to the edges of the layout, this will show the edge indicators"),e.add("rootOrientationVertical",!1).setType(j.BOOLEAN).setDescription("the top level 'row' will layout horizontally by default, set this option true to make it layout vertically"),e.add("enableRotateBorderIcons",!0).setType(j.BOOLEAN).setDescription("boolean indicating if tab icons should rotate with the text in the left and right borders"),e.add("splitterSize",8).setType(j.NUMBER).setDescription("width in pixels of all splitters between tabsets/borders"),e.add("splitterExtra",0).setType(j.NUMBER).setDescription("additional width in pixels of the splitter hit test area"),e.add("splitterEnableHandle",!1).setType(j.BOOLEAN).setDescription("enable a small centralized handle on all splitters"),e.add("tabEnableClose",!0).setType(j.BOOLEAN),e.add("tabCloseType",1).setType("ICloseType"),e.add("tabEnablePopout",!1).setType(j.BOOLEAN).setAlias("tabEnableFloat"),e.add("tabEnablePopoutIcon",!0).setType(j.BOOLEAN),e.add("tabEnablePopoutOverlay",!1).setType(j.BOOLEAN),e.add("tabEnableDrag",!0).setType(j.BOOLEAN),e.add("tabEnableRename",!0).setType(j.BOOLEAN),e.add("tabContentClassName",void 0).setType(j.STRING),e.add("tabClassName",void 0).setType(j.STRING),e.add("tabIcon",void 0).setType(j.STRING),e.add("tabEnableRenderOnDemand",!0).setType(j.BOOLEAN),e.add("tabDragSpeed",.3).setType(j.NUMBER),e.add("tabBorderWidth",-1).setType(j.NUMBER),e.add("tabBorderHeight",-1).setType(j.NUMBER),e.add("tabSetEnableDeleteWhenEmpty",!0).setType(j.BOOLEAN),e.add("tabSetEnableDrop",!0).setType(j.BOOLEAN),e.add("tabSetEnableDrag",!0).setType(j.BOOLEAN),e.add("tabSetEnableDivide",!0).setType(j.BOOLEAN),e.add("tabSetEnableMaximize",!0).setType(j.BOOLEAN),e.add("tabSetEnableClose",!1).setType(j.BOOLEAN),e.add("tabSetEnableSingleTabStretch",!1).setType(j.BOOLEAN),e.add("tabSetAutoSelectTab",!0).setType(j.BOOLEAN),e.add("tabSetEnableActiveIcon",!1).setType(j.BOOLEAN),e.add("tabSetClassNameTabStrip",void 0).setType(j.STRING),e.add("tabSetEnableTabStrip",!0).setType(j.BOOLEAN),e.add("tabSetEnableTabWrap",!1).setType(j.BOOLEAN),e.add("tabSetTabLocation","top").setType("ITabLocation"),e.add("tabMinWidth",Ge).setType(j.NUMBER),e.add("tabMinHeight",Ge).setType(j.NUMBER),e.add("tabSetMinWidth",Ge).setType(j.NUMBER),e.add("tabSetMinHeight",Ge).setType(j.NUMBER),e.add("tabMaxWidth",Ve).setType(j.NUMBER),e.add("tabMaxHeight",Ve).setType(j.NUMBER),e.add("tabSetMaxWidth",Ve).setType(j.NUMBER),e.add("tabSetMaxHeight",Ve).setType(j.NUMBER),e.add("tabSetEnableTabScrollbar",!1).setType(j.BOOLEAN),e.add("borderSize",200).setType(j.NUMBER),e.add("borderMinSize",Ge).setType(j.NUMBER),e.add("borderMaxSize",Ve).setType(j.NUMBER),e.add("borderEnableDrop",!0).setType(j.BOOLEAN),e.add("borderAutoSelectTabWhenOpen",!0).setType(j.BOOLEAN),e.add("borderAutoSelectTabWhenClosed",!1).setType(j.BOOLEAN),e.add("borderClassName",void 0).setType(j.STRING),e.add("borderEnableAutoHide",!1).setType(j.BOOLEAN),e.add("borderEnableTabScrollbar",!1).setType(j.BOOLEAN),e}};_(Nt,"MAIN_WINDOW_ID","__main_window_id__");_(Nt,"attributeDefinitions",Nt.createAttributeDefinitions());let Le=Nt;const St=class Pe extends Yt{constructor(e,t,s){super(s),_(this,"contentRect",q.empty()),_(this,"tabHeaderRect",q.empty()),_(this,"location"),this.location=e,this.attributes.id=`border_${e.getName()}`,Pe.attributeDefinitions.fromJson(t,this.attributes),s.addNode(this)}static fromJson(e,t){const s=Y.getByName(e.location),o=new Pe(s,e,t);return e.children&&(o.children=e.children.map(a=>{const r=le.fromJson(a,t);return r.setParent(o),r})),o}getLocation(){return this.location}getClassName(){return this.getAttr("className")}isHorizontal(){return this.location.orientation===J.HORZ}getSize(){const e=this.getAttr("size"),t=this.getSelected();if(t===-1)return e;{const s=this.children[t],o=this.isHorizontal()?s.getAttr("borderWidth"):s.getAttr("borderHeight");return o===-1?e:o}}getMinSize(){const e=this.getSelectedNode();let t=this.getAttr("minSize");if(e){const s=this.isHorizontal()?e.getMinWidth():e.getMinHeight();t=Math.max(t,s)}return t}getMaxSize(){const e=this.getSelectedNode();let t=this.getAttr("maxSize");if(e){const s=this.isHorizontal()?e.getMaxWidth():e.getMaxHeight();t=Math.min(t,s)}return t}getSelected(){return this.attributes.selected}isAutoHide(){return this.getAttr("enableAutoHide")}getSelectedNode(){if(this.getSelected()!==-1)return this.children[this.getSelected()]}getOrientation(){return this.location.getOrientation()}getConfig(){return this.attributes.config}isMaximized(){return!1}isShowing(){return this.attributes.show}toJson(){const e={};return Pe.attributeDefinitions.toJson(e,this.attributes),e.location=this.location.getName(),e.children=this.children.map(t=>t.toJson()),e}isAutoSelectTab(e){return e==null&&(e=this.getSelected()!==-1),e?this.getAttr("autoSelectTabWhenOpen"):this.getAttr("autoSelectTabWhenClosed")}isEnableTabScrollbar(){return this.getAttr("enableTabScrollbar")}setSelected(e){this.attributes.selected=e}getTabHeaderRect(){return this.tabHeaderRect}setTabHeaderRect(e){this.tabHeaderRect=e}getRect(){return this.tabHeaderRect}getContentRect(){return this.contentRect}setContentRect(e){this.contentRect=e}isEnableDrop(){return this.getAttr("enableDrop")}setSize(e){const t=this.getSelected();if(t===-1)this.attributes.size=e;else{const s=this.children[t];(this.isHorizontal()?s.getAttr("borderWidth"):s.getAttr("borderHeight"))===-1?this.attributes.size=e:this.isHorizontal()?s.setBorderWidth(e):s.setBorderHeight(e)}}updateAttrs(e){Pe.attributeDefinitions.update(e,this.attributes)}remove(e){const t=this.removeChild(e);this.getSelected()!==-1&&At(this,t)}canDrop(e,t,s){if(!(e instanceof le))return;let o;const a=Y.CENTER;if(this.tabHeaderRect.contains(t,s)){if(this.location.orientation===J.VERT)if(this.children.length>0){let r=this.children[0],l=r.getTabRect();const d=l.y,c=l.height;let h=this.tabHeaderRect.x,u=0;for(let f=0;f<this.children.length;f++){if(r=this.children[f],l=r.getTabRect(),u=l.x+l.width/2,t>=h&&t<u){const b=new q(l.x-2,d,3,c);o=new ve(this,b,a,f,L.FLEXLAYOUT__OUTLINE_RECT);break}h=u}if(o==null){const f=new q(l.getRight()-2,d,3,c);o=new ve(this,f,a,this.children.length,L.FLEXLAYOUT__OUTLINE_RECT)}}else{const r=new q(this.tabHeaderRect.x+1,this.tabHeaderRect.y+2,3,18);o=new ve(this,r,a,0,L.FLEXLAYOUT__OUTLINE_RECT)}else if(this.children.length>0){let r=this.children[0],l=r.getTabRect();const d=l.x,c=l.width;let h=this.tabHeaderRect.y,u=0;for(let f=0;f<this.children.length;f++){if(r=this.children[f],l=r.getTabRect(),u=l.y+l.height/2,s>=h&&s<u){const b=new q(d,l.y-2,c,3);o=new ve(this,b,a,f,L.FLEXLAYOUT__OUTLINE_RECT);break}h=u}if(o==null){const f=new q(d,l.getBottom()-2,c,3);o=new ve(this,f,a,this.children.length,L.FLEXLAYOUT__OUTLINE_RECT)}}else{const r=new q(this.tabHeaderRect.x+2,this.tabHeaderRect.y+1,18,3);o=new ve(this,r,a,0,L.FLEXLAYOUT__OUTLINE_RECT)}if(!e.canDockInto(e,o))return}else if(this.getSelected()!==-1&&this.contentRect.contains(t,s)){const r=this.contentRect;if(o=new ve(this,r,a,-1,L.FLEXLAYOUT__OUTLINE_RECT),!e.canDockInto(e,o))return}return o}drop(e,t,s,o){let a=0;const r=e.getParent();r!==void 0&&(a=r.removeChild(e),r!==this&&r instanceof Pe&&r.getSelected()===a?r.setSelected(-1):At(r,a)),e instanceof le&&r===this&&a<s&&s>0&&s--;let l=s;l===-1&&(l=this.children.length),e instanceof le&&this.addChild(e,l),(o||o!==!1&&this.isAutoSelectTab())&&this.setSelected(l),this.model.tidy()}getSplitterBounds(e,t=!1){const s=[0,0],o=t?this.getMinSize():0,a=t?this.getMaxSize():99999,r=this.model.getRoot(Le.MAIN_WINDOW_ID),l=r.getRect(),d=this.model.getSplitterSize();if(this.location===Y.TOP){s[0]=this.tabHeaderRect.getBottom()+o;const c=this.tabHeaderRect.getBottom()+a;s[1]=Math.max(s[0],l.getBottom()-r.getMinHeight()-d),s[1]=Math.min(s[1],c)}else if(this.location===Y.LEFT){s[0]=this.tabHeaderRect.getRight()+o;const c=this.tabHeaderRect.getRight()+a;s[1]=Math.max(s[0],l.getRight()-r.getMinWidth()-d),s[1]=Math.min(s[1],c)}else if(this.location===Y.BOTTOM){s[1]=this.tabHeaderRect.y-o-d;const c=this.tabHeaderRect.y-a-d;s[0]=Math.min(s[1],l.y+r.getMinHeight()),s[0]=Math.max(s[0],c)}else if(this.location===Y.RIGHT){s[1]=this.tabHeaderRect.x-o-d;const c=this.tabHeaderRect.x-a-d;s[0]=Math.min(s[1],l.x+r.getMinWidth()),s[0]=Math.max(s[0],c)}return s}calculateSplit(e,t){const s=this.getSplitterBounds(t);return this.location===Y.BOTTOM||this.location===Y.RIGHT?Math.max(0,s[1]-t):Math.max(0,t-s[0])}getAttributeDefinitions(){return Pe.attributeDefinitions}static getAttributeDefinitions(){return Pe.attributeDefinitions}static createAttributeDefinitions(){const e=new xt;return e.add("type",Pe.TYPE,!0).setType(j.STRING).setFixed(),e.add("selected",-1).setType(j.NUMBER).setDescription("index of selected/visible tab in border; -1 means no tab selected"),e.add("show",!0).setType(j.BOOLEAN).setDescription("show/hide this border"),e.add("config",void 0).setType("any").setDescription("a place to hold json config used in your own code"),e.addInherited("enableDrop","borderEnableDrop").setType(j.BOOLEAN).setDescription("whether tabs can be dropped into this border"),e.addInherited("className","borderClassName").setType(j.STRING).setDescription("class applied to tab button"),e.addInherited("autoSelectTabWhenOpen","borderAutoSelectTabWhenOpen").setType(j.BOOLEAN).setDescription("whether to select new/moved tabs in border when the border is already open"),e.addInherited("autoSelectTabWhenClosed","borderAutoSelectTabWhenClosed").setType(j.BOOLEAN).setDescription("whether to select new/moved tabs in border when the border is currently closed"),e.addInherited("size","borderSize").setType(j.NUMBER).setDescription("size of the tab area when selected"),e.addInherited("minSize","borderMinSize").setType(j.NUMBER).setDescription("the minimum size of the tab area"),e.addInherited("maxSize","borderMaxSize").setType(j.NUMBER).setDescription("the maximum size of the tab area"),e.addInherited("enableAutoHide","borderEnableAutoHide").setType(j.BOOLEAN).setDescription("hide border if it has zero tabs"),e.addInherited("enableTabScrollbar","borderEnableTabScrollbar").setType(j.BOOLEAN).setDescription("whether to show a mini scrollbar for the tabs"),e}};_(St,"TYPE","border");_(St,"attributeDefinitions",St.createAttributeDefinitions());let Re=St,ht=!1;const ts=i=>{const{layout:e,node:t,index:s,horizontal:o}=i,[a,r]=p.useState(!1),l=p.useRef(null),d=p.useRef(null),c=p.useRef([]),h=p.useRef(void 0),u=p.useRef(void 0),f=p.useRef(0),b=p.useRef(0),g=p.useRef({initialSizes:[],sum:0,startPosition:0}),y=t.getModel().getSplitterSize();let T=t.getModel().getSplitterExtra();si()||(T=Math.max(20,T+y)-y),p.useEffect(()=>{var v,m;return(v=l.current)==null||v.addEventListener("touchstart",O,{passive:!1}),(m=d.current)==null||m.addEventListener("touchstart",O,{passive:!1}),()=>{var E,F;(E=l.current)==null||E.removeEventListener("touchstart",O),(F=d.current)==null||F.removeEventListener("touchstart",O)}},[]);const O=v=>{v.preventDefault(),v.stopImmediatePropagation()},N=v=>{var m;v.stopPropagation(),t instanceof Te&&(g.current=t.getSplitterInitials(s)),es(!1,e.getCurrentDocument()),ii(v.currentTarget.ownerDocument,v,w,I,R),c.current=t.getSplitterBounds(s,!0);const E=e.getRootDiv();h.current=e.getCurrentDocument().createElement("div"),h.current.style.flexDirection=o?"row":"column",h.current.className=e.getClassName(L.FLEXLAYOUT__SPLITTER_DRAG),h.current.style.cursor=t.getOrientation()===J.VERT?"ns-resize":"ew-resize",t.getModel().isSplitterEnableHandle()&&(u.current=e.getCurrentDocument().createElement("div"),u.current.className=S(L.FLEXLAYOUT__SPLITTER_HANDLE)+" "+S(o?L.FLEXLAYOUT__SPLITTER_HANDLE_HORZ:L.FLEXLAYOUT__SPLITTER_HANDLE_VERT),h.current.appendChild(u.current));const F=(m=l.current)==null?void 0:m.getBoundingClientRect(),B=new q(F.x-e.getDomRect().x,F.y-e.getDomRect().y,F.width,F.height);f.current=v.clientX-F.x,b.current=v.clientY-F.y,B.positionElement(h.current),E&&E.appendChild(h.current),r(!0),ht=!0},R=()=>{const v=e.getRootDiv();v&&h.current&&v.removeChild(h.current),h.current=void 0,r(!1),ht=!1},w=(v,m)=>{if(h.current){const E=e.getDomRect();if(!E)return;t.getOrientation()===J.VERT?h.current.style.top=W(m-E.y-b.current)+"px":h.current.style.left=W(v-E.x-f.current)+"px",e.isRealtimeResize()&&x()}},I=()=>{if(h.current){x();const v=e.getRootDiv();v&&h.current&&v.removeChild(h.current),h.current=void 0}es(!0,e.getCurrentDocument()),r(!1),ht=!1},x=v=>{(()=>{if(h.current){let E=0;if(t.getOrientation()===J.VERT?E=h.current.offsetTop:E=h.current.offsetLeft,t instanceof Re){const F=t.calculateSplit(t,E);e.doAction(Z.adjustBorderSplit(t.getId(),F))}else{const F=g.current,B=t.calculateSplit(s,E,F.initialSizes,F.sum,F.startPosition);e.doAction(Z.adjustWeights(t.getId(),B))}}})()},W=v=>{const m=c.current;let E=v;return v<m[0]&&(E=m[0]),v>m[1]&&(E=m[1]),E},S=e.getClassName,C={cursor:o?"ew-resize":"ns-resize",flexDirection:o?"column":"row"};let A=S(L.FLEXLAYOUT__SPLITTER)+" "+S(L.FLEXLAYOUT__SPLITTER_+t.getOrientation().getName());t instanceof Re?A+=" "+S(L.FLEXLAYOUT__SPLITTER_BORDER):t.getModel().getMaximizedTabset(e.getWindowId())!==void 0&&(C.display="none"),o?(C.width=y+"px",C.minWidth=y+"px"):(C.height=y+"px",C.minHeight=y+"px");let M;if(!a&&t.getModel().isSplitterEnableHandle()&&(M=n.jsx("div",{className:S(L.FLEXLAYOUT__SPLITTER_HANDLE)+" "+S(o?L.FLEXLAYOUT__SPLITTER_HANDLE_HORZ:L.FLEXLAYOUT__SPLITTER_HANDLE_VERT)})),T===0)return n.jsx("div",{className:A,style:C,ref:l,"data-layout-path":t.getPath()+"/s"+(s-1),onPointerDown:N,children:M});{const v={};t.getOrientation()===J.HORZ?(v.height="100%",v.width=y+T+"px",v.cursor="ew-resize"):(v.height=y+T+"px",v.width="100%",v.cursor="ns-resize");const m=S(L.FLEXLAYOUT__SPLITTER_EXTRA);return n.jsx("div",{className:A,style:C,ref:l,"data-layout-path":t.getPath()+"/s"+(s-1),onPointerDown:N,children:n.jsx("div",{style:v,ref:d,className:m,onPointerDown:N})})}};function kn(i){const{layout:e,border:t,show:s}=i,o=p.useRef(null),a=p.useRef(void 0);p.useLayoutEffect(()=>{const c=e.getBoundingClientRect(o.current);!isNaN(c.x)&&c.width>0&&(t.getContentRect().equals(c)||(t.setContentRect(c),ht?(a.current&&clearTimeout(a.current),a.current=setTimeout(()=>{e.redrawInternal("border content rect "+c),a.current=void 0},50)):e.redrawInternal("border content rect "+c)))});let r=!0;const l={};t.getOrientation()===J.HORZ?(l.width=t.getSize(),l.minWidth=t.getMinSize(),l.maxWidth=t.getMaxSize()):(l.height=t.getSize(),l.minHeight=t.getMinSize(),l.maxHeight=t.getMaxSize(),r=!1),l.display=s?"flex":"none";const d=e.getClassName(L.FLEXLAYOUT__BORDER_TAB_CONTENTS);return t.getLocation()===Y.LEFT||t.getLocation()===Y.TOP?n.jsxs(n.Fragment,{children:[n.jsx("div",{ref:o,style:l,className:d}),s&&n.jsx(ts,{layout:e,node:t,index:0,horizontal:r})]}):n.jsxs(n.Fragment,{children:[s&&n.jsx(ts,{layout:e,node:t,index:0,horizontal:r}),n.jsx("div",{ref:o,style:l,className:d})]})}var ft=(i=>(i[i.Visible=1]="Visible",i[i.Always=2]="Always",i[i.Selected=3]="Selected",i))(ft||{});const Yn=i=>{const{layout:e,node:t,selected:s,border:o,icons:a,path:r}=i,l=p.useRef(null),d=p.useRef(null),c=C=>{t.isEnableDrag()?(C.stopPropagation(),e.setDragNode(C.nativeEvent,t)):C.preventDefault()},h=C=>{C.stopPropagation(),e.clearDragMain()},u=C=>{gt(C)&&e.auxMouseClick(t,C)},f=C=>{e.showContextMenu(t,C)},b=()=>{e.doAction(Z.selectTab(t.getId()))},g=()=>{const C=t.getCloseType();return!!(s||C===ft.Always||C===ft.Visible&&window.matchMedia&&window.matchMedia("(hover: hover) and (pointer: fine)").matches)},y=C=>{g()&&(e.doAction(Z.deleteTab(t.getId())),C.stopPropagation())},T=C=>{C.stopPropagation()};p.useLayoutEffect(()=>{t.setTabRect(e.getBoundingClientRect(l.current)),e.getEditingTab()===t&&d.current.select()});const O=C=>{C.stopPropagation()},N=C=>{C.code==="Escape"?e.setEditingTab(void 0):(C.code==="Enter"||C.code==="NumpadEnter")&&(e.setEditingTab(void 0),e.doAction(Z.renameTab(t.getId(),C.target.value)))},R=e.getClassName;let w=R(L.FLEXLAYOUT__BORDER_BUTTON)+" "+R(L.FLEXLAYOUT__BORDER_BUTTON_+o);s?w+=" "+R(L.FLEXLAYOUT__BORDER_BUTTON__SELECTED):w+=" "+R(L.FLEXLAYOUT__BORDER_BUTTON__UNSELECTED),t.getClassName()!==void 0&&(w+=" "+t.getClassName());let I=0;t.getModel().isEnableRotateBorderIcons()===!1&&(o==="left"?I=90:o==="right"&&(I=-90));const x=hs(e,t,I);let W=x.content?n.jsx("div",{className:R(L.FLEXLAYOUT__BORDER_BUTTON_CONTENT),children:x.content}):null;const S=x.leading?n.jsx("div",{className:R(L.FLEXLAYOUT__BORDER_BUTTON_LEADING),children:x.leading}):null;if(e.getEditingTab()===t&&(W=n.jsx("input",{ref:d,className:R(L.FLEXLAYOUT__TAB_BUTTON_TEXTBOX),"data-layout-path":r+"/textbox",type:"text",autoFocus:!0,defaultValue:t.getName(),onKeyDown:N,onPointerDown:O})),t.isEnableClose()){const C=e.i18nName(Oe.Close_Tab);x.buttons.push(n.jsx("div",{"data-layout-path":r+"/button/close",title:C,className:R(L.FLEXLAYOUT__BORDER_BUTTON_TRAILING),onPointerDown:T,onClick:y,children:typeof a.close=="function"?a.close(t):a.close},"close"))}return n.jsxs("div",{ref:l,"data-layout-path":r,className:w,onClick:b,onAuxClick:u,onContextMenu:f,title:t.getHelpText(),draggable:!0,onDragStart:c,onDragEnd:h,children:[S,W,x.buttons]})},Ct=i=>{const{layout:e,node:t}=i,s=e.getClassName,o=s(L.FLEXLAYOUT__TAB_BUTTON_STAMP),a=hs(e,t),r=a.content?n.jsx("div",{className:s(L.FLEXLAYOUT__TAB_BUTTON_CONTENT),children:a.content}):t.getNameForOverflowMenu(),l=a.leading?n.jsx("div",{className:s(L.FLEXLAYOUT__TAB_BUTTON_LEADING),children:a.leading}):null;return n.jsxs("div",{className:o,title:t.getHelpText(),children:[l,r]})};function oi(i,e,t,s,o){const a=o.getRootDiv(),r=o.getClassName,l=i.ownerDocument,d=i.getBoundingClientRect(),c=(a==null?void 0:a.getBoundingClientRect())??new DOMRect(0,0,100,100),h=l.createElement("div");h.className=r(L.FLEXLAYOUT__POPUP_MENU_CONTAINER),d.left<c.left+c.width/2?h.style.left=d.left-c.left+"px":h.style.right=c.right-d.right+"px",d.top<c.top+c.height/2?h.style.top=d.top-c.top+"px":h.style.bottom=c.bottom-d.bottom+"px",o.showOverlay(!0),a&&a.appendChild(h);const u=()=>{o.hideControlInPortal(),o.showOverlay(!1),a&&a.removeChild(h),h.removeEventListener("pointerdown",f),l.removeEventListener("pointerdown",b)},f=g=>{g.stopPropagation()},b=g=>{u()};h.addEventListener("pointerdown",f),l.addEventListener("pointerdown",b),o.showControlInPortal(n.jsx(Xn,{currentDocument:l,parentNode:e,onSelect:s,onHide:u,items:t,classNameMapper:r,layout:o}),h)}const Xn=i=>{const{parentNode:e,items:t,onHide:s,onSelect:o,classNameMapper:a,layout:r}=i,l=p.useRef(null);p.useEffect(()=>{l.current&&l.current.focus()},[]);const d=(b,g)=>{o(b),s(),g.stopPropagation()},c=(b,g)=>{b.stopPropagation(),r.setDragNode(b.nativeEvent,g),setTimeout(()=>{s()},0)},h=b=>{r.clearDragMain()},u=b=>{b.key==="Escape"&&s()},f=t.map((b,g)=>{let y=a(L.FLEXLAYOUT__POPUP_MENU_ITEM);return e.getSelected()===b.index&&(y+=" "+a(L.FLEXLAYOUT__POPUP_MENU_ITEM__SELECTED)),n.jsx("div",{className:y,"data-layout-path":"/popup-menu/tb"+g,onClick:T=>d(b,T),draggable:!0,onDragStart:T=>c(T,b.node),onDragEnd:h,title:b.node.getHelpText(),children:n.jsx(Ct,{node:b.node,layout:r})},b.index)});return n.jsx("div",{className:a(L.FLEXLAYOUT__POPUP_MENU),ref:l,tabIndex:0,onKeyDown:u,"data-layout-path":"/popup-menu",children:f})},ai=(i,e,t,s,o,a)=>{const[r,l]=p.useState([]),[d,c]=p.useState(!1),[h,u]=p.useState(!1),f=p.useRef(null),b=p.useRef(!1),g=p.useRef(void 0),y=p.useRef([]),T=p.useRef(0),O=p.useRef(!1);y.current=r,p.useLayoutEffect(()=>{s.current&&ne(0)},[e.getId()]),p.useLayoutEffect(()=>{b.current=!1},[e.getSelectedNode(),e.getRect().width,e.getRect().height]),p.useLayoutEffect(()=>{M(),b.current===!1&&R(),w(),I()}),p.useEffect(()=>{var D;return(D=f.current)==null||D.addEventListener("wheel",N,{passive:!1}),()=>{var P;(P=f.current)==null||P.removeEventListener("wheel",N)}},[f.current]);const N=D=>{D.preventDefault()};function R(){const D=e.getSelectedNode();if(D&&s.current){const P=i.getBoundingClientRect(s.current),z=D.getTabRect();let G=E(P)-E(z);G>0||V(z)>V(P)?(ne(ee(s.current)-G),O.current=!0):(G=F(z)-F(P),G>0&&(ne(ee(s.current)+G),O.current=!0))}}const w=()=>{if(s.current&&o.current){const D=s.current,P=o.current,z=B(D),G=$(D),te=ee(D);if(G>z&&G>0){let oe=z*z/G,fe=0;oe<20&&(fe=20-oe,oe=20);const ce=te*(z-fe)/G;t===J.HORZ?(P.style.width=oe+"px",P.style.left=ce+"px"):(P.style.height=oe+"px",P.style.top=ce+"px"),P.style.display="block"}else P.style.display="none";t===J.HORZ?P.style.bottom="0px":P.style.right="0px"}},I=()=>{const P=v().length>0;P!==d&&c(P),g.current===void 0&&(g.current=setTimeout(()=>{const z=v();Pn(z,y.current)||l(z),g.current=void 0},100))},x=()=>{O.current||(b.current=!0),O.current=!1,w(),I()},W=D=>{var P;D.stopPropagation(),o.current.setPointerCapture(D.pointerId);const z=(P=o.current)==null?void 0:P.getBoundingClientRect();t===J.HORZ?T.current=D.clientX-z.x:T.current=D.clientY-z.y,ii(D.currentTarget.ownerDocument,D,S,C,A)},S=(D,P)=>{if(s.current&&o.current){const z=s.current,G=o.current,te=B(z),oe=$(z),fe=B(G),ce=z.getBoundingClientRect();let xe=0;if(t===J.HORZ?xe=D-ce.x-T.current:xe=P-ce.y-T.current,xe=Math.max(0,Math.min(oe-fe,xe)),te>0){const De=xe*oe/te;ne(De)}}},C=()=>{},A=()=>{},M=()=>{if(s.current){const P=s.current.firstElementChild,z=h?10:0,G=B(P)+z>B(s.current);G!==h&&u(G)}},v=()=>{const D=[];if(s.current){const P=s.current,z=P.getBoundingClientRect(),G=E(z)-1,te=F(z)+1,oe=P.firstElementChild;let fe=0;Array.from(oe.children).forEach(ce=>{const xe=ce.getBoundingClientRect();ce.classList.contains(a)&&((E(xe)<G||F(xe)>te)&&D.push(fe),fe++)})}return D},m=D=>{if(s.current){if(e.getChildren().length===0)return;let P=0;if(Math.abs(D.deltaY)>0){P=-D.deltaY,D.deltaMode===1&&(P*=40);const z=ee(s.current)-P,G=$(s.current)-B(s.current),te=Math.max(0,Math.min(G,z));ne(te),D.stopPropagation()}}},E=D=>t===J.HORZ?D.x:D.y,F=D=>t===J.HORZ?D.right:D.bottom,B=D=>t===J.HORZ?D.clientWidth:D.clientHeight,V=D=>t===J.HORZ?D.width:D.height,$=D=>t===J.HORZ?D.scrollWidth:D.scrollHeight,ne=D=>{t===J.HORZ?s.current.scrollLeft=D:s.current.scrollTop=D},ee=D=>t===J.HORZ?D.scrollLeft:D.scrollTop;return{selfRef:f,userControlledPositionRef:b,onScroll:x,onScrollPointerDown:W,hiddenTabs:r,onMouseWheel:m,isDockStickyButtons:h,isShowHiddenTabs:d}};function Pn(i,e){return i.length===e.length&&i.every((t,s)=>t===e[s])}const qn=i=>{const{border:e,layout:t,size:s}=i,o=p.useRef(null),a=p.useRef(null),r=p.useRef(null),l=p.useRef(null),d=p.useRef(null),c=t.getIcons();p.useLayoutEffect(()=>{e.setTabHeaderRect(t.getBoundingClientRect(h.current))});const{selfRef:h,userControlledPositionRef:u,onScroll:f,onScrollPointerDown:b,hiddenTabs:g,onMouseWheel:y,isDockStickyButtons:T,isShowHiddenTabs:O}=ai(t,e,J.flip(e.getOrientation()),d,a,t.getClassName(L.FLEXLAYOUT__BORDER_BUTTON)),N=z=>{gt(z)&&t.auxMouseClick(e,z)},R=z=>{t.showContextMenu(e,z)},w=z=>{z.stopPropagation()},I=z=>{const G=t.getShowOverflowMenu(),te=g.map(oe=>({index:oe,node:e.getChildren()[oe]}));if(G!==void 0)G(e,z,te,x);else{const oe=r.current;oi(oe,e,te,x,t)}z.stopPropagation()},x=z=>{t.doAction(Z.selectTab(z.node.getId())),u.current=!1},W=z=>{const G=e.getChildren()[e.getSelected()];G!==void 0&&t.doAction(Z.popoutTab(G.getId())),z.stopPropagation()},S=t.getClassName,C=[],A=z=>{const G=e.getSelected()===z,te=e.getChildren()[z];C.push(n.jsx(Yn,{layout:t,border:e.getLocation().getName(),node:te,path:e.getPath()+"/tb"+z,selected:G,icons:c},te.getId())),z<e.getChildren().length-1&&C.push(n.jsx("div",{className:S(L.FLEXLAYOUT__BORDER_TAB_DIVIDER)},"divider"+z))};for(let z=0;z<e.getChildren().length;z++)A(z);let M=S(L.FLEXLAYOUT__BORDER)+" "+S(L.FLEXLAYOUT__BORDER_+e.getLocation().getName());e.getClassName()!==void 0&&(M+=" "+e.getClassName());let v,m=[],E=[];const F={leading:v,buttons:m,stickyButtons:E,overflowPosition:void 0};if(t.customizeTabSet(e,F),v=F.leading,E=F.stickyButtons,m=F.buttons,F.overflowPosition===void 0&&(F.overflowPosition=E.length),E.length>0&&(T?m=[...E,...m]:C.push(n.jsx("div",{ref:l,onPointerDown:w,onDragStart:z=>{z.preventDefault()},className:S(L.FLEXLAYOUT__TAB_TOOLBAR_STICKY_BUTTONS_CONTAINER),children:E},"sticky_buttons_container"))),O){const z=t.i18nName(Oe.Overflow_Menu_Tooltip);let G;if(typeof c.more=="function"){const te=g.map(oe=>({index:oe,node:e.getChildren()[oe]}));G=c.more(e,te)}else G=n.jsxs(n.Fragment,{children:[c.more,n.jsx("div",{className:S(L.FLEXLAYOUT__TAB_BUTTON_OVERFLOW_COUNT),children:g.length>0?g.length:""})]});m.splice(Math.min(F.overflowPosition,m.length),0,n.jsx("button",{ref:r,className:S(L.FLEXLAYOUT__BORDER_TOOLBAR_BUTTON)+" "+S(L.FLEXLAYOUT__BORDER_TOOLBAR_BUTTON_OVERFLOW)+" "+S(L.FLEXLAYOUT__BORDER_TOOLBAR_BUTTON_OVERFLOW_+e.getLocation().getName()),title:z,onClick:I,onPointerDown:w,children:G},"overflowbutton"))}const B=e.getSelected();if(B!==-1){const z=e.getChildren()[B];if(z!==void 0&&t.isSupportsPopout()&&z.isEnablePopout()){const G=t.i18nName(Oe.Popout_Tab);m.push(n.jsx("button",{title:G,className:S(L.FLEXLAYOUT__BORDER_TOOLBAR_BUTTON)+" "+S(L.FLEXLAYOUT__BORDER_TOOLBAR_BUTTON_FLOAT),onClick:W,onPointerDown:w,children:typeof c.popout=="function"?c.popout(z):c.popout},"popout"))}}const V=n.jsx("div",{ref:o,className:S(L.FLEXLAYOUT__BORDER_TOOLBAR)+" "+S(L.FLEXLAYOUT__BORDER_TOOLBAR_+e.getLocation().getName()),children:m},"toolbar");let $={},ne={};const ee=s-1;e.getLocation()===Y.LEFT?($={right:"100%",top:0},ne={width:ee,overflowY:"auto"}):e.getLocation()===Y.RIGHT?($={left:"100%",top:0},ne={width:ee,overflowY:"auto"}):($={left:0},ne={height:ee,overflowX:"auto"});let D;e.isEnableTabScrollbar()&&(D=n.jsx("div",{ref:a,className:S(L.FLEXLAYOUT__MINI_SCROLLBAR),onPointerDown:b}));let P;return v&&(P=n.jsx("div",{className:S(L.FLEXLAYOUT__BORDER_LEADING),children:v})),n.jsxs("div",{ref:h,style:{display:"flex",flexDirection:e.getOrientation()===J.VERT?"row":"column"},className:M,"data-layout-path":e.getPath(),onClick:N,onAuxClick:N,onContextMenu:R,onWheel:y,children:[P,n.jsxs("div",{className:S(L.FLEXLAYOUT__MINI_SCROLLBAR_CONTAINER),children:[n.jsx("div",{ref:d,className:S(L.FLEXLAYOUT__BORDER_INNER)+" "+S(L.FLEXLAYOUT__BORDER_INNER_+e.getLocation().getName()),style:ne,onScroll:f,children:n.jsx("div",{style:$,className:S(L.FLEXLAYOUT__BORDER_INNER_TAB_CONTAINER)+" "+S(L.FLEXLAYOUT__BORDER_INNER_TAB_CONTAINER_+e.getLocation().getName()),children:C})}),D]}),V]})},Gn=i=>{const{layout:e,node:t}=i,s=p.useRef(null);p.useEffect(()=>{t.setTabStamp(s.current)},[t,s.current]);const o=e.getClassName,a=o(L.FLEXLAYOUT__DRAG_RECT);return n.jsx("div",{ref:s,className:a,children:n.jsx(Ct,{layout:e,node:t},t.getId())})},Vn=i=>{const{title:e,layout:t,layoutWindow:s,url:o,onCloseWindow:a,onSetWindow:r,children:l}=i,d=p.useRef(null),[c,h]=p.useState(void 0),u=new Map;return p.useLayoutEffect(()=>{if(!d.current){const f=s.windowId,b=s.rect;d.current=window.open(o,f,`left=${b.x},top=${b.y},width=${b.width},height=${b.height}`),d.current?(s.window=d.current,r(s,d.current),window.addEventListener("beforeunload",()=>{if(d.current){const g=d.current;d.current=null,g.close()}}),d.current.addEventListener("load",()=>{if(d.current){d.current.focus(),d.current.resizeTo(b.width,b.height),d.current.moveTo(b.x,b.y);const g=d.current.document;g.title=e;const y=g.createElement("div");y.className=L.FLEXLAYOUT__FLOATING_WINDOW_CONTENT,g.body.appendChild(y),Jn(g,u).then(()=>{h(y)});const T=new MutationObserver(O=>$n(O,g,u));T.observe(document.head,{childList:!0}),d.current.addEventListener("beforeunload",()=>{d.current&&(a(s),d.current=null,T.disconnect())})}})):(console.warn(`Unable to open window ${o}`),a(s))}return()=>{var f;t.getModel().getwindowsMap().has(s.windowId)||((f=d.current)==null||f.close(),d.current=null)}},[]),c!==void 0?Et.createPortal(l,c):null};function $n(i,e,t){for(const s of i)if(s.type==="childList"){for(const o of s.addedNodes)(o instanceof HTMLLinkElement||o instanceof HTMLStyleElement)&&ri(e,o,t);for(const o of s.removedNodes)if(o instanceof HTMLLinkElement||o instanceof HTMLStyleElement){const a=t.get(o);a&&e.head.removeChild(a)}}}function Jn(i,e){const t=[],s=document.querySelectorAll('style, link[rel="stylesheet"]');for(const o of s)ri(i,o,e,t);return Promise.all(t)}function ri(i,e,t,s){if(e instanceof HTMLLinkElement){const o=e.cloneNode(!0);i.head.appendChild(o),t.set(e,o),s&&s.push(new Promise(a=>{o.onload=()=>a(!0)}))}else if(e instanceof HTMLStyleElement)try{const o=e.cloneNode(!0);i.head.appendChild(o),t.set(e,o)}catch{}}const rt={width:"1em",height:"1em",display:"flex",alignItems:"center"},Ls=()=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",style:rt,viewBox:"0 0 24 24",children:[n.jsx("path",{fill:"none",d:"M0 0h24v24H0z"}),n.jsx("path",{stroke:"var(--color-icon)",fill:"var(--color-icon)",d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})]}),Zn=()=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",style:rt,viewBox:"0 0 24 24",fill:"var(--color-icon)",children:[n.jsx("path",{d:"M0 0h24v24H0z",fill:"none"}),n.jsx("path",{stroke:"var(--color-icon)",d:"M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"})]}),Kn=()=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",style:rt,viewBox:"0 0 24 24",fill:"var(--color-icon)",children:[n.jsx("path",{d:"M0 0h24v24H0z",fill:"none"}),n.jsx("path",{stroke:"var(--color-icon)",d:"M7 10l5 5 5-5z"})]}),Qn=()=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",style:{display:"block",width:10,height:10},preserveAspectRatio:"none",viewBox:"0 0 100 100",children:n.jsx("path",{fill:"var(--color-edge-icon)",stroke:"var(--color-edge-icon)",d:"M10 30 L90 30 l-40 40 Z"})}),eo=()=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",style:rt,viewBox:"0 0 20 20",fill:"var(--color-icon)",children:[n.jsx("path",{d:"M11 3a1 1 0 100 2h2.586l-6.293 6.293a1 1 0 101.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z"}),n.jsx("path",{d:"M5 5a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-3a1 1 0 10-2 0v3H5V7h3a1 1 0 000-2H5z"})]}),to=()=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",style:rt,viewBox:"0 0 24 24",fill:"var(--color-icon)",children:[n.jsx("path",{d:"M0 0h24v24H0z",fill:"none"}),n.jsx("path",{stroke:"var(--color-icon)",d:"M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"})]}),so=()=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",style:rt,height:"24px",viewBox:"0 -960 960 960",width:"24px",children:n.jsx("path",{fill:"var(--color-icon)",stroke:"var(--color-icon)",d:"M440-120v-264L254-197l-57-57 187-186H120v-80h264L197-706l57-57 186 187v-264h80v264l186-187 57 57-187 186h264v80H576l187 186-57 57-186-187v264h-80Z"})}),io=i=>{const{layout:e,show:t}=i;return n.jsx("div",{className:e.getClassName(L.FLEXLAYOUT__LAYOUT_OVERLAY),style:{display:t?"flex":"none"}})},no=i=>{const{layout:e,node:t,selected:s,path:o}=i,a=p.useRef(null),r=p.useRef(null),l=e.getIcons();p.useLayoutEffect(()=>{t.setTabRect(e.getBoundingClientRect(a.current)),e.getEditingTab()===t&&r.current.select()});const d=m=>{t.isEnableDrag()?(m.stopPropagation(),e.setDragNode(m.nativeEvent,t)):m.preventDefault()},c=m=>{e.clearDragMain()},h=m=>{gt(m)&&e.auxMouseClick(t,m)},u=m=>{e.showContextMenu(t,m)},f=()=>{e.doAction(Z.selectTab(t.getId()))},b=m=>{t.isEnableRename()&&(g(),m.stopPropagation())},g=()=>{e.setEditingTab(t),e.getCurrentDocument().body.addEventListener("pointerdown",y)},y=m=>{m.target!==r.current&&(e.getCurrentDocument().body.removeEventListener("pointerdown",y),e.setEditingTab(void 0))},T=()=>{const m=t.getCloseType();return!!(s||m===ft.Always||m===ft.Visible&&window.matchMedia&&window.matchMedia("(hover: hover) and (pointer: fine)").matches)},O=m=>{T()&&(e.doAction(Z.deleteTab(t.getId())),m.stopPropagation())},N=m=>{m.stopPropagation()},R=m=>{m.stopPropagation()},w=m=>{m.code==="Escape"?e.setEditingTab(void 0):(m.code==="Enter"||m.code==="NumpadEnter")&&(e.setEditingTab(void 0),e.doAction(Z.renameTab(t.getId(),m.target.value)))},I=e.getClassName,x=t.getParent(),W=x.isEnableSingleTabStretch()&&x.getChildren().length===1,S=W?L.FLEXLAYOUT__TAB_BUTTON_STRETCH:L.FLEXLAYOUT__TAB_BUTTON;let C=I(S);C+=" "+I(S+"_"+x.getTabLocation()),W||(s?C+=" "+I(S+"--selected"):C+=" "+I(S+"--unselected")),t.getClassName()!==void 0&&(C+=" "+t.getClassName());const A=hs(e,t);let M=A.content?n.jsx("div",{className:I(L.FLEXLAYOUT__TAB_BUTTON_CONTENT),children:A.content}):null;const v=A.leading?n.jsx("div",{className:I(L.FLEXLAYOUT__TAB_BUTTON_LEADING),children:A.leading}):null;if(e.getEditingTab()===t&&(M=n.jsx("input",{ref:r,className:I(L.FLEXLAYOUT__TAB_BUTTON_TEXTBOX),"data-layout-path":o+"/textbox",type:"text",autoFocus:!0,defaultValue:t.getName(),onKeyDown:w,onPointerDown:R})),t.isEnableClose()&&!W){const m=e.i18nName(Oe.Close_Tab);A.buttons.push(n.jsx("div",{"data-layout-path":o+"/button/close",title:m,className:I(L.FLEXLAYOUT__TAB_BUTTON_TRAILING),onPointerDown:N,onClick:O,children:typeof l.close=="function"?l.close(t):l.close},"close"))}return n.jsxs("div",{ref:a,"data-layout-path":o,className:C,onClick:f,onAuxClick:h,onContextMenu:u,title:t.getHelpText(),draggable:!0,onDragStart:d,onDragEnd:c,onDoubleClick:b,children:[v,M,A.buttons]})},oo=i=>{const{node:e,layout:t}=i,s=p.useRef(null),o=p.useRef(null),a=p.useRef(null),r=p.useRef(null),l=p.useRef(null),d=p.useRef(null),c=p.useRef(null),h=p.useRef(void 0),u=t.getIcons();p.useLayoutEffect(()=>{e.setRect(t.getBoundingClientRect(f.current)),s.current&&e.setTabStripRect(t.getBoundingClientRect(s.current));const k=t.getBoundingClientRect(r.current);!e.getContentRect().equals(k)&&!isNaN(k.x)&&(e.setContentRect(k),ht?(h.current&&clearTimeout(h.current),h.current=setTimeout(()=>{t.redrawInternal("border content rect "+k),h.current=void 0},50)):t.redrawInternal("border content rect "+k))});const{selfRef:f,userControlledPositionRef:b,onScroll:g,onScrollPointerDown:y,hiddenTabs:T,onMouseWheel:O,isDockStickyButtons:N,isShowHiddenTabs:R}=ai(t,e,J.HORZ,a,o,t.getClassName(L.FLEXLAYOUT__TAB_BUTTON)),w=k=>{const ye=t.getShowOverflowMenu(),Ye=T.map(Xe=>({index:Xe,node:e.getChildren()[Xe]}));if(ye!==void 0)ye(e,k,Ye,I);else{const Xe=d.current;oi(Xe,e,Ye,I,t)}k.stopPropagation()},I=k=>{t.doAction(Z.selectTab(k.node.getId())),b.current=!1},x=k=>{t.getEditingTab()?k.preventDefault():e.isEnableDrag()?(k.stopPropagation(),t.setDragNode(k.nativeEvent,e)):k.preventDefault()},W=k=>{gt(k)||t.doAction(Z.setActiveTabset(e.getId(),t.getWindowId()))},S=k=>{gt(k)&&t.auxMouseClick(e,k)},C=k=>{t.showContextMenu(e,k)},A=k=>{k.stopPropagation()},M=k=>{e.canMaximize()&&t.maximize(e),k.stopPropagation()},v=k=>{t.doAction(Z.deleteTabset(e.getId())),k.stopPropagation()},m=k=>{t.doAction(Z.deleteTab(e.getChildren()[0].getId())),k.stopPropagation()},E=k=>{V!==void 0&&t.doAction(Z.popoutTab(V.getId())),k.stopPropagation()},F=k=>{e.canMaximize()&&t.maximize(e)},B=t.getClassName,V=e.getSelectedNode(),$=e.getPath(),ne=[];if(e.isEnableTabStrip())for(let k=0;k<e.getChildren().length;k++){const ye=e.getChildren()[k],Ye=e.getSelected()===k;ne.push(n.jsx(no,{layout:t,node:ye,path:$+"/tb"+k,selected:Ye},ye.getId())),k<e.getChildren().length-1&&ne.push(n.jsx("div",{className:B(L.FLEXLAYOUT__TABSET_TAB_DIVIDER)},"divider"+k))}let ee,D=[],P=[];const z={leading:ee,stickyButtons:D,buttons:P,overflowPosition:void 0};t.customizeTabSet(e,z),ee=z.leading,D=z.stickyButtons,P=z.buttons;const G=e.isEnableSingleTabStretch()&&e.getChildren().length===1,te=G&&e.getChildren()[0].isEnableClose()||e.isEnableClose();if(z.overflowPosition===void 0&&(z.overflowPosition=D.length),D.length>0&&(!e.isEnableTabWrap()&&(N||G)?P=[...D,...P]:ne.push(n.jsx("div",{ref:c,onPointerDown:A,onDragStart:k=>{k.preventDefault()},className:B(L.FLEXLAYOUT__TAB_TOOLBAR_STICKY_BUTTONS_CONTAINER),children:D},"sticky_buttons_container"))),!e.isEnableTabWrap()&&R){const k=t.i18nName(Oe.Overflow_Menu_Tooltip);let ye;if(typeof u.more=="function"){const Ye=T.map(Xe=>({index:Xe,node:e.getChildren()[Xe]}));ye=u.more(e,Ye)}else ye=n.jsxs(n.Fragment,{children:[u.more,n.jsx("div",{className:B(L.FLEXLAYOUT__TAB_BUTTON_OVERFLOW_COUNT),children:T.length>0?T.length:""})]});P.splice(Math.min(z.overflowPosition,P.length),0,n.jsx("button",{"data-layout-path":$+"/button/overflow",ref:d,className:B(L.FLEXLAYOUT__TAB_TOOLBAR_BUTTON)+" "+B(L.FLEXLAYOUT__TAB_BUTTON_OVERFLOW),title:k,onClick:w,onPointerDown:A,children:ye},"overflowbutton"))}if(V!==void 0&&t.isSupportsPopout()&&V.isEnablePopout()&&V.isEnablePopoutIcon()){const k=t.i18nName(Oe.Popout_Tab);P.push(n.jsx("button",{"data-layout-path":$+"/button/popout",title:k,className:B(L.FLEXLAYOUT__TAB_TOOLBAR_BUTTON)+" "+B(L.FLEXLAYOUT__TAB_TOOLBAR_BUTTON_FLOAT),onClick:E,onPointerDown:A,children:typeof u.popout=="function"?u.popout(V):u.popout},"popout"))}if(e.canMaximize()){const k=t.i18nName(Oe.Restore),ye=t.i18nName(Oe.Maximize);P.push(n.jsx("button",{"data-layout-path":$+"/button/max",title:e.isMaximized()?k:ye,className:B(L.FLEXLAYOUT__TAB_TOOLBAR_BUTTON)+" "+B(L.FLEXLAYOUT__TAB_TOOLBAR_BUTTON_+(e.isMaximized()?"max":"min")),onClick:M,onPointerDown:A,children:e.isMaximized()?typeof u.restore=="function"?u.restore(e):u.restore:typeof u.maximize=="function"?u.maximize(e):u.maximize},"max"))}if(!e.isMaximized()&&te){const k=G?t.i18nName(Oe.Close_Tab):t.i18nName(Oe.Close_Tabset);P.push(n.jsx("button",{"data-layout-path":$+"/button/close",title:k,className:B(L.FLEXLAYOUT__TAB_TOOLBAR_BUTTON)+" "+B(L.FLEXLAYOUT__TAB_TOOLBAR_BUTTON_CLOSE),onClick:G?m:v,onPointerDown:A,children:typeof u.closeTabset=="function"?u.closeTabset(e):u.closeTabset},"close"))}if(e.isActive()&&e.isEnableActiveIcon()){const k=t.i18nName(Oe.Active_Tabset);P.push(n.jsx("div",{"data-layout-path":$+"/button/active",title:k,className:B(L.FLEXLAYOUT__TAB_TOOLBAR_ICON),children:typeof u.activeTabset=="function"?u.activeTabset(e):u.activeTabset},"active"))}const oe=n.jsx("div",{ref:l,className:B(L.FLEXLAYOUT__TAB_TOOLBAR),onPointerDown:A,onDragStart:k=>{k.preventDefault()},children:P},"buttonbar");let fe,ce=B(L.FLEXLAYOUT__TABSET_TABBAR_OUTER);if(e.getClassNameTabStrip()!==void 0&&(ce+=" "+e.getClassNameTabStrip()),ce+=" "+L.FLEXLAYOUT__TABSET_TABBAR_OUTER_+e.getTabLocation(),e.isActive()&&(ce+=" "+B(L.FLEXLAYOUT__TABSET_SELECTED)),e.isMaximized()&&(ce+=" "+B(L.FLEXLAYOUT__TABSET_MAXIMIZED)),G){const k=e.getChildren()[0];k.getTabSetClassName()!==void 0&&(ce+=" "+k.getTabSetClassName())}let xe;if(ee&&(xe=n.jsx("div",{className:B(L.FLEXLAYOUT__TABSET_LEADING),children:ee})),e.isEnableTabWrap())e.isEnableTabStrip()&&(fe=n.jsxs("div",{className:ce,style:{flexWrap:"wrap",gap:"1px",marginTop:"2px"},ref:s,"data-layout-path":$+"/tabstrip",onPointerDown:W,onDoubleClick:F,onContextMenu:C,onClick:S,onAuxClick:S,draggable:!0,onDragStart:x,children:[xe,ne,n.jsx("div",{style:{flexGrow:1}}),oe]}));else if(e.isEnableTabStrip()){let k;e.isEnableTabScrollbar()&&(k=n.jsx("div",{ref:o,className:B(L.FLEXLAYOUT__MINI_SCROLLBAR),onPointerDown:y})),fe=n.jsxs("div",{className:ce,ref:s,"data-layout-path":$+"/tabstrip",onPointerDown:W,onDoubleClick:F,onContextMenu:C,onClick:S,onAuxClick:S,draggable:!0,onWheel:O,onDragStart:x,children:[xe,n.jsxs("div",{className:B(L.FLEXLAYOUT__MINI_SCROLLBAR_CONTAINER),children:[n.jsx("div",{ref:a,className:B(L.FLEXLAYOUT__TABSET_TABBAR_INNER)+" "+B(L.FLEXLAYOUT__TABSET_TABBAR_INNER_+e.getTabLocation()),style:{overflowX:"auto",overflowY:"hidden"},onScroll:g,children:n.jsx("div",{style:{width:G?"100%":"none"},className:B(L.FLEXLAYOUT__TABSET_TABBAR_INNER_TAB_CONTAINER)+" "+B(L.FLEXLAYOUT__TABSET_TABBAR_INNER_TAB_CONTAINER_+e.getTabLocation()),children:ne})}),k]}),oe]})}let De;if(e.getChildren().length===0){const k=t.getTabSetPlaceHolderCallback();k&&(De=k(e))}let Ze=n.jsx("div",{ref:r,className:B(L.FLEXLAYOUT__TABSET_CONTENT),children:De});e.getTabLocation()==="top"?Ze=n.jsxs(n.Fragment,{children:[fe,Ze]}):Ze=n.jsxs(n.Fragment,{children:[Ze,fe]});const mt={flexGrow:Math.max(1,e.getWeight()*1e3),minWidth:e.getMinWidth(),minHeight:e.getMinHeight(),maxWidth:e.getMaxWidth(),maxHeight:e.getMaxHeight()};e.getModel().getMaximizedTabset(t.getWindowId())!==void 0&&!e.isMaximized()&&(mt.display="none");const ke=n.jsx("div",{ref:f,className:B(L.FLEXLAYOUT__TABSET_CONTAINER),style:mt,children:n.jsx("div",{className:B(L.FLEXLAYOUT__TABSET),"data-layout-path":$,children:Ze})});return e.isMaximized()&&t.getMainElement()?Et.createPortal(n.jsx("div",{style:{position:"absolute",display:"flex",top:0,left:0,bottom:0,right:0},children:ke}),t.getMainElement()):ke},li=i=>{const{layout:e,node:t}=i,s=p.useRef(null),o=t.getOrientation()===J.HORZ;p.useLayoutEffect(()=>{t.setRect(e.getBoundingClientRect(s.current))});const a=[];let r=0;for(const d of t.getChildren())r>0&&a.push(n.jsx(ts,{layout:e,node:t,index:r,horizontal:o},"splitter"+r)),d instanceof Te?a.push(n.jsx(li,{layout:e,node:d},d.getId())):d instanceof re&&a.push(n.jsx(oo,{layout:e,node:d},d.getId())),r++;const l={flexGrow:Math.max(1,t.getWeight()*1e3),minWidth:t.getMinWidth(),minHeight:t.getMinHeight(),maxWidth:t.getMaxWidth(),maxHeight:t.getMaxHeight()};return o?l.flexDirection="row":l.flexDirection="column",n.jsx("div",{ref:s,className:e.getClassName(L.FLEXLAYOUT__ROW),style:l,children:a})},ao=i=>{const{layout:e,selected:t,node:s,path:o}=i,a=p.useRef(null),r=p.useRef(!0),l=s.getParent(),d=l.getContentRect();p.useLayoutEffect(()=>{const g=s.getMoveableElement();a.current.appendChild(g),s.setMoveableElement(g);const y=()=>{s.saveScrollPosition()};return g.addEventListener("scroll",y),a.current.addEventListener("pointerdown",c),()=>{g.removeEventListener("scroll",y),a.current&&a.current.removeEventListener("pointerdown",c),s.setVisible(!1)}},[]),p.useEffect(()=>{s.isSelected()&&r.current&&(s.restoreScrollPosition(),r.current=!1)});const c=()=>{const g=s.getParent();g instanceof re&&(g.isActive()||e.doAction(Z.setActiveTabset(g.getId(),e.getWindowId())))};s.setRect(d);const h=e.getClassName,u={};d.styleWithPosition(u);let f=null;if(t){if(s.setVisible(!0),document.hidden&&s.isEnablePopoutOverlay()){const g={};d.styleWithPosition(g),f=n.jsx("div",{style:g,className:h(L.FLEXLAYOUT__TAB_OVERLAY)})}}else u.display="none",s.setVisible(!1);l instanceof re&&s.getModel().getMaximizedTabset(e.getWindowId())!==void 0&&(l.isMaximized()?u.zIndex=10:u.display="none"),l instanceof Re&&(l.isShowing()||(u.display="none"));let b=h(L.FLEXLAYOUT__TAB);return l instanceof Re&&(b+=" "+h(L.FLEXLAYOUT__TAB_BORDER),b+=" "+h(L.FLEXLAYOUT__TAB_BORDER_+l.getLocation().getName())),s.getContentClassName()!==void 0&&(b+=" "+s.getContentClassName()),n.jsxs(n.Fragment,{children:[f,n.jsx("div",{ref:a,style:u,className:b,"data-layout-path":o})]})};class ro extends p.Component{constructor(e){super(e),_(this,"retry",()=>{this.setState({hasError:!1})}),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,t){console.debug(e),console.debug(t)}render(){return this.state.hasError?n.jsx("div",{className:L.FLEXLAYOUT__ERROR_BOUNDARY_CONTAINER,children:n.jsx("div",{className:L.FLEXLAYOUT__ERROR_BOUNDARY_CONTENT,children:n.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[this.props.message,n.jsx("p",{children:n.jsx("button",{onClick:this.retry,children:this.props.retryText})})]})})}):this.props.children}}const lo=p.memo(({layout:i,node:e})=>n.jsx(ro,{message:i.i18nName(Oe.Error_rendering_component),retryText:i.i18nName(Oe.Error_rendering_component_retry),children:i.props.factory(e)}),co);function co(i,e){return!(e.visible&&(!i.rect.equalSize(e.rect)||i.forceRevision!==e.forceRevision||i.tabsRevision!==e.tabsRevision))}class ho extends p.Component{constructor(e){super(e),_(this,"selfRef"),_(this,"revision"),this.selfRef=p.createRef(),this.revision=0}redraw(){this.selfRef.current.redraw("parent "+this.revision)}addTabToTabSet(e,t){return this.selfRef.current.addTabToTabSet(e,t)}addTabWithDragAndDrop(e,t,s){this.selfRef.current.addTabWithDragAndDrop(e,t,s)}moveTabWithDragAndDrop(e,t){this.selfRef.current.moveTabWithDragAndDrop(e,t)}addTabToActiveTabSet(e){return this.selfRef.current.addTabToActiveTabSet(e)}setDragComponent(e,t,s,o){this.selfRef.current.setDragComponent(e,t,s,o)}getRootDiv(){return this.selfRef.current.getRootDiv()}render(){return n.jsx(uo,{ref:this.selfRef,...this.props,renderRevision:this.revision++})}}const di=class Ae extends p.Component{constructor(e){super(e),_(this,"selfRef"),_(this,"moveablesRef"),_(this,"findBorderBarSizeRef"),_(this,"mainRef"),_(this,"previousModel"),_(this,"orderedTabIds"),_(this,"orderedTabMoveableIds"),_(this,"moveableElementMap",new Map),_(this,"dropInfo"),_(this,"outlineDiv"),_(this,"currentDocument"),_(this,"currentWindow"),_(this,"supportsPopout"),_(this,"popoutURL"),_(this,"icons"),_(this,"resizeObserver"),_(this,"dragEnterCount",0),_(this,"dragging",!1),_(this,"windowId"),_(this,"layoutWindow"),_(this,"mainLayout"),_(this,"isMainWindow"),_(this,"isDraggingOverWindow"),_(this,"styleObserver"),_(this,"popoutWindowName"),_(this,"updateLayoutMetrics",()=>{if(this.findBorderBarSizeRef.current){const t=this.findBorderBarSizeRef.current.getBoundingClientRect().height;t!==this.state.calculatedBorderBarSize&&this.setState({calculatedBorderBarSize:t})}}),_(this,"onModelChange",t=>{this.redrawInternal("model change"),this.props.onModelChange&&this.props.onModelChange(this.props.model,t)}),_(this,"updateRect",()=>{if(this.selfRef.current){const t=q.fromDomRect(this.selfRef.current.getBoundingClientRect());!t.equals(this.state.rect)&&t.width!==0&&t.height!==0&&(this.setState({rect:t}),this.windowId!==Le.MAIN_WINDOW_ID&&this.redrawInternal("rect updated"))}}),_(this,"getClassName",t=>this.props.classNameMapper===void 0?t:this.props.classNameMapper(t)),_(this,"onCloseWindow",t=>{this.doAction(Z.closeWindow(t.windowId))}),_(this,"onSetWindow",(t,s)=>{}),_(this,"showControlInPortal",(t,s)=>{const o=Et.createPortal(t,s);this.setState({portal:o})}),_(this,"hideControlInPortal",()=>{this.setState({portal:void 0})}),_(this,"getIcons",()=>this.icons),_(this,"setDragNode",(t,s)=>{if(Ae.dragState=new Jt(this.mainLayout,"internal",s,void 0,void 0),t.dataTransfer.setData("text/plain","--flexlayout--"),t.dataTransfer.effectAllowed="copyMove",t.dataTransfer.dropEffect="move",this.dragEnterCount=0,s instanceof re){let o=!1,a=this.i18nName(Oe.Move_Tabset);if(s.getChildren().length>0&&(a=this.i18nName(Oe.Move_Tabs).replace("?",String(s.getChildren().length))),this.props.onRenderDragRect){const r=this.props.onRenderDragRect(a,s,void 0);r&&(this.setDragComponent(t,r,10,10),o=!0)}o||this.setDragComponent(t,a,10,10)}else{const a=t.target.getBoundingClientRect(),r=t.clientX-a.left,l=t.clientY-a.top,d=s==null?void 0:s.getParent(),c=d instanceof Re&&d.getOrientation()===J.HORZ,h=c?10:r,u=c?10:l;let f=!1;if(this.props.onRenderDragRect){const b=n.jsx(Ct,{layout:this,node:s},s.getId()),g=this.props.onRenderDragRect(b,s,void 0);g&&(this.setDragComponent(t,g,h,u),f=!0)}f||(zn()?this.setDragComponent(t,n.jsx(Ct,{node:s,layout:this}),h,u):t.dataTransfer.setDragImage(s.getTabStamp(),h,u))}}),_(this,"onDragEnterRaw",t=>{this.dragEnterCount++,this.dragEnterCount===1&&this.onDragEnter(t)}),_(this,"onDragLeaveRaw",t=>{this.dragEnterCount--,this.dragEnterCount===0&&this.onDragLeave(t)}),_(this,"onDragEnter",t=>{if(!Ae.dragState&&this.props.onExternalDrag){const s=this.props.onExternalDrag(t);if(s){const o=le.fromJson(s.json,this.props.model,!1);Ae.dragState=new Jt(this.mainLayout,"external",o,s.json,s.onDrop)}}if(Ae.dragState){if(this.windowId!==Le.MAIN_WINDOW_ID&&Ae.dragState.mainLayout===this.mainLayout&&Ae.dragState.mainLayout.setDraggingOverWindow(!0),Ae.dragState.mainLayout!==this.mainLayout)return;t.preventDefault(),this.dropInfo=void 0;const s=this.selfRef.current;this.outlineDiv=this.currentDocument.createElement("div"),this.outlineDiv.className=this.getClassName(L.FLEXLAYOUT__OUTLINE_RECT),this.outlineDiv.style.visibility="hidden";const o=this.props.model.getAttribute("tabDragSpeed");this.outlineDiv.style.transition=`top ${o}s, left ${o}s, width ${o}s, height ${o}s`,s.appendChild(this.outlineDiv),this.dragging=!0,this.showOverlay(!0),!this.isDraggingOverWindow&&this.props.model.getMaximizedTabset(this.windowId)===void 0&&this.setState({showEdges:this.props.model.isEnableEdgeDock()});const a=this.selfRef.current.getBoundingClientRect();new q(t.clientX-a.left,t.clientY-a.top,1,1).positionElement(this.outlineDiv)}}),_(this,"onDragOver",t=>{var s;if(this.dragging&&!this.isDraggingOverWindow){t.preventDefault();const o=(s=this.selfRef.current)==null?void 0:s.getBoundingClientRect(),a={x:t.clientX-((o==null?void 0:o.left)??0),y:t.clientY-((o==null?void 0:o.top)??0)};this.checkForBorderToShow(a.x,a.y);const r=this.props.model.findDropTargetNode(this.windowId,Ae.dragState.dragNode,a.x,a.y);r&&(this.dropInfo=r,this.outlineDiv&&(this.outlineDiv.className=this.getClassName(r.className),r.rect.positionElement(this.outlineDiv),this.outlineDiv.style.visibility="visible"))}}),_(this,"onDragLeave",t=>{this.dragging&&(this.windowId!==Le.MAIN_WINDOW_ID&&Ae.dragState.mainLayout.setDraggingOverWindow(!1),this.clearDragLocal())}),_(this,"onDrop",t=>{if(this.dragging){t.preventDefault();const s=Ae.dragState;if(this.dropInfo)if(s.dragJson!==void 0){const o=this.doAction(Z.addNode(s.dragJson,this.dropInfo.node.getId(),this.dropInfo.location,this.dropInfo.index));s.fnNewNodeDropped!==void 0&&s.fnNewNodeDropped(o,t)}else s.dragNode!==void 0&&this.doAction(Z.moveNode(s.dragNode.getId(),this.dropInfo.node.getId(),this.dropInfo.location,this.dropInfo.index));this.mainLayout.clearDragMain()}this.dragEnterCount=0}),this.orderedTabIds=[],this.orderedTabMoveableIds=[],this.selfRef=p.createRef(),this.moveablesRef=p.createRef(),this.mainRef=p.createRef(),this.findBorderBarSizeRef=p.createRef(),this.supportsPopout=e.supportsPopout!==void 0?e.supportsPopout:go,this.popoutURL=e.popoutURL?e.popoutURL:"popout.html",this.icons={...po,...e.icons},this.windowId=e.windowId?e.windowId:Le.MAIN_WINDOW_ID,this.mainLayout=this.props.mainLayout?this.props.mainLayout:this,this.isDraggingOverWindow=!1,this.layoutWindow=this.props.model.getwindowsMap().get(this.windowId),this.layoutWindow.layout=this,this.popoutWindowName=this.props.popoutWindowName||"Popout Window",this.state={rect:q.empty(),editingTab:void 0,showEdges:!1,showOverlay:!1,calculatedBorderBarSize:29,layoutRevision:0,forceRevision:0,showHiddenBorder:Y.CENTER},this.isMainWindow=this.windowId===Le.MAIN_WINDOW_ID}componentDidMount(){if(this.updateRect(),this.currentDocument=this.selfRef.current.ownerDocument,this.currentWindow=this.currentDocument.defaultView,this.layoutWindow.window=this.currentWindow,this.layoutWindow.toScreenRectFunction=e=>this.getScreenRect(e),this.resizeObserver=new ResizeObserver(e=>{requestAnimationFrame(()=>{this.updateRect()})}),this.selfRef.current&&this.resizeObserver.observe(this.selfRef.current),this.isMainWindow)this.props.model.addChangeListener(this.onModelChange),this.updateLayoutMetrics();else{this.currentWindow.addEventListener("resize",()=>{this.updateRect()});const e=this.props.mainLayout.getRootDiv(),t=this.selfRef.current;As(e,t),this.styleObserver=new MutationObserver(()=>{As(e,t)&&this.redraw("mutation observer")}),this.styleObserver.observe(e,{attributeFilter:["style"]})}document.addEventListener("visibilitychange",()=>{for(const[e,t]of this.props.model.getwindowsMap())t.layout&&this.redraw("visibility change")})}componentDidUpdate(){this.currentDocument=this.selfRef.current.ownerDocument,this.currentWindow=this.currentDocument.defaultView,this.isMainWindow&&(this.props.model!==this.previousModel&&(this.previousModel!==void 0&&this.previousModel.removeChangeListener(this.onModelChange),this.props.model.getwindowsMap().get(this.windowId).layout=this,this.props.model.addChangeListener(this.onModelChange),this.layoutWindow=this.props.model.getwindowsMap().get(this.windowId),this.layoutWindow.layout=this,this.layoutWindow.toScreenRectFunction=e=>this.getScreenRect(e),this.previousModel=this.props.model,this.tidyMoveablesMap()),this.updateLayoutMetrics())}componentWillUnmount(){var e,t;this.selfRef.current&&((e=this.resizeObserver)==null||e.unobserve(this.selfRef.current)),this.isMainWindow&&this.props.model.removeChangeListener(this.onModelChange),(t=this.styleObserver)==null||t.disconnect()}render(){if(!this.selfRef.current)return n.jsxs("div",{ref:this.selfRef,className:this.getClassName(L.FLEXLAYOUT__LAYOUT),children:[n.jsx("div",{ref:this.moveablesRef,className:this.getClassName(L.FLEXLAYOUT__LAYOUT_MOVEABLES)},"__moveables__"),this.renderMetricsElements()]});const e=this.props.model;e.getRoot(this.windowId).calcMinMaxSize(),e.getRoot(this.windowId).setPaths(""),e.getBorderSet().setPaths();const t=this.renderLayout(),s=this.renderBorders(t),o=this.renderTabs(),a=this.reorderComponents(o,this.orderedTabIds);let r=null,l=null,d=null,c=null;if(this.isMainWindow){r=this.renderWindows(),c=this.renderMetricsElements();const h=this.renderTabMoveables();l=this.reorderComponents(h,this.orderedTabMoveableIds),d=n.jsx("div",{className:this.getClassName(L.FLEXLAYOUT__LAYOUT_TAB_STAMPS),children:this.renderTabStamps()},"__tabStamps__")}return n.jsxs("div",{ref:this.selfRef,className:this.getClassName(L.FLEXLAYOUT__LAYOUT),onDragEnter:this.onDragEnterRaw,onDragLeave:this.onDragLeaveRaw,onDragOver:this.onDragOver,onDrop:this.onDrop,children:[n.jsx("div",{ref:this.moveablesRef,className:this.getClassName(L.FLEXLAYOUT__LAYOUT_MOVEABLES)},"__moveables__"),c,n.jsx(io,{layout:this,show:this.state.showOverlay},"__overlay__"),s,a,l,d,this.state.portal,r]})}renderBorders(e){const t=this.getClassName(L.FLEXLAYOUT__LAYOUT_MAIN),s=this.props.model.getBorderSet().getBorderMap();if(this.isMainWindow&&s.size>0){e=n.jsx("div",{className:t,ref:this.mainRef,children:e});const o=new Map,a=new Map;for(const[d,c]of Y.values){const h=s.get(c);h&&h.isShowing()&&(!h.isAutoHide()||h.isAutoHide()&&(h.getChildren().length>0||this.state.showHiddenBorder===c))&&(o.set(c,n.jsx(qn,{layout:this,border:h,size:this.state.calculatedBorderBarSize})),a.set(c,n.jsx(kn,{layout:this,border:h,show:h.getSelected()!==-1})))}const r=this.getClassName(L.FLEXLAYOUT__LAYOUT_BORDER_CONTAINER),l=this.getClassName(L.FLEXLAYOUT__LAYOUT_BORDER_CONTAINER_INNER);if(this.props.model.getBorderSet().getLayoutHorizontal()){const d=n.jsxs("div",{className:l,style:{flexDirection:"column"},children:[a.get(Y.TOP),n.jsxs("div",{className:l,style:{flexDirection:"row"},children:[a.get(Y.LEFT),e,a.get(Y.RIGHT)]}),a.get(Y.BOTTOM)]});return n.jsxs("div",{className:r,style:{flexDirection:"column"},children:[o.get(Y.TOP),n.jsxs("div",{className:l,style:{flexDirection:"row"},children:[o.get(Y.LEFT),d,o.get(Y.RIGHT)]}),o.get(Y.BOTTOM)]})}else{const d=n.jsxs("div",{className:l,style:{flexDirection:"row"},children:[a.get(Y.LEFT),n.jsxs("div",{className:l,style:{flexDirection:"column"},children:[a.get(Y.TOP),e,a.get(Y.BOTTOM)]}),a.get(Y.RIGHT)]});return n.jsxs("div",{className:r,style:{flexDirection:"row"},children:[o.get(Y.LEFT),n.jsxs("div",{className:l,style:{flexDirection:"column"},children:[o.get(Y.TOP),d,o.get(Y.BOTTOM)]}),o.get(Y.RIGHT)]})}}else return n.jsx("div",{className:t,ref:this.mainRef,style:{position:"absolute",top:0,left:0,bottom:0,right:0,display:"flex"},children:e})}renderLayout(){return n.jsxs(n.Fragment,{children:[n.jsx(li,{layout:this,node:this.props.model.getRoot(this.windowId)},"__row__"),this.renderEdgeIndicators()]})}renderEdgeIndicators(){const e=[],t=this.icons.edgeArrow;if(this.state.showEdges){const s=this.props.model.getRoot(this.windowId).getRect(),o=$t,a=Ms,r=$t/2,l=this.getClassName(L.FLEXLAYOUT__EDGE_RECT),d=50;e.push(n.jsx("div",{style:{top:0,left:s.width/2-r,width:o,height:a,borderBottomLeftRadius:d,borderBottomRightRadius:d},className:l+" "+this.getClassName(L.FLEXLAYOUT__EDGE_RECT_TOP),children:n.jsx("div",{style:{transform:"rotate(180deg)"},children:t})},"North")),e.push(n.jsx("div",{style:{top:s.height/2-r,left:0,width:a,height:o,borderTopRightRadius:d,borderBottomRightRadius:d},className:l+" "+this.getClassName(L.FLEXLAYOUT__EDGE_RECT_LEFT),children:n.jsx("div",{style:{transform:"rotate(90deg)"},children:t})},"West")),e.push(n.jsx("div",{style:{top:s.height-a,left:s.width/2-r,width:o,height:a,borderTopLeftRadius:d,borderTopRightRadius:d},className:l+" "+this.getClassName(L.FLEXLAYOUT__EDGE_RECT_BOTTOM),children:n.jsx("div",{children:t})},"South")),e.push(n.jsx("div",{style:{top:s.height/2-r,left:s.width-a,width:a,height:o,borderTopLeftRadius:d,borderBottomLeftRadius:d},className:l+" "+this.getClassName(L.FLEXLAYOUT__EDGE_RECT_RIGHT),children:n.jsx("div",{style:{transform:"rotate(-90deg)"},children:t})},"East"))}return e}renderWindows(){const e=[];if(this.supportsPopout){const t=this.props.model.getwindowsMap();let s=1;for(const[o,a]of t)o!==Le.MAIN_WINDOW_ID&&(e.push(n.jsx(Vn,{layout:this,title:this.popoutWindowName+" "+s,layoutWindow:a,url:this.popoutURL+"?id="+o,onSetWindow:this.onSetWindow,onCloseWindow:this.onCloseWindow,children:n.jsx("div",{className:this.props.popoutClassName,children:n.jsx(Ae,{...this.props,windowId:o,mainLayout:this})})},o)),s++)}return e}renderTabMoveables(){const e=new Map;return this.props.model.visitNodes(t=>{if(t instanceof le){const s=t,o=this.getMoveableElement(s.getId());s.setMoveableElement(o);const a=s.isSelected(),r=s.getParent().getContentRect(),l=a||!s.isEnableRenderOnDemand(),d=s.isRendered()||l&&r.width>0&&r.height>0;if(d){const c=s.getId()+(s.isEnableWindowReMount()?s.getWindowId():"");e.set(t.getId(),Et.createPortal(n.jsx(lo,{layout:this,node:s,rect:r,visible:l,forceRevision:this.state.forceRevision,tabsRevision:this.props.renderRevision},c),o,c)),s.setRendered(d)}}}),e}renderTabStamps(){const e=[];return this.props.model.visitNodes(t=>{if(t instanceof le){const s=t;e.push(n.jsx(Gn,{layout:this,node:s},s.getId()))}}),e}renderTabs(){const e=new Map;return this.props.model.visitWindowNodes(this.windowId,t=>{if(t instanceof le){const s=t,o=s.isSelected(),a=s.getPath();(s.isRendered()||o||!s.isEnableRenderOnDemand())&&e.set(s.getId(),n.jsx(ao,{layout:this,path:a,node:s,selected:o},s.getId()))}}),e}renderMetricsElements(){return n.jsx("div",{ref:this.findBorderBarSizeRef,className:this.getClassName(L.FLEXLAYOUT__BORDER_SIZER),children:"FindBorderBarSize"},"findBorderBarSize")}checkForBorderToShow(e,t){const s=this.getBoundingClientRect(this.mainRef.current),o=s.getCenter(),a=Ms,r=$t/2;let l=!1;this.props.model.isEnableEdgeDock()&&this.state.showHiddenBorder===Y.CENTER&&(t>o.y-r&&t<o.y+r||e>o.x-r&&e<o.x+r)&&(l=!0);let d=Y.CENTER;l||(e<=s.x+a?d=Y.LEFT:e>=s.getRight()-a?d=Y.RIGHT:t<=s.y+a?d=Y.TOP:t>=s.getBottom()-a&&(d=Y.BOTTOM)),d!==this.state.showHiddenBorder&&this.setState({showHiddenBorder:d})}tidyMoveablesMap(){const e=new Map;this.props.model.visitNodes((t,s)=>{t instanceof le&&e.set(t.getId(),t)});for(const[t,s]of this.moveableElementMap)e.has(t)||(s.remove(),this.moveableElementMap.delete(t))}reorderComponents(e,t){const s=[],o=new Set;let a=[];for(const r of t)e.get(r)&&(s.push(r),o.add(r));t.splice(0,t.length,...s);for(const[r,l]of e)o.has(r)||t.push(r);return a=t.map(r=>e.get(r)),a}redraw(e){this.mainLayout.setState((t,s)=>({forceRevision:t.forceRevision+1}))}redrawInternal(e){this.mainLayout.setState((t,s)=>({layoutRevision:t.layoutRevision+1}))}doAction(e){if(this.props.onAction!==void 0){const t=this.props.onAction(e);return t!==void 0?this.props.model.doAction(t):void 0}else return this.props.model.doAction(e)}getBoundingClientRect(e){const t=this.getDomRect();return t?q.getBoundingClientRect(e).relativeTo(t):q.empty()}getMoveableContainer(){return this.moveablesRef.current}getMoveableElement(e){let t=this.moveableElementMap.get(e);return t===void 0&&(t=document.createElement("div"),this.moveablesRef.current.appendChild(t),t.className=L.FLEXLAYOUT__TAB_MOVEABLE,this.moveableElementMap.set(e,t)),t}getMainLayout(){return this.mainLayout}getCurrentDocument(){return this.currentDocument}getDomRect(){return this.selfRef.current?q.fromDomRect(this.selfRef.current.getBoundingClientRect()):q.empty()}getWindowId(){return this.windowId}getRootDiv(){return this.selfRef.current}getMainElement(){return this.mainRef.current}getFactory(){return this.props.factory}isSupportsPopout(){return this.supportsPopout}isRealtimeResize(){return this.props.realtimeResize??!1}getPopoutURL(){return this.popoutURL}setEditingTab(e){this.setState({editingTab:e})}getEditingTab(){return this.state.editingTab}getModel(){return this.props.model}getScreenRect(e){const t=e.clone(),s=this.getDomRect(),o=60,a=2;return t.x=this.currentWindow.screenX+this.currentWindow.scrollX+a/2+s.x+t.x,t.y=this.currentWindow.screenY+this.currentWindow.scrollY+(o-a/2)+s.y+t.y,t.height+=o,t.width+=a,t}addTabToTabSet(e,t){if(this.props.model.getNodeById(e)!==void 0)return this.doAction(Z.addNode(t,e,Y.CENTER,-1))}addTabToActiveTabSet(e){const t=this.props.model.getActiveTabset(this.windowId);if(t!==void 0)return this.doAction(Z.addNode(e,t.getId(),Y.CENTER,-1))}maximize(e){this.doAction(Z.maximizeToggle(e.getId(),this.getWindowId()))}customizeTab(e,t){this.props.onRenderTab&&this.props.onRenderTab(e,t)}customizeTabSet(e,t){this.props.onRenderTabSet&&this.props.onRenderTabSet(e,t)}i18nName(e,t){let s;return this.props.i18nMapper&&(s=this.props.i18nMapper(e,t)),s===void 0&&(s=e+(t===void 0?"":t)),s}getShowOverflowMenu(){return this.props.onShowOverflowMenu}getTabSetPlaceHolderCallback(){return this.props.onTabSetPlaceHolder}showContextMenu(e,t){this.props.onContextMenu&&this.props.onContextMenu(e,t)}auxMouseClick(e,t){this.props.onAuxMouseClick&&this.props.onAuxMouseClick(e,t)}showOverlay(e){this.setState({showOverlay:e}),es(!e,this.currentDocument)}addTabWithDragAndDrop(e,t,s){const o=le.fromJson(t,this.props.model,!1);Ae.dragState=new Jt(this.mainLayout,"add",o,t,s)}moveTabWithDragAndDrop(e,t){this.setDragNode(e,t)}setDragComponent(e,t,s,o){const a=n.jsx("div",{style:{position:"unset"},className:this.getClassName(L.FLEXLAYOUT__LAYOUT)+" "+this.getClassName(L.FLEXLAYOUT__DRAG_RECT),children:t}),r=this.currentDocument.createElement("div");r.setAttribute("data-layout-path","/drag-rectangle"),r.style.position="absolute",r.style.left="-10000px",r.style.top="-10000px",this.currentDocument.body.appendChild(r),zi(r).render(a),e.dataTransfer.setDragImage(r,s,o),setTimeout(()=>{this.currentDocument.body.removeChild(r)},0)}setDraggingOverWindow(e){this.isDraggingOverWindow!==e&&(this.outlineDiv&&(this.outlineDiv.style.visibility=e?"hidden":"visible"),e?this.setState({showEdges:!1}):this.props.model.getMaximizedTabset(this.windowId)===void 0&&this.setState({showEdges:this.props.model.isEnableEdgeDock()}),this.isDraggingOverWindow=e)}clearDragMain(){Ae.dragState=void 0,this.windowId===Le.MAIN_WINDOW_ID&&(this.isDraggingOverWindow=!1);for(const[,e]of this.props.model.getwindowsMap())e.layout.clearDragLocal()}clearDragLocal(){this.setState({showEdges:!1}),this.showOverlay(!1),this.dragEnterCount=0,this.dragging=!1,this.outlineDiv&&(this.selfRef.current.removeChild(this.outlineDiv),this.outlineDiv=void 0)}};_(di,"dragState");let uo=di;const po={close:n.jsx(Ls,{}),closeTabset:n.jsx(Ls,{}),popout:n.jsx(eo,{}),maximize:n.jsx(Zn,{}),restore:n.jsx(to,{}),more:n.jsx(Kn,{}),edgeArrow:n.jsx(Qn,{}),activeTabset:n.jsx(so,{})},go=si(),$t=100,Ms=10;class Jt{constructor(e,t,s,o,a){_(this,"mainLayout"),_(this,"dragSource"),_(this,"dragNode"),_(this,"dragJson"),_(this,"fnNewNodeDropped"),this.mainLayout=e,this.dragSource=t,this.dragNode=s,this.dragJson=o,this.fnNewNodeDropped=a}}function fo({currentDeepBookPool:i,deepBookPools:e,currentAccount:t,currentBalanceManagerInfo:s}){const{size:o}=Ps(),a=p.useMemo(()=>Le.fromJson({global:{tabEnableClose:!1,tabSetEnableTabStrip:!1},layout:{type:"column",children:[{type:"column",weight:85,children:[{type:"tabset",weight:8,minWidth:800,minHeight:64,maxHeight:64,children:[{type:"tab",component:"TopDataBlock",zIndex:9}],enableDivide:!1},{type:"row",weight:75,zIndex:8,config:{splitterEnabled:!1},children:[{type:"tabset",weight:83,minWidth:288,minHeight:400,config:{tabSetMinHeight:400,tabSetMaxHeight:0},children:[{type:"tab",component:"ChartBlock"}]},{type:"tabset",weight:17,minWidth:328,minHeight:360,config:{tabSetMinHeight:360,tabSetMaxHeight:0},children:[{type:"tab",component:"OrderBookBlock"}]}]},{type:"tabset",weight:36,minHeight:368,children:[{type:"tab",component:"TradeTableBlock"}]}]},{type:"column",weight:15,children:[{type:"tabset",weight:100,minWidth:352,minHeight:808,children:[{type:"tab",component:"TradeBlock",name:"TradeBlock"}]}]}]}}),[]),r=p.useCallback(u=>{const f=u.getComponent();if(f==="TopDataBlock")return n.jsx(l,{});switch(f){case"TradeBlock":return n.jsxs(pe,{h:"100%",w:"100%",children:[n.jsx(Ks,{}),n.jsx(pe,{h:"8px",bg:"bg_primary"}),n.jsx(Vs,{})]});case"ChartBlock":return n.jsx(pe,{h:"100%",w:"100%",children:n.jsx($s,{currentDeepBookPool:i})});case"OrderBookBlock":return n.jsx(pe,{h:"100%",w:"100%",children:n.jsx(Js,{})});case"TradeTableBlock":return n.jsx(pe,{h:"100%",w:"100%",children:n.jsx(ti,{})});case"FooterBlock":return n.jsx(pe,{h:"100%",w:"100%",children:n.jsx(Qt,{})});default:return null}},[i]),l=p.useCallback(()=>(p.useEffect(()=>{const u=setTimeout(()=>{const f=document.querySelectorAll(".flexlayout__splitter");f.length>0&&(f[0].style.backgroundColor="transparent",f[0].style.pointerEvents="none")},0);return()=>clearTimeout(u)},[]),n.jsx(pe,{h:"100%",w:"100%",children:n.jsx(Zs,{})})),[]),d=p.useMemo(()=>(o==null?void 0:o.h)-80,[o==null?void 0:o.h]),c=p.useMemo(()=>(o==null?void 0:o.h)-80-48,[o==null?void 0:o.h]),h=p.useMemo(()=>(o==null?void 0:o.h)<600?500:368,[o==null?void 0:o.h]);return p.useEffect(()=>{if(o!=null&&o.h){const u=document.querySelector('.flexlayout__tabset[data-weight="36"]');u&&(u.style.minHeight=`${h}px`);const f=document.querySelector('.flexlayout__row[data-weight="75"]');if(f){const b=o.h-80-48-64-h,g=Math.max(b,400);f.style.minHeight=`${g}px`,f.style.height=`${g}px`}if(o.h>=900){const b=document.querySelector('.flexlayout__tabset[data-weight="83"]'),g=document.querySelector('.flexlayout__tabset[data-weight="17"]');b&&(b.style.minHeight="500px"),g&&(g.style.minHeight="400px")}}},[o==null?void 0:o.h,h]),n.jsxs(K,{minWidth:"1160px",w:"100%",minHeight:"648px",h:d,overflow:((o==null?void 0:o.h)<650,"unset"),children:[n.jsx(pe,{minH:"808px",h:c,w:"100%",bg:"bg_secondary",position:"relative",zIndex:"5",children:n.jsx(ho,{model:a,factory:r,realtimeResize:!0})}),n.jsx(Qt,{})]})}function bo(){const{fetchByApi:i}=Hs(),{currentAccount:e}=ge(),{deepBookPoolsObj:t,setDeepBookOrderHistoryLoading:s,setDeepBookOrderHistory:o}=Q(),{queryDeepBookPoolByValue:a}=ds(),r=p.useMemo(()=>new Map,[]),l=async()=>{var c,h;try{s(!0);const u=await i(ki,"GET",{address:e==null?void 0:e.address,limit:9999});console.log("🚀🚀🚀 ~ useGetDeepBookOrderHistort.ts:11 ~ getDeepBookOrderHistory ~ res:",u);const f=new Set;if((c=u==null?void 0:u.list)==null||c.forEach(g=>{!t[g.pool_id]&&!r.has(g.pool_id)&&f.add(g.pool_id)}),f.size>0){console.log("🚀🚀🚀 ~ 需要查询的池信息:",Array.from(f));const g=Array.from(f);for(const y of g)try{const T=await a(y);T&&T.length>0&&r.set(y,T[0])}catch(T){console.error(`查询池信息失败 poolId: ${y}`,T)}}const b=[];for(let g=0;g<((h=u==null?void 0:u.list)==null?void 0:h.length);g++){const y=u==null?void 0:u.list[g],T=d(y);b.push(T)}return o(b),s(!1),b}catch(u){return console.log("🚀🚀🚀 ~ useGetDeepBookOrderHistory.ts:15 ~ getDeepBookOrderHistory ~ error:",u),s(!1),[]}},d=c=>{let h=t[c.pool_id];if(h||(h=r.get(c.pool_id),console.log("🚀🚀🚀 ~ 从缓存获取池信息:",h)),!h)return console.warn(`池信息不存在，跳过历史记录 poolId: ${c.pool_id}`),null;const{baseAssets:u,quoteAssets:f}=h,b=f.decimals,g=u.decimals,{block_time:y,is_bid:T,pool_id:O,tx:N}=c,R=X(c.price).div(Math.pow(10,b-g+9)).toString(),w=X(c.base_asset_quantity_filled).div(Math.pow(10,g)).toString();X(c.original_quantity).div(Math.pow(10,g)).toString();const I=X(w).mul(X(R)).toString();return{baseAssets:u,quoteAssets:f,blockTime:Yi(y),side:T?"Buy":"Sell",price:R,filled:I,fee:0,orderStatus:"Success",total:w,poolId:O,tx:N}};return{getDeepBookOrderHistory:l}}function Vo(){const{address:i}=Oi(),{currentAccount:e}=ge(),{deepBookPools:t,setDeepBookOpenOrders:s,setDeepBookOrderHistory:o,setDeepBookSettleList:a,setManagerBalanceObjs:r,currentDeepBookPool:l,isCheckedAllMarkets:d,deepBookPoolsObj:c,setBalanceManagerList:h,getCurrentBalanceManagerInfo:u,currentBalanceManagerInfoMap:f}=Q(),{isApp:b}=ze(),{getDeepBookPools:g}=ds(),{getDeepBookOpenOrders:y,getDeepBookAllOpenOrders:T}=kt(),{getDeepBookOrderHistory:O}=bo(),{getOrderBook:N}=Ce(),{getBalanceManagerInfo:R,getManagerBalance:w}=Se(),{fetchTokenPrices:I}=Ft(),x=p.useMemo(()=>e!=null&&e.address?u(e==null?void 0:e.address):null,[e==null?void 0:e.address,f]),W=()=>{const S=[];t.forEach(C=>{var A,M;S.push((A=C==null?void 0:C.baseAssets)==null?void 0:A.coin_type,(M=C==null?void 0:C.quoteAssets)==null?void 0:M.coin_type)}),I(S)};return p.useEffect(()=>{g(i)},[]),qs({interval:30*1e3,callback:()=>{g(i),W(),d?T(!1):y(l,!1)}}),p.useEffect(()=>{e!=null&&e.address&&R(e==null?void 0:e.address)},[e==null?void 0:e.address]),p.useEffect(()=>{(t==null?void 0:t.length)>0&&W()},[t==null?void 0:t.length]),p.useEffect(()=>{s([]),o([]),a([]),r([]),h([])},[e==null?void 0:e.address]),p.useEffect(()=>{l!=null&&l.address&&(e!=null&&e.address)&&(d?T():y(l))},[l==null?void 0:l.address,e==null?void 0:e.address,d,x]),p.useEffect(()=>{(t==null?void 0:t.length)>0&&(e!=null&&e.address)&&Is(c)&&O()},[t==null?void 0:t.length,e==null?void 0:e.address,c,d]),p.useEffect(()=>{l!=null&&l.address&&N("all",l.tickSize,!0,9)},[l==null?void 0:l.address]),p.useEffect(()=>{x!=null&&x.balanceManager&&(l!=null&&l.address)&&(e!=null&&e.address)&&w([{coin_type:l==null?void 0:l.baseAssets.coin_type,decimals:l==null?void 0:l.baseAssets.decimals},{coin_type:l==null?void 0:l.quoteAssets.coin_type,decimals:l==null?void 0:l.quoteAssets.decimals}],e==null?void 0:e.address,x==null?void 0:x.balanceManager)},[x,e==null?void 0:e.address,l]),b?n.jsx(Un,{currentDeepBookPool:l,deepBookPools:t,currentAccount:e,currentBalanceManagerInfo:x}):n.jsx(fo,{currentDeepBookPool:l,deepBookPools:t,currentAccount:e,currentBalanceManagerInfo:x})}export{Vo as default};
