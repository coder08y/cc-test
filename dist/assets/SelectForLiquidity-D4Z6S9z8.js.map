{"version":3,"file":"SelectForLiquidity-D4Z6S9z8.js","sources":["../../src/hooks/create-pool/useSelectPool.ts","../../src/pages/SelectForLiquidity.tsx"],"sourcesContent":["import { PoolType } from '@/components/pools/createPool/SelectPoolType'\nimport { FeeTier } from '@/components/selectPool/type'\nimport useCreatePoolHelper from '@/hooks/create-pool/useCreatePoolHelper'\nimport useQuoteWhiteTokenList from '@/hooks/create-pool/useQuoteWhiteTokenList'\nimport useCreatePoolStore from '@/store/pool/useCreatePool'\nimport { isTrustedToken } from '@/utils'\nimport { clmmDefaultFeeOptions, dlmmDefaultFeeOptions } from '@cetus/design/src/components/common/feeSelect/config'\nimport { useSdk } from '@cetus/sdk-factory'\nimport { Token } from '@cetus/types'\nimport envConfigs from '@cetus/types/src/config/envConfigs'\nimport { fixCoinType } from '@cetusprotocol/common-sdk'\nimport { useDisclosure } from '@chakra-ui/react'\nimport { useEffect, useState } from 'react'\nimport { useNavigate } from 'react-router-dom'\n\nfunction useSelectPool() {\n  const navigate = useNavigate()\n  const [baseToken, setBaseToken] = useState<Token | undefined>()\n  const [quoteToken, setQuoteToken] = useState<Token | undefined>(envConfigs.sui_coin)\n  const [feeTier, setFeeTier] = useState<FeeTier | undefined>(undefined)\n  const [feeTierList, setFeeTierList] = useState<FeeTier[]>([])\n  const { fetchFeeTierList, getBinStepConfigs } = useCreatePoolHelper()\n  const { quoteWhiteTokenList } = useQuoteWhiteTokenList()\n  const { poolType, setPoolType, setCurrentStep } = useCreatePoolStore()\n  const [feeOptions, setFeeOptions] = useState<any[]>([])\n  const [binStep, setBinStep] = useState<any>(undefined)\n  const dlmmSdk = useSdk('dlmm')\n  const onPoolTypeChange = (type: PoolType) => {\n    setPoolType(type)\n  }\n\n  const updateFeeTierList = () => {\n    if (baseToken && quoteToken) {\n      fetchFeeTierList(baseToken.coin_type, quoteToken.coin_type).then(res => {\n        setFeeTierList(\n          res?.map(item => {\n            const title = res.find(feeTier => feeTier.feeRate === item.feeRate)?.title || item.title\n            return {\n              ...item,\n              description: undefined,\n              disabled:\n                title === 'Not Created' && !isTrustedToken(baseToken, quoteWhiteTokenList) && !isTrustedToken(quoteToken, quoteWhiteTokenList)\n                  ? true\n                  : false\n            }\n          }) as any\n        )\n      })\n    } else {\n      setFeeTierList(\n        clmmDefaultFeeOptions?.map(item => ({\n          ...item,\n          description: undefined,\n          title: ''\n        })) as any\n      )\n    }\n  }\n\n  const updateBinStepList = () => {\n    if (baseToken && quoteToken) {\n      getBinStepConfigs(baseToken?.coin_type, quoteToken?.coin_type).then(res => {\n        setFeeOptions(\n          res?.map(item => {\n            const title = res.find(feeTier => feeTier.fee === item.fee)?.title || item.title\n            return {\n              ...item,\n              description: undefined,\n              disabled:\n                title === 'Not Created' && !isTrustedToken(baseToken, quoteWhiteTokenList) && !isTrustedToken(quoteToken, quoteWhiteTokenList)\n                  ? true\n                  : false\n            }\n          })\n        )\n      })\n    } else {\n      setFeeOptions(\n        dlmmDefaultFeeOptions?.map(item => ({\n          ...item,\n          description: undefined,\n          title: ''\n        }))\n      )\n    }\n  }\n\n  useEffect(() => {\n    if (poolType === 'clmm') {\n      updateFeeTierList()\n    }\n    if (poolType === 'dlmm') {\n      updateBinStepList()\n    }\n  }, [baseToken?.coin_type, quoteToken?.coin_type, poolType])\n\n  const { isOpen, onOpen, onClose } = useDisclosure()\n\n  const onContinue = async () => {\n    if (feeTier && poolType === 'clmm') {\n      if (feeTier.poolAddress) {\n        navigate(`/clmm?tab=deposit&poolAddress=${feeTier.poolAddress}`)\n      } else {\n        onOpen()\n      }\n    }\n    if (binStep && poolType === 'dlmm') {\n      if (binStep?.poolAddress) {\n        navigate(`/dlmm?tab=deposit&poolId=${binStep.poolAddress}`)\n      } else {\n        if (baseToken?.coin_type && quoteToken?.coin_type) {\n          try {\n            const address = await dlmmSdk?.Pool?.getPoolAddress(\n              fixCoinType(baseToken?.coin_type, true),\n              fixCoinType(quoteToken?.coin_type, true),\n              binStep?.binStep,\n              binStep?.baseFactor\n            )\n            if (address) {\n              setBinStep({ ...binStep, poolAddress: address })\n              navigate(`/dlmm?tab=deposit&poolId=${address}`)\n            } else {\n              onOpen()\n            }\n          } catch (error) {\n            onOpen()\n          }\n        }\n      }\n    }\n  }\n\n  const onConfirm = () => {\n    if (baseToken && quoteToken && feeTier && poolType === 'clmm') {\n      // create pool\n      setCurrentStep(2)\n      navigate(`/create-pool/${baseToken?.coin_type}/${quoteToken?.coin_type}/${feeTier?.feeRate}`)\n    }\n    if (baseToken && quoteToken && binStep && poolType === 'dlmm') {\n      setCurrentStep(2)\n      navigate(`/create-pool/${baseToken?.coin_type}/${quoteToken?.coin_type}/${binStep?.fee}`)\n    }\n  }\n\n  const handleBinStepChange = async (binStep: any, baseCoinType?: string, quoteCoinType?: string) => {\n    if (!binStep?.poolAddress && baseCoinType && quoteCoinType) {\n      try {\n        const address = await dlmmSdk?.Pool?.getPoolAddress(\n          fixCoinType(baseCoinType, true),\n          fixCoinType(quoteCoinType, true),\n          binStep?.binStep,\n          binStep?.baseFactor\n        )\n        if (address) {\n          setBinStep({ ...binStep, poolAddress: address })\n        } else {\n          setBinStep(binStep)\n        }\n      } catch (error) {\n        setBinStep(binStep)\n      }\n    } else {\n      setBinStep(binStep)\n    }\n  }\n\n  return {\n    poolType,\n    onContinue,\n    baseToken,\n    quoteToken,\n    setBaseToken,\n    setQuoteToken,\n    feeTier,\n    setFeeTier,\n    feeTierList,\n    onPoolTypeChange,\n    isOpen,\n    onClose,\n    onConfirm,\n    handleBinStepChange,\n    feeOptions,\n    binStep\n  }\n}\n\nexport default useSelectPool\n","import SelectTokenAndFeeConfirm from '@/components/liquidity/clmm/SelectTokenAndFeeConfirm'\nimport SelectPoolType from '@/components/pools/createPool/SelectPoolType'\nimport SelectPool from '@/components/selectPool'\nimport useSelectPool from '@/hooks/create-pool/useSelectPool'\nimport { BackButton } from '@cetus/ui-kit'\nimport { VStack } from '@chakra-ui/react'\nimport { useNavigate } from 'react-router-dom'\nfunction SelectForLiquidity() {\n  const navigate = useNavigate()\n  const {\n    poolType,\n    onContinue,\n    baseToken,\n    quoteToken,\n    setBaseToken,\n    setQuoteToken,\n    feeTier,\n    setFeeTier,\n    feeTierList,\n    onPoolTypeChange,\n    isOpen,\n    onClose,\n    onConfirm,\n    binStep,\n    feeOptions,\n    handleBinStepChange\n  } = useSelectPool()\n\n  const onBack = () => {\n    if (poolType === 'dlmm') {\n      navigate('/pools?tab=dlmm_pools')\n    } else {\n      navigate('/pools')\n    }\n  }\n\n  return (\n    <>\n      <VStack w=\"524px\" align=\"flex-start\" gap=\"20px\" mt=\"20px\">\n        <BackButton text=\"Pools\" onClick={onBack} />\n        <SelectPool\n          poolType={poolType}\n          title=\"Select pair\"\n          description=\"Select the token you want to provide liquidity for.\"\n          onContinue={onContinue}\n          baseToken={baseToken}\n          onBaseTokenChange={token => setBaseToken(token)}\n          quoteToken={quoteToken}\n          onQuoteTokenChange={token => setQuoteToken(token)}\n          feeTier={feeTier}\n          onFeeTierChange={fee => setFeeTier(fee)}\n          binStep={binStep}\n          binStepList={feeOptions}\n          onBinStepChange={value => handleBinStepChange(value, baseToken?.coin_type, quoteToken?.coin_type)}\n          fromSource=\"addLiquidity\"\n          feeTierList={feeTierList}\n        >\n          <SelectPoolType type={poolType} onChange={onPoolTypeChange} currentStep={1} wrapStyle={{ p: '0' }} fromSource=\"addLiquidity\" />\n        </SelectPool>\n      </VStack>\n      {isOpen && (\n        <SelectTokenAndFeeConfirm\n          title=\"This Pool has not been initialized\"\n          subTitle=\"Do you want to initialize it?\"\n          btnText=\"Initialized Pool\"\n          isOpen={isOpen}\n          onClose={onClose}\n          onConfirm={onConfirm}\n        />\n      )}\n    </>\n  )\n}\n\nexport default SelectForLiquidity\n"],"names":["useSelectPool","navigate","useNavigate","baseToken","setBaseToken","useState","quoteToken","setQuoteToken","envConfigs","feeTier","setFeeTier","feeTierList","setFeeTierList","fetchFeeTierList","getBinStepConfigs","useCreatePoolHelper","quoteWhiteTokenList","useQuoteWhiteTokenList","poolType","setPoolType","setCurrentStep","useCreatePoolStore","feeOptions","setFeeOptions","binStep","setBinStep","dlmmSdk","useSdk","onPoolTypeChange","type","updateFeeTierList","res","item","title","_a","isTrustedToken","clmmDefaultFeeOptions","updateBinStepList","dlmmDefaultFeeOptions","useEffect","isOpen","onOpen","onClose","useDisclosure","address","fixCoinType","baseCoinType","quoteCoinType","SelectForLiquidity","onContinue","onConfirm","handleBinStepChange","onBack","jsxs","Fragment","VStack","jsx","BackButton","SelectPool","token","fee","value","SelectPoolType","SelectTokenAndFeeConfirm"],"mappings":"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"}