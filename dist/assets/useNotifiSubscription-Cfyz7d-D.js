import{u as _}from"./useNotifiAlerts-Duz6Uw_i.js";import{b as v,aJ as T,d as D,M as U}from"./index-ihcskjKt.js";import"./cross-CbhIs7DK.js";import{u as j}from"./useXCetusHelper-CrXtSO0d.js";import"./vendor-CBmAETR3.js";import{u as E}from"./useCurrentPos-qZJLM1cy.js";function O(){const{fetchOwnerVeNFT:N}=j(),{showCommonToast:n}=v(),{notifiSources:u}=T(),{setNotifiSubscriptionLoading:g}=T();return{createNotifiSubscriptionVerify:async()=>{try{const i=await N();if(i!=null&&i.xcetus_balance){if(D(i.xcetus_balance).div(Math.pow(10,9)).lessThan(1e3))return n("Price alerts are currently open to users who hold 1000+ xCETUS.","rejected"),!1}else return n("Unable to fetch xCetus information.","rejected"),!1;return u.length>=5?(n("Price alerts can only be enabled for up to 5 positions for an account at the same time.","rejected"),!1):!0}catch(i){return console.error("ğŸš€ ~ createNotifiSubscriptionVerify ~ error:",i),g(!1),n("An error occurred while verifying the subscription.","rejected"),!1}},getPositionNotifiStatus:(i,p)=>{console.log("ğŸš€ğŸš€ğŸš€ ~ useNotifiHelper.ts:46 ~ getPositionNotifiStatus ~ notifiSources:",u);try{const r=u.find(P=>{const{pool_address:S,position_index:b}=P;return S===i&&b===p});return{isSubscription:!!r,alertID:(r==null?void 0:r.alertID)||""}}catch(r){return console.error("ğŸš€ ~ getPositionNotifiStatus ~ error:",r),{isSubscription:!1,alertID:""}}}}}function H(){const{getCurrentPosByPosId:N}=E(),{currentAccount:n}=U(),{createNotifiAlert:u,deleteNotifiAlerts:g}=_(),{setIsChecked:I,setNotifiSubscriptionLoading:m,notifiClient:i}=T(),{createNotifiSubscriptionVerify:p,getPositionNotifiStatus:r}=O(),P=async o=>{if(m(!0),!await p())return I(!1),!1;const{subscriptionSource:e,position:s,posIndex:d,events:l}=o;console.log("ğŸš€ğŸš€ğŸš€ ~ useNotifiSubscription.ts:30 ~ notifiSubscription ~ notifiSubscriptionParams:",o);try{if(e=="PositionDetail")S(String(s),String(d));else{const a=l.filter(x=>x.type.indexOf("OpenPositionEvent")>-1)[0],t=l.filter(x=>x.type.indexOf("DepositEvent")>-1)[0],{position:f,pool:w}=a.parsedJson,h=t?t.parsedJson.wrapped_position_id:a.parsedJson.position,y=await N(n==null?void 0:n.address,h);y&&(console.log("ğŸš€ğŸš€ğŸš€ ~ file: useNotifiSubscription.ts:36 ~ notifiSubscription ~ currentPosInfo.index:",y.index),S(f,String(y.index)))}}catch(a){m(!1),console.log("ğŸš€ğŸš€ğŸš€ ~ file: useNotifiSubscription.ts:45 ~ notifiSubscription ~ error:",a)}},S=async(o,c)=>{u(o,c)},b=async(o,c,e)=>{console.log("ğŸš€ğŸš€ğŸš€ ~ useNotifiSubscription.ts:57 ~ notifiUnSubscription ~ posId:",o),console.log("ğŸš€ğŸš€ğŸš€ ~ useNotifiSubscription.ts:58 ~ notifiUnSubscription ~ posIndex:",e);const{alertID:s}=r(o,String(e));console.log("ğŸš€ğŸš€ğŸš€ ~ useNotifiSubscription.ts:59 ~ notifiUnSubscription ~ alertID:",s),s&&g(s)};return{notifiSubscription:P,notifiUnSubscription:b,getNotifiPositionTransfer:(o,c,e)=>{if(c&&c.userState&&c.userState.status=="authenticated"){console.log("ğŸš€ğŸš€ğŸš€ ~ useNotifiSubscription.ts:62 ~ getNotifiPositionTransfer ~ notifiSources:",e);for(let s=0;s<e.length;s++){const{pool_address:d,position_index:l}=e[s];let a=!1,t;for(let f=0;f<o.length;f++){const{posId:w,index:h}=o[f];d==w&&Number(h)==Number(l)&&(a=!0),t={pool_address:d,position_index:l,clmmPool:o[f].clmmPool}}a||b(t==null?void 0:t.pool_address,t==null?void 0:t.clmmPool,t==null?void 0:t.position_index)}}console.log("ğŸš€ğŸš€ğŸš€ ~ useNotifiSubscription.ts:60 ~ getNotifiPositionTransfer ~ notifiSources:",e),console.log("ğŸš€ğŸš€ğŸš€ ~ useNotifiSubscription.ts:60 ~ getNotifiPositionTransfer ~ posBaseList:",o),console.log("ğŸš€ğŸš€ğŸš€ ~ useNotifiSubscription.ts:60 ~ getNotifiPositionTransfer ~ notifiClient:",c.us)}}}export{H as u};
//# sourceMappingURL=useNotifiSubscription-Cfyz7d-D.js.map
