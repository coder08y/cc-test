import{c as Q,r as u,a as ft,j as e,M as mt,o as xt,p as ht,$ as gt,a0 as bt,q as yt,t as St,V as _,C as Fe,H as v,T as H,w as re,B as te,l as vt,as as jt,m as G}from"./vendor-CBmAETR3.js";import{i as _t,j as Le,Z as F,aj as wt,Q as ie,z as k,M as ye,dU as ee,T as ge,a3 as Rt,ae as Tt,a as He,a7 as It,O as At,ah as xe,I as q,S as be,E as se,a8 as Ct,c8 as We,u as Be,p as Qe,c as et,cv as kt,e as Ve}from"./index-Lo8eQgA0.js";import{c as Mt}from"./useSwapHelper-BDfKH-rI.js";import{u as Ot}from"./useAccountBalance-Bp-GiNHM.js";import{B as Pt,T as Et}from"./cross-J9VCREIf.js";import{u as Ue}from"./useTokenBalance-B8pbbpGD.js";import{i as ue,r as Se}from"./typeof-DiuEXoG3.js";import{r as tt}from"./tslib.es6-DnZfMYI-.js";import{a as Lt}from"./debounce-MPJy35Ge.js";import{u as zt}from"./useTransaction-C3m_5TTr.js";import{b as Ft,c as qe}from"./useSwap-HaNq9_Of.js";import{u as ve}from"./index-BgoHGJbV.js";import{v as $e}from"./v4-C6aID195.js";import{B as Ht}from"./BackButton-D2-OxVyR.js";import{H as ce}from"./HTextLabelBox-0wWY3DfK.js";import{E as he}from"./ErrorTips-BLWaROlb.js";import{c as Wt,S as Bt,O as nt,R as Ut}from"./useGetRouterConfig-BTy0MLX6.js";import{u as ot}from"./usePriceImpact-d6OtzSL1.js";import{C as rt}from"./CurrentPrice-fVnoCZ1x.js";import{P as st}from"./PriceImpact-DbxoofPM.js";import{S as Vt}from"./Slippage-jToMHVh_.js";import{A as qt}from"./index-Pa0sotw3.js";import{F as $t}from"./FreshProgressV2-D8JIZ9Mf.js";import"./useGetPoolList-Bo7JxsYj.js";import"./utils-BTUfT3hi.js";import"./useWrapPoolData-tzYpVDlL.js";import"./en_US-KAK2ZBDO-KTAiToGz.js";import"./useTrack-T_4vPqTb.js";import"./useSigner-Dol5aKH6.js";import"./useTransactionModal-Bz8Bofje.js";import"./aggregator-CK22pvE4.js";import"./index-9yHNdYxH.js";import"./index-D39Sw25C.js";import"./useFindBestRouting-CPdS9aqM.js";import"./useChainTime-BzvA1z1J.js";import"./index-D8UqOC8m.js";import"./_baseClone-BEKueZbq.js";import"./_getAllKeysIn-Doplhvy3.js";import"./_defineProperty-DWWEPMFy.js";import"./HighlightText-Dw_TnRsZ.js";import"./swap-ClL3XCB_.js";import"./MarketSource-Do5c0CXX.js";import"./TooltipIcon-Bqqgb7rr.js";import"./AggregatorModal-CMk7rWax.js";import"./index-CgYRIMgB.js";import"./index-Dq_SzPY7.js";const Dt=(t,n)=>({isOpenRoutePathModal:!1,setIsOpenRoutePathModal:o=>{t({isOpenRoutePathModal:o})},selectedRoutePathIndex:0,setSelectedRoutePathIndex:o=>{t({selectedRoutePathIndex:o})},isShowSelectRouter:!1,setIsShowSelectRouter:o=>{t({isShowSelectRouter:o})},mergeSwapQuote:void 0,setMergeSwapQuote:o=>{t({mergeSwapQuote:o})},findRouterLoading:!1,setFindRouterLoading:o=>{t({findRouterLoading:o})},fromAmountObj:{},setFromAmountObj:(o,r)=>{t({fromAmountObj:{...n().fromAmountObj,[o]:r}})},clearFromAmountObj:()=>{t({fromAmountObj:{}})},toAmount:"",setToAmount:o=>{t({toAmount:o})},toToken:{...Le.sui_coin},setToToken:o=>{t({toToken:o})},fromTokenList:[],setFromTokenList:o=>{const s={...n().fromAmountObj},a=new Set(o.map(c=>c.coin_type));Object.keys(s).forEach(c=>{a.has(c)||(s[c]="")}),t({fromTokenList:o,fromAmountObj:s})},switchFromToken:(o,r)=>{const s=n().fromTokenList,a=n().fromAmountObj,c=s.findIndex(i=>F(i.coin_type)===F(o.coin_type));a[s[r].coin_type]="",a[o.coin_type]="",s[r]=o;let l=s.filter((i,p)=>p!==c);t({fromTokenList:[...l],fromAmountObj:{...a}})},removeFromToken:o=>{const r=n().fromTokenList;t({fromTokenList:r.filter(s=>s.coin_type!==o.coin_type)})},clearData:()=>{t({fromTokenList:[],toToken:{...Le.sui_coin},toAmount:"",findRouterLoading:!1,mergeSwapQuote:void 0,isShowSelectRouter:!1,fromAmountObj:{},isOpenRoutePathModal:!1,selectedRoutePathIndex:0})}}),Y=_t(Dt);var it={},Ie={},Ae={},De;function Nt(){return De||(De=1,function(t){var n=ue;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"debounce",{enumerable:!0,get:function(){return r.default}});var o=n(Se()),r=n(Lt);function s(){var a=(typeof Q>"u"||typeof Q>"u"?"undefined":(0,o.default)(Q))=="object"&&Q&&Q.Object===Object&&Q,c=(typeof self>"u"?"undefined":(0,o.default)(self))=="object"&&self&&self.Object===Object&&self;return a||c}s()||(Q.Date=Date)}(Ae)),Ae}var Ce={},Ne;function at(){return Ne||(Ne=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=u;function o(r){var s=(0,n.useRef)(r);return s.current=r,s}t.default=o}(Ce)),Ce}var ke={},O={},Ge;function lt(){if(Ge)return O;Ge=1;var t=ue;Object.defineProperty(O,"__esModule",{value:!0}),O.isUndef=O.isString=O.isObject=O.isNumber=O.isFunction=O.isBoolean=void 0;var n=t(Se());return O.isObject=function(r){return r!==null&&(0,n.default)(r)==="object"},O.isFunction=function(r){return typeof r=="function"},O.isString=function(r){return typeof r=="string"},O.isBoolean=function(r){return typeof r=="boolean"},O.isNumber=function(r){return typeof r=="number"},O.isUndef=function(r){return typeof r>"u"},O}var Me={},Ye;function ct(){return Ye||(Ye=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=!1;t.default=n}(Me)),Me}var Ze;function Gt(){return Ze||(Ze=1,function(t){var n=ue;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=n(Se()),r=u,s=n(at()),a=lt(),c=n(ct()),l=function(p){c.default&&((0,a.isFunction)(p)||console.error("useUnmount expected parameter is a function, got ".concat((0,o.default)(p))));var d=(0,s.default)(p);(0,r.useEffect)(function(){return function(){d.current()}},[])};t.default=l}(ke)),ke}var Xe;function Yt(){return Xe||(Xe=1,function(t){var n=ue;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=n(Se()),r=tt,s=Nt(),a=u,c=n(at()),l=n(Gt()),i=lt(),p=n(ct());function d(f,g){var y;p.default&&((0,i.isFunction)(f)||console.error("useDebounceFn expected parameter is a function, got ".concat((0,o.default)(f))));var h=(0,c.default)(f),j=(y=g==null?void 0:g.wait)!==null&&y!==void 0?y:1e3,M=(0,a.useMemo)(function(){return(0,s.debounce)(function(){for(var m=[],w=0;w<arguments.length;w++)m[w]=arguments[w];return h.current.apply(h,(0,r.__spreadArray)([],(0,r.__read)(m),!1))},j,g)},[]);return(0,l.default)(function(){M.cancel()}),{run:M,cancel:M.cancel,flush:M.flush}}t.default=d}(Ie)),Ie}var Oe={},Pe={},Ke;function Zt(){return Ke||(Ke=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.createUpdateEffect=void 0;var n=u,o=t.createUpdateEffect=function(s){return function(a,c){var l=(0,n.useRef)(!1);s(function(){return function(){l.current=!1}},[]),s(function(){if(!l.current)l.current=!0;else return a()},c)}};t.default=o}(Pe)),Pe}var Je;function Xt(){return Je||(Je=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=u,o=Zt();t.default=(0,o.createUpdateEffect)(n.useEffect)}(Oe)),Oe}(function(t){var n=ue;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=tt,r=u,s=n(Yt()),a=n(Xt());function c(l,i,p){var d=(0,o.__read)((0,r.useState)({}),2),f=d[0],g=d[1],y=(0,s.default)(function(){g({})},p).run;(0,r.useEffect)(function(){return y()},i),(0,a.default)(l,[f])}t.default=c})(it);const Ee=ft(it),Kt=(t,n)=>u.useMemo(()=>{if(t!=null&&t.data&&(n!=null&&n.data)){const o={};return t.data.allRoutes.forEach(s=>{o[s.paths[0].from]=k(s.amountOut.toString()).div(s.amountIn.toString()).toString()}),n.data.allRoutes.find(s=>{const a=k(s.amountOut.toString()).div(s.amountIn.toString()).toString(),c=o[s.paths[0].from];return c?!k(a).eq(k(c)):!1})?n:void 0}},[t,n]),ut=(t,n)=>u.useMemo(()=>{if(n)return k(n).mul(k(1).sub(k(t))).toString()},[n,t]);function Jt(t){const[n,o]=u.useState([]);return ve(()=>{const r=new Set;t.forEach(s=>{s.provider&&r.add(s.provider)}),o(Array.from(r))},[t]),{routeProviders:n}}function Qt(t,n){const{getTokenPrice:o,fetchTokenPrices:r}=ie(),s=(a,c,l=!1)=>{const i=c?[...a,c]:[...a],p=[];i.forEach(d=>{o(d.coin_type,l?void 0:3e4)||p.push(d.coin_type)}),p.length>0&&r(p)};return ve(()=>{s(t,n)},[t,n]),{handleTokenPrices:s}}function en(t){var s;ie();const[n,o]=u.useState(!1);return{allProviders:u.useMemo(()=>{var a;if(t&&((a=t.data)!=null&&a.allRoutes)){const c=new Set;return t.data.allRoutes.forEach(l=>{l.paths.forEach(i=>{i.provider&&c.add(i.provider)})}),Array.from(c)}},[(s=t==null?void 0:t.data)==null?void 0:s.allRoutes]),hasHighPriceDiff:n}}function tn(t,n){const{getTokenAmountValue:o,coinPriceObj:r}=ie(),[s,a]=u.useState("");return ve(()=>{let c=k(0),l=!0;t.forEach(i=>{const p=n[i.coin_type];if(+p){const d=o(i.coin_type,p);+d?c=c.add(k(d)):l=!1}}),a(l?c.toString():"Incalculable")},[n,r]),{totalInputValue:s}}function nn(t,n){const{currentAccount:o}=ye(g=>({currentAccount:g.currentAccount})),{getBalanceInfoFromCache:r,tokenBalanceObj:s}=Ue(),[a,c]=u.useState(!1),[l,i]=u.useState(!1),[p,d]=u.useState(!1),f=u.useCallback((g,y)=>{let h=g.length>0,j=!1,M=!1;return g.forEach(m=>{+y[m.coin_type]?M=!0:h=!1}),o&&h?j=g.every(m=>{const w=r(m),E=y[m.coin_type];return w&&+E?k(w.balanceFormat).gte(E):!1}):j=!1,{isAllBalanceEnough:j,isAllInputValid:h,hasAnyInput:M}},[o,s,t,n]);return ve(()=>{const{isAllBalanceEnough:g,isAllInputValid:y,hasAnyInput:h}=f(t,n);i(y),c(g),d(h)},[n,t,o,s]),{isAllBalanceEnough:a,isAllInputValid:l,verifySwapInput:f,hasAnyInput:p}}function on(t,n,o,r,s){const a={uuid:t,fromTokenList:o,toToken:n,fromAmountObj:r,totalAmountOut:"",totalAmountOutDisplay:""};if(s){const c=s.totalAmountOut.toString();if(a.data=s,s.error){if(a.error=s.error,a.error.code===ee.BadRequest&&a.error.msg){const l=a.error.msg,i=/0x[a-fA-F0-9]{64}::[a-zA-Z0-9_]+::[a-zA-Z0-9_]+/,p=l.match(i);if(p){const d=p[0],f=o.find(g=>g.coin_type===d);f&&(a.error.coin=f,a.error.code=ee.InsufficientLiquidity)}}}else s.allRoutes.length===0?a.error={code:ee.BadRequest,msg:"no router"}:(a.totalAmountOut=c,a.totalAmountOutDisplay=ge(c,n.decimals))}else a.error={code:ee.BadRequest,msg:"no router"};return a}function rn(t){const{scamsCoinList:n}=Ft(t),[o,r]=u.useState("");return wt(()=>{if(n.length===0){r("");return}const s=[];if(n.forEach(a=>{const c=t.find(l=>F(l.coin_type,!1)===F(a.coin_type,!1));c&&s.push(c)}),s.length===0){r("");return}r(s.map(a=>a.symbol).join(", ")),s.length===1?r(`${s[0].symbol} token is `):s.length===2?r(`${s[0].symbol} and ${s[1].symbol} are `):r(`${s.map(a=>a.symbol).join(", ")} are `)},[n,t]),{scamsText:o}}function sn(){const{aggregatorSDK:t}=Rt(),{providers:n}=Tt(),{currentAccount:o}=ye(),{slippage:r,mevProtect:s,maxCapForGas:a,transactionMode:c,customGasPrice:l}=He(),{fetchAccountBalance:i}=Ot(),{providersSwitchStates:p}=Mt(),{fromTokenList:d,setToAmount:f,findRouterLoading:g,setFindRouterLoading:y,toToken:h,fromAmountObj:j,clearFromAmountObj:M,mergeSwapQuote:m,setMergeSwapQuote:w,clearData:E,setIsShowSelectRouter:$}=Y(),W=u.useRef(""),{getTokenAmountValue:Z,fetchTokenPrices:U}=ie(),[X,ae]=u.useState(!1),ne=u.useRef(null),{verifiedTokenMap:K}=It(x=>({verifiedTokenMap:x.verifiedTokenMap})),{handleTokenPrices:S}=Qt(d,h),R=()=>{var x;(x=ne.current)==null||x.reset()};u.useEffect(()=>()=>{E()},[]),u.useEffect(()=>{U([Le.sui_coin.coin_type])},[]);const{totalInputValue:V}=tn(d,j),{isAllInputValid:B,isAllBalanceEnough:L,verifySwapInput:I,hasAnyInput:pe}=nn(d,j),P=u.useMemo(()=>B&&L,[B,L]),de=u.useMemo(()=>[...Array.from(K.values()).filter(x=>x.is_merge_target&&Number(x.is_merge_target)>0)],[K]),N=async(x,D,b,A)=>{y(!0),R();const z={target:D.coin_type,byAmountIn:!0,depth:3,providers:Object.entries(p).filter(([T,C])=>C===!0).map(([T,C])=>T),froms:x.map(T=>({coinType:T.coin_type,amount:new Pt(At(b[T.coin_type],T.decimals))}))};if(W.current===A)try{console.log("findRouter params",z,W.current,A);const T=await t.findMergeSwapRouters(z),C=on(A,D,x,b,T);console.log("findRouter result",{routerResult:T,quote:C,uuidRef:W.current,uuid:A}),W.current===A&&(w(C),C&&!(C!=null&&C.error)?$(!0):$(!1))}catch(T){console.log("findRouter error",T),w(void 0)}finally{y(!1)}},le=()=>{W.current="",f(""),y(!1),w(void 0),$(!1)};Ee(()=>{const{isAllInputValid:x,isAllBalanceEnough:D}=I(d,j);if(x&&D&&P&&h&&o){const b=$e();W.current=b,N(d,h,j,b)}else le()},[d,j,h,o,P,p],{wait:300}),Ee(()=>{m&&!(m!=null&&m.error)?$(!0):$(!1)},[m]),Ee(()=>{P&&h&&o||le()},[o,P]);const oe=()=>{if(P&&h){const x=$e();W.current=x,N(d,h,j,x)}else le()},je=u.useMemo(()=>m!=null&&m.totalAmountOut?Z(m.toToken.coin_type,m.totalAmountOutDisplay):"",[m]),{balanceInfo:J}=Ue(h),fe=ut(r.toString(),m==null?void 0:m.totalAmountOutDisplay),{signAndExecuteTransaction:_e,transactionConfirmation:me}=zt();return{totalOutValue:je,totalInputValue:V,minReceivedAmount:fe,toBalanceInfo:J,handleSwapSubmit:async x=>{console.log("🚀 ~ handleSwapSubmit ~ swapData:",{swapData:x,slippage:r,aggregatorPartner:qe});const{data:D,fromTokenList:b}=x,A={getShowInfo:z=>{const T=b.length>1?`Swapping ${b.length} tokens for ${xe(x.totalAmountOutDisplay)} ${x.toToken.symbol}`:`Swapping  ${xe(x.fromAmountObj[x.fromTokenList[0].coin_type])} ${x.fromTokenList[0].symbol} for ${xe(x.totalAmountOutDisplay)} ${x.toToken.symbol}`,C={modalDescriptionText:T,toastTitleText:T};if(z==="success"){const Te=T.replace("Swapping","Swapped");C.toastDescriptionContent=Te,C.modalDescriptionText=Te,C.toastTitleText="Swap Successful"}return z==="rejected"&&(C.toastTitleText=T.replace("Swapping","Swap")),C}};me(A);try{const z=new Et,T={router:D,slippage:Number(r),txb:z,partner:qe};await _e(async()=>(await t.fastMergeSwap(T),z),A,{useMev:s})?(f(""),w(void 0),M(),setTimeout(()=>{i()},1e3)):oe()}catch(z){console.log("🚀 ~ handleSwapSubmit ~ error:",z)}},reCalculateRouteData:oe,isAllowFindRouter:P,isAllBalanceEnough:L,isAllInputValid:B,handleRefresh:()=>{oe(),X||i(),S(d,h)},isOpenConfirmModel:X,setIsOpenConfirmModel:ae,progressRef:ne,hasAnyInput:pe,targetTokenList:de}}const ze=1e4;function an(t,n,o){const{currentAccount:r}=ye(),{fromTokenList:s,mergeSwapQuote:a,toToken:c}=Y(i=>({fromTokenList:i.fromTokenList,mergeSwapQuote:i.mergeSwapQuote,toToken:i.toToken})),l=u.useMemo(()=>{const i={text:"Swap",disabled:!0};if(!(r!=null&&r.address))return i.text="Connect Wallet",i.disabled=!1,i;if(s.length===0||!c)return i.text="Select a token",i.disabled=!0,i;if(!t)return i.text="Enter an amount",i.disabled=!0,i;if(a!=null&&a.error){if(a.error.code===ee.InsufficientLiquidity||a.error.code===ee.HoneyPot)return i.text="Insufficient Liquidity",i.disabled=!0,i;if(a.error.code===ee.BadRequest)return i.text="No Available Route",i.disabled=!0,i}return n?+o&&k(o).gt(ze)?(i.disabled=!0,i):(a&&(i.disabled=!1),i):(i.disabled=!0,i.text="Insufficient  Balance",i)},[r==null?void 0:r.address,s,n,t,a,o]);return{btnText:l.text,btnDisabled:l.disabled}}function ln(t){var K;const{mergeSwapQuote:n}=Y(),{data:o,isOpen:r,onClose:s,handleRouterSwap:a}=t,{slippage:c}=He(),[l,i]=u.useState(!1),[p,d]=u.useState({}),[f,g]=u.useState(o),[y,h]=u.useState(!1),[j,M]=u.useState(!0),m=u.useRef(null),w=ut(c.toString(),f.totalAmountOutDisplay),E=Kt(f,n),[$,W]=u.useState(600),Z=u.useMemo(()=>E!==void 0,[E]),U=u.useCallback((S,R)=>{d(V=>({...V,[S]:R}))},[]);u.useEffect(()=>{const S=Object.values(p).some(R=>R);i(S)},[p]),u.useEffect(()=>{const S=()=>{if(m.current){const V=m.current,B=window.innerHeight-300,L=V.scrollHeight>B;M(L),W(B)}};S(),window.addEventListener("resize",S);let R=null;return m.current&&(R=new ResizeObserver(S),R.observe(m.current)),()=>{window.removeEventListener("resize",S),R&&R.disconnect()}},[m.current,f.fromTokenList,l,Z]);const X=u.useCallback(S=>{var B,L;const R=F(S,!1),V=(L=(B=f.data)==null?void 0:B.allRoutes.find(I=>F(I.paths[0].from,!1)===R))==null?void 0:L.amountOut.toString();return V?ge(V,f.toToken.decimals):"0"},[(K=f==null?void 0:f.data)==null?void 0:K.allRoutes,f.toToken.decimals]),ae=u.useMemo(()=>y?!1:!!l,[y,l]),ne=()=>{if(E){const S=Wt(E);g({...S})}};return e.jsxs(mt,{autoFocus:!1,returnFocusOnClose:!1,trapFocus:!1,isOpen:r,onClose:()=>s(),isCentered:!0,children:[e.jsx(xt,{}),e.jsxs(ht,{children:[e.jsx(gt,{children:e.jsx(bt,{fontWeight:"500",fontSize:"16px",children:"Merge Swap"})}),e.jsx(yt,{onClick:()=>s()}),e.jsx(St,{textAlign:"center",p:"16px",children:e.jsxs(_,{w:"100%",gap:"16px",children:[e.jsxs(_,{ref:m,w:"100%",gap:"8px",maxH:`${$}px`,overflowY:j?"auto":"visible",children:[f.fromTokenList.map(S=>e.jsx(cn,{fromToken:S,toToken:f.toToken,fromAmount:f.fromAmountObj[S.coin_type],toAmount:X(S.coin_type),onPriceImpactWarnChange:R=>U(S.coin_type,R)},S.coin_type)),e.jsx(Fe,{minH:"36px",maxH:"36px",w:"36px",h:"36px",mt:"8px",mb:"8px",borderRadius:"50%",border:"1px solid",borderColor:"token_inactive_border",bg:"input_bg",children:e.jsx(q,{cursor:"default",xlinkHref:"#icon-a-icon_trade",svgFill:"text_caption",fontSize:"12px"})}),e.jsxs(v,{justifyContent:"center",w:"100%",borderRadius:"12px",bg:"bg_primary",border:"1px solid",borderColor:"border",p:"16px",gap:"8px",children:[e.jsx(be,{imageUrl:f.toToken.logo_url,w:"32px",h:"32px",coinType:o.toToken.coin_type}),e.jsxs(H,{fontSize:"16px",color:"text_caption",children:[se(f.totalAmountOutDisplay,f.toToken.decimals)," ",f.toToken.symbol]})]}),e.jsx(ce,{label:"Slippage Tolerance",value:Ct(Number(c)*100),labelStyle:{fontWeight:500,whiteSpace:"nowrap",fontSize:"14px"},valueStyle:{fontWeight:500,fontSize:"14px"},skeletonStyle:{valueW:"128px"},wrapStyle:{mt:"8px"}}),e.jsx(ce,{label:"Minimum Received",value:`${se(w,f.toToken.decimals)} ${f.toToken.symbol}`,labelStyle:{fontWeight:500,whiteSpace:"nowrap",fontSize:"14px"},valueStyle:{fontWeight:500,fontSize:"14px"},skeletonStyle:{valueW:"128px"},wrapStyle:{mt:"8px"}})]}),l&&e.jsxs(_,{w:"100%",gap:"8px",children:[e.jsx(v,{w:"100%",bg:"primary_red_opacity.10",borderRadius:"12px",border:"1px solid",borderColor:"border",justifyContent:"start",p:"10px 16px",children:e.jsx(H,{color:"primary_red",fontSize:"12px",lineHeight:"20px",textAlign:"start",children:"The exchange rate of this order deviates from the market price by a large percentage. Are you sure you want to continue the swap?"})}),e.jsxs(v,{w:"100%",justifyContent:"space-between",gap:"16px",children:[e.jsx(re,{variant:"outline",w:"100%",color:"text_highlight",fontSize:"14px",borderColor:y?"text_highlight":"button_outline_border",onClick:()=>{h(!0)},children:"Yes, please continue."}),e.jsx(re,{variant:"outline",w:"100%",color:"text_highlight",fontSize:"14px",borderColor:"button_outline_border",onClick:()=>s(),children:"No,cancel it."})]})]}),Z&&e.jsxs(v,{w:"100%",justifyContent:"space-between",children:[e.jsxs(v,{children:[e.jsx(q,{xlinkHref:"#icon-icon_priceupdated1",svgW:"20px",svgH:"20px"}),e.jsx(H,{color:"text_caption",fontWeight:"500",fontSize:"14px",children:"Price updated"})]}),e.jsx(re,{onClick:ne,h:"40px",borderRadius:"12px",fontSize:"16px",fontWeight:"500",p:"0 42px",children:"Accept"})]}),!Z&&e.jsx(re,{fontSize:"18px",fontWeight:"500",width:"100%",h:"52px",isDisabled:ae,colorScheme:l?"orange":"blue",onClick:()=>{a(f),s()},children:"Confirm"})]})})]})]})}function cn(t){const{fromToken:n,toToken:o,fromAmount:r,toAmount:s,onPriceImpactWarnChange:a}=t,{marketPrice:c,sources:l,priceImpactTextInfo:i,showIncalculable:p,showPriceImpactWarn:d}=ot(n,o,r,s);return u.useEffect(()=>{a==null||a(d)},[d]),e.jsxs(_,{gap:"12px",w:"100%",borderRadius:"12px",bg:"bg_primary",border:"1px solid",borderColor:"border",p:"16px",children:[e.jsxs(v,{w:"100%",justifyContent:"space-between",children:[e.jsx(be,{imageUrl:n.logo_url,w:"32px",h:"32px",coinType:n.coin_type}),e.jsxs(_,{alignItems:"end",gap:"4px",children:[e.jsxs(H,{fontSize:"16px",color:"text_caption",fontWeight:"500",children:[se(r,n.decimals)," ",n.symbol]}),e.jsx(rt,{noIcon:!0,fromToken:n,toToken:o,fromValue:r,toValue:s,fontSize:"14px"})]})]}),e.jsx(te,{w:"100%",borderBottom:"1px dashed",borderColor:"border"}),e.jsx(st,{fromToken:n,toToken:o,marketPrice:c,priceImpact:i,sources:l,showIncalculable:p})]})}function un(t){const{progressRef:n,handleRefresh:o,callbackInterval:r}=t;return e.jsxs(v,{children:[e.jsx(qt,{showRfqSwitch:!1}),e.jsx(Vt,{slippageType:"merge_swap",showFastMode:!1}),e.jsx($t,{callbackInterval:r,ref:n,min:0,max:10,onClick:o})]})}function pn({handleRemoveClick:t,openSelectTokenModal:n}){const{fromTokenList:o}=Y(),r=u.useMemo(()=>o.length<6,[o]);return e.jsxs(_,{w:"100%",gap:"8px",children:[o.length===0&&e.jsx(fn,{openSelectTokenModal:n}),o.map((s,a)=>e.jsx(dn,{token:s,showRemoveIcon:o.length>1,handleRemoveClick:t,openSelectTokenModal:()=>{n("single",a)}},s.coin_type)),r&&e.jsx(re,{bg:"primary_opacity.10",color:"primary",w:"100%",h:"44px",fontSize:"14px",borderRadius:"12px",_hover:{bg:"primary_opacity.20"},variant:"solid",leftIcon:e.jsx(q,{cursor:"pointer",svgFill:"primary",xlinkHref:"#icon-a-icon_add1",fontSize:"14px"}),onClick:()=>{n("multiple",0)},children:"Add one more token"})]})}function dn({token:t,handleRemoveClick:n,openSelectTokenModal:o,showRemoveIcon:r}){const{setFromAmountObj:s,fromAmountObj:a}=Y(),{getTokenAmountValue:c}=ie(),{balanceInfo:l}=Ue(t),i=a[t.coin_type]||"",p=c(t.coin_type,i);return e.jsxs(v,{w:"100%",gap:"8px",bg:r?"primary_opacity.10":"transparent",borderRadius:"12px",pr:r?"8px":"0px",children:[e.jsx(We,{value:i||"",balance:(l==null?void 0:l.balanceFormat)||"0",token:t,inputAllowed:!0,selectable:!0,placeholder:"0",openSelectTokenModal:o,onChange:function(d){s(t.coin_type,d)},amountValue:p,wrapStyle:{h:"98px",borderRadius:"12px"}}),r&&e.jsx(Fe,{w:"18px",h:"18px",borderRadius:"50%",bg:"primary_opacity.10",cursor:"pointer",_hover:{bg:"primary",svg:{fill:"black"}},onClick:()=>{n(t),s(t.coin_type,"")},children:e.jsx(q,{svgFill:"primary",xlinkHref:"#icon-tx_remove",fontSize:"10px",svgHover:"black"})})]})}function fn({openSelectTokenModal:t}){return e.jsx(We,{value:"",balance:"",inputAllowed:!0,selectable:!0,placeholder:"0",half:!1,max:!1,openSelectTokenModal:()=>{t("multiple",0)},onChange:()=>{},amountValue:"",wrapStyle:{h:"98px",borderRadius:"12px"},rightJustify:"flex-end",symbolTipStyle:{fontSize:"16px"}})}function pt(){var we,Re,x,D;Be();const t=vt(),{toToken:n,setToToken:o,setFromTokenList:r,switchFromToken:s,fromTokenList:a,removeFromToken:c,mergeSwapQuote:l,findRouterLoading:i,isOpenRoutePathModal:p,setIsOpenRoutePathModal:d,selectedRoutePathIndex:f,setSelectedRoutePathIndex:g,isShowSelectRouter:y}=Y(),{totalOutValue:h,totalInputValue:j,minReceivedAmount:M,toBalanceInfo:m,handleSwapSubmit:w,isAllInputValid:E,hasAnyInput:$,isAllBalanceEnough:W,handleRefresh:Z,isOpenConfirmModel:U,setIsOpenConfirmModel:X,progressRef:ae,targetTokenList:ne}=sn(),{btnText:K,btnDisabled:S}=an(E,W,h),{currentAccount:R,onWalletModal:V}=ye(),[B,L]=u.useState(!1),[I,pe]=u.useState("from"),[P,de]=u.useState("multiple"),[N,le]=u.useState(0),{scamsText:oe}=rn(a),je=u.useCallback(b=>{if(console.log("MergeSwapTrade 🚀 ~ onSelectToken ~ tokenInfo:",b),!!b)if(P==="multiple")n&&b.find(z=>F(z.coin_type)===F(n.coin_type))&&o(void 0),r(b);else if(I==="from"){const A=b;if(A.coin_type===a[N].coin_type)return;n&&F(A.coin_type)===F(n.coin_type)&&o(void 0),s(A,N)}else r(a.filter(A=>F(A.coin_type)!==F(b.coin_type))),o(b)},[P,I,a,n,N]),J=u.useRef(null),{allProviders:fe}=en(l),_e=u.useMemo(()=>P==="multiple"?a:I==="from"?a[N]:n,[a,n,P,N,I]),me=()=>U&&J.current?J.current:{...l};return u.useEffect(()=>{U||(J.current=null)},[U]),e.jsxs(_,{alignItems:"start",mt:{base:"28px",lg:"32px"},w:{base:"100%",lg:"470px"},position:"relative",gap:"12px",children:[e.jsx(Ht,{h:"28px",customTextStyle:{fontSize:"12px"},onClick:()=>{t("/swap")}}),e.jsxs(v,{mt:"20px",width:"100%",justifyContent:"space-between",alignItems:"center",children:[e.jsx(H,{fontSize:"16px",fontWeight:"500",color:"text_caption",children:"Merge Swap"}),e.jsx(un,{progressRef:ae,handleRefresh:Z,callbackInterval:U?5:10})]}),e.jsxs(_,{w:"100%",gap:"12px",pt:"12px",pb:"12px",alignItems:"start",children:[e.jsx(H,{fontSize:"13px",children:"You Pay"}),e.jsx(pn,{openSelectTokenModal:(b,A)=>{de(b),pe("from"),le(A),L(!0)},handleRemoveClick:b=>{c(b)}}),e.jsx(Fe,{w:"36px",h:"36px",ml:"calc(50% - 18px)",borderRadius:"50%",border:"1px solid",borderColor:"token_inactive_border",bg:"input_bg",children:e.jsx(q,{cursor:"default",xlinkHref:"#icon-a-icon_trade",svgFill:"text_caption",fontSize:"12px"})}),e.jsx(H,{fontSize:"13px",children:"You Receive"}),e.jsx(We,{token:n,value:(l==null?void 0:l.totalAmountOutDisplay)||"",balance:(m==null?void 0:m.balanceFormat)||"0",selectable:!0,placeholder:"0",inputAllowed:!1,half:!1,max:!1,loading:i,onChange:()=>{},openSelectTokenModal:()=>{pe("to"),de("single"),L(!0)},amountValue:h,wrapStyle:{h:"98px",borderRadius:"12px"},symbolTipStyle:{fontSize:"16px"}}),oe&&e.jsx(te,{mt:"-44px",p:"48px 16px 16px",borderRadius:"20px",bg:"bg_secondary",border:"1px solid",borderColor:"border",children:e.jsx(Bt,{scamsText:oe})}),!i&&h&&k(h).gt(ze)&&e.jsx(he,{mt:"-4px",type:"error",tips:`The Output exceeds the maximum: $${xe(ze)}`}),!i&&((we=l==null?void 0:l.error)==null?void 0:we.coin)&&e.jsx(he,{mt:"-4px",type:"error",tips:`Insufficient Liquidity on ${(x=(Re=l==null?void 0:l.error)==null?void 0:Re.coin)==null?void 0:x.symbol}`}),!R&&$&&e.jsx(he,{mt:"-4px",type:"warning",tips:"Please connect wallet to load results."}),e.jsxs(_,{gap:"12px",bg:"bg_secondary",w:"100%",borderRadius:"12px 12px 16px 16px",border:"1px solid",borderColor:"border",children:[e.jsx(re,{fontSize:"18px",fontWeight:"500",width:"100%",h:"52px",m:"-1px",isDisabled:S||i,isLoading:i,onClick:()=>{if(!(R!=null&&R.address)){V(!0);return}l&&(J.current={...l}),X(!0)},children:K}),(l==null?void 0:l.data)&&l.data.allRoutes.length>0&&y&&e.jsxs(_,{w:"100%",mt:"4px",pb:"12px",children:[e.jsx(ce,{isLoading:i,label:"Total Input Value",value:`${j==="Incalculable"?j:Qe(j,2)}`,labelStyle:{fontWeight:500,whiteSpace:"nowrap",fontSize:"14px"},valueStyle:{fontWeight:500,fontSize:"14px",color:j==="Incalculable"?"primary_yellow":"text_primary"},skeletonStyle:{valueW:"128px"},wrapStyle:{p:"0 8px",minH:"20px"}}),e.jsx(ce,{isLoading:i,label:"Minimum Received",value:`${se(M,n==null?void 0:n.decimals)} ${n==null?void 0:n.symbol}`,labelStyle:{fontWeight:500,whiteSpace:"nowrap",fontSize:"14px"},valueStyle:{fontWeight:500,fontSize:"14px"},skeletonStyle:{valueW:"128px"},wrapStyle:{p:"0 8px",minH:"20px"}}),e.jsxs(v,{w:"100%",justify:"space-between",align:"flex-start",p:"0 8px",mt:"2px",children:[e.jsx(H,{fontWeight:"500",whiteSpace:"nowrap",children:"Route"}),e.jsx(te,{mt:"-2px",onClick:b=>{et(b),d(!0),g(0)},cursor:"pointer",children:e.jsx(nt,{allProviders:fe,loading:i,children:e.jsx(q,{xlinkHref:"#icon-icon_spread",fontSize:"16px"})})})]})]})]})]}),U&&me()&&e.jsx(ln,{data:me(),onClose:()=>{X(!1),J.current=null},handleRouterSwap:b=>{w(b)},isOpen:U}),p&&(l==null?void 0:l.data)&&e.jsx(Ut,{isOpen:p,onClose:()=>{d(!1)},mergeSwapData:{allRoutes:[...(D=l==null?void 0:l.data)==null?void 0:D.allRoutes],currentIndex:f},toCoin:n,allProviders:fe}),e.jsx(kt,{selectType:P,value:_e,isShowCoinInfo:I==="from",showSearchInput:I==="from",isShowHotList:I!=="to",haveImport:I!=="to",isShowLabelTab:I!=="to",isShowTokenListTab:I!=="to",isShowCollectListBox:I==="from",whiteTokenList:I==="to"?ne:void 0,maxSelectNum:P==="multiple"?6:1,isOnlyMergeTargetToken:I==="to",onSelectToken:je,isOpen:B,onClose:()=>{L(!1)}})]})}function mn({route:t,index:n,openRoutesModal:o}){const{getTokenAmountValue:r}=ie();if(t.paths.length===0)return e.jsx(e.Fragment,{});const s=t.paths[0].from,a=t.paths[t.paths.length-1].target,{routeProviders:c}=Jt(t.paths||[]),{tokenInfo:l}=Ve(s),{tokenInfo:i}=Ve(a),p=ge(t.amountOut.toString(),(i==null?void 0:i.decimals)||0),d=ge(t.amountIn.toString(),(l==null?void 0:l.decimals)||0),f=r(a,p),{marketPrice:g,priceImpact:y,sources:h,priceImpactTextInfo:j,showIncalculable:M}=ot(l,i,d,p),[m,w]=u.useState(!1);return e.jsxs(_,{w:"100%",borderRadius:"12px",bg:"card_bg",p:"16px",gap:"12px",children:[e.jsxs(v,{w:"100%",justifyContent:"space-between",children:[e.jsxs(v,{gap:"8px",children:[e.jsx(be,{imageUrl:l==null?void 0:l.logo_url,w:"28px",h:"28px",coinType:s}),e.jsx(q,{xlinkHref:"#icon-icon_double_arrow_left",svgW:"12px",svgH:"12px",iconCursor:"default",showHover:!1}),e.jsx(be,{imageUrl:i==null?void 0:i.logo_url,w:"28px",h:"28px",coinType:a})]}),e.jsxs(_,{gap:"6px",alignItems:"end",children:[e.jsxs(H,{fontSize:"16px",color:"text_caption",fontWeight:"500",children:[se(p)," ",i==null?void 0:i.symbol]}),e.jsx(H,{fontSize:"14px",children:Qe(f,2)})]})]}),e.jsx(te,{w:"100%",borderBottom:"1px dashed",borderColor:"border"}),e.jsx(st,{fromToken:l,toToken:i,marketPrice:g,priceImpact:j,sources:h,showIncalculable:M}),e.jsxs(v,{w:"100%",justifyContent:"space-between",children:[e.jsx(rt,{noIcon:!0,fromToken:l,toToken:i,fromValue:d,toValue:p,color:"text_caption",fontSize:"14px"}),e.jsx(v,{flex:1,justifyContent:"end",alignItems:"center",cursor:"pointer",onClick:()=>w(!m),children:e.jsx(q,{transform:m?"rotate(0deg)":"rotate(180deg)",transition:"transform 0.5s",xlinkHref:"#icon-icon_ascending",fontSize:"18px"})})]}),k(y).lte(-30)&&e.jsx(he,{tipsFontSize:"12px",tips:"High price difference. Be cautious before submitting your order.",p:"8px",gap:"4px"}),e.jsx(jt,{unmountOnExit:!0,animateOpacity:!0,in:m,style:{width:"100%"},transition:{enter:{duration:.2,ease:"easeOut"},exit:{duration:.2,ease:"easeIn"}},children:e.jsx(xn,{toToken:i,amount_out_ui:p,allProviders:c,handleOpenRoutesModal:()=>o(n)})})]})}function xn({amount_out_ui:t,allProviders:n,handleOpenRoutesModal:o,toToken:r}){const{slippage:s}=He(),a=u.useMemo(()=>{if(+t)return k(t).mul(k(1).sub(k(s))).toString()},[s,t]);return e.jsxs(_,{w:"100%",bg:"primary_opacity.10",borderRadius:"8px",p:"12px",gap:"12px",children:[e.jsx(ce,{label:"Minimum Received",value:`${se(a)} ${r==null?void 0:r.symbol}`,labelStyle:{fontWeight:500,whiteSpace:"nowrap",fontSize:"14px"},valueStyle:{fontWeight:500,fontSize:"14px"},skeletonStyle:{valueW:"128px"},wrapStyle:{minH:"20px"}}),e.jsxs(v,{w:"100%",justify:"space-between",align:"flex-start",children:[e.jsx(H,{fontWeight:"500",whiteSpace:"nowrap",children:"Route"}),e.jsx(te,{mt:"-2px",onClick:c=>{et(c),o()},cursor:"pointer",children:e.jsx(nt,{allProviders:n,children:e.jsx(q,{xlinkHref:"#icon-icon_spread",fontSize:"16px"})})})]})]})}function dt(t){const{routerData:n,findRouterLoading:o}=t,[r,s]=u.useState(n);Be();const{setIsOpenRoutePathModal:a,setSelectedRoutePathIndex:c}=Y(i=>({setIsOpenRoutePathModal:i.setIsOpenRoutePathModal,setSelectedRoutePathIndex:i.setSelectedRoutePathIndex})),l=u.useMemo(()=>n?(s(n),n):r,[r==null?void 0:r.quoteID,n==null?void 0:n.quoteID]);return e.jsxs(_,{gap:"12px",alignItems:"start",mt:{base:"20px",lg:"144px"},w:{base:"100%",lg:"470px"},children:[e.jsx(H,{mt:"0px",fontSize:"13px",color:"text_caption",children:"Route"}),e.jsxs(_,{bg:"block_color_opacity.10",p:"12px",w:"100%",gap:"8px",borderRadius:"12px",border:"1px solid",borderColor:"border",children:[(!l||o)&&e.jsx(hn,{data:l}),l&&!o&&(l==null?void 0:l.allRoutes.map((i,p)=>e.jsx(mn,{route:i,index:p,openRoutesModal:d=>{a(!0),c(d)}},p+i.amountIn.toString()+(i==null?void 0:i.amountOut.toString()))))]})]})}function hn({data:t}){const n=(t==null?void 0:t.allRoutes)||[1,2,3];return e.jsx(_,{w:"100%",gap:"16px",children:n.map((o,r)=>e.jsxs(_,{width:"100%",bg:"bg_primary",position:"relative",alignItems:"flex-start",padding:"16px",borderRadius:"8px",border:"1px solid",borderColor:"border",gap:"12px",children:[e.jsxs(v,{w:"100%",justifyContent:"space-between",children:[e.jsxs(v,{children:[e.jsx(G,{boxSize:"32px",borderRadius:"50%"}),e.jsx(q,{xlinkHref:"#icon-icon_double_arrow_left",svgW:"12px",svgH:"12px",iconCursor:"default",showHover:!1}),e.jsx(G,{boxSize:"32px",borderRadius:"50%"})]}),e.jsxs(_,{alignItems:"flex-end",children:[e.jsx(G,{height:"20px",width:"100px"}),e.jsx(G,{height:"16px",width:"100px"})]})]}),e.jsxs(_,{w:"100%",gap:"8px",children:[e.jsxs(v,{w:"100%",justifyContent:"space-between",children:[e.jsx(v,{children:e.jsx(G,{height:"16px",width:"100px"})}),e.jsx(G,{height:"16px",width:"100px"})]}),e.jsxs(v,{w:"100%",justifyContent:"space-between",children:[e.jsx(v,{children:e.jsx(G,{height:"16px",width:"100px"})}),e.jsx(G,{height:"16px",width:"100px"})]})]})]},r))})}function po(){const{isApp:t}=Be(),{isShowSelectRouter:n,findRouterLoading:o,mergeSwapQuote:r}=Y(s=>({isShowSelectRouter:s.isShowSelectRouter,mergeSwapQuote:s.mergeSwapQuote,findRouterLoading:s.findRouterLoading}));return e.jsx(_,{w:t?"100%":"1200px",children:t?e.jsx(bn,{isShowSelectRouter:n,mergeSwapQuoteData:r,findRouterLoading:o}):e.jsx(gn,{isShowSelectRouter:n,mergeSwapQuoteData:r,findRouterLoading:o})})}function gn({isShowSelectRouter:t,mergeSwapQuoteData:n,findRouterLoading:o}){return e.jsx(te,{transition:"all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)",willChange:"transform",transform:t?"calc(50% - 235px))":"translateX(calc(50% - 235px))",children:e.jsxs(v,{alignItems:"start",gap:"16px",position:"relative",children:[e.jsx(pt,{}),e.jsx(te,{transition:"all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)",opacity:t?1:0,transform:t?"translateX(0) scale(1)":"translateX(30px) scale(0.95)",pointerEvents:t?"auto":"none",willChange:"transform, opacity",visibility:t?"visible":"hidden",children:e.jsx(dt,{routerData:n==null?void 0:n.data,findRouterLoading:o})})]})})}function bn({isShowSelectRouter:t,mergeSwapQuoteData:n,findRouterLoading:o}){var r;return e.jsxs(_,{w:"100%",maxW:"100%",gap:"0px",children:[e.jsx(pt,{}),t&&n&&!((r=n==null?void 0:n.data)!=null&&r.error)&&e.jsx(dt,{routerData:n==null?void 0:n.data,findRouterLoading:o})]})}export{po as default};
