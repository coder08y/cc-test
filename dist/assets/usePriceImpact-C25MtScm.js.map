{"version":3,"file":"usePriceImpact-C25MtScm.js","sources":["../../src/hooks/swap/usePriceImpact.ts"],"sourcesContent":["import useTokenPrice from '@cetus/hooks/src/useTokenPrice'\nimport { Token } from '@cetus/types'\nimport { Decimal, formatNumber } from '@cetus/utils'\nimport { d } from '@cetusprotocol/common-sdk'\nimport { useMemo } from 'react'\nimport { useGetSwapPrice } from './useSwapHelper'\n\nexport function usePriceImpact(fromToken?: Token, toToken?: Token, fromValue?: string, toValue?: string, verifyPrice = false) {\n  const { getTokenPrice } = useTokenPrice()\n\n  const fromTokenPrice = getTokenPrice(fromToken?.coin_type, verifyPrice ? 10 * 1000 * 60 : undefined)\n  const toTokenPrice = getTokenPrice(toToken?.coin_type, verifyPrice ? 10 * 1000 * 60 : undefined)\n\n  /**\n   * 兑换价格\n   */\n  const swapPrice = useGetSwapPrice(fromValue, toValue)\n\n  /**\n   * 市场价格\n   */\n  const marketPrice = useMemo(() => {\n    if (toTokenPrice && fromTokenPrice) {\n      return d(fromTokenPrice.price).div(toTokenPrice.price).toString()\n    }\n    return undefined\n  }, [fromTokenPrice?.price, toTokenPrice?.price])\n\n  /**\n   * 价差\n   */\n  const priceImpact = useMemo(() => {\n    if (marketPrice && +swapPrice) {\n      return d(swapPrice).sub(marketPrice).div(marketPrice).mul(100).toFixed(10)\n    }\n\n    return undefined\n  }, [marketPrice, swapPrice])\n\n  const priceImpactBasedOnMarket = useMemo(() => {\n    if (marketPrice && +swapPrice) {\n      return d(swapPrice).sub(marketPrice).div(marketPrice).mul(100).toFixed(10)\n    }\n    return undefined\n  }, [marketPrice, swapPrice])\n\n  /**\n   * 价格提供源\n   */\n  const sources = useMemo(() => {\n    const list = []\n    if (fromTokenPrice) {\n      list.push(fromTokenPrice.market)\n    }\n\n    if (toTokenPrice && !list.includes(toTokenPrice.market)) {\n      list.push(toTokenPrice.market)\n    }\n\n    return list\n  }, [fromTokenPrice?.market, toTokenPrice?.market])\n\n  const showIncalculable = useMemo(() => {\n    if (!fromTokenPrice || !toTokenPrice) {\n      return true\n    }\n    if (fromTokenPrice.market === 'cetus' || toTokenPrice.market === 'cetus') {\n      return true\n    }\n    return false\n  }, [fromTokenPrice, toTokenPrice])\n\n  /**\n   * 是否展示提示\n   */\n  const showPriceImpactTips = useMemo(() => {\n    if (showIncalculable) {\n      return false\n    }\n    if (priceImpact && d(priceImpact).lt(0)) {\n      return d(priceImpact).abs().gt(5)\n    }\n    return false\n  }, [priceImpact])\n\n  /**\n   * 是否展示警告\n   */\n  const showPriceImpactWarn = useMemo(() => {\n    if (showIncalculable) {\n      return false\n    }\n    if (priceImpact && d(priceImpact).lt(0)) {\n      return d(priceImpact).abs().gt(10)\n    }\n    return false\n  }, [priceImpact, showIncalculable])\n\n  const priceImpactTextInfo = useMemo(() => {\n    let priceImpactText = undefined\n    let textColor = 'primary_yellow'\n\n    if (showIncalculable) {\n      return {\n        priceImpactText: 'Incalculable',\n        textColor: 'primary_yellow'\n      }\n    }\n\n    if (priceImpact) {\n      // 大于0\n      if (d(priceImpact).gt(0)) {\n        textColor = 'primary_green'\n        // < 0.1%\n        if (d(priceImpact).lt(0.1)) {\n          priceImpactText = '< 0.1% better than'\n        } else {\n          // > 0.1%\n          priceImpactText = `${formatNumber(priceImpact, 2, true, Decimal.ROUND_UP)}% better than`\n        }\n      } else if (d(priceImpact).eq(0)) {\n        // 等于0\n        priceImpactText = '0%'\n        textColor = 'primary_green'\n      } else {\n        // 小于0\n        const priceImpactAbs = d(priceImpact).abs()\n        if (priceImpactAbs.lte(5)) {\n          // [-5%,0%)\n          textColor = 'primary_green'\n          priceImpactText = `Within ${formatNumber(priceImpactAbs.toString(), 2, true, Decimal.ROUND_UP)}%`\n        } else if (priceImpactAbs.lte(10)) {\n          // [-10%,-5%)\n          textColor = 'primary_yellow'\n          priceImpactText = `${formatNumber(priceImpactAbs.toString(), 2, true, Decimal.ROUND_UP)}% away from`\n        } else if (priceImpactAbs.lte(100)) {\n          // [-100%,-10%)\n          textColor = 'primary_red'\n          priceImpactText = `${formatNumber(priceImpactAbs.toString(), 2, true, Decimal.ROUND_UP)}% away from`\n        } else {\n          // < -100%\n          textColor = 'primary_red'\n          priceImpactText = `> 100% away from`\n        }\n      }\n    }\n    return {\n      priceImpactText,\n      textColor\n    }\n  }, [priceImpact, showIncalculable])\n\n  return {\n    swapPrice,\n    marketPrice,\n    priceImpact,\n    sources,\n    showPriceImpactTips,\n    showPriceImpactWarn,\n    priceImpactTextInfo,\n    priceImpactBasedOnMarket,\n    showIncalculable\n  }\n}\n"],"names":["usePriceImpact","fromToken","toToken","fromValue","toValue","verifyPrice","getTokenPrice","useTokenPrice","fromTokenPrice","toTokenPrice","swapPrice","useGetSwapPrice","marketPrice","useMemo","d","priceImpact","priceImpactBasedOnMarket","sources","list","showIncalculable","showPriceImpactTips","showPriceImpactWarn","priceImpactTextInfo","priceImpactText","textColor","formatNumber","Decimal","priceImpactAbs"],"mappings":"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"}