import{r as p,j as e,M as ae,o as re,p as ie,$ as ce,a0 as le,q as de,t as ue,V as B,H as L,T as R,w as K,B as Ce,D as be,E as ge,G as Te,J as we}from"./vendor-CBmAETR3.js";import{u as H}from"./useTransaction-C3m_5TTr.js";import{M as E,f as P,N as O,j as k,d as Q,O as te,ah as q,G as J,ad as se,w as Se,B as oe,a8 as fe,u as je,S as $,E as ve,Q as ye,cV as Ie,al as ke,z as ee,Z as De}from"./index-Lo8eQgA0.js";import{M as G}from"./msafe-BzcjPV-e.js";import{u as N}from"./useAccountBalance-Bp-GiNHM.js";import{T as Me,n as _e}from"./cross-J9VCREIf.js";import{u as xe}from"./useTokenBalance-B8pbbpGD.js";import{u as z,a as me,b as Re,c as Oe,d as Ae}from"./useXCetusHelper-CH_eZp0G.js";import{T as pe}from"./TradeInputGroup-DzPgsb9a.js";import{C as Le}from"./CheckBox-BfyJMUfq.js";import{H as Pe}from"./HighlightText-Dw_TnRsZ.js";import{a as Ue}from"./index-D39Sw25C.js";import{H as Ee}from"./HTextLabelBox-0wWY3DfK.js";import{T as Xe}from"./TradeConfirmAmountInfo-DwLYGD8Z.js";import{H as Fe}from"./HiddenDotted-D7bAXnIM.js";import{u as Be}from"./activeOrders-Blk-EQ9B.js";const lt=(u,a,n="seconds")=>{const o=()=>{const r=u-new Date().getTime();if(r<=0)return{years:0,months:0,days:0,hours:0,minutes:0,seconds:0};const l=Math.floor(r/1e3%60),i=Math.floor(r/1e3/60%60),t=Math.floor(r/(1e3*60*60)%24),f=Math.floor(r/(1e3*60*60*24)%30),C=Math.floor(r/(1e3*60*60*24*30)%12),b=Math.floor(r/(1e3*60*60*24*365));return n==="days"?{years:0,months:0,days:f+C*30+b*365,hours:t,minutes:i,seconds:l}:n==="months"?{years:0,months:C+b*12,days:f,hours:t,minutes:i,seconds:l}:{years:b,months:C,days:f,hours:t,minutes:i,seconds:l}},[c,s]=p.useState(o());return p.useEffect(()=>{if(u-new Date().getTime()<=0)return;const l=setInterval(()=>{const i=o();s(i),i.years===0&&i.months===0&&i.days===0&&i.hours===0&&i.minutes===0&&i.seconds===0&&(clearInterval(l),a&&a())},1e3);return()=>clearInterval(l)},[u]),c};function Ne(){const{fetchAccountBalance:u}=N(),{signAndExecuteTransaction:a}=H(),{currentAccount:n}=E(),{fetchOwnerVeNFT:o}=z(),c=P("xcetus"),{veNFT:s}=O(),[d,r]=p.useState(""),[l,i]=p.useState(""),{balanceInfo:t}=xe(k.cetus_coin),f=x=>{r(x),i(x)},[C,b]=p.useState(!1),T=async()=>{try{b(!0);const x={venft_id:s==null?void 0:s.id,amount:te(d,9)},j=await c.XCetusModule.convertPayload(x),M=await a(j,{getShowInfo:w=>{const y=`Converting ${q(d)} CETUS to ${q(d)} xCETUS`,v={modalTitleText:"Convert",modalDescriptionText:y,toastDescriptionContent:y};if(w==="success"){const U=y.replace("Converting","Converted");v.modalDescriptionText=U,v.toastDescriptionContent=U}return v}},{msafeParams:{action:G.xCETUSConvert,txbParams:x}});b(!1),M&&(r(""),i(""),setTimeout(()=>{u(),n&&o(n==null?void 0:n.address,!0)},2e3))}catch{b(!1)}},S=p.useMemo(()=>{const x={text:"Convert",disabled:!1};return n!=null&&n.address?+d?(+d&&Q(d).gt((t==null?void 0:t.balanceFormat)||0)&&(x.disabled=!0,x.text="Insufficient CETUS Balance"),x):(x.text="Enter an amount",x.disabled=!0,x):(x.text="Connect Wallet",x.disabled=!1,x)},[t==null?void 0:t.balanceFormat,n==null?void 0:n.address,d]);return{inputAmountFrom:d,inputAmountTo:l,handleInputChange:f,balanceInfoFrom:t,convertLoading:C,btnText:S.text,btnDisabled:S.disabled,handleConvertClick:T}}function Ve(u){const{isOpen:a,onClose:n,onSubmitClick:o}=u,{setShowConvertModel:c}=O(),[s,d]=p.useState(!1);return e.jsxs(ae,{autoFocus:!1,returnFocusOnClose:!1,isOpen:a,onClose:n,isCentered:!0,children:[e.jsx(re,{}),e.jsxs(ie,{children:[e.jsx(ce,{children:e.jsx(le,{fontWeight:"500",fontSize:"16px"})}),e.jsx(de,{}),e.jsx(ue,{textAlign:"center",p:"0px",children:e.jsxs(B,{w:"100%",gap:"20px",p:"20px",pb:"90px",pos:"relative",children:[e.jsx(Pe,{text_color:"text_caption",text_size:"14px",text:` Please note that after conversion, if you want to convert xCETUS back to CETUS, a vesting period will be applied & different vesting
              durations correspond to different redeem ratios. Learn more`,keywords:["Learn more"],onKeywordClick:()=>{window.open("https://cetus-1.gitbook.io/cetus-docs/tokenomics/xcetus","_blank")}}),e.jsxs(L,{children:[e.jsx(Le,{checked:s,onClick:()=>{d(!s)}}),e.jsx(R,{color:"text_caption",children:"Do not remind again."})]}),e.jsx(K,{pos:"absolute",bottom:"0px",mt:"4px",w:"100%",h:"52px",borderRadius:"12px",fontSize:"16px",fontWeight:"500",onClick:()=>{c(!s),o()},children:"Convert"})]})})]})]})}function dt(u){const{availableXCetusAmount:a,iconParams:n,onIconClick:o,onClose:c}=u,{currentAccount:s,onWalletModal:d}=E(),{inputAmountFrom:r,inputAmountTo:l,handleInputChange:i,balanceInfoFrom:t,btnText:f,btnDisabled:C,handleConvertClick:b,convertLoading:T}=Ne(),{showConvertModel:S}=O(),[x,j]=p.useState(!1);return e.jsxs(B,{w:"100%",gap:"8px",children:[e.jsx(pe,{onClick:o,borderRadius:"12px",from:{wrapStyle:{borderRadius:"12px"},title:"From",balance:(t==null?void 0:t.balanceFormat)||"",value:r,amountValue:"",loading:!1,onChange:M=>{i(M)},selectable:!1,placeholder:"0.0",token:k.cetus_coin},to:{wrapStyle:{borderRadius:"12px"},title:"To",balance:J(a,9),value:l,half:!1,max:!1,amountValue:"",onChange:M=>{i(M)},selectable:!1,placeholder:"0.0",token:k.x_cetus_coin},iconParams:n}),e.jsx(K,{w:"100%",borderRadius:"12px",h:"52px",fontSize:"18px",fontWeight:"500",isDisabled:C||T,isLoading:T,onClick:()=>{console.log(s,S,"showConvertModel"),s?S?j(!0):b().then(()=>{c&&c()}):d(!0)},children:f}),x&&e.jsx(Ve,{isOpen:x,onClose:()=>{j(!1)},onSubmitClick:()=>{j(!1),b().then(()=>{c&&c()})}})]})}function We(u){const{fetchAccountBalance:a}=N(),{signAndExecuteTransaction:n}=H(),{currentAccount:o}=E(),{fetchOwnerVeNFT:c}=z(),s=P("xcetus"),{veNFT:d}=O(),[r,l]=p.useState(""),[i,t]=p.useState(""),[f,C]=p.useState(180),[b,T]=p.useState(""),[S,x]=p.useState(!0),{balanceInfo:j}=xe(k.cetus_coin),M=(m,I)=>{x(I),I?l(m):t(m),y(m,I,f)},w=m=>{C(m),y(S?r:i,S,m)},y=async(m,I,X)=>{if(+m){const F=te(m,9);if(I){const D=await s.XCetusModule.redeemNum(F,X);t(J(D.amount_out,9)),T(Q(D.percent).mul(100).toFixed(2,se.ROUND_DOWN))}else{const D=await s.XCetusModule.reverseRedeemNum(F,X);l(J(D.amount_out,9)),T(Q(D.percent).mul(100).toFixed(2,se.ROUND_DOWN))}}else!m&&Ue(m)?(l(""),t(""),T("")):(I?t(""):l(""),T(""))},[v,U]=p.useState(!1),Y=async()=>{if(!d)return;U(!0);const m={venft_id:d.id,amount:te(r,9),lock_day:f},I=s.XCetusModule.redeemLockPayload(m),X=await n(I,{getShowInfo:F=>{const D=`Redeeming ${q(r)} xCETUS to ${q(i)} CETUS`,W={modalTitleText:"Redeem",modalDescriptionText:D,toastDescriptionContent:D};if(F==="success"){const _=D.replace("Redeeming","Redeemed");W.modalDescriptionText=_,W.toastDescriptionContent=_}return W}},{msafeParams:{action:G.xCETUSRedeemLock,txbParams:m}});U(!1),X&&(o&&setTimeout(()=>{c(o==null?void 0:o.address,!0)},2e3),l(""),t(""),a())},V=p.useMemo(()=>{const m={text:"Redeem",disabled:!1};return o!=null&&o.address?+r?(+r&&Q(r).gt(u||0)&&(m.disabled=!0,m.text="Insufficient xCETUS Balance"),m):(m.text="Enter an amount",m.disabled=!0,m):(m.text="Connect Wallet",m.disabled=!1,m)},[u,o==null?void 0:o.address,r]);return{inputAmountFrom:r,inputAmountTo:i,handleInputChange:M,balanceInfoTo:j,convertLoading:v,btnText:V.text,btnDisabled:V.disabled,handleConvertClick:Y,day:f,handleDayChange:w,percent:b}}function He(u){const{inputAmountFrom:a,inputAmountTo:n,day:o,isOpen:c,onClose:s,onSubmitClick:d}=u;return e.jsxs(ae,{autoFocus:!1,returnFocusOnClose:!1,isOpen:c,onClose:s,isCentered:!0,children:[e.jsx(re,{}),e.jsxs(ie,{children:[e.jsx(ce,{children:e.jsx(le,{fontWeight:"500",fontSize:"16px",children:"Redeem"})}),e.jsx(de,{}),e.jsx(ue,{textAlign:"center",p:"0px",children:e.jsxs(B,{w:"100%",gap:"20px",p:"0 20px",pb:"72px",pos:"relative",children:[e.jsx(Xe,{bg:"bg_primary",coinA:{amount:a||"0",...k.x_cetus_coin},iconParams:{xlinkHref:"#icon-a-icon_trade",svgFill:"text_caption",fontSize:"12px"},coinB:{amount:n||"0",...k.cetus_coin}}),e.jsxs(L,{w:"100%",justify:"space-between",children:[e.jsx(R,{children:"Vesting duration "}),e.jsxs(R,{color:"text_caption",children:[o," days"]})]}),e.jsx(K,{pos:"absolute",bottom:"0px",w:"100%",h:"52px",borderRadius:"12px",fontSize:"16px",fontWeight:"500",onClick:()=>{d()},children:"Confirm Redeem"})]})})]})]})}function Ge(u){const{day:a,onChange:n}=u,o=p.useMemo(()=>`${a}D`,[a]),c=[{label:"15D"},{label:"30D"},{label:"90D"},{label:"180D"}];return e.jsxs(Ce,{children:[e.jsxs(L,{w:"100%",justifyContent:"space-between",m:"10px 0",children:[e.jsxs(R,{fontSize:"16px",color:"text_caption",whiteSpace:"nowrap",children:[a," Days"]}),e.jsx(Se,{type:"outlineTab",tabList:c,currentTab:o,handleChangeTab:s=>{s.label==="MAX"?n(100):n(s.label.replace("D",""))},wrapStyle:{flex:"1",maxW:"300px",h:"32px",p:"3px",borderRadius:"8px"},itemStyle:{flex:"1",fontSize:"12px",margin:"0px"}})]}),e.jsxs(be,{"aria-label":"slider-ex-1",min:15,max:180,focusThumbOnChange:!1,value:Number(a),onChange:s=>n(s),children:[e.jsx(ge,{h:"8px",children:e.jsx(Te,{h:"4px"})}),e.jsx(we,{})]})]})}function ut(u){const{availableXCetusAmount:a,iconParams:n,onIconClick:o,onClose:c}=u,{currentAccount:s,onWalletModal:d}=E(),{inputAmountFrom:r,inputAmountTo:l,handleInputChange:i,balanceInfoTo:t,btnText:f,btnDisabled:C,handleConvertClick:b,day:T,handleDayChange:S,percent:x,convertLoading:j}=We(a),{showConvertModel:M}=O(),[w,y]=p.useState(!1);return e.jsxs(B,{w:"100%",gap:"8px",children:[e.jsx(pe,{onClick:o,borderRadius:"12px",from:{wrapStyle:{borderRadius:"12px"},title:"From",balance:a,value:r,amountValue:"",loading:!1,onChange:v=>{i(v,!0)},selectable:!1,placeholder:"0.0",token:k.x_cetus_coin},to:{wrapStyle:{borderRadius:"12px"},title:"To",balance:(t==null?void 0:t.balanceFormat)||"",value:l,half:!1,max:!1,amountValue:"",onChange:v=>{i(v,!1)},selectable:!1,placeholder:"0.0",token:k.cetus_coin},iconParams:n}),e.jsxs(oe,{borderRadius:"12px",p:{base:"16px 8px",lg:"16px"},children:[e.jsx(R,{mb:"16px",color:"primary_gray",children:"Vesting duration"}),e.jsx(Ge,{day:T,onChange:v=>{S(Number(v))}})]}),e.jsx(oe,{borderRadius:"12px",p:"0px",border:"none",children:e.jsxs(B,{w:"100%",gap:"20px",children:[e.jsx(K,{mt:"-1px",w:"100%",borderRadius:"12px",h:"52px",fontSize:"18px",fontWeight:"500",isDisabled:C||j,isLoading:j,onClick:()=>{s?y(!0):d(!0)},children:f}),+x&&e.jsx(L,{w:"100%",p:"34px 16px 20px",border:"1px solid",borderColor:"border",mt:"-34px",borderRadius:"12px",children:e.jsx(Ee,{label:"Redeem ratio",labelStyle:{fontSize:"14px"},value:fe(x),valueStyle:{fontSize:"14px"}})})]})}),w&&e.jsx(He,{inputAmountFrom:r,inputAmountTo:l,day:T,isOpen:w,onClose:()=>{y(!1)},onSubmitClick:()=>{y(!1),b().then(()=>{c&&c()})}})]})}function ft(){const{fetchAccountBalance:u}=N(),{signAndExecuteTransaction:a}=H(),n=P("xcetus"),{veNFT:o}=O(),{fetchOwnerVeNFT:c}=z(),{currentAccount:s}=E(),[d,r]=p.useState(!1);return{handleCancelOrder:async i=>{if(!o)return;r(!0);const t={venft_id:o.id,lock_id:i.id},f=n.XCetusModule.cancelRedeemPayload(t),C=await a(f,{},{msafeParams:{action:G.xCETUSCancelRedeem,txbParams:t}});r(!1),C&&(u(),s&&setTimeout(()=>{c(s==null?void 0:s.address,!0)},2e3))},cancelOrderLoading:d}}function xt(){const{fetchAccountBalance:u}=N(),{signAndExecuteTransaction:a}=H(),n=P("xcetus"),{veNFT:o}=O(),{fetchOwnerVeNFT:c}=z(),{currentAccount:s}=E(),[d,r]=p.useState(!1);return{handleClaimOrder:async i=>{if(r(!0),!o)return;const t={lock_id:i,venft_id:o.id},f=await n.XCetusModule.redeemPayload(t);console.log("xCetus ðŸš€ ~ handleClaimOrder ~ params:",t);const C=await a(f,{},{useDevInspect:!1,msafeParams:{action:G.xCETUSRedeem,txbParams:t}});r(!1),C&&setTimeout(()=>{u(),s&&c(s==null?void 0:s.address,!0)},2e3)},claimOrderLoading:d}}function mt({xcetus_amount:u,cetus_amount:a,imageSize:n="24px"}){const{isApp:o}=je();return o?e.jsxs(B,{w:"100%",align:"center",gap:"8px",children:[e.jsxs(L,{w:{base:"100%",lg:"unset"},children:[e.jsx($,{imageUrl:k.x_cetus_coin.logo_url,p:"4px",imgBoxStyle:{w:n,h:n,bg:"block_color",borderColor:"transparent",borderRadius:"20px"}}),e.jsx(Z,{amount:u,token:"xCETUS"}),e.jsx(R,{color:"text_caption",children:"â†’"})]}),e.jsxs(L,{w:{base:"100%",lg:"unset"},children:[e.jsx($,{imageUrl:k.cetus_coin.logo_url,p:"2px",imgBoxStyle:{w:n,h:n,bg:"block_color",borderColor:"transparent",borderRadius:"20px"}}),e.jsx(Z,{amount:a,token:"CETUS"})]})]}):e.jsxs(L,{children:[e.jsx($,{imageUrl:k.x_cetus_coin.logo_url,p:"4px",imgBoxStyle:{w:n,h:n,bg:"block_color",borderColor:"transparent",borderRadius:"20px"}}),e.jsx(Z,{amount:u,token:"xCETUS"}),e.jsx(R,{color:"text_caption",children:" â†’"}),e.jsx($,{imageUrl:k.cetus_coin.logo_url,p:"2px",imgBoxStyle:{w:n,h:n,bg:"block_color",borderColor:"transparent",borderRadius:"20px"}}),e.jsx(Z,{amount:a,token:"CETUS"})]})}const Z=({amount:u,token:a})=>e.jsxs(L,{as:"div",children:[e.jsx(Fe,{children:e.jsxs(R,{as:"span",color:"text_caption",children:[ve(J(u,9),9)," "]})}),e.jsx(R,{as:"span",color:"text_paragraph",children:a})]});function pt(){const{fetchAccountBalance:u}=N(),{signAndExecuteTransaction:a}=H(),n=P("xcetus"),{veNFT:o}=O(),[c,s]=p.useState(!1),{fetchVeNFTDividendInfo:d}=me();return{handleClaimReward:async l=>{if(o){s(!0),console.log("ðŸš€ ~ file: useXCetusClaimRewardAction.ts:23 ~ handleClaimReward ~ rewardList:",l);try{const i=n.XCetusModule.redeemDividendV3Payload(o.id,l),t=await a(i,{},{useDevInspect:!0,msafeParams:{action:G.xCETUSClaimStakingRwewards,txbParams:{veNftId:o.id,rewardList:l}}});s(!1),t&&setTimeout(()=>{u(),d(o.id)},2e3)}catch(i){console.log("ðŸš€ ~ file: useXCetusClaimRewardAction.ts:40 ~ handleClaimReward ~ error:",i)}finally{s(!1)}}},claimRewardLoading:c}}function ze(){const{getTokenPrice:u,fetchTokenPrices:a}=ye();return{refreshCoinPriceInfo:async(o,c=!1,s=!1)=>{const d=new Set;s||o.forEach(r=>{const l=u(r,6e4);l?c&&!l.price_change&&d.add(r):d.add(r)}),console.log("ðŸš€ ~ refreshCoinPriceInfo ~ notFetchCoinList:",{notFetchCoinList:d,coinTypeList:o}),d.size>0&&await a(Array.from(d),!0,!1)}}}function ht(){const{limitUserIndexerObj:u,setLimitUserIndexerObj:a,dcaUserIndexerObj:n,setDcaUserIndexerObj:o}=Be(),c=P("limit"),s=P("dca");return{getLimitUserIndexer:async l=>{const i=u[l];if(i)return i;try{const t=new Me;c==null||c.LimitOrder.buildGetUserIndexerHandle(l,t);const f=await c.FullClient.devInspectTransactionBlock({transactionBlock:t,sender:_e("0x0")}),C=c==null?void 0:c.LimitOrder.parsedQueryUserIndexerEvent(f);if(C)return a(l,C),C}catch(t){console.log("ðŸš€ ~ getLimitUserIndexer ~ error:",t)}},getDcaUserIndexer:async l=>{const i=n[l];if(i)return i;try{const{dca:t}=s.sdkOptions,{user_indexer_id:f}=Ie(t),C=await s.FullClient.getDynamicFieldObject({parentId:f,name:{type:"address",value:l}}),b=ke(C).value.fields.id.id;if(b)return o(l,b),b}catch(t){console.log("ðŸš€ ~ getDcaUserIndexer ~ error:",t)}}}}function Ct(u=!1){const a=P("xcetus"),{currentAccount:n}=E(),{fetchAccountBalance:o}=N(),{refreshCoinPriceInfo:c}=ze(),{lockCetusList:s,veNFTLoading:d,lockCetusListLoading:r,clearData:l,owner:i,veNFT:t,XCetusManager:f,setXCetusManager:C,setDividendManager:b,setPhaseDividendInfoMap:T,phaseDividendInfoMap:S,availableXCetusAmount:x,availableXCetusAmountLoading:j}=O(),{nextStartTime:M,currentPeriod:w,calculateCurrPeriod:y}=Re(),{summaryRewardList:v,rewardList:U,totalRewardValue:Y}=Oe(w),{fetchVeNFTDividendInfo:V}=me(),m=async h=>{try{const g=await a.XCetusModule.getXcetusManager(h);g&&C(g)}catch(g){console.log("ðŸš€ ~ fetchXCetusManager ~ error:",g)}},I=async(h,g=5)=>{try{const A=await a.XCetusModule.getPhaseDividendInfo(h.toString());if(console.log("ðŸš€ ~ fetchPhaseDividendInfo ~ info:",{info:A,phase:h,maxFetchTimes:g}),A)return T(A),A;if(g>0&&h>0)return I(h-1,g-1)}catch{if(g>0&&h>0)return I(h-1,g-1)}},X=async h=>{try{const g=await a.XCetusModule.getDividendManager(h);g&&b(g)}catch(g){console.log("ðŸš€ ~ fetchXCetusManager ~ error:",g)}},{fetchOwnerVeNFT:F}=z(),D=p.useMemo(()=>{if(t&&!j){const h=ee(t.xcetus_balance).sub(x);if(h.gte(0))return h.toFixed(0)}return"0"},[t==null?void 0:t.xcetus_balance,x,j]),W=p.useMemo(()=>{if(f&&t){const h=ee(t.xcetus_balance).div(f.treasury).mul(100);return ee(h).lt(.01)?"<0.01%":fe(h.toString(),3)}return n!=null&&n.address?"0%":"--"},[f==null?void 0:f.treasury,t==null?void 0:t.xcetus_balance,n==null?void 0:n.address]),_=p.useMemo(()=>{if(w){let h=S[w.toString()];if(h===void 0){const g=Object.values(S);g.length>0&&(h=g.reduce((A,ne)=>Number(ne.phase)>Number(A.phase)?ne:A))}return h}},[S,w]),{cetusApr:he}=Ae(_,f==null?void 0:f.treasury);return p.useEffect(()=>{if(_){const h=_.bonus_types.map(g=>De(g,!1));h&&(h.push("0x5d4b302506645c37ff133b98c4b50a5ae14841659738d6d733d59d0d217a93bf::coin::COIN"),c(h))}},[_==null?void 0:_.id]),p.useEffect(()=>{w&&w>0&&I(w)},[w]),p.useEffect(()=>{t&&!u&&V(t.id)},[t==null?void 0:t.id]),{fetchOwnerVeNFT:F,fetchAccountBalance:o,fetchXCetusManager:m,fetchDividendManager:X,fetchVeNFTDividendInfo:V,veNFTLoading:d,lockCetusListLoading:r,redeemingXCetusAmount:D,availableXCetusAmount:x,veNFT:t,myShare:W,nextStartTime:M,cetusApr:he,summaryRewardList:v,rewardList:U,totalRewardValue:Y,lockCetusList:s,calculateCurrPeriod:y}}export{dt as C,mt as X,ft as a,xt as b,pt as c,Ct as d,ut as e,ze as f,ht as g,lt as u};
