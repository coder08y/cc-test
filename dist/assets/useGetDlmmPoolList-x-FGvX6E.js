import{d as T,ad as z,as as x,f as O,aG as W,n as Z,aH as q,j as R,Z as j}from"./index-ihcskjKt.js";import{f as I,a as N}from"./utils-GUDa3Y46.js";import{r as $}from"./vendor-CBmAETR3.js";import"./cross-CbhIs7DK.js";import{u as H}from"./useWrapPoolData-CzWcfmSl.js";function K(){const{wrapDLmmPoolData:_}=H();return{wrapDlmmGroupedPoolData:(b,C=!1)=>b==null?void 0:b.map(s=>{var p,J,y,G,B,f,A,S;const M=s==null?void 0:s.showReverse,g=(s==null?void 0:s.pools)||[],o=g==null?void 0:g.map(c=>{var t,n,l,e;return _({...c,showReverse:M,coinA:(s==null?void 0:s.coinA)||{coinType:c==null?void 0:c.coinTypeA,symbol:(n=(t=c==null?void 0:c.coinTypeA)==null?void 0:t.split("::"))==null?void 0:n.pop()},coinB:(s==null?void 0:s.coinB)||{coinType:c==null?void 0:c.coinTypeB,symbol:(e=(l=c==null?void 0:c.coinTypeB)==null?void 0:l.split("::"))==null?void 0:e.pop()},pool:(c==null?void 0:c.pool)||(c==null?void 0:c.id)},C)});let u="--";if((o==null?void 0:o.length)===1)u=o[0].totalApr;else if((o==null?void 0:o.length)>1){const c=o.filter(l=>{console.log("00000: ",l);const e=T(l.totalApr=="--"?0:l.totalApr),v=T(l.tvl=="--"?0:l.tvl);return!(e.gt(1e4)&&v.lt(10))}),t=o.filter(l=>{const e=T(l.totalApr=="--"?0:l.totalApr),v=T(l.tvl=="--"?0:l.tvl);return e.gt(1e4)&&v.lt(10)}),n=o.filter(l=>T(l.totalApr=="--"?0:l.totalApr).eq(0));t.length>0&&n.length===o.length-t.length?u="10001":c.length===1?u=c[0].totalApr:u=z.max(...c.map(e=>T(e.totalApr))).toString()}const h=new Map;o==null||o.forEach(c=>{var t;(t=c==null?void 0:c.miningRewardList)==null||t.forEach(n=>{var l;h.has(n==null?void 0:n.coinType)?h.set(n==null?void 0:n.coinType,{...n,emissionsEveryDay:T((l=h.get(n==null?void 0:n.coinType))==null?void 0:l.emissionsEveryDay).plus(n==null?void 0:n.emissionsEveryDay).toString()}):h.set(n==null?void 0:n.coinType,n)})});const L=new Map;o==null||o.forEach(c=>{var t;(t=c==null?void 0:c.farmsRewarderList)==null||t.forEach(n=>{var l;L.has(n==null?void 0:n.coinType)?L.set(n==null?void 0:n.coinType,{...n,emissionsEveryDay:T((l=L.get(n==null?void 0:n.coinType))==null?void 0:l.emissionsEveryDay).plus(n==null?void 0:n.emissionsEveryDay).toString()}):L.set(n==null?void 0:n.coinType,n)})});const k=C?"--":x((g==null?void 0:g.reduce((c,t)=>T(c).plus((t==null?void 0:t.tvl)||"0").toString(),"0"))||0),E=s!=null&&s.coinTypeA?{coinType:s==null?void 0:s.coinTypeA,symbol:(J=(p=s==null?void 0:s.coinTypeA)==null?void 0:p.split("::"))==null?void 0:J.pop()}:s==null?void 0:s.coinA,D=s!=null&&s.coinTypeB?{coinType:s==null?void 0:s.coinTypeB,symbol:(G=(y=s==null?void 0:s.coinTypeB)==null?void 0:y.split("::"))==null?void 0:G.pop()}:s==null?void 0:s.coinB;return{id:(((B=s==null?void 0:s.coinA)==null?void 0:B.coinType)||(s==null?void 0:s.coinTypeA))+"-"+(((f=s==null?void 0:s.coinB)==null?void 0:f.coinType)||(s==null?void 0:s.coinTypeB)),tokenA:E,tokenB:D,isReverse:M,displayTokenA:M?D:E,displayTokenB:M?E:D,...s,coinTypeA:((A=s==null?void 0:s.coinA)==null?void 0:A.coinType)||(s==null?void 0:s.coinTypeA),coinTypeB:((S=s==null?void 0:s.coinB)==null?void 0:S.coinType)||(s==null?void 0:s.coinTypeB),haveFarming:o==null?void 0:o.some(c=>c.haveFarming),haveMining:o==null?void 0:o.some(c=>c.haveMining),volume24Display:C?"--":x(g==null?void 0:g.reduce((c,t)=>{var n,l;return T(c).plus(((l=(n=t==null?void 0:t.stats)==null?void 0:n.find(e=>e.dateType==="24H"))==null?void 0:l.vol)||"0")},"0")),fees24Display:C?"--":x(g==null?void 0:g.reduce((c,t)=>{var n,l;return T(c).plus(((l=(n=t==null?void 0:t.stats)==null?void 0:n.find(e=>e.dateType==="24H"))==null?void 0:l.fee)||"0")},"0"),"$"),miningRewardList:Array.from(h==null?void 0:h.values()),farmsRewarderList:Array.from(L==null?void 0:L.values()),totalAllAprDisplay:C||u==="--"?u:T(u).gt(1e4)?">1,000,000%":T(u).lt(1e-4)&&T(u).gt(0)?"<0.01%":x(T(u).mul(100).toString(),"%"),tvlDisplay:k,list:o}})}}function a(){O("dlmm");const{isInitialized:_}=W(),{fetchByApi:F}=Z(),{wrapDlmmGroupedPoolData:b}=K(),{wrapDLmmPoolData:C}=H(),s=async o=>{var u,h,L,k,E;try{const D={...o},p=I(o==null?void 0:o.coin_type);p&&(D.coin_type=p);const J=N(D),y=await F(q,"POST",J);if(console.log("ðŸš€ ~ getDlmmPoolListFromApi ~ res:",y),(u=y==null?void 0:y.data)!=null&&u.list){const G=b((h=y==null?void 0:y.data)==null?void 0:h.list);return console.log("ðŸš€ ~ file: useGetDlmmPoolList.ts:22 ~ poolList ~ poolList:",JSON.stringify((L=y==null?void 0:y.data)==null?void 0:L.list),(k=y==null?void 0:y.data)==null?void 0:k.list,G),{list:G,total:(E=y==null?void 0:y.data)==null?void 0:E.pool_num,isLocal:!1}}}catch(D){return console.log("ðŸš€ ~ getLocalJsonPoolList ~ error:",D),await M(o,!0)}return{list:[],total:0}},M=async(o,u=!0)=>{var h,L,k,E,D,p,J,y;console.log("ðŸš€ðŸš€ðŸš€ ~ useGetPoolList.ts:136 ~ useGetPoolList ~ params:",o);try{console.log("ðŸš€ ~ useGetPoolList ~ envConfigs?.env:",(h=R)==null?void 0:h.env);const G=((L=R)==null?void 0:L.env)==="testnet"?"/data/dlmm-pools-testnet.json":"/data/dlmm-pools.json",B=await fetch(G,{cache:"no-cache"}).then(f=>f.json());if(console.log(B,"getLocalJsonPoolList"),(k=B==null?void 0:B.data)!=null&&k.list){const f=(E=B==null?void 0:B.data)==null?void 0:E.list;let A=f;if(o!=null&&o.pools){const t=(D=o==null?void 0:o.pools)==null?void 0:D.map(n=>n==null?void 0:n.toLowerCase());A=f==null?void 0:f.filter(n=>{var e,v;const l=(e=n==null?void 0:n.pools)==null?void 0:e.some(i=>{var P;return t==null?void 0:t.includes((P=i==null?void 0:i.pool)==null?void 0:P.toLowerCase())});return l&&(n.pools=(v=n.pools)==null?void 0:v.filter(i=>{var P;return t==null?void 0:t.includes((P=i==null?void 0:i.pool)==null?void 0:P.toLowerCase())})),l})}if(o!=null&&o.pool){const t=(p=o==null?void 0:o.pool)==null?void 0:p.toLowerCase();A=f==null?void 0:f.filter(n=>{var e,v;const l=(e=n==null?void 0:n.pools)==null?void 0:e.some(i=>{var P;return((P=i==null?void 0:i.pool)==null?void 0:P.toLowerCase())===t});return l&&(n.pools=(v=n.pools)==null?void 0:v.filter(i=>{var P;return((P=i==null?void 0:i.pool)==null?void 0:P.toLowerCase())===t})),l})}if(console.log("ðŸš€ðŸš€ðŸš€ ~ useGetPoolList.ts:151 ~ useGetPoolList ~ originList:",o,f),o!=null&&o.coinTypes&&((J=o==null?void 0:o.coinTypes)==null?void 0:J.length)>0||o!=null&&o.coin_type&&((y=o==null?void 0:o.coin_type)==null?void 0:y.length)>0){const t=(o==null?void 0:o.coinTypes)||(o==null?void 0:o.coin_type);console.log(t,f,"coinArr, originList"),A=f==null?void 0:f.filter(n=>{var v,i;const l=j((v=n==null?void 0:n.coinA)==null?void 0:v.coinType,!1),e=j((i=n==null?void 0:n.coinB)==null?void 0:i.coinType,!1);return(t==null?void 0:t.length)>1&&(t.includes(l)&&t.includes(e)||t.includes(e)&&t.includes(l))?!0:!!((t==null?void 0:t.length)===1&&(t.includes(l)||t.includes(e)))})}if(u){const t=b(A,!0);return console.log("getLocalJsonPoolList ðŸš€ ~ poolList ~ poolList:",t),{list:t,total:(A==null?void 0:A.length)||0,isLocal:!0}}const S=[],c=A==null?void 0:A.map(t=>{var n;(n=t.pools)==null||n.forEach(l=>{S.push(C({...l,...t},!0))})});return console.log("getLocalJsonPoolList ðŸš€ ~ poolList ~ poolList:",c),{list:S,total:(S==null?void 0:S.length)||0,isLocal:!0}}}catch(G){console.error("getLocalJsonPoolList Error:",G)}return{list:[],total:0,isLocal:!1}},g=$.useCallback(o=>{if(_)return s(o).then(u=>u);setTimeout(()=>{g(o)},1e3)},[_]);return{getDlmmPoolList:g,getLocalJsonPoolList:M}}export{a as u};
//# sourceMappingURL=useGetDlmmPoolList-x-FGvX6E.js.map
