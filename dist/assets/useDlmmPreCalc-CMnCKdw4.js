import{r as R,j as i,V as W,H as E,B as si,T as O,a0 as T,a6 as Si,a7 as _i,a8 as ji,C as bi,S as vi,w as wi}from"./vendor-CBmAETR3.js";import{C as Ci,B as Ai,S as k,F as Fi,P as ni,u as Ii}from"./useCreatePriceBin-bOk7VAIh.js";import{T as Mi}from"./TotalAmount-B2jkoq59.js";import{M as Li,d as J,t as Z,i as Ri,L as V,aj as zi,aW as ai,a5 as Bi,Q as mi,z as pi,l as q,w as Pi,C as ci,I as di,bC as oi,f as Vi,s as F}from"./index-BpSfzecM.js";import"./cross-DJ28FxNa.js";import{a as Ni}from"./useCreatePoolHelper-DDo1nSpS.js";import{H as Ei}from"./HTextLabelBox-D0r99Smv.js";import{E as ii}from"./ErrorTips-lJshH5MT.js";import{u as ui}from"./useTokenBalance-c3RAkCCY.js";import{T as Hi}from"./TradeInputGroup-C0B6uidS.js";import{u as Wi}from"./useCreatePool-CDFSrv9X.js";import{d as $i,e as Oi,h as xi,i as Qi}from"./dlmm-DdxfaipV.js";import{u as Di}from"./index-C7OfScvw.js";import{u as Gi}from"./addDlmmLiquidity-BTnvpcHs.js";function Zi(l,d,t,e,s,r,o,g,p){const{currentAccount:n}=Li(),b=R.useMemo(()=>{const a={text:"Create",disabled:!1};return n!=null&&n.address?!l||!d||l&&!+l||d&&!+d?(a.text="Enter an amount",a.disabled=!0,a):l&&+l&&J(l).gt((s==null?void 0:s.balanceFormat)||0)?(a.disabled=!0,a.text=`Insufficient ${Z(t==null?void 0:t.symbol)} Balance`,a):d&&+d&&J(d).gt((r==null?void 0:r.balanceFormat)||0)?(a.disabled=!0,a.text=`Insufficient ${Z(e==null?void 0:e.symbol)} Balance`,a):!l||!d?(a.disabled=!0,a):((o&&+o&&o>1||g||p)&&(a.disabled=!0,a.text="Change the price range"),a):(a.text="Connect Wallet",a.disabled=!1,a)},[n==null?void 0:n.address,l,d,s==null?void 0:s.balanceDisplay,r==null?void 0:r.balanceDisplay,t==null?void 0:t.coin_type,e==null?void 0:e.coin_type,o,g,p]);return{btnText:b.text,btnDisabled:b.disabled}}const Ji=(l,d)=>({initPrice:"",setInitPrice:t=>{l(()=>({initPrice:t}))},binStep:void 0,setBinStep:t=>{l(()=>({binStep:t}))},baseAmount:"",setBaseAmount:t=>{l(()=>({baseAmount:t}))},quoteAmount:"",setQuoteAmount:t=>{l(()=>({quoteAmount:t}))},baseTokenLock:!1,setBaseTokenLock:t=>{l(()=>({baseTokenLock:t}))},quoteTokenLock:!1,setQuoteTokenLock:t=>{l(()=>({quoteTokenLock:t}))},isAutoFill:!0,setIsAutoFill:t=>{l(()=>({isAutoFill:t}))},strategy:V.Spot,setStrategy:t=>{l(()=>({strategy:t}))},fixAmountA:!0,setFixAmountA:t=>{l(()=>({fixAmountA:t}))},activeId:void 0,setActiveId:t=>{l(()=>({activeId:t}))},minPriceData:void 0,setMinPriceData:t=>{l(()=>({minPriceData:t}))},maxPriceData:void 0,setMaxPriceData:t=>{l(()=>({maxPriceData:t}))},createBinInfos:void 0,setCreateBinInfos:t=>{l(()=>({createBinInfos:t}))},positionCount:0,setPositionCount:t=>{l(()=>({positionCount:t}))},numBins:0,setNumBins:t=>{l(()=>({numBins:t}))},resetCreateDlmmPoolState:()=>{l(()=>({initPrice:"",positionCount:0,numBins:0,binStep:void 0,baseAmount:"",quoteAmount:"",baseTokenLock:!1,quoteTokenLock:!1,isAutoFill:!0,strategy:V.Spot,fixAmountA:!0,minPriceData:void 0,maxPriceData:void 0,createBinInfos:void 0}))}}),ri=Ri(Ji);function Ki(l){const{activeId:d,createBinInfos:t,binStep:e,setMinPriceData:s,setMaxPriceData:r,minPriceData:o,maxPriceData:g}=ri(),{baseToken:p,quoteToken:n}=Wi(),[b,a]=R.useState(),[z,m]=R.useState(),_=R.useCallback(({activeBin:x,binStep:C,baseDecimal:u,quoteDecimal:H,direct:I=!0,minBin:f,maxBin:j})=>{const M=w=>{const B=Qi(w,C,u,H);return{amount_a:"0",amount_b:"0",bin_id:w,liquidity:"100",price:Bi(I?B:J(1).div(B).toString(),6),price_per_lamport:""}},h=(w,B,D)=>{const K=[];for(let G=w;D>0?G<=B:G>=B;G+=D)K.push(M(G));return K},y=J($i).sub(2).div(2).toNumber(),Q=f!==void 0&&x-f>y?f:x-y,S=j!==void 0&&j-x>y?j:x+y,A=h(x,Q,-1),L=h(x+1,S,1);return{list:[...A,...L].sort((w,B)=>Number(w.price)-Number(B.price)),max:100}},[]);return zi(()=>{var x;if(t&&((x=t==null?void 0:t.bins)==null?void 0:x.length)>0&&(p!=null&&p.coin_type)&&(n!=null&&n.coin_type)&&d!==void 0&&(e==null?void 0:e.binStep)!==void 0){const C=Oi(t.bins,p,n,l,d,e==null?void 0:e.binStep);a(C)}},[t,p==null?void 0:p.coin_type,n==null?void 0:n.coin_type,l,d,e]),R.useEffect(()=>{if(d!==void 0&&e!==void 0&&(p!=null&&p.coin_type)&&(n!=null&&n.coin_type)&&(o==null?void 0:o.binId)!==void 0&&(g==null?void 0:g.binId)!==void 0){const x=_({activeBin:Number(d),binStep:e.binStep,baseDecimal:p.decimals,quoteDecimal:n.decimals,direct:l,minBin:o==null?void 0:o.binId,maxBin:g==null?void 0:g.binId});m(x)}},[e==null?void 0:e.binStep,p==null?void 0:p.coin_type,n==null?void 0:n.coin_type,d,l,o==null?void 0:o.binId,g==null?void 0:g.binId]),{currentLiquidityBins:b,activeId:d,maxBinRangeData:z,handleRangeChange:(x,C)=>{if((e==null?void 0:e.binStep)!==void 0&&(p==null?void 0:p.decimals)!==void 0&&(n==null?void 0:n.decimals)!==void 0&&x!==void 0&&C!==void 0){const u=ai.getPriceFromBinId(x,e==null?void 0:e.binStep,p==null?void 0:p.decimals,n==null?void 0:n.decimals),[H,I,f]=xi(u),j=ai.getPriceFromBinId(C,e==null?void 0:e.binStep,p==null?void 0:p.decimals,n==null?void 0:n.decimals),[M,h,y]=xi(j),Q={binId:x,price:u,displayPrice:H,reversePrice:I,displayReversePrice:f,type:"lower"},S={binId:C,price:j,displayPrice:M,reversePrice:h,displayReversePrice:y,type:"upper"};s({...Q,type:"lower"}),r({...S,type:"upper"})}}}}const ti=476;function Ui({direct:l}){var g;const{currentLiquidityBins:d,activeId:t,maxBinRangeData:e,handleRangeChange:s}=Ki(l),{minPriceData:r,maxPriceData:o}=ri();return i.jsxs(W,{position:"relative",width:`${ti}px`,w:"100%",h:"200px",children:[i.jsx(Ci,{data:d,activeBin:Number(t),width:ti,height:162,direct:l}),e&&((g=e==null?void 0:e.list)==null?void 0:g.length)>0&&i.jsx(Ai,{activeBin:Number(t),data:e,width:ti,height:0,type:"liquidity",noToolTip:!0,onChangeRange:s,minBinId:r==null?void 0:r.binId,maxBinId:o==null?void 0:o.binId,direct:l})]})}function ct({initPrice:l,currentStep:d,editStep:t,onCreate:e,baseToken:s,quoteToken:r,baseAmount:o,quoteAmount:g,displayBaseToken:p,displayQuoteToken:n,onBaseAmountChange:b,onQuoteAmountChange:a,isReverse:z,handlePriceAction:m,minPriceData:_,maxPriceData:v,binStep:x,fixAmountA:C,setFixAmountA:u,isAutoFill:H,setIsAutoFill:I,strategy:f,setStrategy:j,onPriceChange:M}){const{balanceInfo:h}=ui(s),{balanceInfo:y}=ui(r),{fetchTokenPrices:Q,getTokenAmountValue:S}=mi(),{numBins:A,positionCount:L,baseTokenLock:N,quoteTokenLock:w,activeId:B}=ri(),{btnText:D,btnDisabled:K}=Zi(o,g,s,r,h,y,L,N,w),{showInputPriceWarn:G,showPriceRangeWarn:fi}=Ni(B,_==null?void 0:_.binId,v==null?void 0:v.binId),hi=()=>{const c=[];s!=null&&s.coin_type&&c.push(s==null?void 0:s.coin_type),r!=null&&r.coin_type&&c.push(r==null?void 0:r.coin_type),c.length>0&&Q(c)};R.useEffect(()=>{hi()},[s==null?void 0:s.coin_type,r==null?void 0:r.coin_type]);const U=S(s==null?void 0:s.coin_type,o),X=S(r==null?void 0:r.coin_type,g),yi=R.useMemo(()=>{if(+U&&+X)return pi(U||"0").plus(X||"0").toString()},[U,X]),$=R.useMemo(()=>q(s)&&q(r)?[s,r].filter(Boolean).map(c=>({label:c==null?void 0:c.symbol,isToken:!0,imgInfo:{src:c==null?void 0:c.logo_url,w:"16px",h:"16px",borderRadius:"50%",fallbackSrc:"/images/placeholder-token@2x.png"}})):[],[s,r]),[Y,ei]=R.useState("");R.useEffect(()=>{var c;($==null?void 0:$.length)>0&&ei(((c=$==null?void 0:$[0])==null?void 0:c.label)+"")},[$]);const P=R.useMemo(()=>Y===(s==null?void 0:s.symbol),[Y,s==null?void 0:s.symbol]),li=R.useMemo(()=>P?`${Z(r==null?void 0:r.symbol)} per ${Z(s==null?void 0:s.symbol)}`:`${Z(s==null?void 0:s.symbol)} per ${Z(r==null?void 0:r.symbol)}`,[s==null?void 0:s.symbol,r==null?void 0:r.symbol,P]);return i.jsx(i.Fragment,{children:d===4&&t===4?i.jsxs(W,{w:"100%",gap:"40px",bg:"bg_fifth",borderRadius:"12px",p:{base:"16px 8px",lg:"32px"},align:"flex-start",children:[i.jsxs(W,{w:"100%",gap:"12px",children:[i.jsxs(W,{w:"100%",align:"flex-start",children:[i.jsxs(E,{w:"100%",justify:"space-between",children:[i.jsx(T,{fontSize:"16px",fontWeight:"500",children:"Deposit amounts"}),i.jsxs(Si,{display:"flex",alignItems:"center",w:"fit-content",children:[i.jsx(_i,{htmlFor:"auto-fill",mb:"0",fontSize:"14px",color:"text_paragraph",children:"Auto Fill"}),i.jsx(ji,{id:"auto-fill",isChecked:H,onChange:()=>{},isDisabled:!0})]})]}),i.jsx(O,{fontSize:"12px",children:"Please enter the amount you want to deposit into the pool"})]}),i.jsx(Hi,{wrapStyle:{mt:"4px"},from:{wrapStyle:{h:"108px"},balance:(h==null?void 0:h.balanceFormat)||"",value:o,amountValue:U,loading:!1,onChange:c=>{u(!0),b(c)},selectable:!1,placeholder:"0.0",token:s,lock:{isLock:!N&&w,text:"The current price is outside your specified price range. Single-asset deposit only."}},to:{wrapStyle:{h:"108px"},balance:(y==null?void 0:y.balanceFormat)||"",value:g,amountValue:X,loading:!1,onChange:c=>{u(!1),a(c)},selectable:!1,placeholder:"0.0",token:r,lock:{isLock:N&&!w,text:"The current price is outside your specified price range. Single-asset deposit only."}},lock:{isLock:N&&w,style:{h:"224px"}}})]}),i.jsxs(W,{w:"100%",align:"flex-start",gap:"12px",children:[i.jsxs(W,{w:"100%",align:"flex-start",children:[i.jsx(T,{fontSize:"16px",fontWeight:"500",children:"Select Strategy"}),i.jsx(O,{fontSize:"12px",children:"Choose the liquidity distribution strategy you want"})]}),i.jsxs(E,{w:"100%",justify:"space-between",children:[i.jsx(k,{type:V.Spot,isActive:f===V.Spot,onClick:()=>j(V.Spot),size:"l"}),i.jsx(k,{type:V.Curve,isActive:f===V.Curve,onClick:()=>j(V.Curve),size:"l"}),i.jsx(k,{type:V.BidAsk,isActive:f===V.BidAsk,onClick:()=>j(V.BidAsk),size:"l"})]})]}),i.jsxs(W,{w:"100%",gap:"12px",children:[i.jsxs(W,{w:"100%",align:"flex-start",gap:"12px",children:[i.jsxs(E,{w:"100%",justify:"space-between",align:"flex-start",children:[i.jsxs(W,{align:"flex-start",children:[i.jsx(T,{fontSize:"16px",fontWeight:"500",children:"Set Price Range"}),i.jsx(O,{fontSize:"12px",children:"Set the price range you want to provide liquidity"})]}),i.jsx(Pi,{type:"outlineTab",tabList:$,currentTab:Y,handleChangeTab:c=>{c.label!==Y&&ei(c.label)},wrapStyle:{w:{base:"100%",lg:"auto"},h:"32px",p:"3px",border:"1px solid",borderColor:"border",borderRadius:"8px",gap:"4px"},itemStyle:{flex:1,h:"24px",p:"4px 12px",borderRadius:"4px",gap:"4px"}})]}),i.jsxs(E,{w:"100%",justify:"space-between",children:[i.jsxs(E,{gap:"12px",children:[i.jsx(gi,{symbol:s.symbol,color:"dlmm_blue"}),i.jsx(gi,{symbol:r.symbol,color:"dlmm_green"})]}),i.jsx(Fi,{label:"Initial Price"})]}),i.jsx(Ui,{direct:P}),i.jsxs(E,{w:"100%",justifyContent:"space-between",bg:"num_bins_bg",borderRadius:"12px",p:"12px 8px",children:[i.jsx(E,{left:"12px",top:"17px",children:i.jsxs(E,{gap:"4px",children:[i.jsx(O,{children:"Num Bins"}),i.jsx(ci,{tooltip:"Total bins in this position or actions.",children:i.jsx(bi,{cursor:"pointer",children:i.jsx(di,{xlinkHref:"#icon-icon_tips",svgW:"20px",svgH:"20px"})})})]})}),i.jsx(O,{children:A})]}),i.jsxs(vi,{mt:"4px",position:"relative",flexDir:{base:"column",lg:"row"},w:"100%",gap:{base:"8px",lg:"16px"},children:[i.jsx(si,{opacity:1,w:{base:"100%",lg:"50%"},children:i.jsx(ni,{title:"Min Price",perText:li,maxPrice:l,data:P?_:v,direct:P,loading:!1,onPriceChange:M,handleAddPrice:c=>m==null?void 0:m("Add",c,P),handleSubPrice:c=>m==null?void 0:m("Sub",c,P)})}),i.jsx(si,{opacity:1,w:{base:"100%",lg:"50%"},children:i.jsx(ni,{title:"Max Price",perText:li,minPrice:l,data:P?v:_,direct:P,loading:!1,onPriceChange:M,handleAddPrice:c=>m==null?void 0:m("Add",c,!P),handleSubPrice:c=>m==null?void 0:m("Sub",c,!P)})})]}),q(v)&&q(_)&&pi(v==null?void 0:v.price).lt(_==null?void 0:_.price)&&i.jsx(ii,{isShowIcon:!1,tipsFontSize:"12px",justifyContent:"center",tips:"The Max price should be higher than or equal to the Min price.",p:"0 16px",h:"28px",borderRadius:"8px"}),G&&!fi&&i.jsx(ii,{p:"8px 16px",w:"100%",isShowIcon:!1,type:"warning",borderRadius:"8px",tipsFontSize:"12px",tipsLineHeight:"16px",tips:"To create a new pool, the initial price you set must be within your price range."}),L&&L>1&&i.jsx(ii,{p:"8px 16px",w:"100%",isShowIcon:!1,type:"warning",borderRadius:"8px",tipsFontSize:"12px",tipsLineHeight:"16px",tips:`Pool creation allows adding liquidity in only 1 position (max ${oi-1} bins).`})]}),i.jsx(wi,{w:"100%",onClick:e,h:"48px",fontSize:"16px",borderRadius:"12px",isDisabled:K,children:D}),L>1&&i.jsx(Ei,{isLoading:!1,label:i.jsxs(E,{gap:"4px",children:[i.jsx(O,{children:"Position"}),i.jsx(ci,{tooltip:i.jsxs(O,{lineHeight:"20px",fontSize:"12px",children:["Each position covers up to ",oi-1," bins on Sui, multiple positions are needed to cover a larger range."]}),children:i.jsx(di,{xlinkHref:"#icon-icon_tips"})})]}),value:L,labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px"},skeletonStyle:{valueW:"128px"}}),i.jsx(Mi,{totalAmount:yi})]})]}):null})}const gi=({symbol:l,color:d})=>i.jsxs(E,{children:[i.jsx(si,{w:"8px",h:"8px",borderRadius:"2px",bg:d}),i.jsx(O,{fontSize:"12px",children:l})]});function dt(){const{getBinInfosByAutoFill:l,getBinInfosByBothAmount:d}=Ii(),{getTokenAmountValue:t}=mi(),e=Vi("dlmm"),{setPreCalcParams:s}=Gi(),{activeBin:r}=Di();return{handleAutoFillPreAdd:async({amount:p,tokenA:n,tokenB:b,currentBinStep:a,strategy:z,isReverse:m,fixAmountA:_,lowerBinId:v,upperBinId:x,activeId:C,pool:u,uuid:H})=>{var y;const I=n.decimals,f=b.decimals;let j;u&&(j=r||await((y=e==null?void 0:e.Position)==null?void 0:y.getActiveBinIfInRange(u==null?void 0:u.bin_manager.bin_manager_handle,v,x,C,a,!0)));const M={input_amount:p,bin_step:a,strategy_type:z,lower_bin_id:v,upper_bin_id:x,fix_amount_a:_,active_id:C,amount_in_active_bin:j,pool_id:u==null?void 0:u.id},h=await l(M);if(s({autoFill:M}),h){const{bins:Q,amount_a:S,amount_b:A}=h;console.log(n,b,"tokenA, tokenB");const L=F(S.toString(),I),N=F(A.toString(),f),w=t(n==null?void 0:n.coin_type,L),B=t(b==null?void 0:b.coin_type,N),D=J(w).plus(B).toString();return{uuid:H,coinAmountAOrigin:S.toString(),coinAmountBOrigin:A.toString(),displayCoinAmountA:m?F(A.toString(),f):F(S.toString(),I),displayCoinAmountB:m?F(S.toString(),I):F(A.toString(),f),coinAmountA:L,coinAmountB:N,totalAmount:D,binInfos:h}}},handleNotAutoFillPreAdd:async({coinAmountA:p,coinAmountB:n,currentBinStep:b,tokenA:a,tokenB:z,lowerBinId:m,upperBinId:_,strategyType:v,activeId:x,isReverse:C,pool:u,uuid:H})=>{var y;const I=a==null?void 0:a.decimals,f=z==null?void 0:z.decimals;let j;u&&(j=r||await((y=e==null?void 0:e.Position)==null?void 0:y.getActiveBinIfInRange(u==null?void 0:u.bin_manager.bin_manager_handle,m,_,x,b,!0)));const M={amount_a:p,amount_b:n,bin_step:b,active_id:x,strategy_type:v,lower_bin_id:m,upper_bin_id:_,amount_in_active_bin:j,pool_id:u==null?void 0:u.id},h=await d(M);if(s({notAutoFill:M}),h){const{bins:Q,amount_a:S,amount_b:A}=h,L=t(a==null?void 0:a.coin_type,F(S.toString(),I)),N=t(z==null?void 0:z.coin_type,F(A.toString(),f)),w=J(L).plus(N).toString();return{uuid:H,coinAmountAOrigin:S.toString(),coinAmountBOrigin:A.toString(),displayCoinAmountA:C?F(A.toString(),f):F(S.toString(),I),displayCoinAmountB:C?F(S.toString(),I):F(A.toString(),f),coinAmountA:F(S.toString(),I),coinAmountB:F(A.toString(),f),totalAmount:w,binInfos:h}}}}}export{ct as D,gi as L,dt as a,ri as u};
