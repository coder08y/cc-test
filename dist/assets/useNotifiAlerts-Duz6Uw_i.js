import{aJ as p,b as V}from"./index-ihcskjKt.js";import"./vendor-CBmAETR3.js";function v(){const{notifiClient:a}=p(),{setDefaultTargetGroup:N,setEmailTarget:A,setTelegramTarget:T,setSmsTarget:m,setNotifiLoginLoading:l}=p(),c=t=>{t.emailTargets&&t.emailTargets.length>0&&A(t.emailTargets.slice(-1)[0]),t.telegramTargets&&(t==null?void 0:t.telegramTargets.length)>0&&T(t.telegramTargets.slice(-1)[0]),t.smsTargets&&(t==null?void 0:t.smsTargets.length)>0&&m(t.smsTargets.slice(-1)[0])};return{getNotifiTargetGroups:async t=>{try{const r=t?await t.getTargetGroups():await a.getTargetGroups();if(console.log("ðŸš€ðŸš€ðŸš€ ~ useGetNotifiTargetGroups.ts:8 ~ getNotifiTargetGroups ~ targetGroup:",r),(r==null?void 0:r.length)>0){const n=r[0];console.log("ðŸš€ðŸš€ðŸš€ ~ First target group:",n),c(n)}return N(r),r}catch(r){return console.error("ðŸš€ðŸš€ðŸš€ ~ useGetNotifiTargetGroups.ts:20 ~ getNotifiTargetGroups ~ error:",r),{}}},ensureTargetGroup:async t=>{try{l(!0);const r={...t},n=await a.ensureTargetGroup({name:"Default",...r});n!=null&&n.id&&c(n),N([n]),l(!1)}catch(r){l(!1),console.error("ðŸš€ðŸš€ðŸš€ ~ useGetNotifiTargetGroups.ts:45 ~ ensureTargetGroup ~ error:",r)}}}}function J(){const{notifiClient:a}=p(),{defaultTargetGroup:N,setNotifiAlerts:A,setNotifiSourceGroups:T,setNotifiSources:m,setIsChecked:l,setNotifiSubscriptionLoading:c}=p(),{showCommonToast:f}=V(),{getNotifiTargetGroups:h}=v(),t=async o=>{let s=N.filter(i=>i.name==="Default");return s.length||(s=(await h(o)).filter(i=>i.name==="Default")),s[0]},r=(o,s)=>{console.log("ðŸš€ðŸš€ðŸš€ ~ useNotifiAlerts.ts:18 ~ useNotifiAlert ~ alerts:",o),console.log("ðŸš€ðŸš€ðŸš€ ~ useNotifiAlerts.ts:55 ~ handleAlertSource ~ alerts:",JSON.stringify(o));const i=[],u=[],g=[];o.forEach(e=>{var S,y;console.log("ðŸš€ðŸš€ðŸš€ ~ useNotifiAlerts.ts:41 ~ useNotifiAlert ~ alert:",e.subscriptionValue);const d=(e==null?void 0:e.subscriptionValue)!==null&&(e==null?void 0:e.subscriptionValue)!=="*"&&(e!=null&&e.subscriptionValue)?JSON.parse(e==null?void 0:e.subscriptionValue):null;((y=(S=e==null?void 0:e.sourceGroup)==null?void 0:S.name)!=null&&y.includes("position")||e.name.includes("Position Range Alerts"))&&e.name!=="Fusion Source Filter"&&e.name!=="defaultAlert"&&(i.push(e==null?void 0:e.sourceGroup),d!==null&&u.push({...d,alertID:e.id,alertName:e.name})),g.push({...d,alertID:e.id,alertName:e.name})}),console.log("ðŸš€ðŸš€ðŸš€ ~ useNotifiAlerts.ts:38 ~ useNotifiAlert ~ allSource:",g);const b=g.some(e=>e.alertName==="defaultAlert");return console.log("ðŸš€ðŸš€ðŸš€ ~ useNotifiAlerts.ts:51 ~ handleAlertSource ~ hasDefaultSource:",b),b||D(s),{sourceGroup:i,sources:u}},n=async o=>{try{const s=o?await o.getAlerts():await a.getAlerts();console.log("ðŸš€ ~ getNotifiAlerts ~ alerts:",s);const{sourceGroup:i,sources:u}=r(s,o||a);A(s),T(i),m(u),c(!1)}catch(s){console.error("ðŸš€ ~ getNotifiAlerts ~ error:",s)}},G=async o=>{console.log("ðŸš€ ~ deleteNotifiAlerts ~ id:",o);try{await a.deleteAlert({id:o}),f("Unsubscribed","success","You'll no longer receive alerts when the price goes out of range."),n(),c(!1)}catch(s){console.error("ðŸš€ ~ deleteNotifiAlerts ~ error:",s),f("There was an error unsubscribe alert","rejected",String(s)),c(!1)}},w=async(o,s)=>{try{const i=await t(),u={alerts:[{fusionEventId:"0192d2ba2cc371e5b6583e43295a3272",name:o&&s?`Position Range Alerts${new Date().getTime()}`:"defaultAlert",targetGroupId:i.id,subscriptionValue:o&&s?JSON.stringify({pool_address:o,position_index:String(s)}):"*",filterOptions:JSON.stringify('{"version":1,"input":{}}')}]},g=await a.ensureFusionAlerts(u);console.log("ðŸš€ ~ createNotifiAlert ~ alerts:",g),f("Subscribed to Alerts!","success","Verify your notification channels to receive alerts when the price goes out of range. To edit your alert settings, click the bell icon in the top nav."),n()}catch(i){console.error("ðŸš€ ~ createNotifiAlert ~ error:",i),f("There was an error subscribe alert","rejected",String(i)),l(!1),c(!1)}},D=async o=>{try{const i={alerts:[{fusionEventId:"0192d2ba2cc371e5b6583e43295a3272",name:"defaultAlert",targetGroupId:(await t(o)).id,subscriptionValue:"*",filterOptions:JSON.stringify('{"version":1,"input":{}}')}]};await o.ensureFusionAlerts(i),n()}catch(s){console.error("ðŸš€ ~ initDefaultAlert ~ error:",s)}};return{getNotifiAlerts:n,createNotifiAlert:w,deleteNotifiAlerts:G}}export{v as a,J as u};
//# sourceMappingURL=useNotifiAlerts-Duz6Uw_i.js.map
