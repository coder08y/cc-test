import{d as l,aV as q,F as E,aW as I,aX as V,ai as N,a5 as B,s as A}from"./index-BpSfzecM.js";import"./cross-DJ28FxNa.js";import{g as j}from"./utils-CMHkC_9A.js";const J=n=>{if(n!=null&&n.length){const r=n==null?void 0:n.map(o=>{var s,d;return{feeDisplay:o==null?void 0:o.feeDisplay,feeRate:o==null?void 0:o.feeRate,poolAddress:o==null?void 0:o.poolAddress,tickSpacing:o.tickSpacing,fee:o.fee,tvl:(o==null?void 0:o.tvl)==="--"?"0":o==null?void 0:o.tvl,liquidity:((s=o==null?void 0:o.object)==null?void 0:s.liquidity)==="--"?"0":(d=o==null?void 0:o.object)==null?void 0:d.liquidity}}),c=r==null?void 0:r.reduce((o,s)=>l(o).plus(s.tvl),l(0)).toString();if(l(c).gt(0)){let o=[];return o=r==null?void 0:r.map(s=>l(s==null?void 0:s.tvl).div(c).mul(100).toString()),R(r,o)}if(r.length===1)return r==null?void 0:r.map((o,s)=>({...o,title:"100% select"}));const t=r==null?void 0:r.reduce((o,s)=>l(o).plus((s==null?void 0:s.liquidity)||"0"),l(0)).toString();let u=[];return l(t).gt(0)?(u=r==null?void 0:r.map(o=>l(o==null?void 0:o.liquidity).div(t).mul(100).toString()),R(r,u)):(u=r==null?void 0:r.map(o=>0),R(r,u))}else return[]},R=(n,r,c=!0)=>{const t=r==null?void 0:r.some(s=>l(s).lt(.01)&&l(s).gt(0)),u=r==null?void 0:r.filter(s=>l(s).eq(0)).length;let o=u;return t?r=r.map(s=>l(s).gte(.01)?q(s,2):s):r=r.map(s=>E(s,2)),u>0&&c&&(r=r.map(s=>l(s).gte(0)&&l(s).lt(.02)?s:o>0?(o--,l(s).sub("0.01").toString()):s)),n==null?void 0:n.map((s,d)=>{const p=r[d],e=l(p).gt(0)&&l(p).lt(.01)?"<0.01 % select":p+"% select";return{...s,title:e}})},K=n=>{const r=l(n[1]).minus(n[0]).abs();let c=r;if(l(n[0]).lte("0"))return c.toString();for(;l(n[0]).minus(c).lt("0")&&(c=c.mul(.8),!c.lte(r.div(10))););return c.toString()},Q=50,U=n=>{const r=n==="âˆž"?"âˆž":V(N(n),6)+"",c=j(N(n))+"",t=c==="âˆž"?"âˆž":V(c,6)+"";return[r,c,t]},Y=n=>{const r=n==="âˆž"?"âˆž":B(N(n))+"",c=j(N(n))+"",t=c==="âˆž"?"âˆž":B(c)+"";return[r,c,t]},z=(n,r,c)=>String(I.getPriceFromLamport(r,c,n)),w=(n,r,c,t)=>String(I.getPriceFromBinId(n,r,c,t)),Z=(n,r,c,t=!0,u,o)=>{var P,S;let s=0;const d=(n==null?void 0:n.length)>150,p=r==null?void 0:r.decimals,e=c==null?void 0:c.decimals,f=n==null?void 0:n.map(i=>{var a;const y=(a=l(i==null?void 0:i.liquidity))==null?void 0:a.div(Math.pow(10,10)).toNumber(),h=N(z(i.price_per_lamport,p,e)),v=A(i==null?void 0:i.amount_a,p),_=A(i==null?void 0:i.amount_b,e);let L,F;if((i==null?void 0:i.bin_id)===u){const g=l(v).mul(h).add(_);L=l(v).mul(h).div(g).toString(),F=l(_).div(g).toString()}return s=Math.max(s,y),{...i,liquidity:y,price:t||t===void 0?h:l(1).div(h).toString(),priceOrigin:Number(t||t===void 0?h:l(1).div(h).toString()),baseSymbol:r==null?void 0:r.symbol,quoteSymbol:c==null?void 0:c.symbol,baseAmount:v,quoteAmount:_,quantityA:L,quantityB:F,noRadius:d}});if(u!==void 0&&o!==void 0&&((P=f==null?void 0:f[0])==null?void 0:P.bin_id)>u){const i=w(u,o,p,e);f.unshift({bin_id:u,price:t||t===void 0?i:l(1).div(i).toString(),priceOrigin:Number(t||t===void 0?i:l(1).div(i).toString()),liquidity:void 0})}if(u!==void 0&&o!==void 0&&((S=f==null?void 0:f[(f==null?void 0:f.length)-1])==null?void 0:S.bin_id)<u){const i=w(u,o,p,e);f.push({bin_id:u,price:t||t===void 0?i:l(1).div(i).toString(),priceOrigin:Number(t||t===void 0?i:l(1).div(i).toString()),liquidity:void 0})}return{list:[...f.sort((i,y)=>(i==null?void 0:i.priceOrigin)-(y==null?void 0:y.priceOrigin))],max:l(s).toNumber()}},$=({activeBin:n,allBins:r,binStep:c,baseToken:t,quoteToken:u,maxBinsLength:o=49,direct:s=!0,maxBin:d,minBin:p})=>{const e=l(o).sub(1).div(2).toNumber(),f=p!==void 0&&n-p>e?p:n-e,b=d!==void 0&&d-n>e?d:n+e,P=a=>{const g=r==null?void 0:r[String(a)],x=N(w(a,c,t==null?void 0:t.decimals,u==null?void 0:u.decimals));console.log("ðŸš€ ~ createBinItem ~ item:",g);const G=g!=null&&g.liquidity&&l(g==null?void 0:g.liquidity).gt("0")?l(g==null?void 0:g.liquidity).div(Math.pow(10,10)).toNumber():0,D=A(g==null?void 0:g.amount_a,t==null?void 0:t.decimals),m=A(g==null?void 0:g.amount_b,u==null?void 0:u.decimals);let C,M;if((g==null?void 0:g.bin_id)===n){const O=l(D).mul(x).add(m);C=l(D).mul(x).div(O).toString(),M=l(m).div(O).toString()}return{amount_a:(g==null?void 0:g.amount_a)||"0",amount_b:(g==null?void 0:g.amount_b)||"0",bin_id:a,liquidity:G,price:s?x:l(1).div(x).toString(),priceOrigin:Number(s?x:l(1).div(x).toString()),price_per_lamport:(g==null?void 0:g.price_per_lamport)||"",baseSymbol:t==null?void 0:t.symbol,quoteSymbol:u==null?void 0:u.symbol,baseLogo:t==null?void 0:t.logo_url,quoteLogo:u==null?void 0:u.logo_url,baseAmount:D,quoteAmount:m,quantityA:C,quantityB:M}};let S=n,i=0;const y=[];for(;S>=f;){const a=P(S);y.push(a),i=a!=null&&a.liquidity?Math.max(i,Number(a.liquidity)):i,S--}let h=n,v=0;const _=[];for(;h<b;){h++;const a=P(h);_.push(a),v=Math.max(v,a.liquidity)}return{list:[...y,..._].sort((a,g)=>Number(a.priceOrigin)-Number(g.priceOrigin)),max:Math.max(i,v)}},k=n=>{if((n==null?void 0:n.length)>0){const r=n==null?void 0:n.map(t=>({feeDisplay:t==null?void 0:t.feeDisplay,feeRate:t==null?void 0:t.feeRate,poolAddress:t==null?void 0:t.poolAddress,tvl:(t==null?void 0:t.tvl)==="--"?"0":t==null?void 0:t.tvl,fee:t.fee})),c=r==null?void 0:r.reduce((t,u)=>l(t).plus(u.tvl),l(0)).toString();if(l(c).gt(0)){let t=[];return t=r==null?void 0:r.map(u=>l(u==null?void 0:u.tvl).div(c).mul(100).toString()),R(r,t,!1)}if(l(c).eq(0))return r==null?void 0:r.map((t,u)=>({...t,title:"0% select"}));if(r.length===1)return r==null?void 0:r.map((t,u)=>({...t,title:"100% select"}))}return[]};function T(n,r){const c=[];let t=[],u=0;return n.forEach(o=>{var d;const s=((d=o.liquidityShares)==null?void 0:d.length)||0;u+s>r&&t.length>0&&(console.log("ðŸš€ ~ getDlmmPosFeeAndReward ~ currentBatchBinCount 1:",{currentBatchBinCount:u,currentBatch:t}),c.push([...t]),t=[],u=0),t.push(o),u+=s}),t.length>0&&(console.log("ðŸš€ ~ getDlmmPosFeeAndReward ~ currentBatchBinCount 2:",{currentBatchBinCount:u,currentBatch:t}),c.push(t)),console.log("ðŸš€ ~ getDlmmPosFeeAndReward ~ batches:",c,"totalBatches:",c.length),c}function rr(n,r,c){const t=r*c,u=Math.min(t+c,n.length),o=n.slice(t,u);return{bins:o,amount_a:o.reduce((d,p)=>l(d).add(l(p.amount_a)).toFixed(0),"0"),amount_b:o.reduce((d,p)=>l(d).add(l(p.amount_b)).toFixed(0),"0")}}export{k as a,rr as b,Y as c,Q as d,Z as e,z as f,J as g,U as h,w as i,$ as j,K as k,T as s};
