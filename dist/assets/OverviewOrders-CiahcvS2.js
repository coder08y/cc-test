import{u as I}from"./activeOrders-CRpxOhzY.js";import{u as J}from"./useAccountBalance-D7pkS3C9.js";import{M as K,l as N,bo as tt,u as Q,E as $,t as F,I as G,c as st,av as at,w as et,B as it,d as H,s as q,bL as lt}from"./index-ihcskjKt.js";import{r as n,j as a,H as v,T as j,ad as ct,m as X,V as k,B as Z,C as xt,w as mt}from"./vendor-CBmAETR3.js";import"./cross-CbhIs7DK.js";import{u as V}from"./useTransaction-BEUdFaaa.js";import{u as d,a as r,b as o,c as pt}from"./useGetDcaOrderHistory-D2emN1Os.js";import{u as gt}from"./useTokenRank-CM-9-tXe.js";import{P as ut}from"./Table-CmEnXJpd.js";import{H as Y}from"./HTextLabelBox-Cv1F2u1A.js";import{N as nt}from"./NoData-BFX9XpKb.js";import{E as ht}from"./ErrorTips-D8Nv331n.js";function Wt(){const[s,l]=n.useState(!1),[t,p]=n.useState(!1),{dcaWithdrawPayload:x}=d(),{dcaCloseOrderPayload:e}=r(),{signAndExecuteTransaction:i}=V(),{fetchAccountBalance:u}=J(),{currentAccount:h}=K(),{getDcaOrderList:P}=o(),{setDcaActiveOrderList:b}=I();return{closeAll:async _=>{p(!0);try{const w=_==null?void 0:_.map(m=>({order_id:m==null?void 0:m.orderID,in_coin_type:m==null?void 0:m.inCoin.coin_type,out_coin_type:m==null?void 0:m.outCoin.coin_type}));console.log("ðŸš€ ~ const closeOrderParams:any=pageList.map ~ closeOrderParams:",w);const W=await e(w),A=await i(W,{getShowInfo:m=>{const T={modalDescriptionText:"Closing DCA order",toastTitleText:"Closing DCA order"};return m==="success"&&(T.modalDescriptionText="DCA Order Closed",T.toastDescriptionContent="",T.toastTitleText="DCA Order Closed"),T}});console.log("ðŸš€ ~ closeAll ~ res:",A),A&&(b([]),setTimeout(()=>{u(),P(h==null?void 0:h.address,!0)},2e3)),p(!1)}catch(w){console.log("ðŸš€ ~ closeAll ~ error:",w),p(!1)}},claimAll:async _=>{l(!0);try{const w=_==null?void 0:_.map(m=>({order_id:m==null?void 0:m.orderID,in_coin_type:m==null?void 0:m.inCoin.coin_type,out_coin_type:m==null?void 0:m.outCoin.coin_type}));console.log("ðŸš€ ~ const claimOrderParams:any=pageList.map ~ claimOrderParams:",w);const W=await x(w),A=await i(W,{getShowInfo:m=>{const T={modalDescriptionText:"DCA Order Claimed",toastTitleText:"DCA Order Claimed"};return m==="success"&&(T.toastDescriptionContent=""),T}});console.log("ðŸš€ ~ claimAll ~ res:",A),A&&setTimeout(()=>{u(),P(h==null?void 0:h.address,!0)},2e3),l(!1)}catch(w){console.log("ðŸš€ ~ claimAll ~ error:",w),l(!1)}},isClaimAllLoading:s,isCloseAllLoading:t}}function bt(){const[s,l]=n.useState(!1),[t,p]=n.useState(!1),[x,e]=n.useState(!1),[i,u]=n.useState([]),[h,P]=n.useState(0),{currentAccount:b}=K(),{dcaWithdrawPayload:O}=d(),{fetchCoinBalance:z}=J(),{signAndExecuteTransaction:_}=V(),{getDcaOrderList:w}=o(),{dcaCloseOrderPayload:W}=r(),{getDcaOrderHistory:A}=pt();return{toClaim:async c=>{l(!0);try{console.log("ðŸš€ ~ closeOrder ~ orderInfo:",c);const S=[],E={order_id:c==null?void 0:c.orderID,in_coin_type:c==null?void 0:c.inCoin.coin_type,out_coin_type:c==null?void 0:c.outCoin.coin_type};S.push(E),console.log("ðŸš€ ~ toClaim ~ claimOrderParams:",S);const R=await O(S),D=await _(R,{getShowInfo:C=>{var B,L;const g={modalDescriptionText:`${(B=c==null?void 0:c.outCoin)==null?void 0:B.symbol} Claimed`,toastTitleText:`${(L=c==null?void 0:c.outCoin)==null?void 0:L.symbol} Claimed`};return C==="success"&&(g.toastDescriptionContent=""),g}});D&&(console.log("ðŸš€ ~ toClaim ~ res:",D),setTimeout(()=>{z(b==null?void 0:b.address,c==null?void 0:c.outCoin.coin_type),w(b==null?void 0:b.address,!0)},2e3)),l(!1)}catch(S){console.log("ðŸš€ ~ toClaim ~ error:",S),l(!1)}},closeOrderAction:async c=>{p(!0);try{console.log("ðŸš€ ~ closeOrder ~ orderInfo:",c);const S=[{order_id:c==null?void 0:c.orderID,in_coin_type:c==null?void 0:c.inCoin.coin_type,out_coin_type:c==null?void 0:c.outCoin.coin_type}];console.log("ðŸš€ðŸš€ðŸš€ ~ file: dca-order-card.vue:280 ~ closeOrder ~ closeOrderParams:",S);const E=await W(S),R=await _(E,{getShowInfo:D=>{const C={modalDescriptionText:"Closing DCA order",toastTitleText:"Closing DCA order"};return D==="success"&&(C.modalDescriptionText="DCA Order Closed",C.toastDescriptionContent="",C.toastTitleText="DCA Order Closed"),C}});console.log("ðŸš€ ~ closeOrder ~ res:",R),R&&setTimeout(()=>{z(),w(b==null?void 0:b.address,!0)},2e3),p(!1)}catch(S){console.log("ðŸš€ ~ closeOrder ~ error:",S),p(!1)}},isCloseLoading:t,isClaimLoading:s,total:h,orderHistoryList:i,handleGetDcaOrderHistory:async(c,S,E,R=!1)=>{var C,g,B,L;console.log("ðŸš€ ~ handleGetDcaOrderHistory ~ loading:",R),e(R);const D=await A({orderId:c,limit:S,offset:E});console.log("ðŸš€ ~ handleGetDcaOrderHistory ~ res?.list:",D),N(D)&&((C=D[c])!=null&&C.list)&&u((g=D[c])==null?void 0:g.list),N(D)&&((B=D[c])!=null&&B.total)&&P((L=D[c])==null?void 0:L.total),e(!1),console.log("ðŸš€ ~ file: TestData.tsx:170 ~ handleGetDcaOrderHistory ~ res:",D)},orderHistoryListLoading:x}}function Et({orderInfo:s}){const{inCoin:l,outCoin:t}=s;return a.jsxs(v,{children:[a.jsx(tt,{coinAIconUrl:l==null?void 0:l.logo_url,coinBIconUrl:t==null?void 0:t.logo_url,coinACoinType:l==null?void 0:l.coin_type,coinBCoinType:t==null?void 0:t.coin_type,w:"28px",h:"28px"}),a.jsxs(j,{color:"text_caption",children:[l==null?void 0:l.symbol," â†’ ",t==null?void 0:t.symbol]})]})}function kt({orderInfo:s,isProfile:l}){const{inCoin:t}=s,{isApp:p}=Q();return a.jsxs(v,{flexDirection:l?p?"row":"column":"row",align:l?"flex-end":"center",gap:l?"4px":"8px",children:[a.jsxs(v,{children:[a.jsxs(j,{color:"text_caption",fontSize:l?"14px":"12px",children:[$(s==null?void 0:s.inDepositedOut)," ",t==null?void 0:t.symbol]}),a.jsxs(j,{color:l?"text_caption":"primary_gray",fontSize:l?"14px":"12px",children:["/ ",$(s==null?void 0:s.inDeposited)," ",t==null?void 0:t.symbol]})]}),a.jsxs(v,{children:[a.jsxs(j,{color:"primary_gray",fontSize:"12px",children:["(",s==null?void 0:s.inBalanceRatio,"%)"]}),(!l||!p)&&a.jsx(ct,{w:l?"40px":"50px",h:"4px",value:s==null?void 0:s.inBalanceRatio,bg:"#282828",sx:{'div[role="progressbar"]':{bg:"primary"}}})]})]})}function Ht({orderInfo:s,isProfile:l=!1,isRank:t=!1}){const p="400",x=n.useMemo(()=>({minPrice:s==null?void 0:s.minPrice,maxPrice:s==null?void 0:s.maxPrice,minPriceResever:s==null?void 0:s.minPriceResever,maxPriceResever:s==null?void 0:s.maxPriceResever}),[s]),e=n.useMemo(()=>s==null?void 0:s.outCoin,[s]),i=n.useMemo(()=>s==null?void 0:s.inCoin,[s]),[u,h]=n.useState(!0),{getTokenRank:P}=gt();n.useEffect(()=>{if(t){const z=P(e,i);console.log("ðŸš€ ~ useEffect ~ direct:",z),h(z)}},[t,e==null?void 0:e.coin_type,i==null?void 0:i.coin_type]);const b=l?"14px":"12px",O=l?"text_paragraph":"primary_gray";return a.jsx(v,{mt:l?"0px":"3px",justify:l?"flex-end":"flex-start",children:a.jsx(X,{isLoaded:!!(x!=null&&x.minPrice)&&!!e&&!!i,children:a.jsxs(v,{flexWrap:"wrap",gap:"4px",justify:"flex-start",align:l?"flex-end":"center",flexDirection:l?"column":"row",children:[a.jsx(j,{lineHeight:"16px",h:"16px",fontSize:b,fontWeight:p,color:"text_caption",whiteSpace:"nowrap",children:u?`${x==null?void 0:x.minPrice} - ${x==null?void 0:x.maxPrice}`:`${x==null?void 0:x.minPriceResever} - ${x==null?void 0:x.maxPriceResever}`}),a.jsxs(v,{gap:"4px",children:[a.jsxs(v,{gap:"0",children:[a.jsx(j,{fontSize:"12px",fontWeight:p,color:O,children:F(u?i==null?void 0:i.symbol:e==null?void 0:e.symbol,10)}),a.jsx(j,{fontSize:"12px",fontWeight:p,color:O,children:"Â perÂ "}),a.jsx(j,{fontSize:"12px",fontWeight:p,color:O,children:F(u?e==null?void 0:e.symbol:i==null?void 0:i.symbol,10)})]}),a.jsx(G,{xlinkHref:"#icon-icon_swap1",w:"14px",h:"14px",onClick:z=>{st(z),h(!u)}})]})]})})})}function y({label:s,value:l,direct:t,onChangeDirect:p,textAlign:x="left",showDirectIcon:e=!0,...i}){return a.jsxs(k,{align:"flex-start",flexDirection:{base:"row",lg:"column"},w:{base:"100%",lg:"unset"},justify:{base:"space-between",lg:"unset"},...i,children:[s!==""&&a.jsxs(v,{h:"12px",children:[a.jsx(j,{fontSize:"12px",children:s}),p&&e&&a.jsx(G,{xlinkHref:"#icon-icon_swap1",svgW:"14px",svgH:"14px",ml:"-6px",onClick:p})]}),l!==""&&a.jsx(Z,{fontSize:"12px",color:"text_caption",textAlign:x,children:l})]})}function Mt({isDetail:s,currentTabVal:l,orderInfo:t,pageDirect:p}){const{isApp:x}=Q(),{inCoin:e,outCoin:i}=t,[u,h]=n.useState(p),[P,b]=n.useState(p),O=10,[z,_]=n.useState(1),{isClaimLoading:w,toClaim:W,total:A,orderHistoryList:m,handleGetDcaOrderHistory:T,orderHistoryListLoading:M}=bt(),[c,S]=n.useState({label:"Overview",value:"overview"}),E=n.useMemo(()=>[{label:"Overview",value:"overview"},{label:M||Number(A)===0?"Orders":`Orders (${A})`,value:"orders"}],[A]),R=g=>{S(g),_(1),t!=null&&t.orderID&&T(t==null?void 0:t.orderID,O,0,!1)};n.useEffect(()=>{s&&(t!=null&&t.orderID)&&T(t==null?void 0:t.orderID,O,0,!1)},[t==null?void 0:t.orderID,s]);const D=g=>{console.log("ðŸš€ ~ handleCurrentPage ~ page:",g);const B=(g-1)*O;T(t==null?void 0:t.orderID,O,B,!1),_(g)},{getExplorerUrl:C}=at();return a.jsxs(k,{w:"100%",gap:"20px",children:[a.jsx(et,{type:"outlineTab",wrapStyle:{w:"100%",h:"36px",borderRadius:"8px",p:"4px",mt:"-1px",zIndex:"1"},itemStyle:{w:"50%",fontSize:"12px"},tabList:E,currentTab:c.label,handleChangeTab:R}),a.jsxs(it,{p:"30px 8px 20px",mt:"-42px",borderRadius:"8px",zIndex:"0",bg:"bg_primary",children:[c.value=="orders"&&(M?a.jsx(X,{height:"4",width:"100%"}):(m==null?void 0:m.length)===0?a.jsx(nt,{type:"nodata",text:"No orders",noBorder:!0,p:"12px",bg:"none"}):a.jsxs(k,{w:"100%",align:"flex-start",gap:"16px",mt:"12px",children:[!x&&a.jsxs(v,{w:"100%",flexDirection:{base:"column",lg:"row"},children:[a.jsx(y,{label:"Order info",value:"",w:{base:"100%",lg:"40%"}}),a.jsx(y,{label:"Rate",value:"",w:{base:"100%",lg:"calc(32% - 16px)"},direct:P,onChangeDirect:()=>b(!P)}),a.jsx(y,{label:"Time (UTC)",value:"",w:{base:"100%",lg:"28%"},align:"flex-end",textAlign:"right"})]}),m==null?void 0:m.map(g=>{const B=q(g.inAmount,e==null?void 0:e.decimals),L=q(g.outAmount,i==null?void 0:i.decimals),U=H(B).div(L).toString(),f=H(1).div(U).toString();return a.jsxs(v,{w:"100%",flexDirection:{base:"column",lg:"row"},borderBottom:x?"1px solid":"none",pb:x?"16px":"0",borderColor:"border",_last:{borderBottom:"none",pb:"0"},children:[a.jsx(y,{label:x?"Order info":"",value:`${$(B)} ${e.symbol} â†’ ${$(L)} ${i.symbol}`,w:{base:"100%",lg:"40%"}}),a.jsx(y,{label:x?"Rate":"",value:P?`${$(U)} ${e.symbol} per ${i.symbol}`:`${$(f)} ${i.symbol} per ${e.symbol}`,w:{base:"100%",lg:"calc(32% - 16px)"},direct:P,showDirectIcon:!!x,onChangeDirect:()=>b(!P)}),a.jsx(y,{label:x?"Time (UTC)":"",value:a.jsxs(v,{h:"12px",children:[a.jsx(j,{fontSize:"12px",color:"text_caption",children:lt((g==null?void 0:g.time)*1e3,"YMDHM")}),a.jsx(G,{xlinkHref:"#icon-icon_link1",onClick:()=>{window.open(C(g==null?void 0:g.tx,"tx"))},fontSize:"16px"})]}),w:{base:"100%",lg:"28%"},align:"flex-end",textAlign:"right"})]},g==null?void 0:g.time)}),H(A).gt(O)&&a.jsx(xt,{w:"100%",children:a.jsx(ut,{total:A,size:O,currentPage:z,onChange:D})})]})),c.value=="overview"&&a.jsxs(k,{align:"flex-start",gap:"20px",children:[(t==null?void 0:t.isShowTradeTips)&&(t==null?void 0:t.orderStatus)=="Active"&&l=="active"&&a.jsx(Dt,{}),a.jsxs(k,{w:"100%",borderRadius:"8px",p:"12px",bg:"card_bg",gap:"12px",children:[a.jsx(Y,{isLoading:!1,label:`DCA  ${e==null?void 0:e.symbol} Balance`,value:`${jt(t)} ${e==null?void 0:e.symbol}`,skeletonStyle:{valueW:"128px"}}),a.jsxs(v,{w:"100%",justify:"space-between",children:[a.jsxs(j,{fontSize:"12px",children:["DCA ",i==null?void 0:i.symbol," Balance"]}),a.jsxs(v,{children:[a.jsxs(j,{color:"text_caption",fontSize:"12px",children:[wt(t)," ",i==null?void 0:i.symbol]}),l=="active"&&a.jsx(mt,{isLoading:w,onClick:()=>W(t),isDisabled:(t==null?void 0:t.outBalance)<=0||w,w:"60px",h:"20px",fontSize:"12px",borderRadius:"4px",variant:"outline",children:"Claim"})]})]}),a.jsx(Y,{isLoading:!1,label:"Amount Withdrawn",value:vt(t,l=="active"),skeletonStyle:{valueW:"128px"}})]}),a.jsxs(v,{flexWrap:"wrap",p:{base:"0",lg:"0 12px"},mt:{base:"-12px",lg:"-28px"},sx:{">div":{mt:{base:"12px",lg:"28px"},w:{base:"100%",lg:"calc((100% - 66px)/3)"},"&:nth-child(3n+1)":{mr:{base:"0",lg:"50px"}}}},children:[a.jsx(y,{label:"Invest Every",value:t==null?void 0:t.investEvery}),a.jsx(y,{label:"# of Orders Left",value:t==null?void 0:t.ofOrderLeft}),a.jsx(y,{label:"Each Order Size",value:`${t==null?void 0:t.eachOrderSize} ${e==null?void 0:e.symbol}`,align:"flex-end",textAlign:"right"}),a.jsx(y,{label:"Minimum Price",value:u?`${t==null?void 0:t.minPrice} ${e==null?void 0:e.symbol} per ${i==null?void 0:i.symbol}`:`${t==null?void 0:t.minPriceResever} ${i==null?void 0:i.symbol} per ${e==null?void 0:e.symbol}`,direct:u,onChangeDirect:()=>h(!u)}),a.jsx(y,{label:"Maximum Price",value:u?`${t==null?void 0:t.maxPrice} ${e==null?void 0:e.symbol} per ${i==null?void 0:i.symbol}`:`${t==null?void 0:t.maxPriceResever} ${i==null?void 0:i.symbol} per ${e==null?void 0:e.symbol}`,direct:u,onChangeDirect:()=>h(!u)}),l=="active"&&a.jsx(y,{label:"Current Avg. Price",value:u?`${t==null?void 0:t.currentAvgPrice} ${e==null?void 0:e.symbol} per ${i==null?void 0:i.symbol}`:`${t==null?void 0:t.currentAvgPriceResever} ${i==null?void 0:i.symbol} per ${e==null?void 0:e.symbol}`,align:"flex-end",textAlign:"right",direct:u,onChangeDirect:()=>h(!u)}),l!=="active"&&(t==null?void 0:t.currentAvgPrice)!=="--"&&a.jsx(y,{label:"Avg. Price",value:u?`${t==null?void 0:t.currentAvgPrice} ${e==null?void 0:e.symbol} per ${i==null?void 0:i.symbol}`:`${t==null?void 0:t.currentAvgPriceResever} ${i==null?void 0:i.symbol} per ${e==null?void 0:e.symbol}`,align:"flex-end",textAlign:"right",direct:u,onChangeDirect:()=>h(!u)}),l=="active"&&a.jsx(y,{label:"Next Order (UTC)",value:t==null?void 0:t.nextCycleAt}),a.jsx(y,{label:"Created (UTC)",value:t==null?void 0:t.createAt,align:l=="active"||l!=="active"&&(t==null?void 0:t.currentAvgPrice)!=="--"?"flex-start":"flex-end"})]})]})]})]})}const vt=(s,l,t=!1)=>{const{inCoin:p,outCoin:x}=s;return l?`${$(s==null?void 0:s.outWithdraw,2)} ${x==null?void 0:x.symbol}`:(s==null?void 0:s.orderStatus)==="PartialDeal"||(s==null?void 0:s.orderStatus)==="Close"?H(s==null?void 0:s.outWithdraw).gt(0)?a.jsxs(a.Fragment,{children:[$(s==null?void 0:s.inWithdrawn)," ",p==null?void 0:p.symbol,t&&a.jsx(Z,{as:"span",display:"inline-block",m:"0 8px",w:"1px",h:"14px",bg:"border"}),$(s==null?void 0:s.outWithdraw)," ",x==null?void 0:x.symbol]}):`${$(s==null?void 0:s.inWithdrawn)} ${p==null?void 0:p.symbol}`:`${$(s==null?void 0:s.outWithdraw)} ${x==null?void 0:x.symbol}`},jt=s=>$(s==null?void 0:s.inBalance,2)||"0",wt=s=>(s==null?void 0:s.outBalance)>0?$(s==null?void 0:s.outBalance):s==null?void 0:s.outBalance,Dt=()=>a.jsxs(k,{p:"12px 12px 0",align:"flex-start",children:[a.jsx(v,{children:a.jsx(ht,{tips:"The system tried to execute your order multiple times but did not get it through. This is possibly because:",type:"warning",tipsFontSize:"12px",p:"0",bg:"none",svgW:"20px",svgH:"20px"})}),a.jsx(yt,{})]});function yt(){return a.jsxs(k,{align:"flex-start",w:"100%",children:[a.jsx(j,{color:"primary_yellow",lineHeight:"20px",fontSize:"12px",children:"- The market price is not in your required price range"}),a.jsx(j,{color:"primary_yellow",lineHeight:"20px",fontSize:"12px",children:"- The market no longer exit"}),a.jsx(j,{color:"primary_yellow",lineHeight:"20px",fontSize:"12px",children:"- The market is extremely volatile"}),a.jsx(j,{color:"primary_yellow",lineHeight:"20px",fontSize:"12px",textAlign:"left",children:"This DCA will continue to be attempted and the estimated end date may be extended until your order is fully executed."})]})}export{Et as D,Mt as O,Ht as R,yt as W,kt as a,Wt as b,jt as c,wt as d,vt as g,bt as u};
//# sourceMappingURL=OverviewOrders-CiahcvS2.js.map
