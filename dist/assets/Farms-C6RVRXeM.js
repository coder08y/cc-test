import{r as n,j as e,V as w,T as _,B as N,m as S,w as Z,H as v,Y as U}from"./vendor-CBmAETR3.js";import{u as ls}from"./ExpendItem-BR-Au2GE.js";import{a as Y,c as $}from"./usePositionList-heG2hQcx.js";import{M as A,p as as,d as P,Q as H,k as D,I as is,u as O,w as ns}from"./index-BpSfzecM.js";import"./cross-DJ28FxNa.js";import{N as X}from"./NoData-BFX9XpKb.js";import{A as ds}from"./index-DfyAgMoy.js";import{V as xs,R as ms,S as ps,T as gs,F as cs,a as hs}from"./FarmsTable-UIjeXFuA.js";import{R as us}from"./RefreshButton-bgRHxGzR.js";import{S as bs}from"./SortDropBlock-B-n__xh7.js";import{u as js}from"./useGetPoolList-4kFQ2tyG.js";import{u as fs}from"./useAccountBalance-DV0qM_Vy.js";import{u as Ls}from"./useRpcListener-BdFabOsZ.js";import"./useTransaction-uEos3ZjK.js";import"./useTrack-Cdn9qear.js";import"./v4-C6aID195.js";import"./useSigner-Ct94kXtL.js";import"./useTransactionModal-DL7w_I3R.js";import"./LiquidityValueBlock-CJnPKpci.js";import"./msafe-BzcjPV-e.js";import"./PositionPriceRangeBar-Bdy_fJqo.js";import"./RangeValue-CrFwA76f.js";import"./useTokenRank-CM-9-tXe.js";import"./useWrapPoolData-CMGMCXwG.js";import"./dlmm-DdxfaipV.js";import"./utils-CMHkC_9A.js";import"./en_US-KAK2ZBDO-C1Pw6Q2s.js";import"./useFavoritePool-5MLb1oZG.js";import"./CoinPairInfo-BH5hoU3X.js";import"./config-DTm0VBgZ.js";import"./PoolTag-DVhitHGR.js";import"./usePreviousValue-Da-o2xpb.js";function Ss(s){const{totalRewards:d}=s,{currentAccount:o}=A(),{posBaseList:r}=Y(),{getPositionBaseList:h}=$(),{toClaimAllPos:l,claimLoading:g}=ls(),a=n.useRef(null),T=async()=>{o!=null&&o.address&&await h(o==null?void 0:o.address)},u=()=>{l(r,T)};return n.useEffect(()=>{a!=null&&a.current&&(a.current.textContent=as(d,2))},[d]),e.jsx(w,{w:"100%",pos:"absolute",alignItems:"start",sx:{backgroundImage:{base:"url('/images/farms_banner_h5.png')",lg:"url('/images/farms.png')"},backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},children:e.jsxs(w,{minW:{base:"100%",lg:"1200px"},p:"40px 20px 0",margin:"0px auto",gap:"12px",h:"240px",alignItems:"start",children:[e.jsx(_,{color:"text_caption",fontSize:"28px",fontWeight:"500",children:"Farms"}),e.jsx(_,{fontSize:"16px",children:"Stake your positions to earn higher yield."}),(o==null?void 0:o.address)&&e.jsx(N,{h:"20px",mt:"16px",children:e.jsx(S,{isLoaded:!!d,children:e.jsx(_,{color:"primary",fontSize:"20px",fontWeight:"500",ref:a})})}),(o==null?void 0:o.address)&&e.jsx(Z,{isLoading:g,isDisabled:g||d=="--"?!0:P(d).lte(0),h:"28px",fontSize:"14px",borderRadius:"8px",onClick:u,children:"Claim All Rewards"})]})})}function ys({dataList:s,showSkeletonLoading:d,currTabLabel:o}){const{currentAccount:r,onWalletModal:h}=A();return e.jsx(e.Fragment,{children:o=="Your Farms"&&!(r!=null&&r.address)?e.jsx(X,{type:"nowallet",onboard:()=>{h(!0)}}):d?e.jsx(Ts,{}):s.length===0?e.jsx(X,{type:"nodata",text:"No farms found"}):e.jsx(w,{w:"100%",children:s.map(l=>e.jsx(Fs,{apiInfo:l},l==null?void 0:l.poolAddress))})})}const Fs=({apiInfo:s})=>{const{getTokenAmountValue:d}=H(),{coinPriceObj:o}=D();console.log("ðŸš€ ~ FarmsTableItem ~ apiInfo:",s);const{currentAccount:r,onWalletModal:h}=A(),[l,g]=n.useState({}),{farmsPosRewardsDataLoading:a,farmsPosRewardsData:T,posBaseListLoading:u,posBaseListGroupByPool:f}=Y(),y=n.useMemo(()=>{var b;if(!(r!=null&&r.address)||!(s!=null&&s.poolAddress))return"--";if(!u&&!a)return(((b=f[s.poolAddress])==null?void 0:b.list)||[]).reduce((p,j)=>{const x=T[j==null?void 0:j.id]||[];console.log("ðŸš€ ~ returnposBaseList.reduce ~ posFarmsData:",p,x);const V=x.reduce((W,m)=>{if(W==="--")return"--";const C=d(m==null?void 0:m.token.coin_type,m==null?void 0:m.display_amount_owed,"--");return C==="--"?"--":P(W).plus(C).toString()},"0");return p==="--"||V==="--"?"--":P(p).plus(V).toString()},"0")},[u,T,a,o,r==null?void 0:r.address]),B=n.useMemo(()=>{var L,p;const b=((p=(L=f==null?void 0:f[s==null?void 0:s.poolAddress])==null?void 0:L.list)==null?void 0:p.filter(j=>j.posType!=="burn").sort((j,x)=>Number(x.liquidity)-Number(j.liquidity)))||[];return console.log("ðŸš€ ~ expendList ~ list:",b),b},[s==null?void 0:s.poolAddress,f]);return e.jsxs(w,{gap:"16px",w:"100%",align:"flex-start",bg:"bg_fifth",border:"1px solid",borderColor:"border",p:"8px",borderRadius:"12px",children:[e.jsx(xs,{apiInfo:s}),e.jsx(E,{label:"Staked TVL",value:e.jsx(_,{fontWeight:"500",textColor:"text_caption",textAlign:"right",children:s==null?void 0:s.farmsStatedTvlDisplay})}),e.jsx(E,{label:"APR",value:e.jsx(ds,{poolInfo:s,isPosition:!0})}),e.jsx(E,{label:"Rewards / day",value:e.jsx(ms,{apiInfo:s})}),e.jsx(E,{label:"Your Staked",value:e.jsx(ps,{apiInfo:s})}),e.jsx(E,{label:"Your Earned",value:e.jsx(gs,{totalEarned:y,apiInfo:s,disabled:y=="--"?!0:P(y).lte(0)})}),e.jsx(Z,{w:"100%",h:"40px",borderRadius:"8px",variant:"ghost",onClick:()=>{l[s==null?void 0:s.poolAddress]?l[s==null?void 0:s.poolAddress]=!1:l[s==null?void 0:s.poolAddress]=!0,g({...l})},sx:{_hover:{svg:{fill:"text_caption"}}},children:e.jsx(is,{svgW:"16px",xlinkHref:"#icon-icon_arrow",variant:"gray",transition:"transform 0.5s",transform:l[s==null?void 0:s.poolAddress]?"rotate(180deg)":"rotate(0deg)"})}),l[s==null?void 0:s.poolAddress]&&e.jsx(cs,{expendList:B,apiInfo:s})]})},E=({label:s,value:d})=>e.jsxs(v,{w:"100%",justify:"space-between",children:[e.jsx(_,{children:s}),d]}),Ts=()=>e.jsx(w,{w:"100%",align:"flex-start",children:[{},{},{}].map((s,d)=>e.jsxs(w,{w:"100%",align:"flex-start",gap:"16px",bg:"bg_fifth",border:"1px solid",borderColor:"border",p:"8px",borderRadius:"12px",children:[e.jsxs(v,{gap:"0",children:[e.jsx(U,{size:"9"}),e.jsx(U,{size:"9"}),e.jsx(N,{w:"4px"}),e.jsx(S,{height:"4",width:"150px"})]}),e.jsxs(v,{w:"100%",gap:"4px",ml:"4px",justify:"space-between",children:[e.jsx(S,{height:"4",width:"120px"}),e.jsx(S,{height:"4",width:"120px"})]}),e.jsxs(v,{w:"100%",gap:"4px",ml:"4px",justify:"space-between",children:[e.jsx(S,{height:"4",width:"120px"}),e.jsx(S,{height:"4",width:"120px"})]}),e.jsxs(v,{w:"100%",gap:"4px",ml:"4px",justify:"space-between",children:[e.jsx(S,{height:"4",width:"120px"}),e.jsx(S,{height:"4",width:"120px"})]}),e.jsxs(v,{w:"100%",gap:"4px",ml:"4px",justify:"space-between",children:[e.jsx(S,{height:"4",width:"120px"}),e.jsx(S,{height:"4",width:"120px"})]})]},d))});function vs(s){const{sortByList:d,currTab:o,tabList:r,handleChangeTab:h,currSortType:l,onSortByChange:g,sortRule:a,handleRefresh:T,handleChangeSortRule:u}=s,{isApp:f}=O();return e.jsxs(v,{w:"100%",mt:{base:"20px",lg:"40px"},justify:"space-between",flexDirection:{base:"column",lg:"row"},children:[e.jsx(ns,{type:"borderTab",wrapStyle:{w:{base:"100%",lg:"415px"},h:"46px",borderRadius:{base:"8px",lg:"12px"}},itemStyle:{w:"50%",fontSize:"16px"},tabList:r,currentTab:o.label,handleChangeTab:h}),e.jsxs(v,{w:{base:"100%",lg:"unset"},children:[e.jsx(bs,{sortText:"Sort by",xlinkHref:a=="desc"?"#icon-icon_sort2":"#icon-icon_sort_asc1",iconOnClick:()=>{u(a==="asc"?"desc":"asc")},minW:f?"calc(100vw - 126px)":"120px",currentSort:l,sortByList:d,onSortByChange:g,wrapStyle:{borderRadius:{base:"8px",lg:"12px"}}}),e.jsx(us,{handleRefresh:T,borderRadius:{base:"8px",lg:"12px"}})]})]})}function ws(){const{getPoolList:s}=js();return{getFarmList:async(o="-tvl")=>{var h;const r=await s({is_vaults:!1,display_all_pools:!1,has_mining:!1,has_farming:!0,no_incentives:!1,order_by:"-vol",limit:100,offset:0});return console.log("ðŸš€ ~ getFarmList ~ res:",r),(h=r==null?void 0:r.list)==null?void 0:h.sort((l,g)=>o==="-apr"?g.feeAndFarmsApr-l.feeAndFarmsApr:o==="apr"?l.feeAndFarmsApr-g.feeAndFarmsApr:o==="-tvl"?g.farmsStatedTvl-l.farmsStatedTvl:l.farmsStatedTvl-g.farmsStatedTvl)}}}function le(){const{currentAccount:s}=A(),{getPositionBaseList:d}=$(),{posBaseList:o,posBaseListLoading:r,farmsPosRewardsData:h,farmsPosRewardsDataLoading:l}=Y(),{getFarmList:g}=ws(),[a,T]=n.useState([]),[u,f]=n.useState([]),[y,B]=n.useState([]),[b,L]=n.useState(!0),[p,j]=n.useState([]);fs();const[x,V]=n.useState({label:"Live"}),W=[{label:"APR",value:"apr"},{label:"TVL",value:"tvl"}],[m,C]=n.useState({sortRule:"desc",sortType:"tvl"}),[q,I]=n.useState({label:"TVL",value:"tvl"}),ss=n.useMemo(()=>{const t=[];return t.push({label:"Live",num:b?void 0:u.length.toString()}),t.push({label:"Your Farms",num:y.length>0&&(s!=null&&s.address)&&!b?y.length.toString():void 0}),t},[x.label,b,u,y,s==null?void 0:s.address]),Q=async()=>{s!=null&&s.address?(await d(s==null?void 0:s.address,{isFarmsPage:!0}),console.log("ðŸš€ ~ getPositionList ~ currentAccount?.address:",s==null?void 0:s.address)):j([])},z=async t=>{const i=(t==null?void 0:t.sortRule)=="desc"?"-"+(t==null?void 0:t.sortType):t==null?void 0:t.sortType,F=await g(i);F&&T(F)};n.useEffect(()=>{if(console.log("ðŸš€ ~ Farms ~ positionList:",p),a.length>0){if(x.label=="Live"&&(f(a.filter(t=>t==null?void 0:t.haveFarming)),L(!1)),s!=null&&s.address&&(p==null?void 0:p.length)>0){const t=a.filter(i=>{console.log("ðŸš€ðŸš€ðŸš€ ~ Farms.tsx:106 ~ myList ~ item:",i);const F=p==null?void 0:p.filter(c=>(c==null?void 0:c.posType)==="farms");return console.log("ðŸš€ðŸš€ðŸš€ ~ Farms.tsx:103 ~ myList ~ posItems:",F),F.some(c=>(i==null?void 0:i.poolAddress)===(c==null?void 0:c.clmmPool))});console.log("ðŸš€ðŸš€ðŸš€ ~ Farms.tsx:104 ~ myList ~ myList:",t),B(t)}else B([]);r||L(!1)}else f([]),B([])},[x.label,a,s==null?void 0:s.address,p,r]),n.useEffect(()=>{z(m),s!=null&&s.address?(L(!0),Q()):j([])},[s==null?void 0:s.address]),n.useEffect(()=>{j(o)},[o]);const G=()=>{L(!0),z(m),Q()};Ls({onRpcChange:()=>{G()}});const{fetchTokenPrices:es}=H(),ts=()=>{const t=[];a==null||a.forEach(i=>{var F,c;t.includes(i.tokenA.coin_type)||t.push(i.tokenA.coin_type),t.includes(i.tokenB.coin_type)||t.push(i.tokenB.coin_type),((F=i==null?void 0:i.farmsRewarderList)==null?void 0:F.length)>0&&((c=i==null?void 0:i.farmsRewarderList)==null||c.forEach(k=>{t.push(k==null?void 0:k.coinType)}))}),t.length>0&&es(Array.from(new Set(t)))};n.useEffect(()=>{(a==null?void 0:a.length)>0&&ts()},[a]);const{getTokenAmountValue:os}=H(),{coinPriceObj:rs}=D(),J=n.useMemo(()=>{if(!(s!=null&&s.address))return"--";if(!r&&!l)return o.reduce((t,i)=>{const c=(h[i==null?void 0:i.id]||[]).reduce((k,R)=>{if(k==="--")return"--";const K=os(R==null?void 0:R.token.coin_type,R==null?void 0:R.display_amount_owed,"--");return K==="--"?"--":P(k).plus(K).toString()},"0");return t==="--"||c==="--"?"--":P(t).plus(c).toString()},"0")},[r,h,l,rs,s==null?void 0:s.address]);console.log("ðŸš€ ~ totalEarned ~ totalEarned:",J);const{isApp:M}=O();return e.jsxs(w,{gap:"20px",w:"100%",children:[e.jsx(Ss,{totalRewards:J}),e.jsx(N,{h:"220px"}),e.jsx(vs,{sortByList:W,currTab:x,tabList:ss,handleChangeTab:t=>{V(t)},currSortType:q,onSortByChange:t=>{L(!0),m.sortType=t.value,C({...m}),I(t),z(m)},sortRule:m.sortRule,handleChangeSortRule:t=>{L(!0),m.sortRule=t,C({...m}),z(m)},handleRefresh:G}),M&&e.jsx(_,{w:"100%",fontSize:"20px",color:"text_caption",mb:"-8px",children:"Pools"}),!M&&e.jsx(hs,{dataList:x.label=="Live"?u:y,showSkeletonLoading:b,currTabLabel:x==null?void 0:x.label}),M&&e.jsx(ys,{dataList:x.label=="Live"?u:y,showSkeletonLoading:b,currTabLabel:x==null?void 0:x.label})]})}export{le as default};
