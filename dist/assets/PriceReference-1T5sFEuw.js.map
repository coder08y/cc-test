{"version":3,"file":"PriceReference-1T5sFEuw.js","sources":["../../src/components/swap/PriceChart.tsx","../../src/components/swap/PriceReference.tsx"],"sourcesContent":["import { d, formatPrice } from '@cetus/utils'\nimport dayjs from 'dayjs'\nimport { Line, LineChart, ResponsiveContainer, Tooltip, YAxis } from 'recharts'\nimport { CategoricalChartProps } from 'recharts/types/chart/generateCategoricalChart'\n\n// 自定义 Tooltip 内容\nconst CustomTooltip = ({ active, payload, label }: any) => {\n  // console.log(payload, 'payload')\n  if (active && payload && payload.length) {\n    return (\n      <div\n        style={{\n          backgroundColor: '#121212',\n          border: '1px solid border_secondary',\n          padding: '12px',\n          borderRadius: '8px',\n          position: 'relative',\n          left: '0px', // 控制位置\n          top: '-30px', // 控制位置\n          fontSize: '12px'\n        }}\n      >\n        <p style={{ color: '#909CA4' }}>{dayjs.unix(payload[0]?.payload?.timestamp).format('MM/DD HH:mm')}</p>\n        <p style={{ color: '#fff', marginTop: '8px' }}>${formatPrice(payload[0].value)}</p>\n      </div>\n    )\n  }\n  return null\n}\n\nexport default function PriceChart({ data = [] }: { data: CategoricalChartProps['data'] }) {\n  const min = d(Math.min(...data.map((item: any) => item.price)))\n    .mul(0.99999)\n    .toNumber()\n\n  const max = d(Math.max(...data.map((item: any) => item.price)))\n    .mul(1.00001)\n    .toNumber()\n  return (\n    <ResponsiveContainer width=\"100%\" height=\"100%\">\n      <LineChart\n        width={180}\n        height={48}\n        data={data}\n        margin={{\n          top: 5,\n          right: 20,\n          left: 20,\n          bottom: 5\n        }}\n      >\n        <defs>\n          <linearGradient id=\"priceLine\" x1=\"0\" y1=\"0\" x2=\"1\" y2=\"0\">\n            <stop offset=\"0%\" stopColor=\"rgba(117, 200, 255, 1)\" />\n            <stop offset=\"100%\" stopColor=\"rgba(104, 255, 216, 1)\" />\n          </linearGradient>\n        </defs>\n        <YAxis hide domain={[min, max]} />\n        <Tooltip cursor={false} content={<CustomTooltip />} />\n        <Line type=\"linear\" dot={false} dataKey=\"price\" stroke=\"url(#priceLine)\" strokeWidth={2} />\n      </LineChart>\n    </ResponsiveContainer>\n  )\n}\n","import { AddressCopyLink, MarketSource, MarketType, Ratio, TooltipIcon } from '@cetus/design'\nimport useExplorer from '@cetus/hooks/src/useExplorer'\nimport useTokenPrice from '@cetus/hooks/src/useTokenPrice'\nimport { Token } from '@cetus/types'\nimport { SingleCoinImage } from '@cetus/ui-kit'\nimport { formatUSDPrice } from '@cetus/utils'\nimport { Box, HStack, StackProps, Text, TextProps, VStack } from '@chakra-ui/react'\nimport { useEffect, useMemo, useState } from 'react'\nimport PriceChart from './PriceChart'\n\ninterface PriceReferenceProps {\n  fromCoin?: Token\n  toCoin?: Token\n  wrapStyle?: StackProps\n  titleStyle?: TextProps\n  itemStyle?: StackProps\n  chartStyle?: StackProps\n  type?: 'swap' | 'deepbook'\n}\n\nfunction PriceReference({ fromCoin, toCoin, wrapStyle = { gap: '28px' }, titleStyle, itemStyle, type = 'swap', chartStyle }: PriceReferenceProps) {\n  const tokenList = useMemo(() => {\n    return [fromCoin, toCoin].filter(Boolean).filter(item => !!(item?.is_verified === undefined ? item?.is_trusted : item?.is_verified))\n  }, [fromCoin, toCoin])\n  return tokenList.length ? (\n    <VStack w=\"100%\" align=\"flex-start\" gap=\"8px\">\n      <HStack justify=\"flex-start\" h=\"52px\" align=\"center\" gap=\"4px\" {...titleStyle}>\n        <Text fontSize=\"14px\" fontWeight=\"500\" color=\"text_caption\" h=\"20px\" lineHeight=\"20px\">\n          Price Reference\n        </Text>\n        <TooltipIcon tooltipCon=\"The following price is only an external reference from 3rd party data providers, which does not reflect actual data on Cetus.\" />\n      </HStack>\n      <VStack w=\"100%\" {...wrapStyle}>\n        {/* {(fromCoin?.is_verified === undefined ? fromCoin?.is_trusted : fromCoin?.is_verified) && ( */}\n        <Item coin={fromCoin} itemStyle={itemStyle} type={type} chartStyle={chartStyle} />\n        {/* )} */}\n        {/* {(toCoin?.is_verified === undefined ? toCoin?.is_trusted : toCoin?.is_verified) && ( */}\n        <Item coin={toCoin} itemStyle={itemStyle} type={type} chartStyle={chartStyle} />\n        {/* )} */}\n      </VStack>\n    </VStack>\n  ) : null\n}\n\nconst Item = ({\n  coin,\n  itemStyle,\n  type,\n  chartStyle\n}: {\n  coin?: Token\n  itemStyle?: StackProps\n  type?: 'swap' | 'deepbook'\n  chartStyle?: StackProps\n}) => {\n  const { getExplorerUrl } = useExplorer()\n  const { getPriceKline, getTokenPrice } = useTokenPrice()\n  const [priceData, setPriceData] = useState<{ price: any[]; daily_rate: string }>({ price: [], daily_rate: '' })\n\n  useEffect(() => {\n    setPriceData({ price: [], daily_rate: '' })\n  }, [coin?.coin_type])\n\n  const coinMarketInfo = getTokenPrice(coin?.coin_type as string)\n\n  const fetchPriceData = async (coin_type: string, market: string) => {\n    try {\n      const data = await getPriceKline(coin_type, market)\n      setPriceData(data)\n    } catch (error) {\n      console.log(error, 'error')\n    }\n  }\n\n  useEffect(() => {\n    // market = cetus时不再请求chart接口\n    if (coinMarketInfo?.base_symbol && coinMarketInfo?.market !== 'cetus') {\n      // if (coinMarketInfo?.base_symbol) {\n      fetchPriceData(coinMarketInfo?.base_symbol, coinMarketInfo?.market)\n    }\n  }, [coinMarketInfo?.base_symbol, coinMarketInfo?.market, coin?.coin_type])\n\n  // 在 swap 页面，如果没有价格数据则不显示\n  if (type === 'swap' && (!priceData || priceData.price.length === 0)) {\n    return <></>\n  }\n\n  return (\n    <VStack w=\"100%\" gap=\"12px\" {...itemStyle}>\n      <HStack w=\"100%\" justify=\"space-between\" align=\"flex-start\" h=\"32px\">\n        <HStack>\n          <SingleCoinImage imageUrl={coin?.logo_url} coinType={coin?.coin_type} useImportTokenList={false} w=\"28px\" h=\"28px\" />\n          <VStack align=\"flex-start\" gap=\"4px\">\n            <Text fontSize=\"14px\" h=\"16px\" lineHeight=\"16px\" fontWeight=\"600\" color=\"text_caption\">\n              {coin?.symbol}\n            </Text>\n            <Text fontSize=\"12px\" h=\"12px\" lineHeight=\"12px\" fontWeight=\"500\">\n              {coin?.name}\n            </Text>\n          </VStack>\n        </HStack>\n        <HStack>\n          {coinMarketInfo?.market && <MarketSource market={coinMarketInfo?.market as MarketType} />}\n          <Text color=\"text_caption\" fontSize=\"14px\" fontWeight=\"500\">\n            ${coinMarketInfo?.price !== undefined ? formatUSDPrice(coinMarketInfo?.price) : '--'}\n          </Text>\n          {priceData?.daily_rate && coinMarketInfo?.price !== undefined && <Ratio value={priceData?.daily_rate} />}\n        </HStack>\n      </HStack>\n      <HStack w=\"100%\" justify=\"space-between\" align=\"flex-end\" gap=\"0\">\n        <AddressCopyLink\n          address={coin?.coin_type as string}\n          onClickLink={() => window.open(getExplorerUrl(coin?.coin_type, 'coin'))}\n          wrapStyle={{ border: '1px solid', borderColor: 'border', h: '24px', borderRadius: '8px', p: '0 8px', bg: 'bg_secondary', gap: '8px' }}\n          fontWeight=\"500\"\n          iconGap=\"8px\"\n        />\n        <Box flex={chartStyle?.flex || '0 0 210px'} h=\"24px\" mr=\"-13px\">\n          {coinMarketInfo?.price !== undefined && priceData?.price.length > 0 ? (\n            <PriceChart data={priceData?.price} />\n          ) : (\n            <Text fontSize=\"12px\" p=\"0 16px\" textAlign=\"right\">\n              No available data\n            </Text>\n          )}\n        </Box>\n      </HStack>\n    </VStack>\n  )\n}\n\nexport default PriceReference\n"],"names":["CustomTooltip","active","payload","label","jsxs","jsx","dayjs","_b","_a","formatPrice","PriceChart","data","min","d","item","max","ResponsiveContainer","LineChart","YAxis","Tooltip","Line","PriceReference","fromCoin","toCoin","wrapStyle","titleStyle","itemStyle","type","chartStyle","useMemo","VStack","HStack","Text","TooltipIcon","Item","coin","getExplorerUrl","useExplorer","getPriceKline","getTokenPrice","useTokenPrice","priceData","setPriceData","useState","useEffect","coinMarketInfo","fetchPriceData","coin_type","market","error","Fragment","SingleCoinImage","MarketSource","formatUSDPrice","Ratio","AddressCopyLink","Box"],"mappings":"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"}