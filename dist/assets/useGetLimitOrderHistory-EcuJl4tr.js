import{j as e,H as p,T as o,V as O,ad as fe,r as w,B as re,M as le,o as ce,p as oe,$ as xe,q as de,t as pe,a0 as ue,w as z,m as G,ac as Le,C as se}from"./vendor-CBmAETR3.js";import{bo as Se,E as f,cW as me,bL as I,u as q,a8 as ie,av as X,B as F,I as H,c as E,s as K,i as Oe,M as ge,f as ee,e as he,cX as P,T as D,cY as je,z as k,d as N,w as ve,cU as Te,A as ke,S as He,C as ne,n as De,cZ as Be}from"./index-BpSfzecM.js";import"./cross-DJ28FxNa.js";import{I as ae}from"./IconText-CCehETWQ.js";import{D as _e}from"./Drawer-DX1wga2y.js";import{u as Q}from"./useTransaction-uEos3ZjK.js";import{u as be}from"./useAccountBalance-DV0qM_Vy.js";import{N as Ee}from"./NoData-BFX9XpKb.js";import{u as Ae}from"./useTokenRank-CM-9-tXe.js";const ze=({info:t,imgSize:i="32px",isProfile:s=!1})=>{const{pay_coin:l,target_coin:x,total_pay_amount:u,expect_obtain_amount:c}=t;return e.jsxs(p,{children:[e.jsx(Se,{w:i,h:i,coinAIconUrl:l==null?void 0:l.logo_url,coinBIconUrl:x==null?void 0:x.logo_url}),e.jsxs(p,{flexWrap:"wrap",children:[e.jsxs(p,{children:[!s&&e.jsx(o,{color:"text_caption",children:f(u)}),e.jsxs(o,{color:"text_caption",children:[l==null?void 0:l.symbol," â†’ "]})]}),e.jsxs(p,{children:[!s&&e.jsx(o,{color:"text_caption",children:f(c)}),e.jsx(o,{color:"text_caption",children:x==null?void 0:x.symbol})]})]})]})},Fe=({info:t,isProfile:i=!1})=>e.jsx(p,{justifyContent:"end",gap:"2px",children:i?e.jsx(o,{color:"text_caption",children:me(t==null?void 0:t.expire_ts)}):e.jsxs(o,{color:"text_caption",children:[I(t==null?void 0:t.expire_ts,"")," (UTC)"]})}),Me=({info:t,isProfile:i=!1})=>{const{pay_coin:s,total_pay_amount:l,deal_amount:x,deal_rate:u}=t,{isApp:c}=q();return e.jsxs(O,{align:"flex-end",gap:i?"4px":"8px",children:[e.jsxs(p,{justifyContent:"end",gap:"2px",children:[e.jsx(o,{color:"text_caption",children:f(x)}),e.jsxs(p,{justifyContent:"end",gap:"2px",children:[e.jsxs(o,{color:"text_caption",children:["/",f(l)," ",s==null?void 0:s.symbol]}),(!i||c)&&e.jsxs(o,{color:"primary_gray",children:["(",ie(Number(u)*100),")"]})]})]}),i&&!c&&e.jsxs(p,{w:"100%",justify:"flex-end",gap:"2px",children:[e.jsx(o,{color:"primary_gray",fontSize:"12px",children:ie(Number(u)*100)}),e.jsx(fe,{h:"4px",w:"40px",value:Number(u)*100,bg:"primary_opacity.10",sx:{'div[role="progressbar"]':{bg:"primary"}}})]})]})},st=({historyInfo:t,type:i,...s})=>{const{getExplorerUrl:l}=X(),x=w.useMemo(()=>(t==null?void 0:t.events)||[],[t]),{isApp:u}=q();return e.jsx(F,{p:"16px",borderTop:"none",borderRadius:" 0 0 16px 16px",...s,children:e.jsx(O,{align:"flex-start",children:x.map(c=>{const{tokenInfo:j,text:g,icon:h,color:a,num:m}=we(c,t);return e.jsxs(O,{align:"flex-start",w:"100%",bg:"card_bg",borderRadius:"8px",p:"12px",flexDirection:{base:"column",lg:"row"},children:[e.jsxs(p,{align:{base:"flex-start",lg:"center"},w:"100%",gap:"16px",justifyContent:"space-between",children:[e.jsxs(p,{gap:i=="card"?"4px":"8px",flexDirection:i=="card"?"column":"row",align:i=="card"?"flex-start":"center",children:[e.jsxs(p,{w:"68px",justify:"flex-start",gap:"4px",children:[e.jsx(H,{svgW:"14px",xlinkHref:h,svgFill:a,svgHover:a}),e.jsx(o,{color:a,children:g})]}),!u&&e.jsxs(o,{whiteSpace:"nowrap",color:"text_caption",h:"20px",lineHeight:"20px",children:[m,"Â ",j==null?void 0:j.symbol]})]}),e.jsxs(p,{gap:i=="card"?"4px":"20px",flexDirection:i=="card"&&!u?"column":"row",align:i=="card"?"flex-end":"center",children:[e.jsxs(o,{h:"20px",lineHeight:"20px",children:[I(Number(c.block_time),"")," (UTC)"]}),e.jsxs(p,{gap:"4px",cursor:"pointer",onClick:n=>{E(n),window.open(l(c.tx,"tx"))},_hover:{svg:{fill:"text_caption"}},children:[!u&&e.jsx(o,{color:"text_caption",children:"View Transaction"}),e.jsx(H,{fontSize:"16px",xlinkHref:"#icon-icon_link1"})]})]})]}),u&&e.jsxs(o,{whiteSpace:"nowrap",color:"text_caption",h:"20px",lineHeight:"20px",children:[m,"Â ",j==null?void 0:j.symbol]})]},c==null?void 0:c.tx)})})})},we=(t,i)=>{const{pay_coin:s,target_coin:l}=i,x=t==null?void 0:t.event_type;return x.includes("OrderCanceledEvent")?{text:"Cancel",color:"primary_yellow",icon:"#icon-tx_remove",tokenInfo:s,num:`+${f(K(t==null?void 0:t.amount,s==null?void 0:s.decimals))}`}:x.includes("FlashLoanEvent")?{text:"Trade",color:"primary",icon:"#icon-a-icon_swap2",tokenInfo:l,num:`+${f(K(t==null?void 0:t.amount,l==null?void 0:l.decimals))}`}:x.includes("OrderPlacedEvent")?{text:"Create",color:"primary_green",icon:"#icon-a-icon_add1",num:`-${f(K(t==null?void 0:t.amount,s==null?void 0:s.decimals))}`,tokenInfo:s}:{text:"",icon:"",color:"",num:"",tokenInfo:null}},We=({info:t,isProfile:i=!1})=>{const[s,l]=w.useState(!0),{getTokenRank:x}=Ae();w.useEffect(()=>{const a=x(t==null?void 0:t.pay_coin,t==null?void 0:t.target_coin);console.log("ðŸš€ ~ useEffect PriceBlock ~ direct:",a),l(a)},[t==null?void 0:t.pay_coin,t==null?void 0:t.target_coin]);const{pay_coin:u,target_coin:c,price:j,reseverPrice:g}=t,h=i?"12px":"14px";return e.jsxs(O,{flexDirection:i?"column":"row",justify:"flex-end",align:i?"flex-end":"center",gap:i?"0px":"8px",children:[i&&(s?e.jsx(o,{color:"text_caption",lineHeight:"16px",h:"16px",children:f(j)}):e.jsx(o,{color:"text_caption",lineHeight:"16px",h:"16px",children:f(g)})),e.jsxs(p,{justifyContent:"end",children:[s?e.jsxs(p,{flexWrap:"wrap",justify:"flex-end",children:[!i&&e.jsx(o,{color:"text_caption",lineHeight:"1",children:f(j)}),e.jsxs(o,{fontSize:h,color:i?"text_paragraph":"text_caption",whiteSpace:"nowrap",lineHeight:"1",children:[c==null?void 0:c.symbol," per ",u==null?void 0:u.symbol]})]}):e.jsxs(p,{flexWrap:"wrap",justify:"flex-end",children:[!i&&e.jsx(o,{color:"text_caption",children:f(g)}),e.jsxs(o,{fontSize:h,color:i?"text_paragraph":"text_caption",whiteSpace:"nowrap",lineHeight:"1",children:[u==null?void 0:u.symbol," per ",c==null?void 0:c.symbol]})]}),e.jsx(H,{xlinkHref:"#icon-icon_swap1",svgW:"14px",svgH:"14px",ml:"-6px",onClick:a=>{E(a),l(!s)}})]})]})},it=({historyInfo:t,openExpendItemObj:i,isProfile:s=!1})=>e.jsxs(p,{justifyContent:"end",gap:"4px",children:[!s&&((t==null?void 0:t.status)=="Cancelled"?e.jsx(H,{svgW:"20px",xlinkHref:"#icon-icon_cancelled",svgFill:"primary_yellow",svgHover:"primary_yellow"}):e.jsx(H,{svgW:"18px",xlinkHref:"#icon-icon_check",svgFill:"primary_green",svgHover:"primary_green"})),e.jsx(o,{color:(t==null?void 0:t.status)=="Cancelled"?"primary_yellow":"primary_green",children:t==null?void 0:t.status}),!s&&e.jsx(H,{svgW:"12px",xlinkHref:"#icon-icon_arrow",variant:"gray",transition:"transform 0.5s",transform:i[t==null?void 0:t.order_id]?"rotate(180deg)":"rotate(0deg)"})]}),Re=(t,i)=>({orderListLoading:!1,myOrderList:[],setOrderListLoading:s=>{t(()=>({orderListLoading:s}))},historyOrderList:[],setHistoryOrderList:s=>{t(()=>({historyOrderList:s}))},setMyOrderList:s=>{t(()=>({myOrderList:s}))}}),Ue=Oe(Re);function Ne({isOpen:t,onClose:i,historyInfo:s}){const{isApp:l}=q(),x=w.useMemo(()=>(s==null?void 0:s.events)||[],[s]),{getExplorerUrl:u}=X(),c=e.jsx(ue,{h:"44px",lineHeight:"24px",fontWeight:"500",fontSize:"16px",borderBottom:"1px solid",borderColor:"border",pb:"0px",children:"Trade Details"}),j=e.jsx(p,{h:"100%",gap:"12px",mt:"8px",children:e.jsx(O,{align:"flex-start",w:"100%",gap:"32px",ml:"4px",p:"0 0 16px 16px",borderLeft:"1px dashed",borderColor:"border",children:x.map(g=>{const{tokenInfo:h,text:a,icon:m,color:n,num:r}=we(g,s);return e.jsxs(O,{align:"flex-start",w:"100%",mt:"-8px",children:[e.jsxs(p,{w:"100%",gap:"16px",justifyContent:"space-between",position:"relative",children:[e.jsxs(o,{h:"20px",lineHeight:"20px",children:[me(g.block_time)," (UTC)"]}),e.jsx(o,{color:n,children:a}),e.jsx(p,{justify:"center",h:"12px",w:"12px",bg:"primary_opacity.20",position:"absolute",left:"-23px",top:"4px",borderRadius:"50%",children:e.jsx(re,{h:"6px",w:"6px",bg:"primary",borderRadius:"50%"})})]}),e.jsx(F,{p:"16px",borderRadius:"12px",children:e.jsxs(p,{w:"100%",gap:"4px",justify:"space-between",children:[e.jsxs(o,{whiteSpace:"nowrap",color:"text_caption",h:"20px",lineHeight:"20px",children:[r,"Â ",h==null?void 0:h.symbol]}),e.jsx(H,{fontSize:"16px",xlinkHref:"#icon-icon_link1",onClick:d=>{E(d),window.open(u(g.tx,"tx"))}})]})})]},g==null?void 0:g.tx)})})});return l?e.jsx(Ve,{isOpen:t,onClose:i,renderTabs:c,renderContent:j}):e.jsxs(le,{autoFocus:!1,returnFocusOnClose:!1,isOpen:t,onClose:i,isCentered:!0,children:[e.jsx(ce,{}),e.jsxs(oe,{minWidth:"482px",children:[e.jsx(xe,{children:c}),e.jsx(de,{}),e.jsx(pe,{p:"0 16px 0px",textAlign:"center",children:j})]})]})}function Ve({isOpen:t,onClose:i,renderTabs:s,renderContent:l}){return console.log("DetailDrawer rendered",t),e.jsxs(_e,{isOpen:t,onClose:i,placement:"bottom",haveCloseButton:!0,children:[s,e.jsx(re,{h:"20px"}),l]})}function ye(){const{currentAccount:t,addressChangeVersion:i}=ge(),s=ee("limit"),{setOrderListLoading:l,setMyOrderList:x,myOrderList:u,orderListLoading:c}=Ue(),{getTokenListInfo:j}=he(),g=async(a=t==null?void 0:t.address,m)=>{console.log("ðŸš€ ~ fetchMyLimitOrder ~ account:",a);try{if(!a){l(!1),x([]);return}m&&l(!0);const n=await s.LimitOrder.getOwnerLimitOrderList(a,"all"),r=await h(n.data.filter(d=>d.status===P.PartialCompleted||d.status===P.Running));x(r),console.log("ðŸš€ ~ fetchMyLimitOrder ~ list:",r)}catch(n){console.log("ðŸš€ ~ fetchMyLimitOrder ~ error:",n)}finally{l(!1)}},h=async a=>{const m=[],n=[];for(const d of a)n.push(d.pay_coin_type),n.push(d.target_coin_type);const r=await j(n);for(const d of a){const[b,L]=[r==null?void 0:r.get(d.pay_coin_type),r==null?void 0:r.get(d.target_coin_type)];if(b&&L){const{total_pay_amount:S,pay_balance:C,rate:v,obtained_amount:_,claimed_amount:y,target_balance:T,created_ts:M,expire_ts:Y,status:Z,id:W}=d,B=D(S,b.decimals).toString(),A=D(C,b.decimals).toString(),V=D(_,L.decimals).toString(),R=D(y,L.decimals).toString(),$=D(T,L.decimals).toString(),U=je.rateToPrice(v.toString(),b.decimals,L.decimals),J=k(1).div(U).toString(),te=D(k(S).sub(C).toFixed(0),b.decimals).toString(),Ce={order_id:W,pay_coin:b,target_coin:L,price:U,reseverPrice:J,total_pay_amount:B,expect_obtain_amount:k(B).mul(U).toString(),remaining_amount:A,deal_amount:te,deal_rate:k(te).div(B).toString(),obtained_amount:V,claimed_amount:R,un_claimed_amount:k($).sub(R).toString(),created_ts:M,expire_ts:Y,status:Z};m.push(Ce)}}return m.sort((d,b)=>b.created_ts-d.created_ts)};return{fetchMyLimitOrder:g,formatLimitOrderList:h,orderListLoading:c,myOrderList:u}}function $e(){const{fetchAccountBalance:t}=be(),{fetchMyLimitOrder:i}=ye(),{signAndExecuteTransaction:s}=Q(),l=ee("limit"),[x,u]=w.useState(!1),{transactionConfirmation:c}=Q();return{handleCancelOrder:async g=>{u(!0);const h={getShowInfo:r=>{const d="Canceling order",b={modalDescriptionText:d,toastTitleText:d};return r==="success"&&(b.toastDescriptionContent="Order cancelled successfully",b.modalDescriptionText="Order cancelled successfully",b.toastTitleText="Order cancelled"),b}};c(h);const a=g.map(r=>({pay_coin_type:r.pay_coin.coin_type,target_coin_type:r.target_coin.coin_type,order_id:r.order_id})),m=await l.LimitOrder.cancelOrdersByOwner(a),n=await s(m,h);u(!1),n&&setTimeout(()=>{t(),i()},2e3)},cancelOrderLoading:x}}function Ge(){const{fetchAccountBalance:t}=be(),{fetchMyLimitOrder:i}=ye(),{signAndExecuteTransaction:s}=Q(),l=ee("limit"),[x,u]=w.useState(!1),[c,j]=w.useState(!1);return{handleClaimOrder:async(a,m)=>{console.log("ðŸš€ ~ handleClaimOrder ~ info:",a),u(!0);const n={pay_coin_type:a.pay_coin.coin_type,target_coin_type:a.target_coin.coin_type,order_id:a.order_id},r=await l.LimitOrder.claimTargetCoin(n),d=await s(r,{getShowInfo:(b,L)=>{var v;const S=`Claim ${f(m)} ${(v=a==null?void 0:a.target_coin)==null?void 0:v.symbol}`,C={modalDescriptionText:S,toastTitleText:S};return b==="success"&&(C.toastDescriptionContent="",C.modalDescriptionText="",C.toastTitleText="Claim successfully"),C}});u(!1),d&&setTimeout(()=>{t(),i()},2e3)},getLimitOrderClaimHistory:async a=>{console.log("ðŸš€ ~ getLimitOrderClaimHistory ~ order:",a),j(!0);const m=await l.LimitOrder.getLimitOrderClaimLogs(a.order_id);return console.log("ðŸš€ ~ getLimitOrderClaimHistory ~ result:",a,m),m?(j(!1),m.map(n=>{var d;const r=N(n.parsed_json.claimed_amount).div(Math.pow(10,(d=a.target_coin)==null?void 0:d.decimals));return{...n,...n.parsed_json,claimed_amount:r}})):[]},isClaimHistoryLoading:c,claimLoading:x}}const Pe=({orderInfo:t,isOpen:i,onClose:s,handleClaim:l,claimLoading:x,getLimitOrderClaimHistory:u,isClaimHistoryLoading:c})=>{const{getExplorerUrl:j}=X(),[g,h]=w.useState(""),[a,m]=w.useState([]),[n,r]=w.useState({label:"Claim",value:"claim"}),d=[{label:"Claim",value:"claim"},{label:"History",value:"history"}],b=_=>{r(_),(_==null?void 0:_.value)=="history"&&L()},L=async()=>{const _=await u();_&&m(_)},S=w.useMemo(()=>!g||x?{disabled:!0,text:"Claim"}:N(g).gt(t.un_claimed_amount)||N(t.un_claimed_amount).eq(0)?{disabled:!0,text:"Maximum amount that can be withdrawn"}:{disabled:!1,text:"Claim"},[g,t.un_claimed_amount]),[C,v]=w.useState(!0);return w.useEffect(()=>{C&&(v(!1),h(t.un_claimed_amount))},[C,t.un_claimed_amount]),console.log("claimModal###history###",history),e.jsxs(le,{autoFocus:!1,returnFocusOnClose:!1,isOpen:i,onClose:s,isCentered:!0,children:[e.jsx(ce,{}),e.jsxs(oe,{children:[e.jsx(xe,{children:e.jsx(ue,{fontWeight:"500",fontSize:"16px",children:"Claim"})}),e.jsx(de,{}),e.jsx(pe,{textAlign:"center",p:"0px",children:e.jsxs(O,{w:"100%",gap:"20px",p:"16px",pt:"0",align:"flex-start",children:[e.jsx(F,{borderRadius:"8px",p:"8px",children:e.jsx(o,{lineHeight:"20px",textAlign:"left",fontSize:"12px",children:"For a partially filled order, you can manually claim the filled amount if you want. Or you can wait for the auto distribution until your order is fully filled, expired or cancelled."})}),e.jsx(ze,{info:t,imgSize:"28px"}),e.jsxs(p,{w:"100%",justify:"space-between",children:[e.jsx(o,{children:"Price"}),e.jsx(We,{info:t})]}),e.jsxs(p,{w:"100%",justify:"space-between",children:[e.jsx(o,{children:"Filled Size"}),e.jsx(Me,{info:t})]}),e.jsxs(p,{w:"100%",justify:"space-between",children:[e.jsx(o,{children:"Expiry"}),e.jsx(Fe,{info:t})]}),e.jsx(ve,{type:"outlineTab",wrapStyle:{w:"100%",h:"36px",borderRadius:"8px",p:"4px",mt:"-1px",zIndex:"1"},itemStyle:{w:"50%",fontSize:"12px"},tabList:d,currentTab:n.label,handleChangeTab:b}),(n==null?void 0:n.value)=="claim"&&e.jsxs(e.Fragment,{children:[e.jsx(F,{w:"100%",p:"16px",mt:"-4px",children:e.jsxs(O,{gap:"16px",align:"flex-start",children:[e.jsx(o,{lineHeight:"18px",children:"Available to claim"}),e.jsxs(p,{w:"100%",justify:"space-between",children:[e.jsx(Te,{value:g?f(g).toString():"",onChange:_=>{h(_)},decimals:18,style:{width:"calc(100% - 8px)",background:"none",whiteSpace:"nowrap",opacity:1,outline:"none",color:"var(--chakra-colors-text_caption)",fontSize:"28px",touchAction:"manipulation",transition:"all 0.3s"}}),e.jsx(p,{children:e.jsx(ke,{token:t==null?void 0:t.target_coin,haveName:!1,imgBoxStyle:{w:"28px",h:"28px"}})})]})]})}),e.jsx(z,{onClick:()=>{l(g),s()},isDisabled:S.disabled,w:"calc(100% + 32px)",mb:"-30px",ml:"-16px",h:"52px",fontWeight:"500",children:S.text})]}),(n==null?void 0:n.value)=="history"&&e.jsx(O,{w:"100%",gap:"12px",children:c?e.jsxs(F,{w:"100%",p:"16px",mt:"-4px",borderRadius:"12px",children:[e.jsxs(p,{justify:"space-between",children:[e.jsx(G,{height:"4",width:"150px"}),e.jsx(G,{height:"4",width:"150px"})]}),e.jsxs(p,{justify:"space-between",mt:"16px",children:[e.jsx(G,{height:"4",width:"150px"}),e.jsx(G,{height:"4",width:"150px"})]})]}):(a==null?void 0:a.length)==0?e.jsx(Ee,{type:"nodata",text:"No History.",p:"20px"}):a==null?void 0:a.map(_=>{var y,T;return e.jsx(F,{w:"100%",p:"16px",mt:"-4px",borderRadius:"12px",children:e.jsxs(O,{gap:"16px",align:"flex-start",children:[e.jsxs(p,{w:"100%",justify:"space-between",children:[e.jsx(o,{children:"Amount"}),e.jsxs(p,{gap:"4px",children:[e.jsx(He,{imageUrl:(y=t==null?void 0:t.target_coin)==null?void 0:y.logo_url,w:"20px",h:"20px"}),e.jsxs(o,{color:"text_caption",lineHeight:"18px",children:[f(_==null?void 0:_.claimed_amount)," ",(T=t==null?void 0:t.target_coin)==null?void 0:T.symbol]})]})]}),e.jsxs(p,{w:"100%",justify:"space-between",children:[e.jsx(o,{children:"Time"}),e.jsxs(p,{gap:"4px",cursor:"pointer",mr:"-4px",onClick:M=>{E(M),window.open(j(_.digest,"tx"))},children:[e.jsxs(o,{color:"text_caption",children:[I(Number(_==null?void 0:_.timestampMs),"")," (UTC)"]}),e.jsx(H,{fontSize:"16px",xlinkHref:"#icon-icon_link1"})]})]})]})},_.digest)})})]})})]})]})},nt=({orderInfo:t,isProfile:i=!1,isOpenOrder:s=!0})=>{const{handleCancelOrder:l,cancelOrderLoading:x}=$e(),{handleClaimOrder:u,claimLoading:c,getLimitOrderClaimHistory:j,isClaimHistoryLoading:g}=Ge(),[h,a]=w.useState(!1),[m,n]=w.useState(!1),{isApp:r}=q(),{getExplorerUrl:d}=X(),{isOpen:b,onOpen:L,onClose:S}=Le(),C=N(t==null?void 0:t.obtained_amount).gt(0)||N(t.un_claimed_amount).gt(0),v=(y,T)=>{E(y),T==="claim"&&a(!0),T==="cancel"&&!x&&l([t])},_=()=>C?e.jsx(z,{isLoading:c,isDisabled:c,w:{base:"50%",lg:"unset"},h:"32px",p:"0 8px",borderRadius:"8px",fontSize:"12px",fontWeight:"500",onClick:T=>v(T,"claim"),children:"Claim"}):e.jsx(ne,{placement:"top",tooltip:e.jsx(o,{fontSize:"12px",lineHeight:"20px",maxW:"280px",children:"For a partially filled order, you can manually claim the filled amount if you want. Or wait for the auto distribution."}),children:e.jsx(se,{w:{base:"calc(50vw - 32px)",lg:"unset"},children:e.jsx(z,{w:"100%",isDisabled:!0,h:"32px",p:"0 8px",borderRadius:"8px",fontSize:"12px",children:"Claim"})})});return e.jsxs(p,{w:{base:"calc(100vw - 32px)",lg:"unset"},pl:{base:i&&r?"0px":"8px",lg:"0px"},pr:{base:"8px",lg:"0px"},justify:{base:"space-between",lg:"flex-end"},gap:"8px",children:[s&&e.jsx(p,{justify:i&&r?"space-between":"flex-end",children:_()}),s&&e.jsx(z,{isLoading:x,isDisabled:x,w:{base:"50%",lg:"unset"},h:"32px",p:"0 8px",variant:"outline",borderRadius:"8px",fontSize:"12px",fontWeight:"500",onClick:y=>v(y,"cancel"),children:"Cancel"}),i&&e.jsxs(p,{children:[!s&&e.jsx(z,{w:{base:"calc(100vw - 84px)",lg:"unset"},h:"32px",variant:"outline",fontSize:"12px",p:"0 8px",borderRadius:"8px",fontWeight:"500",onClick:y=>{E(y),n(!0)},children:"Details"}),e.jsx(ne,{placement:"bottom-end",showTooltip:!r,tooltip:e.jsx(o,{fontSize:"12px",children:"View on Explorer"}),children:e.jsx(se,{children:e.jsx(z,{onClick:y=>{E(y),window.open(d(t.order_id,"poolAddress"))},w:"32px",h:"32px",p:"0",fontSize:"12px",borderRadius:"8px",variant:"outline",_hover:{svg:{fill:"primary"}},children:e.jsx(H,{fontSize:"16px",xlinkHref:"#icon-icon_link1"})})})})]}),h&&e.jsx(Pe,{orderInfo:t,claimLoading:c,isOpen:h,onClose:()=>a(!1),handleClaim:y=>u(t,y),getLimitOrderClaimHistory:()=>j(t),isClaimHistoryLoading:g}),m&&e.jsx(Ne,{isOpen:m,onClose:()=>n(!1),historyInfo:t}),e.jsx(_e,{isOpen:b,onClose:S,placement:"bottom",children:e.jsx(O,{align:"flex-start",sx:{">div":{w:"100%",">div":{justifyContent:"center",background:"none",p:{color:"text_caption",fontSize:"16px"}}}},children:e.jsx(qe,{getExplorerUrl:d,orderInfo:t,cancelOrderLoading:x,onCancel:()=>l([t])})})})]})};function qe({getExplorerUrl:t,orderInfo:i,cancelOrderLoading:s,onCancel:l}){return e.jsxs(O,{align:"flex-start",children:[e.jsx(ae,{text:"View on Explorer",onClick:()=>window.open(t(i.order_id,"poolAddress"))}),e.jsx(ae,{text:"Cancel",onClick:s?()=>{}:l})]})}function at(){const{fetchByApi:t}=De(),{getTokenListInfo:i}=he(),{currentAccount:s}=ge(),[l,x]=w.useState(!0),[u,c]=w.useState([]);w.useEffect(()=>{c([])},[s==null?void 0:s.address]);const j=async(h,a)=>{var m;try{a&&x(!0);const n=await t(Be,"GET",{wallet_address:h});if(console.log(n,"getLimitOrderHistory"),n!=null&&n.list&&((m=n==null?void 0:n.list)==null?void 0:m.length)>0){const r=await g((n==null?void 0:n.list)||[]);return c(r),console.log("ðŸš€ ~ file: useGetLimitOrderHistory.ts:10 ~ getLimitOrderHistory ~ res:",r),r}return[]}catch(n){return console.log("getLimitOrderHistory ~ error:",n),[]}finally{x(!1)}},g=async h=>{const a=[],m=[];for(const r of h)m.push(r.pay_coin),m.push(r.target_coin);const n=await i(m);for(const r of h){const[d,b]=[n==null?void 0:n.get(r.pay_coin),n==null?void 0:n.get(r.target_coin)];if(d&&b){const{total_pay_amount:L,remaining_amount:S,rate:C,obtained_amount:v,claimed_amount:_,target_balance:y,created_ts:T,expire_ts:M,cancel_reason:Y,events:Z}=r,W=Z;console.log("ðŸš€ ~ formatLimitOrderList ~ eventList:",r,W),W.sort((U,J)=>J.block_time-U.block_time);const B=D(L,d.decimals).toString(),A=je.rateToPrice(C.toString(),d.decimals,b.decimals),V=k(1).div(A).toString();console.log("ðŸš€ ~ formatLimitOrderList ~ reseverPrice:",A,V);const R=D(k(L).sub(S).toFixed(0),d.decimals).toString(),$={order_id:r.order_id,pay_coin:d,target_coin:b,price:A,reseverPrice:V,total_pay_amount:B,remaining_amount:S,deal_amount:R,deal_rate:k(R).div(B).toString(),expect_obtain_amount:k(B).mul(A).toString(),obtained_amount:v,claimed_amount:_,un_claimed_amount:"0",created_ts:T,expire_ts:M,status:Number(Y)===0?P.Completed:P.Cancelled,events:W};console.log("ðŸš€ ~ formatLimitOrderList ~ info:",$),a.push($)}}return a.sort((r,d)=>d.created_ts=r.created_ts),a};return{getLimitOrderHistory:j,historyOrderLoading:l,historyOrderList:u}}export{ze as C,Fe as E,Me as F,st as L,nt as O,We as P,it as S,ye as a,at as b,$e as c,Ue as u};
