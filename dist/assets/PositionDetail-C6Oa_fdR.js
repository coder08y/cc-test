import{r as a,l as ue,j as l,H as v,V as Q,B as pe,T as q,m as Di,w as le,F as Le,n as Re,C as Ee,X as Fe,ao as qe}from"./vendor-CBmAETR3.js";import{S as Ve}from"./Slippage-8fJCLOYr.js";import{A as ze}from"./index-DfyAgMoy.js";import{C as Ge}from"./CoinPairInfo-BH5hoU3X.js";import{S as Ki,u as $e,a as We,L as Ze,N as He}from"./StatsInfo-BBP9Tgib.js";import{u as Ne}from"./useGetTvlInfo-QgMBT0Ce.js";import{a as Ri,j as ae,i as Ue,k as Oe}from"./usePositionList-heG2hQcx.js";import{av as Je,a as de,u as je,aO as Qe,l as P,as as Xe,Q as Wi,v as Bi,d as oi,aT as Ye,h as Ke,M as me,t as Mi,s as ge,ad as fe,bn as re,z as $i,p as Be,aj as Ie,m as Pe,g as se,E as it,a5 as he,w as Se,j as te}from"./index-BpSfzecM.js";import{u as Li}from"./detail-Cbbl8wNo.js";import{S as et}from"./StatusPosition-CL7kLY-2.js";import{D as tt}from"./DetailStatsInfo-aLrG-HRU.js";import{u as lt,a as st,b as pt,T as at,Z as dt,c as mt,F as nt,d as ot,R as ct}from"./RemoveBlock-CGdGO_rZ.js";import{u as xt}from"./useTransaction-uEos3ZjK.js";import{u as gt}from"./addLiquidity-DNM9DGI2.js";import{f as fi}from"./index-gw6wWhzj.js";import{u as ve}from"./useAccountBalance-DV0qM_Vy.js";import{u as rt}from"./useTransactionModal-DL7w_I3R.js";import{u as ye}from"./useTokenBalance-c3RAkCCY.js";import{u as ht}from"./useInsufficientBalanceToast-BgAdjI7g.js";import{u as _e}from"./useCurrentPos-C5suLYji.js";import{u as yt}from"./usePosAdd-DG3IUn6t.js";import{v as ke}from"./v4-C6aID195.js";import"./cross-DJ28FxNa.js";import{T as kt}from"./TradeInputGroup-C0B6uidS.js";import{A as bt}from"./AutoClaimCheckBox-lw6rJPdV.js";import{W as be}from"./WithTooltipInfo-Vqx8IrEo.js";import{P as Tt}from"./PositionCurrentPrice-C10xNmHB.js";import{u as Te}from"./index-CqgM3rES.js";import{g as At}from"./utils-CMHkC_9A.js";import{u as wt}from"./useGetPoolList-4kFQ2tyG.js";import{u as ut}from"./useGetClmmPositionDailyEarning-DV5RvJKu.js";import{u as jt}from"./swapWidget-DsvWJZa9.js";import{B as St}from"./BackButton-DoozH78n.js";import{R as Ae}from"./RefreshButton-bgRHxGzR.js";import{u as vt}from"./useRpcListener-BdFabOsZ.js";import"./TooltipIcon-DVhxXZmh.js";import"./config-DTm0VBgZ.js";import"./PoolTag-DVhitHGR.js";import"./useWrapPoolData-CMGMCXwG.js";import"./usePosClaimFeeAndReward-COsUjXqP.js";import"./msafe-BzcjPV-e.js";import"./dlmm-DdxfaipV.js";import"./LiquidityValueBlock-CJnPKpci.js";import"./generateCategoricalChart-CmRMqbFo.js";import"./debounce-MPJy35Ge.js";import"./YAxis-DLEZvSSr.js";import"./AreaChart-DBMzOkAF.js";import"./Area-Bqahw1_r.js";import"./usePreviousValue-Da-o2xpb.js";import"./HTextLabelBox-D0r99Smv.js";import"./VTextLabelBox-CuuDZpMe.js";import"./useFavoritePool-5MLb1oZG.js";import"./icon_active_new@2x-Bekkt6Xc.js";import"./usePosRemove-04piisVo.js";import"./DepositRatio-D2zurS6C.js";import"./FreshProgressV2-DfCij7Ow.js";import"./index-CgYRIMgB.js";import"./index-Dq_SzPY7.js";import"./usePriceImpact-DTCbq_0I.js";import"./useSwapHelper-RreJ3kMc.js";import"./ErrorTips-lJshH5MT.js";import"./MarketSource-Zu8s3YB-.js";import"./ExpendItem-BR-Au2GE.js";import"./PositionPriceRangeBar-Bdy_fJqo.js";import"./RangeValue-CrFwA76f.js";import"./useTokenRank-CM-9-tXe.js";import"./useTrack-Cdn9qear.js";import"./useSigner-Ct94kXtL.js";import"./_baseClone-B759QteI.js";import"./_getAllKeysIn-Juzb7Mj8.js";import"./_defineProperty-Bpc363rP.js";import"./last-CxFZ9vay.js";import"./CheckBox-eomO844M.js";import"./en_US-KAK2ZBDO-C1Pw6Q2s.js";function _t(){var y;const{currentPosBaseInfo:i,posPoolsRelatedData:X,posPoolsOriginalData:e}=Ri(),{currentPosPoolInfo:s,curPosContractPoolInfo:x}=Li(),n=X[i==null?void 0:i.posId],{getClmmPosName:$,getTokenALock:Z,getTokenBLock:T}=ae(),p=a.useMemo(()=>{var g;if(i!=null&&i.tokenName)return i==null?void 0:i.tokenName;{const H=(g=e==null?void 0:e[i==null?void 0:i.clmmPool])==null?void 0:g.index;return $(i==null?void 0:i.index,H)}},[i==null?void 0:i.tokenName,i==null?void 0:i.index,i==null?void 0:i.clmmPool,e]),Y=(n==null?void 0:n.displayFee)+"%",_=a.useMemo(()=>Z(i,x==null?void 0:x.current_sqrt_price),[x==null?void 0:x.current_tick_index,i]),R=a.useMemo(()=>T(i,x==null?void 0:x.current_sqrt_price),[x==null?void 0:x.current_tick_index,i]),z=a.useMemo(()=>!_&&!R&&(n==null?void 0:n.currentStatus)==="Active",[_,R,n==null?void 0:n.currentStatus]),{getExplorerUrl:u}=Je(),j=ue(),{setBackUrl:o}=de(),{isApp:r}=je(),{totalAmountUSD:t,tvlLoading:b}=Ne();return l.jsxs(v,{gap:"12px",mb:"8px",w:"100%",justifyContent:"space-between",align:"flex-end",flexDirection:{base:"column",lg:"row"},children:[i!=null&&i.clmmPool?l.jsxs(Q,{w:{base:"100%",lg:"unset"},align:"flex-start",gap:"12px",children:[l.jsx(pe,{mb:"-12px",w:{base:"100%",lg:"unset"},onClick:g=>{o(`/position-detail/${i==null?void 0:i.id}`),j(`/liquidity?poolAddress=${i==null?void 0:i.clmmPool}`)},children:l.jsx(Ge,{poolInfo:{feeDisplay:Y,poolAddress:i==null?void 0:i.clmmPool,...i},symbolEllipsesDecimals:10,nameEllipsesDecimals:20,symbolFontSize:"20px",placement:"bottom-start",versionBlockPosition:"right",type:"column",showPoolTypeTag:!0,moreDetails:!0})}),l.jsxs(v,{w:{base:"100%",lg:"unset"},children:[l.jsxs(v,{gap:"4px",p:"3px 8px",borderRadius:"8px",bg:"bg_secondary",children:[p&&l.jsxs(v,{children:[l.jsx(q,{color:"primary_gray",fontSize:"12px",children:"ID"}),l.jsxs(q,{color:"primary_gray",fontSize:"12px",children:[p==null?void 0:p.split("|")[1]," |"]})]}),l.jsx(v,{children:(i==null?void 0:i.id)&&l.jsx(Qe,{fontWeight:"500",showCopy:!1,color:"primary_gray",address:i==null?void 0:i.id,showLink:!1,onClickLink:()=>{window.open(u(i==null?void 0:i.id,"nftAddress"),"_blank")}})})]}),(n==null?void 0:n.currentStatus)!==void 0&&l.jsx(et,{isActive:z,isLoading:!P(i)||!P(e==null?void 0:e[(i==null?void 0:i.clmmPool)||""])})]})]}):l.jsxs(Q,{w:{base:"100%",lg:"unset"},gap:"0px",justify:"flex-end",align:"flex-start",children:[l.jsx(Di,{w:"150px",m:"12px 0"}),l.jsx(Di,{w:"200px"})]}),l.jsxs(v,{w:{base:"100%",lg:"unset"},gap:{base:"12px",lg:"28px"},flexDirection:{base:"column",lg:"row"},children:[l.jsx(Ki,{label:"Pool APR",value:l.jsx(ze,{poolInfo:s,placement:r?"bottom-end":"bottom",children:l.jsxs(v,{justify:"flex-end",align:"flex-end",gap:"4px",lineHeight:"14px",h:"14px",children:[l.jsx(q,{as:"span",fontSize:"14px",color:"text_caption",fontWeight:"500",cursor:s!=null&&s.farmingAprDisplay||((y=s==null?void 0:s.miningAprList)==null?void 0:y.length)>0?"help":"text",children:s!=null&&s.feeAndMiningAprDisplay?s==null?void 0:s.feeAndMiningAprDisplay:"--"}),(s==null?void 0:s.haveFarming)&&(s==null?void 0:s.farmingAprDisplay)&&(s==null?void 0:s.farmingAprDisplay)!=="--"&&l.jsxs(q,{fontSize:"12px",lineHeight:"12px",h:"12px",color:"primary",fontWeight:"500",children:["+",s==null?void 0:s.farmingAprDisplay]})]})}),loading:!(s!=null&&s.poolAddress)}),l.jsx(Ki,{label:"TVL",value:Xe(t,"$",2)||"",loading:b}),l.jsx(Ki,{label:"Volume (24H)",value:(s==null?void 0:s.volume24Display)||"",loading:!(s!=null&&s.poolAddress)}),l.jsx(Ki,{label:"Fees (24H)",value:(s==null?void 0:s.fees24Display)||"",loading:!(s!=null&&s.poolAddress)})]})]})}function Ct(){const{currentPosBaseInfo:i,posPoolsOriginalData:X,posPoolsRelatedData:e,posRewardsData:s,posLiquidityData:x}=Ri(),n=s[i==null?void 0:i.posId],{getTokenAmountValue:$}=Wi(),{transactionConfirmation:Z}=rt(),{preAdd:T,getAddTsPayload:p,getClmmCreateAddData:Y,getFarmsCreateAddData:_}=yt(),{getTokenALock:R,getTokenBLock:z}=ae(),{getCurrentPosBaseInfo:u}=_e(),{setTokenAmountAfterA:j,setTokenAmountAfterB:o,currentPoolSqrtPrice:r,isFixedDisplayTokenA:t,setIsFixedDisplayTokenA:b,curPosContractPoolInfo:y,currentPosDetailTab:g,isPosDetailRefresh:H,useZapIn:E,isAutoClaim:C}=Li(),{getZapDepositToastInfo:K,getZapDepositTx:F,reCalculateZapData:D}=lt(),{preDepositeData:A,setZapAmount:f,setPreDepositeData:O}=gt(),[ti,N]=a.useState(!1),[ii,li]=a.useState(""),[d,M]=a.useState(""),[k,V]=a.useState(""),[h,G]=a.useState(""),J=a.useMemo(()=>x[i==null?void 0:i.posId],[x,i==null?void 0:i.posId]),ci=Bi(J==null?void 0:J.displayCoinAmountA,void 0,!0),xi=Bi(J==null?void 0:J.displayCoinAmountB,void 0,!0);a.useEffect(()=>{if(+k||+h){const m=+k,w=+h;j(oi(m).plus(ci).toString()),o(oi(w).plus(xi).toString())}else j(""),o("")},[k,h]);const S=i==null?void 0:i.displayTokenA,L=i==null?void 0:i.displayTokenB,{mevProtect:U,maxCapForGas:Zi,transactionMode:ni,customGasPrice:Hi,slippage:Ni,zapSlippage:Ei}=de(),{balanceInfo:gi}=ye(S),{balanceInfo:ri}=ye(L),Ii=$(S==null?void 0:S.coin_type,k),Pi=$(L==null?void 0:L.coin_type,h),[Fi,qi]=a.useState(""),Ui=a.useRef("");a.useEffect(()=>{console.log("ðŸš€ ~ usePosAddPage ~ uuid:",Fi),Ui.current=Fi},[Fi]);const hi=()=>{V(""),G(""),N(!1),qi("")},si=a.useMemo(()=>R(i,y==null?void 0:y.current_sqrt_price),[y==null?void 0:y.current_tick_index,i]),yi=a.useMemo(()=>z(i,y==null?void 0:y.current_sqrt_price),[y==null?void 0:y.current_tick_index,i]),Ti=i!=null&&i.isReverse?yi:si,Ai=i!=null&&i.isReverse?si:yi;a.useEffect(()=>{hi()},[Ti,Ai]);const Vi=Ye((m,w,ei)=>{var mi,_i;if(g!=="increase")return;const I=w?(mi=i==null?void 0:i.displayTokenA)==null?void 0:mi.decimals:(_i=i==null?void 0:i.displayTokenB)==null?void 0:_i.decimals,Qi=Ke(m,I),bi=i==null?void 0:i.tokenA,zi=i==null?void 0:i.tokenB,ie=i==null?void 0:i.lowerTick,Xi=i==null?void 0:i.upperTick,ai=i==null?void 0:i.isReverse,di={amount:Qi,tokenA:bi,tokenB:zi,isTokenA:ai?!w:w,lowerTick:ie,upperTick:Xi,curSqrtPrice:r,isReverse:ai,roundUp:!0};console.log("ðŸš€ ~ debouncedPreAdd ~ params:",di);const{displayCoinAmountA:ji,displayCoinAmountB:Gi,tokenMaxA:Si,tokenMaxB:vi}=T(di);Ui.current===ei?(li(Si),M(vi),w?G(Gi||""):V(ji||"")):hi(),N(!1)},500),ki=()=>{if((k||h)&&P(i)){console.log("ðŸš€ ~ reCalculateResult ~ currentPosBaseInfo:",i);const m=t?k:h;if(+m){const w=ke();qi(w),Vi(m,t,w)}}};a.useEffect(()=>{g=="increase"&&H&&ki()},[H]);const Oi=(m,w)=>{if(console.log("ðŸš€ ~ handleAmountChange ~ amount:",!m,+m,m),!m){hi();return}if(b(w),w?V(m):G(m),+m){N(!0);const ei=ke();qi(ei),console.log("ðŸš€ ~ handleAmountChange ~ params:",m),Vi(m,w,ei)}else w?G(""):V("")},{currentAccount:c}=me(),B=a.useMemo(()=>{const m={text:"Add More Liquidity",disabled:!1};return c!=null&&c.address?!+k&&!+h?(m.text="Enter an amount",m.disabled=!0,m):!Ti&&k&&oi(k).gt((gi==null?void 0:gi.balanceFormat)||0)?(m.disabled=!0,m.text=`Insufficient ${Mi(S==null?void 0:S.symbol,10)} Balance`,m):!Ai&&h&&oi(h).gt((ri==null?void 0:ri.balanceFormat)||0)?(m.disabled=!0,m.text=`Insufficient ${Mi(L==null?void 0:L.symbol,10)} Balance`,m):((!si&&!yi&&(!+k||!+h)||(i==null?void 0:i.posType)=="burn")&&(m.disabled=!0),m):(m.text="Connect Wallet",m.disabled=!1,m)},[k,h,gi,ri,c==null?void 0:c.address]),{signAndExecuteTransaction:W}=xt(),{getContractPoolInfo:wi}=st(),[Ji,ui]=a.useState(!1),{fetchAccountBalance:pi}=ve(),{showInsufficientBalanceToast:Ce}=ht(),De=async()=>{var ei;ui(!0);let m,w;try{let I,Qi,bi;const zi=(ei=n||[])==null?void 0:ei.reduce((ai,di)=>(oi(di==null?void 0:di.amount_owed).gt(0)&&ai.push(di.coin_address),ai),[]);if(E)bi=K(),Z(bi),I=await F(i==null?void 0:i.lowerTick,i==null?void 0:i.upperTick,(i==null?void 0:i.posType)=="farms",{pos_id:(i==null?void 0:i.posType)=="farms"?i==null?void 0:i.id:i==null?void 0:i.posId,collect_fee:C,collect_rewarder_types:C?zi:[]});else{const ai=t?k:h,di=t?S.decimals:L.decimals,ji=oi(ai).mul(fe.pow(10,di)).toString(),Gi=i!=null&&i.isReverse?!t:t,Si=i==null?void 0:i.lowerTick,vi=i==null?void 0:i.upperTick,mi=y==null?void 0:y.current_tick_index;mi!==void 0&&Si!==void 0&&vi!==void 0&&(mi>=Si&&mi<=vi?(m=Gi?ji:ii,w=Gi?d:ji):mi>vi?(m=0,w=ji):mi<Si&&(m=ji,w=0)),console.log("ðŸš€ ~ toAdd ~ lowerTick:",Si,vi,mi),console.log("ðŸš€ ~ toAdd ~ amount_a:",i,m,w),console.log("ðŸš€ ~ toAdd ~ rewarderCoinTypes:",n,zi);const _i={poolAddress:i==null?void 0:i.clmmPool,coinTypeA:i==null?void 0:i.coinTypeA,coinTypeB:i==null?void 0:i.coinTypeB,amountA:m,amountB:w,fixAmountA:Gi,lowerTick:i==null?void 0:i.lowerTick,upperTick:i==null?void 0:i.upperTick,currentSqrtPrice:r,posType:i==null?void 0:i.posType,rewarderCoinTypes:zi,posIndex:i==null?void 0:i.index,posId:(i==null?void 0:i.posType)=="farms"?i==null?void 0:i.id:i==null?void 0:i.posId,isAutoClaim:C};(i==null?void 0:i.posType)=="farms"&&(_i.farmsPoolId=i==null?void 0:i.farmsPool),bi={getShowInfo:(Me,ee)=>{const ne="Add "+[fi(k,S==null?void 0:S.symbol),fi(h,L==null?void 0:L.symbol)].filter(Boolean).join(" and "),Yi={modalDescriptionText:ne,toastTitleText:ne};if(Me==="success"){let oe=k,ce=h;ee&&(oe=re(ee,S)||k,ce=re(ee,L)||h);const xe="Add "+[fi(oe,S==null?void 0:S.symbol),fi(ce,L==null?void 0:L.symbol)].filter(Boolean).join(" and ");Yi.toastDescriptionContent=xe,Yi.modalDescriptionText=xe,Yi.toastTitleText="Supplied Successful"}return Yi}},Z(bi),console.log("ðŸš€ ~ toAdd ~ params:",_i);const Ci=await p(_i);I=Ci==null?void 0:Ci.tx,Qi=Ci==null?void 0:Ci.msafeParams}const ie={pool:i==null?void 0:i.clmmPool,lower:i==null?void 0:i.lowerTick,upper:i==null?void 0:i.upperTick,coinTypeA:i==null?void 0:i.coinTypeA,coinTypeB:i==null?void 0:i.coinTypeB,amountA:m,amountB:w,currentSqrtPrice:r,slippage:Ni,zapSlippage:Ei,farmsPoolId:(i==null?void 0:i.posType)=="farms"?i==null?void 0:i.farmsPool:void 0,txAction:E?"increaseLiquidity-zap":"increaseLiquidity"},Xi=await W(I,bi,{useMev:U,useFastMode:ni==="Fast Mode",maxCapForGas:Zi,customGasPrice:Hi,msafeParams:Qi,trackData:ie});console.log("ðŸš€ ~ toClaim ~ res:",Xi),Xi?(pi(),hi(),f(""),u(c==null?void 0:c.address,i==null?void 0:i.id,!0)):i&&wi(i==null?void 0:i.clmmPool).then(ai=>{console.log("ðŸš€ ~ toClaim ~ res:",ai),E?D():ki()}),ui(!1)}catch(I){console.log("ðŸš€ ~ toClaim ~ error:",I),E?D():ki(),Ce(String(I)),ui(!1)}};return a.useEffect(()=>{if(g==="increase"&&E){if(A!=null&&A.amount_a||A!=null&&A.amount_b){const m=i==null?void 0:i.tokenA,w=i==null?void 0:i.tokenB,ei=ge(A==null?void 0:A.amount_a,m==null?void 0:m.decimals),I=ge(A==null?void 0:A.amount_b,w==null?void 0:w.decimals);V(i!=null&&i.isReverse?I:ei),G(i!=null&&i.isReverse?ei:I);return}V(""),G("")}},[E,A,i==null?void 0:i.isReverse]),a.useEffect(()=>(V(""),G(""),()=>{O(void 0)}),[]),{tokenAmountA:k,tokenAmountB:h,reCalculateResult:ki,preAddLoading:ti,preAdd:T,getAddTsPayload:p,displayTokenA:S,displayTokenB:L,tokenABalanceInfo:gi,tokenBBalanceInfo:ri,tokenAmountValueA:Ii,tokenAmountValueB:Pi,handleAmountChange:Oi,resetInputAmount:hi,btnStatusText:B,toAdd:De,isAddLoading:Ji,showTokenALock:si,showTokenBLock:yi,showDisplayTokenALock:Ti,showDisplayTokenBLock:Ai,getClmmCreateAddData:Y,getFarmsCreateAddData:_,currentPoolSqrtPrice:r}}function Dt(){const{currentPosBaseInfo:i,posPoolsRelatedData:X,posApiPoolData:e}=Ri(),{currentAccount:s,onWalletModal:x}=me(),{isFixedDisplayTokenA:n,curPosContractPoolInfo:$,useZapIn:Z,currentPosPoolInfo:T,isAutoClaim:p,setIsAutoClaim:Y}=Li(),{tokenAmountA:_,tokenAmountB:R,displayTokenA:z,displayTokenB:u,tokenABalanceInfo:j,tokenBBalanceInfo:o,tokenAmountValueA:r,tokenAmountValueB:t,handleAmountChange:b,preAddLoading:y,btnStatusText:g,toAdd:H,isAddLoading:E,showDisplayTokenALock:C,showDisplayTokenBLock:K,resetInputAmount:F,currentPoolSqrtPrice:D}=Ct();a.useEffect(()=>()=>{F()},[]);const{getTokenAmountValue:A}=Wi(),f=A(z==null?void 0:z.coin_type,_,"--"),O=A(u==null?void 0:u.coin_type,R,"--"),ti=f=="--"||O=="--"?"--":$i(r).plus(t).toString();X[i==null?void 0:i.posId];const{currentApiPoolInfo:N}=pt(i,e);return l.jsxs(Q,{w:"100%",gap:"16px",children:[l.jsxs(Q,{w:"100%",gap:"16px",p:{base:"0 8px 16px",lg:"0 16px 16px"},bg:"card_bg",borderRadius:"0px 0px 16px 16px",children:[l.jsxs(pe,{w:"100%",position:"relative",children:[(N==null?void 0:N.haveZap)&&(i==null?void 0:i.posType)!=="burn"&&!C&&!K&&l.jsx(at,{action:"Deposit",resetInputAmount:F}),Z?l.jsx(dt,{action:"Deposit",apiPoolInfo:N,currentSqrtPrice:D,lowerTick:i==null?void 0:i.lowerTick,upperTick:i==null?void 0:i.upperTick}):l.jsx(l.Fragment,{children:l.jsx(kt,{from:{wrapStyle:{h:"108px",borderRadius:"12px"},balance:(j==null?void 0:j.balanceFormat)||"",value:_,amountValue:r,loading:!n&&y,onChange:ii=>{b(ii,!0)},placeholder:"0.0",token:z,lock:{isLock:i&&$&&C,style:{borderRadius:"12px"}},rightJustify:"space-around"},to:{wrapStyle:{h:"108px",borderRadius:"12px"},balance:(o==null?void 0:o.balanceFormat)||"",value:R,amountValue:t,loading:n&&y,onChange:ii=>{b(ii,!1)},placeholder:"0.0",token:u,lock:{isLock:i&&$&&K,style:{borderRadius:"12px"}},rightJustify:"space-around"},iconHover:!1,iconParams:C||K?void 0:{xlinkHref:"#icon-icon_add",svgFill:"text_caption"},lock:{isLock:!i||!$||i&&(i==null?void 0:i.posType)=="burn",text:i&&(i==null?void 0:i.posType)=="burn"?"Your liquidity has been permanently locked":void 0,style:{h:"224px",borderRadius:"12px"}}})})]}),l.jsx(bt,{checked:p,onChange:()=>{Y(!p)}}),Z?l.jsx(mt,{action:"Deposit",onClick:H,isPositionStyle:!0,hideDepositRatio:!0,otherLoading:E,isReverse:i==null?void 0:i.isReverse}):l.jsxs(l.Fragment,{children:[l.jsx(le,{onClick:()=>{s?H():x(!0)},isLoading:E,disabled:g.disabled||E||(i==null?void 0:i.isFrozen),w:"100%",h:"56px",fontSize:"20px",fontWeight:"500",children:g.text}),ti&&l.jsxs(v,{w:"100%",justify:"space-between",children:[l.jsx(q,{children:"Total Amount"}),l.jsx(q,{color:"text_caption",children:Be(ti,2)})]})]})]}),(i==null?void 0:i.posType)!=="burn"&&l.jsx(nt,{haveFarming:T==null?void 0:T.haveFarming})]})}function Mt({direct:i,minPriceForDate:X,maxPriceForDate:e}){const{currentPosBaseInfo:s}=Ri(),{currentPosPoolInfo:x,curPosContractPoolInfo:n}=Li(),{setContractPoolInfo:$,setApiPoolInfo:Z}=Te(),{lowerTickData:T,upperTickData:p,setLowerTickData:Y,setUpperTickData:_}=$e();Ie(()=>{Z(x)},[x]);const R=(b,y,g)=>{var f,O;const H=(f=g==null?void 0:g.tokenA)==null?void 0:f.decimals,E=(O=g==null?void 0:g.tokenB)==null?void 0:O.decimals;let C;Math.abs(b)==Math.abs(Pe.getMinIndex(Number(g.tickSpacing)))?C=y==="lower"?"0":"âˆž":C=se.tickIndexToPrice(b,H,E).toString();const K=C==="âˆž"?"âˆž":Bi(C,6),F=At(C),D=F==="âˆž"?"âˆž":Bi(F,6),A={id:y,tokenA:g==null?void 0:g.tokenA,tokenB:g==null?void 0:g.tokenB,tick:b,price:C,displayPrice:K,reversePrice:F,displayReversePrice:D,tickSpacing:g==null?void 0:g.tickSpacing,pool:g==null?void 0:g.poolAddress};y==="lower"?Y({...A}):_({...A})},{getCurrentPrice:z}=ot();a.useEffect(()=>{s!=null&&s.lowerTick&&(n!=null&&n.current_sqrt_price)&&(x!=null&&x.poolAddress)&&(R(s==null?void 0:s.lowerTick,"lower",{...x,tickSpacing:n.tickSpacing}),R(s==null?void 0:s.upperTick,"upper",{...x,tickSpacing:n.tickSpacing}),z(n==null?void 0:n.current_sqrt_price,x,n==null?void 0:n.current_tick_index),$(n))},[s==null?void 0:s.lowerTick,n==null?void 0:n.current_sqrt_price,x==null?void 0:x.poolAddress]);const u=a.useMemo(()=>(s==null?void 0:s.posId)&&(T==null?void 0:T.pool)&&(p==null?void 0:p.pool),[T==null?void 0:T.pool,p==null?void 0:p.pool,s==null?void 0:s.posId]),{isPosDetailRefresh:j}=Li(),{contractPoolInfo:o,apiPoolInfo:r}=Te(),{getFormattedData:t}=We();return a.useEffect(()=>{j&&o!=null&&o.poolAddress&&(o==null?void 0:o.poolAddress)===(r==null?void 0:r.poolAddress)&&(console.log("Test Depth Data###LiquidityRangeChart contractPoolInfo: ",o),console.log("Test Depth Data###LiquidityRangeChart apiPoolInfo1: ",r),console.log("Test Depth Data###LiquidityRangeChart contractPoolInfo?.poolAddress: ",o==null?void 0:o.poolAddress),t({poolAddress:o==null?void 0:o.poolAddress,tokenA:r==null?void 0:r.tokenA,tokenB:r==null?void 0:r.tokenB,tickSpacing:o==null?void 0:o.tickSpacing,currentTickIndex:o==null?void 0:o.current_tick_index,liquidity:o==null?void 0:o.liquidity,feeRate:$i(r==null?void 0:r.feeRate).mul(100).toString()||(o==null?void 0:o.fee_rate)}))},[j,o==null?void 0:o.poolAddress,r==null?void 0:r.poolAddress]),l.jsx(pe,{className:"chart-block",w:"260px",h:"104px",mb:"8px",overflow:"hidden",children:u?l.jsx(Ze,{isFrom:"position",handleClickRefresh:()=>{},direct:i,minPriceData:i?T:p,maxPriceData:i?p:T,dashedMarkerLine:[X,e],readonly:!0}):l.jsx(Le,{justify:"center",align:"center",children:l.jsx(Re,{src:He,w:"100px",h:"100px"})})})}function Lt({positionApr:i,isAprLoading:X}){var O,ti,N,ii,li;const{currentPosBaseInfo:e,posPoolsRelatedData:s,posPoolsOriginalData:x,poolRangeObj:n,posApiPoolData:$,posLiquidityData:Z}=Ri(),T=$[e==null?void 0:e.clmmPool],p=s[e==null?void 0:e.posId],Y=a.useMemo(()=>{console.log("ðŸš€ ~ leverage ~ currentPosPoolsRelatedData:",p);const d=p==null?void 0:p.minPriceOrigin,M=p==null?void 0:p.maxPriceOrigin;return d!=="0"&&M!=="âˆž"?it(1/(1-Number((d/M)**.25)),2)+"x":"1x"},[p==null?void 0:p.minPriceOrigin,p==null?void 0:p.maxPriceOrigin]),_=a.useMemo(()=>e?[e==null?void 0:e.displayTokenA,e==null?void 0:e.displayTokenB].filter(Boolean).map(d=>({label:d==null?void 0:d.symbol,key:d==null?void 0:d.coin_type,isToken:!0,imgInfo:{src:d==null?void 0:d.logo_url,w:"16px",h:"16px",coinType:d?d==null?void 0:d.coin_type:"",showTagWidth:"8px",showTagHeight:"8px"}})):[],[(O=e==null?void 0:e.displayTokenA)==null?void 0:O.symbol,(ti=e==null?void 0:e.displayTokenB)==null?void 0:ti.symbol]),[R,z]=a.useState();a.useEffect(()=>{var d;if(e){const M=(d=e==null?void 0:e.displayTokenA)==null?void 0:d.coin_type;z(M)}},[e==null?void 0:e.clmmPool]);const u=a.useMemo(()=>{var d;return R===((d=e==null?void 0:e.tokenA)==null?void 0:d.coin_type)},[R,(N=e==null?void 0:e.tokenA)==null?void 0:N.coin_type]),[j,o]=a.useState(void 0),r=d=>{var M;o(j==null?!1:!j),d&&(d!=null&&d.coin_type)?z(d==null?void 0:d.coin_type):z((M=_==null?void 0:_.find(k=>k.key!==R))==null?void 0:M.key)},t=a.useMemo(()=>{var d,M,k,V;return!(e!=null&&e.tokenA)||!(e!=null&&e.tokenB)?"":u?`${Mi((d=e==null?void 0:e.tokenB)==null?void 0:d.symbol,10)} per ${Mi((M=e==null?void 0:e.tokenA)==null?void 0:M.symbol,10)}`:`${Mi((k=e==null?void 0:e.tokenA)==null?void 0:k.symbol,10)} per ${Mi((V=e==null?void 0:e.tokenB)==null?void 0:V.symbol,10)}`},[u,e==null?void 0:e.tokenA,e==null?void 0:e.tokenB]),[b,y]=a.useState({type:"30D",key:"month"}),[g,H]=a.useState(""),[E,C]=a.useState("");a.useEffect(()=>{var k,V,h;let d="",M="";if(P(n)&&P(e)&&P(b)){const G=(k=n[e==null?void 0:e.clmmPool])==null?void 0:k.ranges;if(console.log("ðŸš€ðŸš€ðŸš€ ~ PositionChartInfo.tsx:94 ~ useEffect ~ rangArr:",G),!G)return;const J=Object.fromEntries(G==null?void 0:G.map(U=>[U==null?void 0:U.dateType,[se.tickIndexToPrice(U==null?void 0:U.lower,e==null?void 0:e.tokenA.decimals,e==null?void 0:e.tokenB.decimals).toString(),se.tickIndexToPrice(U==null?void 0:U.upper,e==null?void 0:e.tokenA.decimals,e==null?void 0:e.tokenB.decimals).toString()]])),ci=(V=J[b==null?void 0:b.key])==null?void 0:V[0],xi=u?ci:$i(1).div(ci).toString(),S=(h=J[b==null?void 0:b.key])==null?void 0:h[1],L=u?S:$i(1).div(S).toString();d=he(xi,6),M=he(L,6)}else d="-",M="-";H(d),C(M)},[u,b.key,n,e]),a.useMemo(()=>{if(P(p)&&P(T)&&P(n)){const d=n[e==null?void 0:e.clmmPool];if(d)return d==null?void 0:d.ranges.reduce((k,V)=>(k[V.dateType]=V,k),{})}},[p,T,e,b==null?void 0:b.key,n]);const{getPosIsActive:K}=ae();a.useMemo(()=>{var d;return K(e,(d=x==null?void 0:x[(e==null?void 0:e.clmmPool)||""])==null?void 0:d.current_sqrt_price)},[e,x]);const{getTokenAmountValue:F}=Wi(),D=Z[e==null?void 0:e.posId],A=F((ii=e==null?void 0:e.displayTokenA)==null?void 0:ii.coin_type,D==null?void 0:D.displayCoinAmountA),f=F((li=e==null?void 0:e.displayTokenB)==null?void 0:li.coin_type,D==null?void 0:D.displayCoinAmountB);return a.useMemo(()=>$i(A).plus(f).toString(),[A,f]),l.jsxs(Q,{w:"100%",align:"flex-start",p:{base:"12px 8px",lg:"20px"},bg:"bg_secondary",borderRadius:"16px",children:[l.jsxs(v,{w:"100%",justify:"space-between",children:[l.jsx(q,{color:"text_caption",fontSize:"16px",children:"Price range"}),(_==null?void 0:_.length)>0&&l.jsx(Se,{type:"outlineTab",tabList:_,currentTab:R,handleChangeTab:d=>r(d),wrapStyle:{h:"32px",p:"3px",border:"1px solid",borderColor:"border",borderRadius:"8px",gap:"4px",zIndex:"99"},itemStyle:{h:"24px",p:"4px 8px",borderRadius:"4px",gap:"4px"}})]}),l.jsxs(v,{gap:{base:"20px",lg:"40px"},w:"100%",align:"flex-end",justify:"space-between",p:"8px 0",flexDirection:{base:"column",lg:"row"},children:[l.jsxs(Q,{w:{base:"100%",lg:"unset"},align:"center",justify:"center",pb:"2px",children:[l.jsx(Mt,{direct:u,minPriceForDate:g,maxPriceForDate:E}),l.jsxs(v,{children:[l.jsx(Ee,{borderRadius:"4px",border:"1px solid",borderColor:"border",w:"20px",h:"20px",color:"text_caption",children:l.jsx(Fe,{w:"14px",border:"1px dashed"})}),l.jsxs(q,{color:"primary_gray",fontSize:"12px",children:[b==null?void 0:b.type," Price Range"]})]}),l.jsxs(q,{color:"text_caption",textAlign:"center",fontSize:"12px",lineHeight:"12px",children:[u?g:E,"Â -Â ",u?E:g]})]}),l.jsxs(Q,{w:{base:"100%",lg:"calc(100% - 220px)"},gap:{base:"16px",lg:"20px"},children:[l.jsxs(v,{mt:"8px",align:{base:"center",lg:"flex-start"},children:[l.jsx(q,{color:"primary_gray",children:"Current Price"}),l.jsx(Tt,{posId:(e==null?void 0:e.posId)||"",displayTokenA:e==null?void 0:e.displayTokenA,displayTokenB:e==null?void 0:e.displayTokenB,isChangeDirect:j,handleDirect:r,haveChangeIcon:!1})]}),l.jsxs(v,{w:"100%",bg:"card_bg",borderRadius:"12px",p:"16px 20px",justify:"space-between",children:[l.jsxs(Q,{w:"50%",children:[l.jsx(q,{color:"primary_gray",fontSize:"12px",children:"Min Price"}),l.jsx(Di,{isLoaded:!!(p!=null&&p.minPrice)&&!!(p!=null&&p.minPriceResever),children:l.jsx(q,{color:"text_caption",whiteSpace:"nowrap",children:j||j==null?`${p==null?void 0:p.minPrice} `:`${p==null?void 0:p.minPriceResever}`})}),l.jsx(q,{color:"primary_gray",fontSize:"12px",children:t})]}),l.jsxs(Q,{w:"50%",children:[l.jsx(q,{color:"primary_gray",fontSize:"12px",children:"Max Price"}),l.jsx(Di,{isLoaded:!!(p!=null&&p.maxPrice)&&!!(p!=null&&p.maxPriceResever),children:l.jsx(q,{color:"text_caption",whiteSpace:"nowrap",children:j||j==null?` ${p==null?void 0:p.maxPrice}`:`${p==null?void 0:p.maxPriceResever}`})}),l.jsx(q,{color:"primary_gray",fontSize:"12px",children:t})]})]}),l.jsxs(v,{w:"100%",flexDirection:{base:"column",lg:"row"},justify:"space-between",children:[l.jsx(be,{label:"APR",tooltip:"APR based on the daily yield accrued by this position. Past performance is not indicative of future results. Calculations are an estimate and only for reference.",wrapStyle:{flexDir:{base:"row",lg:"column"},align:{base:"center",lg:"flex-start"},width:{base:"100%",lg:"unset"},gap:"2px"},children:l.jsx(Di,{isLoaded:!!p,h:"14px",children:l.jsx(q,{color:"primary",children:i??"--"})})}),l.jsx(be,{label:"Leverage",tooltip:"This parameter indicates the concentration rate of your liquidity relative to a full range position.",wrapStyle:{flexDir:{base:"row",lg:"column"},align:{base:"center",lg:"flex-end"},width:{base:"100%",lg:"unset"},gap:"2px"},children:l.jsx(Di,{isLoaded:!!Y&&!!p,children:l.jsx(q,{color:"primary",children:Y})})})]})]})]})]})}function Bl(){var Ai,Vi,ki,Oi;const i=ue(),{fetchAccountBalance:X}=ve(),{currentAccount:e}=me(),{position_nft_id:s,posTab:x}=qe(),{getCurrentPosBaseInfo:n,getCurrentPosByPosId:$,getPoolLiquiditySnapshot:Z}=_e(),{curPosContractPoolInfo:T,currentPosDetailTab:p,currentPosPoolInfo:Y,setCurrentPosDetailTab:_,setCurrentPosPoolInfo:R,setCurrentPoolSqrtPrice:z,setCurPosContractPoolInfo:u,setIsPosDetailRefresh:j,setUseZapIn:o}=Li(),{posPoolsRelatedData:r,currentPosBaseInfo:t,setCurrentPosBaseInfo:b,farmsPosRewardsData:y,posRewardsData:g,posLiquidityData:H}=Ri();(((Ai=r[t==null?void 0:t.posId])==null?void 0:Ai.displayFee)||"--")+"";const E=[{label:"Increase",value:"increase"},{label:"Remove",value:"remove"}],C=(c=!1)=>{e!=null&&e.address&&s&&n(e==null?void 0:e.address,s,c)};a.useEffect(()=>{console.log("ðŸš€ ~ PositionDetail ~ position_nft_id:",s),C()},[e==null?void 0:e.address,s]),a.useEffect(()=>{console.log("ðŸš€ ~ PositionHistory ~ currentPosBaseInfo?.id:",t==null?void 0:t.id)},[t==null?void 0:t.id]);const{fetchTokenPrices:K}=Wi(),F=y[t==null?void 0:t.id],D=g[t==null?void 0:t.posId],A=()=>{var Ji,ui;const c=(D==null?void 0:D.map(pi=>pi==null?void 0:pi.coin_address))||[],B=(F==null?void 0:F.map(pi=>pi==null?void 0:pi.rewarder_type))||[],W=[(Ji=t==null?void 0:t.tokenA)==null?void 0:Ji.coin_type,(ui=t==null?void 0:t.tokenB)==null?void 0:ui.coin_type].filter(Boolean),wi=Array.from(new Set([...c,...W,...B]));K(wi)};a.useEffect(()=>{A()},[t==null?void 0:t.posId,D==null?void 0:D.length,F==null?void 0:F.length]);const{getPoolList:f}=wt(),O=async()=>{if(!(t!=null&&t.clmmPool))return;const c=await f({pool:t==null?void 0:t.clmmPool,display_all_pools:!0});if(console.log("ðŸš€ ~ getPoolData ~ poolInfo:",t,c),c)return R(c==null?void 0:c.list[0])},{getPosPoolsOriginalObj:ti,getPosPoolsRelatedData:N}=Ue(),{getPosLiquidityData:ii}=Oe(),li=async()=>{if(t!=null&&t.clmmPool){const c=await $(e==null?void 0:e.address,s);if(P(c)&&c){const B=await ti([c]);if(P(B)){console.log("ðŸš€ ~ handleGetPrice ~ contractPoolInfo:",c,B),N([c],B);const W=B[c==null?void 0:c.clmmPool];console.log("ðŸš€ ~ handleGetPrice ~ [currentPosBaseInfo?.clmmPool]:",W,T),(W==null?void 0:W.current_sqrt_price)!==(T==null?void 0:T.current_sqrt_price)&&ii([c],B),z(W==null?void 0:W.current_sqrt_price),u(W)}}}},{setFromCoin:d,setToCoin:M,fromCoin:k,toCoin:V}=jt();a.useEffect(()=>{O(),li();let c;return t!=null&&t.clmmPool&&(c=setInterval(()=>{li()},2e4)),t!=null&&t.displayTokenA&&(t!=null&&t.displayTokenB)&&(d(t==null?void 0:t.displayTokenA),M(t==null?void 0:t.displayTokenB)),console.log("ðŸš€ðŸš€ðŸš€ ~ PositionDetail.tsx:159 ~ useEffect ~ currentPosBaseInfo:",t),()=>{clearInterval(c),d(te.clmm_swap.from_coin),M(te.clmm_swap.to_coin)}},[t==null?void 0:t.clmmPool]),a.useEffect(()=>((!x||x=="increase")&&_("increase"),e!=null&&e.address&&X(),()=>{u(null),b(null),R(null),o(!1)}),[]);const h=a.useMemo(()=>r[t==null?void 0:t.posId],[r,t==null?void 0:t.posId]),G=a.useMemo(()=>(h==null?void 0:h.currentStatus)=="Active",[h]),J=a.useMemo(()=>(h==null?void 0:h.currentStatus)=="Inactive",[h]),ci=a.useMemo(()=>(h==null?void 0:h.currentStatus)!==void 0,[h]);a.useEffect(()=>{G||o(!1)},[G]),vt({onRpcChange:()=>{C(!0),li(),e!=null&&e.address&&X()}});const{isApp:xi}=je(),S=()=>{t!=null&&t.posId&&Z(t)},{setBackUrl:L}=de(),U=()=>{window.history.length>1?i(-1):i("/pools?tab=positions")},{getTokenAmountValue:Zi}=Wi(),ni=H[t==null?void 0:t.posId],Hi=Zi((Vi=t==null?void 0:t.displayTokenA)==null?void 0:Vi.coin_type,ni==null?void 0:ni.displayCoinAmountA),Ni=Zi((ki=t==null?void 0:t.displayTokenB)==null?void 0:ki.coin_type,ni==null?void 0:ni.displayCoinAmountB),Ei=a.useMemo(()=>oi(Hi).plus(Ni).toString(),[Hi,Ni]),[gi,ri]=a.useState(null),[Ii,Pi]=a.useState(null),[Fi,qi]=a.useState(null),{getClmmPositionDailyEarning:Ui}=ut(),[hi,si]=a.useState(!0),yi=async()=>{si(!0);try{const c=await Ui(t==null?void 0:t.posId,Ei);if(c){const{aprDisplay:B,dailyEarnUSDDisplay:W,originResult:wi}=c;console.log("ðŸš€ðŸš€ðŸš€ ~ PositionChartInfo.tsx:155 ~ handleGetPositionApr ~ originResult:",wi),ri(B),Pi(W),qi(wi)}si(!1)}catch{si(!1)}};a.useEffect(()=>{t!=null&&t.posId&&(oi(Ei).gt(0)?yi():si(!1))},[t==null?void 0:t.posId,Ei]);const Ti=()=>{console.log("ðŸš€ ~ handleRefresh ~ handleRefresh:"),j(!0),C(!0),O(),A(),X(),li(),yi(),setTimeout(()=>{j(!1)},1e3)};return l.jsxs(Q,{gap:"12px",w:"100%",pt:"20px",align:"flex-start",children:[l.jsxs(v,{w:"100%",justifyContent:"space-between",flexDirection:{base:"column-reverse",lg:"row"},children:[l.jsxs(v,{w:{base:"100%",lg:"unset"},justifyContent:"space-between",children:[l.jsx(St,{onClick:()=>{U()}}),((Oi=te)==null?void 0:Oi.env)==="testnet"&&!!(t!=null&&t.vestData)&&l.jsx(le,{h:"32px",borderRadius:"8px",onClick:S,children:"Print snapshot"}),xi&&l.jsxs(v,{children:[l.jsx(we,{}),l.jsx(Ae,{handleRefresh:Ti,isAutoRefresh:!0,refreshInterval:5,w:"28px",h:"28px",innerStyle:{bg:"none"}})]})]}),l.jsxs(v,{w:{base:"100%",lg:"unset"},children:[t!=null&&t.isFrozen?null:l.jsx(le,{w:{base:"100%",lg:"unset"},bg:"bg_secondary",fontSize:"14px",p:"0 16px",h:"32px",borderRadius:"8px",fontWeight:"500",variant:"outline",onClick:c=>{L(`/position-detail/${t==null?void 0:t.id}`),i(`/clmm?poolAddress=${t==null?void 0:t.clmmPool}`)},children:"Create a new position"}),!xi&&l.jsx(Ae,{handleRefresh:Ti,isAutoRefresh:!0,refreshInterval:5,w:"32px",h:"32px",innerStyle:{bg:"bg_secondary"}})]})]}),l.jsx(_t,{}),l.jsxs(v,{w:"100%",align:"flex-start",gap:{base:"12px",lg:"16px"},flexDirection:{base:"column-reverse",lg:"row"},children:[l.jsxs(Q,{w:{base:"100%",lg:"60%"},gap:{base:"12px",lg:"16px"},children:[l.jsx(Lt,{positionApr:J?"0%":ci?gi:null,isAprLoading:hi}),l.jsx(tt,{dailyEarnUSDDisplay:J?"$0":ci?Ii:null,originResult:Fi})]},`${t==null?void 0:t.posId}-posInfo`),l.jsxs(Q,{w:{base:"100%",lg:"40%"},gap:"0",children:[l.jsxs(v,{w:"100%",p:"0 16px 12px",bg:"card_bg",borderRadius:"16px 16px 0 0 ",children:[l.jsx(Se,{type:"borderTab",bg:"none",wrapStyle:{w:"100%",h:"60px",border:"none",bg:"none"},itemStyle:{w:{base:"50%",lg:"unset"},fontSize:"16px",mr:"28px"},tabList:E,currentTab:p=="increase"?"Increase":"Remove",handleChangeTab:c=>{_(c==null?void 0:c.value)}}),!xi&&l.jsx(we,{})]}),p=="increase"&&l.jsx(Dt,{}),p=="remove"&&l.jsx(ct,{})]})]})]})}const we=()=>l.jsx(v,{children:l.jsx(Ve,{slippageType:"liquidity",poolType:"clmm"})});export{Bl as default};
