{"version":3,"file":"RefreshButton-DtwRJDvy.js","sources":["../../../utils/src/interval.ts","../../../ui-kit/src/components/RefreshButton.tsx"],"sourcesContent":["type MockIntervalReturnType = {\n  clear: () => void\n}\n\nexport function mockInterval<T extends any[]>(\n  callback: (...args: T) => Promise<void> | void, // 支持异步函数\n  delay: number,\n  ...args: T // 接收任意数量的参数\n): MockIntervalReturnType {\n  let timerId: ReturnType<typeof setTimeout> | null = null // 使用 Node.js 的 Timeout 类型\n\n  const execute = async () => {\n    try {\n      await callback(...args) // 调用异步的回调\n    } catch (err) {\n      console.error('Callback error:', err)\n      clearTimeout(timerId!) // 在错误时清除定时器\n    }\n    timerId = setTimeout(execute, delay) // 递归调用 setTimeout\n  }\n\n  timerId = setTimeout(execute, delay)\n\n  return {\n    clear: () => {\n      if (timerId) {\n        clearTimeout(timerId)\n      }\n    }\n  }\n}\n\n// 使用示例\n// const asyncInterval = mockInterval(\n//   async (param: string) => {\n//     console.log(param)\n//     // 假设 fetchData 是异步函数\n//     await fetchData() // 异步操作\n//   },\n//   2000,\n//   'Async Hello' // 参数\n// )\n","import { cancelBubble, mockInterval } from '@cetus/utils'\nimport { Box, Center, CenterProps, Flex, FlexProps, Spinner } from '@chakra-ui/react'\nimport { useCallback, useEffect, useRef, useState } from 'react'\nimport Icon, { VariantType } from './Icon'\n\ninterface RefreshButtonProps extends CenterProps {\n  variant?: VariantType\n  handleRefresh: (isManual: boolean) => void\n  isAutoRefresh?: boolean\n  refreshInterval?: number // 自动刷新间隔时间, 单位秒\n  innerStyle?: FlexProps\n  isRefreshed?: boolean\n  iconStyle?: FlexProps\n}\n\nexport default function RefreshButton(props: RefreshButtonProps) {\n  const { variant, handleRefresh, isAutoRefresh, refreshInterval, innerStyle = {}, isRefreshed, iconStyle = {}, ...rest } = props\n  const [moveTransform, setMoveTransform] = useState(false)\n  const [rotation, setRotation] = useState(0)\n  const timeoutTimer = useRef<NodeJS.Timeout | null>(null)\n  const intervalTimer = useRef<any>(null)\n  const onRefresh = useCallback(\n    async (isManual: boolean) => {\n      setRotation(360)\n      setMoveTransform(true)\n      try {\n        await handleRefresh(isManual)\n      } catch (error) {\n        console.error('RefreshButton refresh error', error)\n        setMoveTransform(false)\n        setRotation(0)\n      }\n    },\n    [handleRefresh]\n  )\n\n  // 使用 useRef 存储最新函数\n  const latestOnRefresh = useRef(onRefresh)\n\n  useEffect(() => {\n    latestOnRefresh.current = onRefresh\n  }, [onRefresh])\n  const startTimer = useCallback(() => {\n    if (intervalTimer.current) {\n      intervalTimer.current()\n    }\n    if (isAutoRefresh && refreshInterval) {\n      const { clear } = mockInterval(() => {\n        latestOnRefresh.current?.(false)\n      }, refreshInterval * 1000)\n      intervalTimer.current = clear\n    }\n  }, [isAutoRefresh, refreshInterval])\n\n  const handleClick = useCallback(\n    async e => {\n      cancelBubble(e)\n      if (intervalTimer.current) {\n        intervalTimer.current()\n      }\n      await onRefresh(true)\n      startTimer()\n    },\n    [onRefresh, startTimer]\n  )\n\n  useEffect(() => {\n    startTimer()\n\n    return () => {\n      if (timeoutTimer.current) {\n        clearTimeout(timeoutTimer.current)\n        timeoutTimer.current = null\n      }\n      if (intervalTimer.current) {\n        intervalTimer.current()\n        intervalTimer.current = null\n      }\n    }\n  }, [startTimer])\n\n  useEffect(() => {\n    if (typeof isRefreshed == 'boolean') {\n      if (isRefreshed) {\n        setMoveTransform(false)\n        setRotation(0)\n      }\n    } else {\n      if (moveTransform) {\n        timeoutTimer.current = setTimeout(() => {\n          setMoveTransform(false)\n          setRotation(0)\n        }, 1000)\n      }\n    }\n    // 清理超时\n    return () => {\n      if (timeoutTimer.current) {\n        clearTimeout(timeoutTimer.current)\n        timeoutTimer.current = null\n      }\n    }\n  }, [moveTransform, isRefreshed])\n\n  return (\n    // <Tooltip label={<Text fontSize=\"12px\">Refresh</Text>} aria-label=\"Yield\">\n    <Center\n      h=\"40px\"\n      w=\"40px\"\n      borderRadius=\"8px\"\n      bg={innerStyle?.bg ? innerStyle?.bg : 'bg_secondary'}\n      border=\"1px solid\"\n      borderColor=\"border\"\n      cursor=\"pointer\"\n      onClick={handleClick}\n      _hover={{\n        color: 'text_caption',\n        svg: {\n          fill: 'text_caption'\n        }\n      }}\n      {...rest}\n    >\n      <Flex w=\"24px\" h=\"24px\" bg=\"checked_bg\" alignItems=\"center\" justifyContent=\"center\" borderRadius=\"4px\" {...innerStyle}>\n        <Box>\n          {moveTransform ? (\n            <Flex w=\"20px\" h=\"20px\" alignItems=\"center\" justifyContent=\"center\">\n              <Spinner\n                w=\"16px\"\n                h=\"16px\"\n                speed=\"1.2s\"\n                sx={{\n                  color: 'text_paragraph'\n                }}\n              />\n            </Flex>\n          ) : (\n            <Box>\n              <Icon {...iconStyle} xlinkHref=\"#icon-icon_refresh\" variant=\"gray\" />\n            </Box>\n          )}\n        </Box>\n      </Flex>\n    </Center>\n    // </Tooltip>\n  )\n}\n"],"names":["mockInterval","callback","delay","args","timerId","execute","err","RefreshButton","props","variant","handleRefresh","isAutoRefresh","refreshInterval","innerStyle","isRefreshed","iconStyle","rest","moveTransform","setMoveTransform","useState","rotation","setRotation","timeoutTimer","useRef","intervalTimer","onRefresh","useCallback","isManual","error","latestOnRefresh","useEffect","startTimer","clear","_a","handleClick","e","cancelBubble","jsx","Center","Flex","Box","Spinner","Icon"],"mappings":"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"}